function CameraTween(){this.origin={},this.destination={},this.current={},this.origin.x=0,this.origin.y=0,this.origin.zoom=0,this.running=!1,this.onFinish=null,this.speed=20}function ClosestSpot(){this.node=$("<div style='position: absolute;width: 60px; height: 60px;background-color: #ffffff20;bpx-sizing:border-box; border: 3px solid rgba(255, 255, 255, 0.7);border-radius: 100%'></div>"),$("#hotspots").append(this.node),this.proceedcd=0,this.visible=!0}function HotSpotEdit(e){this.hs=e,this.node=e.node;var t=this;this.playernode=$("body"),this.node.on("click",function(e){var i=Events.getPointerEvent(e);t.click(i)})}function Interpolate(){}function multiply(e,t,i,a,n,s,o,r,l,p,d,c,h,u,m,f,g,v,y,w,b,P,M,$,T,S,x,k,_,E,I,C){return[e*g+t*b+i*T+a*_,e*v+t*P+i*S+a*E,e*y+t*M+i*x+a*I,e*w+t*$+i*k+a*C,n*g+s*b+o*T+r*_,n*v+s*P+o*S+r*E,n*y+s*M+o*x+r*I,n*w+s*$+o*k+r*C,l*g+p*b+d*T+c*_,l*v+p*P+d*S+c*E,l*y+p*M+d*x+c*I,l*w+p*$+d*k+c*C,h*g+u*b+m*T+f*_,h*v+u*P+m*S+f*E,h*y+u*M+m*x+f*I,h*w+u*$+m*k+f*C]}function Matrix3D(e){this.entities=e||IDENTITY}function DummySpot(e){this.node=$("<div id='dummy"+e+"' style='position: absolute;'><div style='transform:translate(-50%, -100%);'><img src='/storage/collectibles/2.png' width='300'></div></div>"),$("#hotspots").append(this.node),this.no=e,this.node3D=new css3DNode("#dummy"+this.no)}function PlaneSpot3D(e,t){this.pos={},this.scale=1,this.node=$("<div id='dummy"+e+"' style='position: absolute;'></div>"),$("#hotspots").append(this.node),this.no=e,this.node3D=new css3DNode("#dummy"+this.no),this.layerMul=1,this.ry=0;var i=(new THREE.TextureLoader).load("https://"+window.PROJECT.host+t,function(e){const t=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,map:i,transparent:!0}),a=new THREE.PlaneGeometry(10,20,5,5);this.spotPlate=new THREE.Mesh(a,t),this.spotPlate.layers.set(sphereWebGLStatic.cycle),sphereWebGLStatic.self.preview.add(this.spotPlate)}.bind(this))}function Collectible3D(e){var t="collect-"+e.id,i="/storage/collectibles/"+e.image;void 0==e.settings&&(e.settings={}),this.sounds={collect:new AudioEffect("assets/audio/games/collect.mp3"),backpack:new AudioEffect("assets/audio/games/backpack.mp3")},this.sounds.collect.setVolume(.1),this.layerMul=1,this.c=e,this.pos={},this.scale=1,this.node=$("<div id='dummy"+t+"' style='position: absolute;'></div>"),$("#hotspots").append(this.node),this.no=t,this.node3D=new css3DNode("#dummy"+this.no),this.hovering=!1,this.ry=0,this.firstShow=!0;try{this.scale=.01*parseFloat(this.sphereSpot.data.record.settings.scale)}catch(a){}this.prepareStates(),void 0!=this.c.settings.layer&&this.setLayer(this.c.settings.layer),this.image=i;var n=(new THREE.TextureLoader).load("https://"+window.PROJECT.host+i,function(e){var t=n.image.width/n.image.height;const i=new THREE.MeshBasicMaterial({color:16777215,side:THREE.FrontSide,map:n,transparent:!0,needsUpdate:!0,depthWrite:!1});void 0!=this.c.settings.alpha&&(i.opacity=.01*parseFloat(this.c.settings.alpha));var a=n.image.width/n.image.height;const s=new THREE.PlaneGeometry(10,10/a,5,5);if(this.spotPlate=new THREE.Mesh(s,i),this.spotPlate.layers.set(sphereWebGLStatic.cycle),this.spotPlate.scale.set(this.scale,this.scale,this.scale),this.spotPlate.visible=!1,"deliver"==this.c.type){const o=document.createElement("canvas");var r=.03*parseFloat(this.c.settings.scale);t>=1?(o.width=256*t*r,o.height=256*r,o.height<32&&(o.width=32*t,o.height=32)):(o.width=256*r,o.height=256/t*r,o.width<32&&(o.width=32,o.height=32/t));const l=o.getContext("2d");l.drawImage(n.image,0,0,o.width,o.height);const p=l.getImageData(0,0,o.width,o.height);var d=this.addGlow(p.data,o.width,o.height);const c=new THREE.DataTexture(d,o.width,o.height);c.magFilter=THREE.LinearFilter,c.minFilter=THREE.LinearFilter,c.needsUpdate=!0;const h=new THREE.MeshBasicMaterial({color:16777215,side:THREE.FrontSide,map:c,transparent:!0,needsUpdate:!0,depthWrite:!1});h.blending=THREE.AdditiveBlending,h.opacity=.3;const u=new THREE.PlaneGeometry(10,10/a,5,5);this.spotPlateOutline=new THREE.Mesh(u,h),this.spotPlateOutline.layers.set(sphereWebGLStatic.cycle),this.spotPlateOutline.scale.set(this.scale,this.scale,this.scale),this.spotPlateOutline.visible=!1,void 0==Equipment.delivered[this.c.settings.accept]?this.spotPlate.material.opacity=.3:this.delivered=!0,sphereWebGLStatic.self.preview.add(this.spotPlateOutline)}sphereWebGLStatic.self.preview.add(this.spotPlate)}.bind(this));$("body").on("mouseup",this.mouseUp.bind(this))}function SpotMod(e,t,i){this.sphereSpot=e,this.parent=e.holder;var a="#0ae50d";switch(t){case"static":a="#55d7db";break;case"deliver":a="#e7a537"}this.handle=$("<div class='spot-handler' style='position:absolute; left: 0px; top: 0px;background-color:"+a+";padding: 7px;transform: translate(-50%, -50%);cursor:move;border-radius:20px;display: inline-block;pointer-events: all'><i class='fas fa-arrows-alt' style='font-size:20px;display:none;'></i></a><div class='label'>"+i+"</div></div>"),this.parent.appendUI(this.handle);var n=this;this.handle.on("mouseup",function(e){SpotHelper.currentSelection=n,$(".spot-handler .fas").hide(),n.handle.find(".fas").show(),$("body").trigger("edit.spot",n.sphereSpot)}),this.handle.on("mousedown",function(e){SpotHelper.currentSelection==n&&(n.dragging=!0,n.dragX=e.pageX,n.dragY=e.pageY,n.origin={x:n.sphereSpot.screen.x,y:n.sphereSpot.screen.y},n.dest={x:0,y:0},$("body").on("mousemove.spotmod",n.reposition.bind(n)),$("body").one("mouseup",function(e){n.dragging=!1,$("body").off("mousemove.spotmod"),$("body").trigger("edit.spot",n.sphereSpot)}))})}function SphereSpot(e,t,i){this.coords={x:t.out.x,y:t.out.y,z:t.out.z},this.sphere={x:t["in"].x,y:t["in"].y,z:t["in"].z},this.updatePosition=!0,this.visible=!0,this.holder=e,this.holder.sphereSpot=this,this.data=i,this.setPosition(this.coords,this.sphere)}function StateMachine(e,t){this.states={},this.transitions={},this.current="",this.context=e,this.payload=t}function TabGroup(e,t,i){this.prepends=[],this.name=e,this.appends=[],this.elements=[],this.enabled=i,this.order=t,this.enable=function(){this.enabled=!0},this.disable=function(){this.enabled=!1},this.prepend=function(e,t){void 0==t&&(t=this.prepends.length),this.prepends.push({e:e,p:t}),this.prepends.sort(function(e,t){return e.p<t.p?1:e.p>t.p?-1:0}),this.rebuild()},this.append=function(e,t){void 0==t&&(t=this.appends.length),this.appends.push({e:e,p:t}),this.appends.sort(function(e,t){return e.p<t.p?-1:e.p>t.p?1:0}),this.rebuild()},this.insertAt=function(e,t){if(e<this.prepends.length){var i={e:t,p:e};this.prepends.splice(e,0,i)}else{var i={e:t,p:e-this.prepends.length};this.appends.splice(e-this.prepends.length,0,i)}this.rebuild()},this.removeById=function(e){var t=!1;for(var i in this.prepends)if(this.prepends[i].e.id==e){t=i;break}t!==!1&&this.prepends.splice(i,1),t=!1;for(var i in this.appends)if(this.appends[i].e.id==e){t=i;break}t!==!1&&this.appends.splice(i,1),this.rebuild()},this.rebuild=function(){var e=[];for(var t in this.prepends)e.push(this.prepends[t].e);for(var t in this.appends)e.push(this.appends[t].e);this.elements=e},this.clear=function(){this.appends=[],this.prepends=[],this.rebuild()}}function Tween(e,t){this.func=e,this.finished=t,this.running=!1,this.origin={},this.destination={},this.current={},this.origin.x=0,this.origin.y=0,this.waits=0}function UIElement(e,t,i,a,n,s,o){void 0==s&&(s=0),this.id=n,this.place=o,this.type=void 0==i?0:i,this.folderwide=s,this.params=void 0==a?{}:a,this.uid=Date.now()+"-"+Math.round(1e4*Math.random()),this.node=$("<div class='uielement'><div class='container'><div style='background-color:#ffffff;color:#000000;padding:20px'>uielement</div></div></div>"),(Screen.md()||Screen.lg())&&$("#elements").append(this.node),player.cms&&(this.editor=new UIElementEdit(this)),void 0!=i&&void 0!=a&&this.build(a),this.calculateCoords(e,t),this.update();var r=this;$(window).resize(function(){r.calculateCoords(r.originX,r.originY),r.update()})}function UIElementEdit(e){this.hs=e,this.node=e.node;var t=this;this.playernode=$("#player"),this.node.on("click",function(e){var i=Events.getPointerEvent(e);t.click(i)})}function Vector3D(e,t,i){this.x=e,this.y=t,this.z=i,this.w=0}function VerticalList(e){var t=e.substr(1)+"_inner";this.items=[],this.nodeid=e,this.inner=$("<div id='"+t+"' style='position:absolute;left:0px;top:0px;width:100%;'></div>"),$(e).append(this.inner),this.node=$(this.inner),t="#"+t,this.loader=$("<div style='width:100%;height:100%;background-color:rgba(0,0,0,0.8);position:absolute;left:0px;top:0px;z-index:99999;color:#ffffff;font-size:16px;display:none;'><br><br><br><center>Ładowanie ...</center></div>"),$(e).append(this.loader),this.scroll=new Scroller(t,e)}function View(){}function onYouTubeIframeAPIReady(){AppEvent.on(player,"SOUND.MUTED",function(){YTPlayer.each(function(e,t){(Volume.yt.muted||Volume.master.muted)&&e.mute()})}),AppEvent.on(player,"VOLUME.SET",function(){YTPlayer.each(function(e,t){Volume.currentYTVolume()>0&&e.setVolume&&e.setVolume(Volume.currentYTVolume())})}),AppEvent.on(player,"SOUND.UNMUTED",function(){YTPlayer.each(function(e,t){Volume.yt.muted||Volume.master.muted||e.unMute()})})}function categoryList(){categoryListStatic=this}function css3DNode(e,t){this.forceRefresh=t,""!=e?this.element=$(e):this.element=!1,this.transforms=[],this.children=[],this.last=null,this.resetTransform=function(){this.transforms=[]},this.addChild=function(e){this.children.push(e)},this.getChildAt=function(e){return this.children[e]},this.swapChildren=function(e,t){var i=this.children[e];this.children[e]=this.children[t],this.children[t]=i},this.translate=function(e,t,i){obj={},obj.op="translate",obj.x=e,obj.y=t,obj.z=i,this.last=obj,this.transforms.push(obj)},this.scale=function(e,t,i){obj={},obj.op="scale",obj.x=e,obj.y=t,obj.z=i,this.last=obj,this.transforms.push(obj)},this.scale2D=function(e,t){obj={},obj.op="scale2D",obj.x=e,obj.y=t,this.last=obj,this.transforms.push(obj)},this.rotateX=function(e){obj={},obj.op="rotateX",obj.deg=e%360,this.last=obj,this.transforms.push(obj)},this.rotateY=function(e){obj={},obj.op="rotateY",obj.deg=e%360,this.last=obj,this.transforms.push(obj)},this.rotateZ=function(e){obj={},obj.op="rotateZ",obj.deg=e%360,this.last=obj,this.transforms.push(obj)},this.appendTransforms=function(e){for(var t=0;t<e.length;t++)this.transforms.push(e[t])},this.transformStack=function(){return this.transforms},this.applyTransformsWith=function(e){var t,i="";if(t=this.transforms,0!=e)for(var a=0;a<e.length;a++)t.push(e[a]);for(var a=0;a<this.children.length;a++)this.children[a].applyTransformsWith(t);if(0!=this.element){for(var a=0;a<t.length;a++)switch(obj=t[a],obj.op){case"translate":i+="translate3d("+obj.x+"px,"+obj.y+"px, "+obj.z+"px) ";break;case"rotateX":i+="rotateX("+obj.deg+"deg) ";break;case"rotateY":i+="rotateY("+obj.deg+"deg) ";break;case"rotateZ":i+="rotateZ("+obj.deg+"deg) ";break;case"scale":i+="scale3d("+obj.x+", "+obj.y+", "+obj.z+") ";break;case"scale2D":i+="scale("+obj.x+", "+obj.y+") "}if(this.element.css("transform",i),this.element.css("-webkit-transform",i),this.forceRefresh){this.element.get(0).offsetHeight}}},this.applyTransforms=function(){this.applyTransformsWith(!1)}}function cubeCssRenderer(e,t,i){this.ident=e,this.properties=t,this.paused=!1,this.loaded={a:0,b:0,c:0,d:0,e:0,f:0},this.wfix=!1,this.wfixname="",this.detectMobile()?(this.wfix=!0,this.wfixname="wfixmobile",cubeCssRendererStatic.sd=1280,this.planeWidth=960,this.halfimage=470,this.halfimage2=940):(cubeCssRendererStatic.sd=void 0!=Quality?Quality.current:2048,null!=navigator.userAgent.match(/webkit/i)?(this.wfix=!0,this.wfixname="wfix",this.planeWidth=3100,this.halfimage=1500,this.halfimage2=2500):(this.planeWidth=3e3,this.halfimage=1500,this.halfimage2=2500)),cubeCssRendererStatic.ident=e}function gallery3DView(e,t){this.ident=e,this.properties=t,this.showhelp=0,swipe=new swiper,swipe.setCenter(.5*$("#player").width(),.5*$("#player").height(),.5),player.bottomBar(!0),$("#info").hide()}function galleryView(e,t){for(this.ident=e,this.properties=t,this.max=1,this.menu=null,this.menuOverlay=null,this.wWidth=0,this.wHeight=0,this.menu_title="",this.autoplaying=!1,this.autotimer=null;void 0!=this.properties.properties["image_"+this.max]&&""!=this.properties.properties["image_"+this.max];)this.max++;this.max--,this.wWidth=$(window).width(),this.wHeight=$(window).height(),this.playnode=$("<div></div>"),$("#overlay").append(this.playnode),player.bottomBar(!1),$("#info").hide()}function RadarMarker(e,t,i){this.latlng=e,this.args=i,this.offset=160,this.setMap(t);var a=this;setInterval(function(){a.process()},10)}function menuList(){menuListStatic=this}function multiMenuList(){menuListStatic=this,$("#panos").html("")}function multiMenuListNS(){menuListStatic=this,$("#panos").html("")}function panoramaGridView(e,t){this.ident=e,this.properties=t,swipe=new swiper,this.pano=new css3DNode(""),this.a=new css3DNode("#_a"),this.a.translate(0,0,-375),this.pano.addChild(this.a),this.b=new css3DNode("#_b"),this.b.translate(375,0,0),this.b.rotateY(-90),this.pano.addChild(this.b),this.c=new css3DNode("#_c"),this.c.translate(0,0,375),this.c.rotateY(-180),this.pano.addChild(this.c),this.d=new css3DNode("#_d"),this.d.translate(-375,0,0),this.d.rotateY(-270),this.pano.addChild(this.d),this.e=new css3DNode("#_e"),this.e.translate(0,-375,0),this.e.rotateX(-90),this.pano.addChild(this.e),this.f=new css3DNode("#_f"),this.f.translate(-1,372,0),this.f.rotateX(90),this.pano.addChild(this.f)}function panoramaHotSpot(e,t,i){switch(this.properties=e,this.helper=null,this.helperLeft=null,this.helperRight=null,this.tag="default",this.clicks=0,this.morphHelperState=!1,this.morphHelperPosition=0,this.plate=null,this.lastHelperY=null,this.preventShowingInfo=!1,this.updatePosition=!0,this.canProceed=!0,this.display=e.display,this.valign=!0,this.no=t,this.shown=0,this.north=i,this.hovericon="",this.icon="",this.hovering=!1,this.hoveringdt=0,this.visible=!1,void 0==this.properties.angle&&(this.properties.angle=0),void 0==this.properties.transition&&(this.properties.transition={outzoom:5,inzoom:5}),e.fullName=e.place.place_name,""==e.fullName&&"panorama"==e.place.place_type&&(e.fullName="Panorama "+e.ident),""==e.fullName&&"photo"==e.place.place_type&&(e.fullName="Zdjęcie "+e.ident),"http"==e.ident.substr(0,4)&&(e.fullName=e.ident,e.ident.length>35&&(e.fullName=e.ident.substr(0,35)+" ...")),this.fullName=e.fullName,this.properties.x=parseFloat(this.properties.x),this.properties.y=parseFloat(this.properties.y),player.cms&&(isNaN(this.properties.x)&&(this.properties.x=0),isNaN(this.properties.y)&&(this.properties.y=0)),this.thumbnail=e.place.thumb,player.offline&&("/html5/assets/eee.png?"==this.thumbnail?this.thumbnail="assets/eee.png":this.thumbnail="data/thumb_"+e.ident+".jpg"),this.hasPreview="autopilot"!=e.place.place_type&&"video"!=e.place.place_type?!0:!1,this.display){case"preview":this.updateDisplay("preview",e);break;default:this.updateDisplay("icon",e)}this.properties.x+=parseFloat(i)-95;var a=new Matrix3D;a=a.rotateY(this.properties.x*Math.PI/180);var n=new Vector3D(0,this.properties.y,1500);n=n.transformByMatrix(a),this.vec3D=new Vector3D(n.x,n.y,n.z),AppEvent.trigger(player,"HOTSPOT.CREATED",this)}function panoramaView(e,t,i,a){if(this.ident=e,this.properties=t,this.paused=!1,this.autorunH=1,this.zoomAcc=0,this.zooming=0,this.loadSpots=void 0!=t.loadSpots?t.loadSpots:!0,this.showLoading=void 0!=t.showLoading?t.showLoading:!0,void 0!=a&&""!=a){var n=a.split(",");n.length>1?this.turn_to=[parseFloat(n[0])+90-4,-1*parseFloat(n[1])]:this.turn_to=[parseFloat(n[0])+90-4]}void 0!=player.turn_timer&&null!=player.turn_timer&&(clearTimeout(player.turn_timer),player.turn_timer=null),this.loadSpots&&HotSpotManager.setVisibility(!1),window.WebGLRenderingContext?this.renderer=new sphereWebGLRenderer(e,t,i):this.renderer=new cubeCssRenderer(e,t,i),void 0!=this.showLoading&&(this.renderer.showLoading=this.showLoading),panoramaViewStatic.renderer=this.renderer,panoramaViewStatic.root=this,player.cms&&void 0==panoramaViewStatic.reticle&&(panoramaViewStatic.reticle=$("<div class='reticle'></div>"),$("#ui").append(panoramaViewStatic.reticle)),this.ctween=new CameraTween;var s=player.dir.toString().split(",");if(void 0==$("#pano")||0==$("#pano").length?this.renderer.loadTemplate():this.renderer.reUse(),this.renderer.build(),isNaN(parseFloat(this.properties.properties.north))&&(this.properties.properties.north=0),"@"==s[0].substr(0,1)){var o=parseFloat(s[0].substr(1));s[0]=o+parseFloat(this.properties.properties.north),player.lastHeading=o}else player.lastHeading=s[0]-parseFloat(this.properties.properties.north);s.length>=1&&""!=s[0]&&(this.renderer.rx=parseFloat(s[0])+90-4),s.length>=2&&(this.renderer.ry=-1*parseFloat(s[1])),panoramaViewStatic.ident=e,void 0==panoramaViewStatic.swipe&&(panoramaViewStatic.swipe=new swiper),swipe=panoramaViewStatic.swipe,$("#info").show(),this.setNav()}function photoHotSpot(e,t){this.properties=e,this.helper=null,this.helperLeft=null,this.helperRight=null,this.clicks=0,this.no=t,this.properties.x=parseInt(this.properties.x),this.properties.y=parseInt(this.properties.y),this.alpha=100,this.alpha2=100,this.hovering=!1,this.hoveringdt=0,this.no_preview=!1;var i="",a="",n=!1,s="",o="",r="",l=[50,50],p="autopilot"!=e.place.place_type?!0:!1,d="hotspot-template";"1"==e.spot&&(i="1"),"2"==e.spot&&(i="2"),"3"==e.spot&&(i="3"),"4"==e.spot&&(i="4"),"5"==e.spot&&(i="5"),"6"==e.spot&&(i="6"),"7"==e.spot&&(i="7"),"10"==e.spot&&(i="10"),"11"==e.spot&&(i="11"),"14"==e.spot&&(i="14"),"15"==e.spot&&(i="15"),"15"==e.spot&&(i="15"),"16"==e.spot&&(i="16"),"17"==e.spot&&(i="17"),"18"==e.spot&&(i="18");var c="",h=!1;"hotspots/spot24.swf"==e.spot&&(h=!0,i="start24",d="hotspot-start-template",l=[172,172]),"hotspots/spot23.swf"==e.spot&&(h=!0,i="start23",d="hotspot-start-template",l=[172,172]),"hotspots/spot22.swf"==e.spot&&(h=!0,i="start22",d="hotspot-start-template",l=[172,172]),"hotspots/spot21.swf"==e.spot&&(h=!0,i="start21",d="hotspot-start-template",l=[172,172]),"hotspots/spot20.swf"==e.spot&&(h=!0,i="start20",d="hotspot-start-template",l=[172,172]),"hotspots/spot19.swf"==e.spot&&(h=!0,i="start19",d="hotspot-start-template",l=[172,172]),"hotspots/spot18.swf"==e.spot&&(h=!0,i="start18",d="hotspot-start-template",l=[172,172]),"hotspots/spot17.swf"==e.spot&&(h=!0,i="start17",d="hotspot-start-template",l=[172,172]),"hotspots/spot16.swf"==e.spot&&(h=!0,i="start16",d="hotspot-start-template",l=[172,172]),"hotspots/spot15.swf"==e.spot&&(h=!0,i="start15",d="hotspot-start-template",l=[172,172]),"hotspots/spot14.swf"==e.spot&&(h=!0,i="start14",d="hotspot-start-template",l=[172,172]),"hotspots/spot13.swf"==e.spot&&(h=!0,i="start13",d="hotspot-start-template",l=[172,172]),"hotspots/spot12.swf"==e.spot&&(h=!0,i="start12",d="hotspot-start-template",l=[172,172]),h&&(c="data-speakgroup='TIPS' data-speak='HTML5.tips.start'"),this.idim=[l[0],l[1]],this.tname=d;var u=1;if(void 0!=e.xscale){var m=$(document).width();void 0!=e.xscreen&&(u=m/parseFloat(e.xscreen)),l[0]=l[0]*(parseFloat(e.xscale)*u*.01)}if(void 0!=e.yscale){$(document).height();l[1]=l[1]*(parseFloat(e.yscale)*u*.01)}if(s="left:"+.5*-l[0]+"px;top:"+.5*-l[1]+"px",o="left:"+.5*-l[0]+"px;top:"+.5*-l[1]+"px",fstyle="left:"+.5*-l[0]+"px;top:"+.5*-l[1]+"px;width:"+l[0]+"px;height:"+l[1]+"px",hstyle="",void 0!=e.param1){var f=e.param1.split(",");if(f.length>=4){var g=(255+parseFloat(f[3]))/255;s+=";opacity:"+g,this.alpha=parseInt(100*g)}if(f.length>=5){var v=(255+parseFloat(f[4]))/255;hstyle+=";opacity:"+v,this.alpha2=parseInt(100*v)}}(e.no_preview===!0||"true"==e.no_preview||1==e.no_preview)&&(this.no_preview=!0),h&&(r+=" speaks primary"),e.fullName=e.place.place_name,""==e.fullName&&(e.fullName="Zdjęcie "+e.ident);var y=e.fullName;h&&(y=TPL.lng("tips.starttour","Rozpocznij zwiedzanie od: ")+e.fullName),h&&this.no_preview&&(y="START"),this.node=$("<div class='hotspot"+r+"' title='"+y+"' id='"+t+"' "+c+" tabindex='0'></div>"),this.node.css("outline","none"),""==i?i="/html5/assets/hotspot2_top.png":0==n&&(a="/html5/assets/spots/hover_"+i+".png",i="/html5/assets/spots/"+i+".png"),player.offline&&(i=i.replace("/html5/",""),a=a.replace("/html5/",""));var w=e.place.thumb;player.offline&&(w="data/thumb_"+e.ident+".jpg"),"http"==e.ident.substr(0,4)&&(p=!1,e.fullName=e.ident,e.ident.length>35&&(e.fullName=e.ident.substr(0,35)+" ...")),this.no_preview&&(p=!1),this.node.html(TPL.render(d,{no:t,hasPreview:p,spotfile:i,spotfileHover:a,ident:e.ident,angle:e.angle,click:"on"+Events.pointer.down,data:e,thumbnail:w,ico_width:l[0],ico_height:l[1],style:s,style2:o,hstyle:hstyle,fstyle:fstyle})),this.node.find(".marker").addClass("fin");var b=this;if("hotspot-start-template"==d?player.cms||this.node.on(Events.pointer.up,function(){b.proceed()}):(this.node.on("mouseover",function(){b.target(),!this.hovering&&Date.now()-this.hoveringdt>1e3&&b.speakTitle(),this.hoveringdt=Date.now(),this.hovering=!0}),this.node.on("mouseout",function(){b.noMore(),this.hovering=!1}),player.cms||this.node.on(Events.pointer.up,function(){b.proceed()})),this.node.find(".close").on(Events.pointer.up,function(e){b.noMore(),e.stopPropagation()}),this.no=t,Tab.add("hotspots",{focus:function(e){e.node.children(".rest").addClass("focused"),e.node.focus()},blur:function(e){e.node.children(".rest").removeClass("focused"),e.node.blur()},action:function(e){e.proceed()}},this,0),player.cms)if(void 0==this.editor)this.editor=new HotSpotEdit(this),this.editor.addUI();else{var b=this;this.node.on("click",function(e){var t=Events.getPointerEvent(e);b.editor.click(t)}),this.editor.hs=this,this.editor.hs.node=this.node,this.editor.addUI()}$("#hotspots").append(this.node)}function photoView(e,t){this.ident=e,this.properties=t,this.photoLoaded=!1,swipe=new swiper,Screen.xs()&&$("#info").hide(),SpeechManager.enableSpeech("#ui",".speaks",1,"TOPMENU")}function Scroller(e,t){this.bx=0,this.by=0,this.inX=0,this.inY=0,this.ldist=0,this.cdist=0,this.dist=0,this.cy=0,this.cx=0,this.element=e,this.scrollpane=t,this.scrolling=!1,this.init=function(){this.bx=0,this.by=0,this.recalcBounds=!0,this.scnt=0,$(e).on(Events.pointer.down,$.proxy(this.start,this)),$(e).on(Events.pointer.up,$.proxy(this.end,this)),$(e).on(Events.pointer.move,$.proxy(this.move,this)),this.node3D=new css3DNode(this.element),this.calculateBounds(),player.addProcess(this)},this.start=function(e){var t,i,a=Events.getPointerEvent(e);a.points.length>1&&(t=a.points[0].pageX-a.points[0].pageY,i=a.points[1].pageX-a.points[1].pageY,this.cdist=Math.sqrt(t*t,i*i)),this.bx=a.pageX,this.by=a.pageY,this.scrolling=!0,e.preventDefault()},this.move=function(e){var t,i;if(this.scrolling){var a=Events.getPointerEvent(e);a.points.length>1?(this.ldist=this.cdist,this.cdist=Math.sqrt(t*t+i*i),this.dist=this.cdist-this.ldist):(t=a.pageX,i=a.pageY,this.inX=t-this.bx,this.inY=i-this.by,this.inX>30&&(this.inX=30),this.inX<-30&&(this.inX=-30),this.inY>30&&(this.inY=30),this.inY<-30&&(this.inY=-30),this.bx=t,this.by=i),e.preventDefault(),e.stopPropagation()}},this.end=function(e){return this.scrolling=!1,!1},this.distance=function(){var e=this.dist;return this.dist*=.5,e},this.inertiaX=function(){var e=this.inX;return this.inX*=.95,isNaN(e)?0:e},this.inertiaY=function(){var e=this.inY;return this.inY*=.95,isNaN(e)?0:e},this.isScrolling=function(){return Math.abs(this.inX)>.4||Math.abs(this.inY)>.4?!0:!1},this.jumpTo=function(e,t){this.cy=t,this.cx=e},this.calculateBounds=function(){this.recalcBounds=!0,scnt=0},this.calculateBoundsLazy=function(){this.scrollpane_height=$(this.scrollpane).height(),this.scrollpane_width=$(this.scrollpane).width(),this.outerHeight=$(this.element).outerHeight(!0),this.outerWidth=$(this.element).outerWidth(!0)},this.process=function(){this.recalcBounds||this.scnt>150?(this.calculateBoundsLazy(),this.recalcBounds=!1,this.scnt=0):this.scnt++,isNaN(this.cy)&&(this.cy=0);var e=this.inertiaY();this.cy+=e,this.cx+=this.inertiaX(),this.cy>0&&(this.cy=0);var t=this.scrollpane_height-this.outerHeight;t>0&&(t=0),this.cy<t&&(this.cy=t),this.cx>0&&(this.cx=0),this.cx<this.scrollpane_width-this.outerWidth&&(this.cx=this.scrollpane_width-this.outerWidth),this.node3D.resetTransform(),this.node3D.translate(this.cx,this.cy,0),this.node3D.applyTransforms()},this.init()}function simpleFolderList(){}function sphereWebGLRenderer(e,t,i){this.ident=e,this.properties=t,this.node=null,this.ql=1,sphereWebGLStatic.self=this,this.fov=0,this.textures=[],this.fragments={},this.worker=null,this.opacity=0,this.fading_in=0,this.fading_out=0,this.preview=null,this.disort={x:0,y:0,dstx:0,dsty:0},this.transCounter=1,this.transSpeed=0,this.panofile="",this.cycle="",this.showLoading=!0,this.opacityStep=.04,void 0!=player.lastView&&null!=player.lastView&&void 0!=player.lastView.renderer&&null!=player.lastView.renderer&&void 0!=player.lastView.renderer.disort&&(this.disort=player.lastView.renderer.disort),sphereWebGLStatic.ident=e;var a=this;this.worker=setInterval(function(){a.loadFrustum()},100)}function callssi(e,t,i,a,n,s){var o={};o.className=t,o.methodName=i;for(var r in a)o["parameters!"+r]=a[r];s?$.ajax({type:"GET",url:e,dataType:"json"}).done(function(e){void 0!=ssi_rules[t][i].process&&(e=ssi_rules[t][i].process(a,e)),n(e)}):$.ajax({type:"POST",url:e,dataType:"json",data:o}).done(function(e){n(e)})}function ssi(e,t,i,a){try{if(player.offline&&void 0!=ssi_rules[e]&&void 0!=ssi_rules[e][t]&&void 0!=ssi_rules[e][t].resolve){var n="data/"+ssi_rules[e][t].resolve(i);callssi(n,e,t,i,a,!0)}else player.offline?callssi("http://www.wkraj.pl/gatewayManager.php?result=json",e,t,i,a,!1):callssi("/gatewayManager.php?result=json",e,t,i,a,!1)}catch(s){console.log(s)}}function startView(e,t){this.ident=e,this.properties=t,swipe=new swiper,$("#info").hide()}function swiper(){this.bx=0,this.by=0,this.inX=0,this.inY=0,this.ldist=0,this.cdist=0,this.dist=0,this.distFromCenterX=0,this.distFromCenterY=0,this.centerX=0,this.centerY=0,this.deadCenter=0,this.sweeping=!1,this.resizing=!1,this.lastTap=null,this.doubleTap=!1,this.alwaysSweep=!1;var e=this;this.iv=setInterval(function(){e.inX*=.95,e.inY*=.91},1e3/60),this.start=function(e){var t,i,a;e.points.length>1&&(t=e.points[0].pageX-e.points[1].pageX,i=e.points[0].pageY-e.points[1].pageY),this.bx=e.pageX,this.by=e.pageY,isNaN(this.bx)&&(this.bx=0),isNaN(this.by)&&(this.by=0),this.inX=0,this.inY=0,this.doubleTap=!1,null!=this.lastTap&&(a=Date.now(),a-this.lastTap<200&&!this.sweeping&&!this.zooming&&(this.doubleTap=!0)),this.lastTap=Date.now(),this.sweeping=!0},this.move=function(e){var t,i;this.resizing=!1,this.sweeping||this.alwaysSweep?(e.points.length>1?(t=e.points[0].pageX-e.points[1].pageX,i=e.points[0].pageY-e.points[1].pageY,this.ldist=this.cdist,this.cdist=Math.sqrt(t*t+i*i),this.ldist>-1?this.dist=this.cdist-this.ldist:this.dist=0,this.resizing=!0,this.inX=0,this.inY=0):(this.ldist=-1,this.cdist=-1),t=e.pageX,i=e.pageY,isNaN(t)&&(t=this.bx),isNaN(i)&&(i=this.by),this.distFromCenterX=t-this.centerX,this.distFromCenterY=i-this.centerY,Math.abs(this.distFromCenterX)<this.centerX*this.deadCenter?this.distFromCenterX=0:this.distFromCenterX=this.distFromCenterX>0?this.distFromCenterX-this.centerX*this.deadCenter:this.distFromCenterX+this.centerX*this.deadCenter,Math.abs(this.distFromCenterY)<Math.abs(this.centerY)*this.deadCenter?this.distFromCenterY=0:this.distFromCenterY=this.distFromCenterY>0?this.distFromCenterY-this.centerY*this.deadCenter:this.distFromCenterY+this.centerY*this.deadCenter,this.inX*=.7,this.inY*=.7,this.inX-=.03*(t-this.bx),this.inY+=.02*(i-this.by),this.inX>20&&(this.inX=20),this.inX<-20&&(this.inX=-20),this.inY>20&&(this.inY=20),this.inY<-20&&(this.inY=-20),this.bx=t,this.by=i):(e.points.length>1&&(t=e.points[0].pageX-e.points[1].pageX,i=e.points[0].pageY-e.points[1].pageY,this.ldist=this.cdist,this.cdist=Math.sqrt(t*t+i*i),this.ldist>-1?this.dist=this.cdist-this.ldist:this.dist=0,this.resizing=!0,this.inX=0,this.inY=0),t=e.pageX,i=e.pageY,isNaN(t)&&(t=this.bx),isNaN(i)&&(i=this.by),this.distFromCenterX=t-this.centerX,this.distFromCenterY=i-this.centerY,Math.abs(this.distFromCenterX)<this.centerX*this.deadCenter?this.distFromCenterX=0:this.distFromCenterX=this.distFromCenterX>0?this.distFromCenterX-this.centerX*this.deadCenter:this.distFromCenterX+this.centerX*this.deadCenter,Math.abs(this.distFromCenterY)<Math.abs(this.centerY)*this.deadCenter?this.distFromCenterY=0:this.distFromCenterY=this.distFromCenterY>0?this.distFromCenterY-this.centerY*this.deadCenter:this.distFromCenterY+this.centerY*this.deadCenter,this.bx=t,this.by=i)},this.end=function(){this.ldist=-1,this.cdist=-1,this.dist=0,this.sweeping=!1,this.resizing=!1},this.distance=function(){var e=this.dist;return this.dist*=.5,e},this.inertiaX=function(){return this.inX},this.inertiaY=function(){return this.inY},this.isScrolling=function(){return Math.abs(this.inX)>.4||Math.abs(this.inY)>.4?!0:!1},this.setCenter=function(e,t,i){this.centerX=e,this.centerY=t,this.deadCenter=i}}function videoView(e,t){this.l={close:"Zamknij film"},this.ident=e,this.properties=t,this.photoLoaded=!1,this.style={opacity:0},this.state="transin",swipe=new swiper}function vplayer(e){this.state="",this.tabgroup="hotspots",this.loop=!1,TPL.lng("tips.volume","Głośność"),this.l={"btn.play":TPL.lng("tips.vplayer.play","Uruchom odtwarzanie"),"btn.pause":TPL.lng("tips.vplayer.stop","Zatrzymaj odtwarzanie"),"btn.resume":TPL.lng("tips.vplayer.resume","Wznów odtwarzanie")},VideoManager.playerCount++,this.$vnode=$("<video width='100%' height='100%'></video>"),this.vnode=this.$vnode[0],this.$node=$("<div class='video-player'><div class='video-screen'></div><div class='video-controls'></div></div>"),this.$videoscreen=this.$node.find(".video-screen"),this.$videoctl=this.$node.find(".video-controls"),this.$screenctl=$("<a href='javascript:void(null);' class='screen-ctl paused' title='"+this.l["btn.play"]+"'><div class='ctl'><span class='fa fa-play'></span></div></a>"),this.$videoscreen.append(this.$vnode),this.$videoscreen.append(this.$screenctl),this.$play=$("<a href='javascript:void(null);' class='play-button speaks' data-speakgroup='TIPS' data-speak='HTML5.tips.vplayer.play' title='"+this.l["btn.play"]+"'><span class='fa fa-play'></span></a>"),this.$timeline=$("<div class='timeline'><div class='progress'></div></div>"),this.$progress=this.$timeline.find(".progress"),this.$time=$("<div class='time'></div>"),this.$navbuttons=$("<div class='nav-buttons'></div>"),this.$navbar=$("<div class='nav-bar'></div>"),this.$navbuttons.append(this.$play),this.$navbar.append(this.$time),this.$navbar.append(this.$timeline),this.$videoctl.append(this.$navbuttons),this.$videoctl.append(this.$navbar);var t=this;e&&(this.$node.css("pointer-events","none"),this.$videoctl.css("pointer-events","none"),this.$navbar.css("pointer-events","none"),this.$navbuttons.css("pointer-events","none"),this.$play.css("pointer-events","none"),this.$progress.css("pointer-events","none"),this.$timeline.css("pointer-events","none"),this.$time.css("pointer-events","none"),this.$videoscreen.css("pointer-events","none"),this.$screenctl.css("pointer-events","none"),this.$vnode.css("pointer-events","none")),void 0==e&&(this.$play.on("click",function(e){t.playButton(e)}),this.$screenctl.on("click",function(e){t.playButton(e)})),this.title="",this.setTitle=function(e){""!=this.title&&""==e&&void 0!=this.$title&&(this.$title["delete"](),this.$title=void 0),this.title=e,""!=this.title&&(void 0==this.$title?(this.$title=$("<div class='title'>"+this.title+"</div>"),this.$node.append(this.$title)):this.$title.html(this.title))},this.showControls=function(e){0==e?this.$node.find(".video-controls").hide():this.$node.find(".video-controls").show()},this.style=function(e,t){""!=e?this.$node.find(e).css(t):this.$node.css(t)},this.setLoop=function(e){this.loop=e},this.embed=function(){return this.$node},this.load=function(e){this.src=e,this.vnode.src=e;var t=this;this.vnode.addEventListener("loadedmetadata",function(e){t.vwidth=this.videoWidth,t.vheight=this.videoHeight,
t.updateTime(),t.fit()},!1),this.vnode.addEventListener("timeupdate",function(e){var i=t.vnode.currentTime/t.vnode.duration;t.$progress.css("width",100*i+"%"),t.updateTime(),1==i&&t.loop&&(t.vnode.currentTime=0,t.vnode.play())}),this.vnode.addEventListener("pause",function(e){t.state="paused",t.updatePlayButtonState()}),this.vnode.addEventListener("play",function(e){t.$vnode.css("opacity","1"),t.state="playing",t.updatePlayButtonState()}),Tab.add(this.tabgroup,Tab.simpleTab(this.$play,0),{})},this.playButton=function(e){""==this.state?this.vnode.play():"playing"==this.state?this.vnode.pause():"paused"==this.state&&this.vnode.play()},this.stop=function(){this.vnode.pause()},this.play=function(){this.vnode.play()},this.toggle=function(){""==this.state?this.vnode.play():"playing"==this.state?this.vnode.pause():"paused"==this.state&&this.vnode.play()},this.updatePlayButtonState=function(){switch(this.state){case"playing":this.$play.html("<span class='fa fa-pause'></span>"),this.$play.attr("title",this.l["btn.pause"]),this.$play.attr("data-speak","HTML5.tips.vplayer.stop"),this.$screenctl.find(".ctl").html("<span class='fa fa-pause'></span>"),this.$screenctl.removeClass("paused"),this.$screenctl.attr("title",this.l["btn.pause"]);break;case"paused":this.$play.html("<span class='fa fa-play'></span>"),this.$play.attr("title",this.l["btn.resume"]),this.$play.attr("data-speak","HTML5.tips.vplayer.resume"),this.$screenctl.find(".ctl").html("<span class='fa fa-play'></span>"),this.$screenctl.addClass("paused"),this.$screenctl.attr("title",this.l["btn.resume"])}},this.readableTime=function(e){e=Math.round(e);var t=Math.floor(e/60),i=e%60;return 10>t&&(t="0"+t),10>i&&(i="0"+i),t+":"+i},this.updateTime=function(){this.$time.html(this.readableTime(this.vnode.currentTime)+" / "+this.readableTime(this.vnode.duration))},this.fitScreen=function(e,t){this.bbox={mw:e,mh:t}},this.setSize=function(e,t){this.$node.css("width",e),this.$node.css("height",t)},this.fit=function(){if(void 0!=this.bbox){var e=this.vwidth/this.vheight,t=player._width-2*this.bbox.mw;300>t&&(t=player._width);var i=player._height-2*this.bbox.mh;200>i&&(i=player_height),t/e>i?this.$node.css("width",i*e):this.$node.css("width",t)}},AppEvent.on(player,"VOLUME.SET",function(){Volume.currentYTVolume()>0&&(t.vnode.volume=.01*Volume.currentYTVolume())}),AppEvent.on(player,"SOUND.UNMUTED",function(){Volume.yt.muted||Volume.master.muted||(t.vnode.muted=!1)}),AppEvent.on(player,"SOUND.MUTED",function(){(Volume.yt.muted||Volume.master.muted)&&(t.vnode.muted=!0)})}function CLoader(e){this.node=document.getElementById(e),this.ctx=this.node.getContext("2d"),this.width=this.node.width,this.height=this.node.width,this.style={},this.style.percents=!1,this.style.color="#ff0000",this.style.bgcolor="#ffffff",this.style.thickness=5,this.setFont("#ffffff",16,"Arial",30)}function AudioEffect(e){this.file=e,this.muted=!1,this.audio=new Audio(e),this.volume=1,this.fade_dt=.01}function VolBar(e,t){this.power=1,this.muted=!1,this.visibility=!0,this.node=$("<div class='vol'>"+e+"<br><a href='javascript:void(null);' class='b on mute-btn speaks' title='"+TPL.lng("tips.mutesounds","Wyłącz dźwięk")+"' data-speak='PLAYER.VOLUME.MUTE' data-speakgroup='TIPS'><i class='fa fa-volume-up'></i></a><div class='slide'><input type='range' min='0' max='1' step='0.02' class='volctl'></div><div class='clear'></div></div>"),this.muteBtn=this.node.find(".mute-btn"),this.muteIcon=this.node.find(".mute-btn i"),this.slide=this.node.find(".volctl"),this.tabmute=Volume.addBasicTab("topicons",t,this.node.find(".mute-btn")),this.tabslide=Volume.addBasicTab("topicons",t+1,this.node.find(".volctl")),this.visible=function(e){this.visibility=e,this.visibility?(this.node.show(),Tab.enable("topicons",this.tabmute.id),Tab.enable("topicons",this.tabslide.id)):(this.node.hide(),Tab.disable("topicons",this.tabmute.id),Tab.disable("topicons",this.tabslide.id))},this.val=function(){return this.muted?0:this.power},this.ui=function(){return this.node},this.isMuted=function(){return this.muted},this.set=function(e){e>0&&(this.power=e),(0==e&&!this.muted||0!=e&&this.muted)&&this.mute(!this.muted),this.slide.val(e),AppEvent.trigger(player,"VOLUME.SET",{})},this.mute=function(e){this.muted=e,e?(this.set(0),this.muteBtn.html("<img src='assets/speaker-off.svg' width='20' aria-hidden='true' style='margin-top: -3px;'>"),AppEvent.trigger(player,"SOUND.MUTED",{})):(this.muteBtn.html("<i class='fa fa-volume-up'></i>"),this.setDefault(),AppEvent.trigger(player,"SOUND.UNMUTED",{}))},this.setDefault=function(){this.set(this.power)},this.muteBtn.on("click",$.proxy(function(){this.mute(!this.muted)},this)),this.slide.on("change",$.proxy(function(){this.set(this.slide.val())},this)),this.enableTabs=function(e){e?this.visibility&&(Tab.enable("topicons",this.tabmute.id),Tab.enable("topicons",this.tabslide.id)):(Tab.disable("topicons",this.tabmute.id),Tab.disable("topicons",this.tabslide.id))},setInterval($.proxy(function(){this.set(this.slide.val())},this),100),this.setDefault()}function AudioElement(e){this.id=e}function AudioPlayer(e){this.onDataLoaded=null,this.volume=1,this.htmlAudioID=e,this.dataLoaded=!1,this.playAfterLoad=!1;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext,this.audioApiSupport=!0}catch(t){this.audioApiSupport=!1,this.audioElement=new AudioElement(this.htmlAudioID)}}var AppEvent={buildEventManager:function(e,t,i){return new function(e,t,i){this.o=e,this.n=t,this.f=i,this.remove=function(){$(this.o).off(this.n,this.f)}}(e,t,i)},on:function(e,t,i){var a=function(e,t){i(t)};return $(e).on(t,a),this.buildEventManager(e,t,a)},off:function(e,t,i){$(e).off(t,i)},one:function(e,t,i,a){var n=function(e,t){i(t)};return $(e).one(t,a,n),this.buildEventManager(e,t,n)},trigger:function(e,t,i){$(e).trigger(t,i)}};CameraTween.prototype={setSpeed:function(e){this.speed=e},reset:function(){this.origin={},this.destination={},this.current={},this.origin.x=0,this.origin.y=0,this.origin.zoom=0,this.running=!1,this.onFinish=null,this.speed=20},zooming:function(e,t){this.sdt=Date.now(),this.origin.zoom=e,this.current.zoom=e,this.destination.zoom=t,this.distance=this.speed,this.running=!0},addZoom:function(e,t){this.destination.zoom+=e,this.distance+=t},startAt:function(e,t){this.origin.x=e,this.origin.x<0&&(this.origin.x=360+this.origin.x),this.origin.x>360&&(this.origin.x=this.origin.x%360),this.origin.y=t,this.current.x=e,this.current.y=t,this.sdt=Date.now()},finishAt:function(e,t){var i=Math.abs(e-this.origin.x),a=Math.abs(360+e-this.origin.x),n=Math.abs(e-(360+this.origin.x));a>=i&&n>=i?(this.destination.x=e,this.distance=i*this.speed):a>=n?(this.destination.x=e,this.origin.x=this.origin.x+360,this.distance=n*this.speed):(this.destination.x=e+360,this.distance=a*this.speed),this.distance<1e3&&(this.distance=1e3),this.destination.y=t,this.running=!0},stop:function(){this.running=!1},isRunning:function(){return this.running},easeInOutQuad:function(e,t,i,a){return e/=a/2,1>e?i/2*e*e+t:(e--,-i/2*(e*(e-2)-1)+t)},process:function(){if(this.running){var e=Date.now();void 0!=this.current.x&&(this.current.x=this.easeInOutQuad(e-this.sdt,this.origin.x,this.destination.x-this.origin.x,this.distance)),void 0!=this.current.y&&(this.current.y=this.easeInOutQuad(e-this.sdt,this.origin.y,this.destination.y-this.origin.y,this.distance)),void 0!=this.current.zoom&&(this.current.zoom=this.easeInOutQuad(e-this.sdt,this.origin.zoom,this.destination.zoom-this.origin.zoom,this.distance)),e-this.sdt>this.distance&&(this.running=!1,null!=this.onFinish&&this.onFinish())}}},ClosestSpot.prototype={show:function(){Tab.reset(),this.visible=!0},hide:function(){this.visible=!1},resetDistance:function(){this.node.hide(),this.d=9999999999},setDistance:function(e){this.d=e},setSpot:function(e){try{void 0!=e&&null!=e&&this.visible&&void 0!=this.shouldspeak&&Date.now()-this.shouldspeak<500&&e.speakTitle()}catch(t){}this.spot=e},speak:function(){this.shouldspeak=Date.now()},setCoords:function(e){this.visible&&this.node.show(),this.node.css("transform","translate("+(e.x-28)+"px, "+(e.y-28)+"px)")},proceed:function(){if(void 0!=this.spot&&0==this.proceedcd){this.proceedcd=1,this.spot.proceed(!0);var e=this;setTimeout(function(){e.proceedcd=0},500)}}};var Compass={last:[],lastHeading:0,lastBeta:[],previousBeta:0,calculateHeading:function(e,t,i){var a=e*(Math.PI/180),n=t*(Math.PI/180),s=i*(Math.PI/180),o=Math.cos(a),r=Math.sin(a),l=(Math.cos(n),Math.sin(n)),p=Math.cos(s),d=Math.sin(s),c=-o*d-r*l*p,h=-r*d+o*l*p,u=Math.atan(c/h);return 0>h?u+=Math.PI:0>c&&(u+=2*Math.PI),u*=180/Math.PI},heading:function(){var e=Compass.calculateHeading(player.orientation.alpha,player.orientation.beta,player.orientation.gamma);Compass.last.push(e),Compass.last.length>10&&Compass.last.shift();var t=0;if(Math.abs(e-Compass.lastHeading)<300){for(var i=0;i<Compass.last.length;i++)t+=Compass.last[i];t/=Compass.last.length}else Compass.last=[],t=e;return Compass.lastHeading=e,t},tilt:function(){var e=player.orientation.beta;Compass.lastBeta.push(e),Compass.lastBeta.length>10&&Compass.lastBeta.shift();var t=0;if(Math.abs(e-Compass.previousBeta)<300){for(var i=0;i<Compass.lastBeta.length;i++)t+=Compass.lastBeta[i];t/=Compass.lastBeta.length}else Compass.lastBeta=[],t=e;return Compass.previousBeta=e,t}},Console={clear:function(){$("#console").html("")},place:function(e,t,i,a){node=$("#"+e),node.length||(node=$("<div style='color:#ffffff;position:absolute;left:"+t+"px;top:"+i+"px' id='"+e+"'></div>"),$("#console").append(node)),node.html(a)},put:function(e,t,i,a){this.place(e,t,i,e+":"+a)}},ElementManager={elements:[],folderelements:{},lastFolder:null,firstLoad:!0,load:function(e){if(AppEvent.trigger(ElementManager,"beforeLoad",{}),ElementManager.firstLoad&&(Tab.setGroup("elements","+"),ElementManager.firstLoad=!1),null!=ElementManager.lastFolder&&ElementManager.lastFolder!=player.folder){for(var t in ElementManager.folderelements)ElementManager.remove(ElementManager.folderelements[t]);ElementManager.folderelements={}}ElementManager.lastFolder=player.folder;var i={};for(var t in e){var a=e[t];if(i[a.id]=1,void 0==ElementManager.folderelements[a.id]){var n=new UIElement(a.x,a.y,a.type,JSON.parse(a.params),a.id,a.folder_wide,a.place_id);ElementManager.elements.push(n),"0"!=n.folder_wide&&(ElementManager.folderelements[n.id]=n),player.cms&&n.editor.addUI()}else ElementManager.folderelements[a.id].refresh()}for(var t in ElementManager.folderelements)void 0==i[t]&&(ElementManager.remove(ElementManager.folderelements[t]),delete ElementManager.folderelements[t])},add:function(e){ElementManager.elements.push(e)},remove:function(e){e.destroy();for(var t in ElementManager.elements){var i=ElementManager.elements[t];if(i===e)return void ElementManager.elements.splice(t,1)}}},Events={init:function(){var e="ontouchstart"in window;e?this.pointer={down:"touchstart",up:"touchend",move:"touchmove"}:this.pointer={down:"mousedown",up:"mouseup",move:"mousemove"},null!=navigator.userAgent.match(/webkit/i)?this.pointer.wheel="mousewheel":this.pointer.wheel="DOMMouseScroll"},getWheelEvent:function(e){var t={};return t.delta=e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:40*-e.originalEvent.detail,t.origin=e,t},getPointerEvent:function(e){var t={};if(e){if(e.originalEvent&&e.originalEvent.touches){t.origin=e.originalEvent;var i=t.origin.touches;t.origin.touches[0]&&i[0].pageX&&(t.pageX=i[0].pageX,t.pageY=i[0].pageY),t.points=[];for(var a in i)void 0!=i[a].pageX&&t.points.push({pageX:i[a].pageX,pageY:i[a].pageY})}else t.points=[],t.origin=e,t.points.push({pageX:e.pageX,pageY:e.pageY}),e.pageX&&(t.pageX=e.pageX,t.pageY=e.pageY);return t}return null}};HotSpotEdit.prototype.addUI=function(){void 0==this.mover&&(this.mover=$("<div class='hs_mover'></div>")),this.mover.on(Events.pointer.down,function(e){var t=Events.getPointerEvent(e);self.mouseDown(t)}),this.hs.node.append(this.mover)},HotSpotEdit.prototype.addSprite=function(){var e=new THREE.BoxGeometry(1,1,1),t=new THREE.MeshBasicMaterial({color:65280});this.helper=new THREE.Mesh(e,t),this.helper.position.x=this.hs.vec3D.x,this.helper.position.y=this.hs.vec3D.y,this.helper.position.z=this.hs.vec3D.z,this.helper.layers.set(0),sphereWebGLStatic.scene.add(this.helper)},HotSpotEdit.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=.5*this.manager.player.renderer.context.canvas.width,a=.5*this.manager.player.renderer.context.canvas.height;return this.sprite.updateMatrixWorld(),t.setFromMatrixPosition(this.sprite.matrixWorld),e.setFromMatrixPosition(this.sprite.matrixWorld.premultiply(this.manager.player.camera.matrixWorldInverse)),e.z<0?(t.project(this.manager.player.camera),t.x=t.x*i+i,t.y=-(t.y*a)+a,this.dragging||(this.node.css("left",t.x-.5*this.node.width()),this.node.css("top",t.y-.5*this.node.height())),{x:t.x,y:t.y}):{x:-50,y:-50}},HotSpotEdit.prototype.click=function(e){self=this,$(".hs_mover").hide(),this.mover.show(),SpotEdit.select(this)},HotSpotEdit.prototype.mouseDown=function(e){this.drag={},this.drag.x=e.pageX,this.drag.y=e.pageY,this.down=!0,self=this,this.playernode.one(Events.pointer.up,function(e){var t=Events.getPointerEvent(e);self.mouseUp(t)}),this.playernode.on(Events.pointer.move,function(e){var t=Events.getPointerEvent(e);self.mouseMove(t)}),this.node.css("pointer-events","none"),this.hs.updatePosition=!1,SpotEdit.select(this),e.origin.preventDefault()},HotSpotEdit.prototype.moveToScreenCoords=function(e,t){var i=new THREE.Matrix4,a=new THREE.Matrix4;if(void 0!=this.hs.node3D){var n=(this.hs.node3D.last,e),s=t;this.hs.node3D.resetTransform(),this.hs.node3D.translate(n,s,0),this.hs.node3D.applyTransforms();var o=new THREE.Raycaster,r=new THREE.Vector2;r.x=n/this.playernode.width()*2-1,r.y=2*-(s/this.playernode.height())+1,o.setFromCamera(r,player.currentView.renderer.camera);var l=o.intersectObject(player.currentView.renderer.preview,!1),p=new THREE.Vector4;p.fromArray([l[0].point.x,l[0].point.y,l[0].point.z,0]),a.makeRotationY((360-180*player.currentView.renderer.jaw/Math.PI)*Math.PI/180),i.makeRotationX(-1*player.currentView.renderer.pitch),a.multiply(i),p=p.applyMatrix4(a),this.hs.vec3D.x=p.x,this.hs.vec3D.y=p.y,this.hs.vec3D.z=p.z,p.fromArray([l[0].point.x,l[0].point.y,l[0].point.z,0]),a.makeRotationY((360-180*player.currentView.renderer.jaw/Math.PI)*Math.PI/180),i.makeRotationX(-1*player.currentView.renderer.pitch),a.multiply(i),p=p.applyMatrix4(a);var d=new THREE.Quaternion,c=new THREE.Vector3(p.x,p.y,p.z);d.setFromUnitVectors(new THREE.Vector3(0,0,-1),c.normalize());var h=(new THREE.Euler).setFromQuaternion(d,"YXZ"),u=parseFloat(player.currentView.properties.properties.north);null!=window.currentSpot&&(window.currentSpot.newcoords=!0,window.currentSpot.x=(360+u-.01*Math.round(180*h.y/Math.PI*100)+180)%360,window.currentSpot.y=Math.round(180*h.x/Math.PI*100)*-.01),SpotEdit.updateCoords((360+u-.01*Math.round(180*h.y/Math.PI*100)+180)%360,Math.round(180*h.x/Math.PI*100)*-.01)}else void 0!=this.hs.node&&(this.hs.properties.x=e/player._width*1e3,this.hs.properties.y=t/player._height*500,console.log(e))},HotSpotEdit.prototype.mouseUp=function(e){new THREE.Matrix4,new THREE.Matrix4;if(self=this,this.playernode.off(Events.pointer.move,function(e){var t=Events.getPointerEvent(e);self.mouseMove(t)}),this.node.css("pointer-events","all"),this.hs.updatePosition=!0,this.dragging){this.down=!1,this.dragging=!1;var t;if(void 0!=this.hs.node3D&&(t=this.hs.node3D.last,void 0!=t)){var i=t.x+e.pageX-this.drag.x,a=t.y+e.pageY-this.drag.y;this.moveToScreenCoords(i,a)}}else this.down=!1,this.dragging=!1;e.origin.preventDefault()},HotSpotEdit.prototype.mouseMove=function(e){if(this.down){if(this.dragging=!0,void 0!=this.hs.node3D){var t=this.hs.node3D.last;this.hs.node3D.resetTransform(),this.hs.node3D.translate(t.x+e.pageX-this.drag.x,t.y+e.pageY-this.drag.y,0),this.hs.node3D.applyTransforms()}else{var i=e.pageX-this.drag.x,a=e.pageY-this.drag.y;this.hs.properties.x+=i/player._width*1e3,this.hs.properties.y+=a/player._height*500}this.drag.x=e.pageX,this.drag.y=e.pageY}e.origin.preventDefault()},HotSpotEdit.prototype.center=function(){var e=new THREE.Raycaster,t=new THREE.Vector2;t.x=0,t.y=0,e.setFromCamera(t,this.manager.player.camera);var i=e.intersectObject(this.manager.player.geometry,!1);this.sprite.position.x=i[0].point.x,this.sprite.position.y=i[0].point.y,this.sprite.position.z=i[0].point.z};var HotSpotManager={spots:[],renderables:[],playerWidth:0,playerHeight:0,lastMore:null,visiblility:!1,helpers:[],currentTransition:void 0,closest:null,keyListender:null,lastVisited:null,cursor3D:{},add:function(e){this.spots.push(e)},addRenderable:function(e){return this.renderables.push(e),e},removeRenderable:function(e){for(var t in this.renderables)if(this.renderables[t]==e)return this.renderables[t].destroy(),void this.renderables.splice(t,1)},setTransition:function(e){HotSpotManager.currentTransition=e},keyup:function(e){return"Enter"==e.key&&HotSpotManager.closest.visible?(HotSpotManager.closest.proceed(),e.preventDefault(),e.stopPropagation(),!1):void 0},clearRenderables:function(){for(var e in this.renderables)this.renderables[e].destroy();this.renderables=[]},addRenderables:function(e,t){if(void 0!=e&&0!=e.length)for(var i in e){var a=e[i];a.settings.coords.x=parseFloat(a.settings.coords.x),a.settings.coords.y=parseFloat(a.settings.coords.y),a.settings.coords.z=parseFloat(a.settings.coords.z),a.settings.sphere.x=parseFloat(a.settings.sphere.x),a.settings.sphere.y=parseFloat(a.settings.sphere.y),a.settings.sphere.z=parseFloat(a.settings.sphere.z);var n,s={out:a.settings.coords,"in":a.settings.sphere};switch(t){case"collectible":if(-1!=QuestManager.findQuestById(a.collection_id)||"1"==player.cms){if(!ItemState.canSpawn(a))continue;n=HotSpotManager.addRenderable(new SphereSpot(new Collectible3D(a),s,{type:"collectible",record:a}))}break;default:n=HotSpotManager.addRenderable(new SphereSpot(new PlaneSpot3D("collect-"+a.id,"/storage/collectibles/"+a.image),s,{type:"collectible",record:a}))}1==player.cms&&n.edit()}},addAll:function(e,t){null==HotSpotManager.closest&&(HotSpotManager.closest=new ClosestSpot,HotSpotManager.lastVisited=$("<div style='position:absolute; padding: 5px;background-color:#00af00;border-radius: 100%;z-index:1;line-height:10px;border:2px solid #ffffff;'><i class='fa fa-check' style='color:#ffffff;font-size:10px;'></i></div>"),$("#hotspots").append(HotSpotManager.lastVisited)),null==HotSpotManager.keyListender&&(HotSpotManager.keyListender=1,AppEvent.on(player,"PLAYER.KEYUP",HotSpotManager.keyup));for(var i in e)if("true"!=e[i].nomouse){if(isNaN(e[i].x)&&isNaN(e[i].y))continue;var a=new panoramaHotSpot(e[i],i,0);this.spots.push(a),player.cms}this.dcam=new css3DNode("#dbcam")},findById:function(e){for(var t in this.spots)if(console.log(e+" = "+this.spots[t].properties.ident),parseInt(this.spots[t].properties.ident)==e)return this.spots[t];return null},hideWindow:function(e){null!=HotSpotManager.lastMore&&this.spots[HotSpotManager.lastMore].noMore()},more:function(e){null!=HotSpotManager.lastMore&&this.spots[HotSpotManager.lastMore].noMore();for(var t in this.spots)this.spots[t].no==e&&(this.spots[t].more(),HotSpotManager.lastMore=t)},process3D:function(e,t,i){var a=new Matrix3D,n=new Matrix3D,s=new Matrix3D,o=new Matrix3D,r=new Vector3D(0,0,1);if(HotSpotManager.helperMatrix=new Matrix3D,HotSpotManager.visiblility){this.helpers=[],this.dcam.resetTransform(),this.dcam.rotateZ(e),this.dcam.applyTransforms(),HotSpotManager.xx=e,HotSpotManager.yy=t,HotSpotManager.playerWidth=$("#player").width(),HotSpotManager.playerHeight=$("#player").height(),a=a.rotateX(-t*Math.PI/180),a=a.rotateY(e*Math.PI/180),n=n.rotateX(-t*Math.PI/180),n=n.rotateY(-90*Math.PI/180);var l=player.currentView.renderer.getPerspective(),p=2*(180*Math.atan(.5*HotSpotManager.playerHeight/l)/Math.PI);s.makeProjection(p,1/($("#player").width()/$("#player").height()),10,1650),o=o.transform(a),o=o.transpose(),o=o.transform(s),HotSpotManager.helperMatrix=HotSpotManager.helperMatrix.transform(n),HotSpotManager.helperMatrix=HotSpotManager.helperMatrix.transpose(),HotSpotManager.helperMatrix=HotSpotManager.helperMatrix.transform(s),r.transformByMatrix(a),HotSpotManager.lastVisited.css("visibility","hidden"),HotSpotManager.closest.resetDistance();var d=.5*$("#player").width(),c=.5*$("#player").height(),h=null;for(var u in this.spots){var m=this.spots[u].process(o,r);if(void 0!=m){var f=.5*(m.y-c),g=(m.x-d)*(m.x-d)+f*f;g<HotSpotManager.closest.d&&(HotSpotManager.closest.setDistance(g),h={dist:g,spi:u,pt:m})}}null!=h&&(HotSpotManager.closest.setCoords(h.pt),HotSpotManager.closest.setSpot(this.spots[h.spi]));for(var u in this.renderables)var m=this.renderables[u].process(o,r);$("#hotspots").hide().show(0);var v=$("body"),y=new THREE.Raycaster,w=new THREE.Vector2;w.x=player._mouseHoverX/v.width()*2-1,w.y=player._mouseHoverY/v.height()*-2+1,y.setFromCamera(w,player.currentView.renderer.camera),HotSpotManager.cursor3D.raycaster=y,HotSpotManager.cursor3D.intersects=y.intersectObject(player.currentView.renderer.preview,!1)}},removeSpot:function(e){var t=-1;for(var i in this.spots)if(this.spots[i]==e){t=i;break}t>-1&&(this.spots[t].removeHelper(),this.spots[t].remove(),this.spots.splice(t,1))},clear:function(){null!=HotSpotManager.lastVisited&&HotSpotManager.lastVisited.css("visibility","hidden");for(var e in this.spots)this.spots[e].removeHelper(),this.spots[e].remove();HotSpotManager.lastMore=null,HotSpotManager.spots=[]},setVisibility:function(e){if(HotSpotManager.visiblility=e,e){$("#hotspots").show();for(var t in this.spots)this.spots[t].fadeIn()}else null!=HotSpotManager.lastVisited&&HotSpotManager.lastVisited.css("visibility","hidden"),$("#hotspots").hide()},arrangeHelpers:function(e){var t=2e3,i=-2e3;for(var a in this.helpers){var n=this.helpers[a];n.d==e.d&&(n.y<t&&(t=n.y),n.y>i&&(i=n.y))}var s=Math.abs(t-e.y),o=Math.abs(e.y-i);return 40>s?e.y=t-50:40>o&&(e.y=i+50),this.helpers.push(e),e.y},setLastVisited:function(e,t,i){HotSpotManager.lastVisited.css("left",t+15),HotSpotManager.lastVisited.css("top",i-25),HotSpotManager.lastVisited.css("visibility","visible")}},HotSpotManager2D={spots:[],playerWidth:0,playerHeight:0,lastMore:null,visiblility:!1,add:function(e){this.spots.push(e)},addAll:function(e){for(var t in e){if("true"!=e[t].nomouse)var i=new photoHotSpot(e[t],t);this.spots.push(i)}},findById:function(e){for(var t in this.spots)if(parseInt(this.spots[t].properties.ident)==e)return this.spots[t];return null},hideWindow:function(e){null!=HotSpotManager2D.lastMore&&this.spots[HotSpotManager2D.lastMore].noMore()},more:function(e){null!=HotSpotManager2D.lastMore&&this.spots[HotSpotManager2D.lastMore].noMore();for(var t in this.spots)this.spots[t].no==e&&(this.spots[t].more(),HotSpotManager2D.lastMore=t)},process:function(e,t,i){for(var a in this.spots)this.spots[a].process(e.left,e.top,t,i)},clear:function(){for(var e in this.spots)this.spots[e].remove();HotSpotManager2D.lastMore=null,HotSpotManager2D.spots=[]},setVisibility:function(e){HotSpotManager2D.visiblility=e,e?$("#hotspots").show():$("#hotspots").hide()},setMobile:function(e){e?($("#hotspots .hotspot").addClass("hidden"),$("#hotspots .primary").removeClass("hidden"),$("#hotspots .primary").addClass("center"),$("#hotspots .primary img").attr("width","80"),$("#hotspots .primary img").attr("height","80"),$("#hotspots .primary img").css("left","-40px"),$("#hotspots .primary img").css("top","-40px"),$("#hotspots .primary img").css("opacity","1"),$("#hotspots .primary .rest").css("position","initial")):($("#hotspots .hotspot").removeClass("hidden"),$("#hotspots .primary").removeClass("center"))},removeSpot:function(e){var t=-1;for(var i in this.spots)if(this.spots[i]==e){t=i;break}t>-1&&(this.spots[t].remove(),this.spots.splice(t,1))}};THREE.InnerSphereGeometry=function(e,t,i,a,n,s,o){THREE.BufferGeometry.call(this),this.type="InnerSphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:a,phiLength:n,thetaStart:s,thetaLength:o},e=e||50,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),a=void 0!==a?a:0,n=void 0!==n?n:2*Math.PI,s=void 0!==s?s:0,o=void 0!==o?o:Math.PI;var r=s+o,l=(t+1)*(i+1),p=new THREE.BufferAttribute(new Float32Array(3*l),3),d=new THREE.BufferAttribute(new Float32Array(3*l),3),c=new THREE.BufferAttribute(new Float32Array(2*l),2),h=0,u=[],m=new THREE.Vector3,f=0;sy=0,sz=0;for(var g=0;i>=g;g++){for(var v=[],y=g/i,w=0;t>=w;w++){var b=w/t,P=-e*Math.cos(a+b*n)*Math.sin(s+y*o),M=e*Math.cos(s+y*o),$=e*Math.sin(a+b*n)*Math.sin(s+y*o);m.set(P,M,$).normalize(),p.setXYZ(h,P,M,$),d.setXYZ(h,m.x,m.y,m.z),c.setXY(h,1-b,1-y),v.push(h),h++,f+=P,sy+=M,sz+=$}u.push(v)}f/=h,sy/=h,sz/=h;for(var T=[],g=0;i>g;g++)for(var w=0;t>w;w++){var S=u[g][w+1],x=u[g][w],k=u[g+1][w],_=u[g+1][w+1];(0!==g||s>0)&&T.push(S,x,_),(g!==i-1||r<Math.PI)&&T.push(x,k,_)}this.setIndex(new(p.count>65535?THREE.Uint32Attribute:THREE.Uint16Attribute)(T,1)),this.addAttribute("position",p),this.addAttribute("normal",d),this.addAttribute("uv",c),Math.abs(sy)<13?this.boundingSphere=new THREE.Sphere(new THREE.Vector3(f,sy,sz),e/5):this.boundingSphere=new THREE.Sphere(new THREE.Vector3(f,sy,sz),e/4)},THREE.InnerSphereGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.InnerSphereGeometry.prototype.constructor=THREE.SphereBufferGeometry,Interpolate.prototype={pos:0,setStart:function(e){this.begin=e},setEnd:function(e){this.end=e},prepareValues:function(e,t){this.a=e,this.b=t},cosine:function(e){var t=(1-Math.cos(e*Math.PI))/2;return this.a*(1-t)+this.b*t},linear:function(e){return this.a*(1-e)+this.b*e},easeOutCubic:function(e){var t=1-Math.pow(1-e,3);return this.a*(1-t)+this.b*t},easeInCubic:function(e){var t=Math.pow(e,3);return this.a*(1-t)+this.b*t},easeOutElastic:function(e){const t=2*Math.PI/3;var i=0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1;return this.a*(1-i)+this.b*i},reset:function(){this.pos=0},next:function(e){var t=player.currentFrameTime-player.lastFrameTime;this.pos+=t/(1e3*e)},calculate:function(e){switch(e){case"easeOutElastic":return this.easeOutElastic(this.pos);case"easeInCubic":return this.easeInCubic(this.pos);case"easeOutCubic":return this.easeOutCubic(this.pos);case"cosine":return this.cosine(this.pos);default:return this.linear(this.pos)}},cycle:function(e){return this.prepareValues(this.begin,this.end),this.calculate(e)},cycleProperty:function(e,t){return this.prepareValues(this.begin[e],this.end[e]),this.calculate(t)}};var Log={error:function(e,t){alert(e+" ("+t+")")},debug:function(e){console.log(e)}},IDENTITY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sin=Math.sin,cos=Math.cos;Matrix3D.prototype={multiply:function(e){return new Matrix3D(multiply.apply(window,this.entities.concat(e)))},makeProjection:function(e,t,i,a){var n=1/Math.tan(.5*e*(Math.PI/180)),s=(a+i)/(a-i),o=a*i*2/(i-a);this.entities=[n*t,0,0,0,0,n,0,0,0,0,s,1,0,0,o,0]},transform:function(e){return this.multiply(e.entities)},scale:function(e){return this.multiply([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])},rotateX:function(e){var t=cos(e),i=sin(e);return this.multiply([1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1])},rotateY:function(e){var t=cos(e),i=sin(e);return this.multiply([t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1])},rotateZ:function(e){var t=cos(e),i=sin(e);return this.multiply([t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1])},translate:function(e,t,i){return this.multiply([1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1])},transpose:function(){return new Matrix3D([this.entities[0],this.entities[4],this.entities[8],this.entities[12],this.entities[1],this.entities[5],this.entities[9],this.entities[13],this.entities[2],this.entities[6],this.entities[10],this.entities[14],this.entities[3],this.entities[7],this.entities[11],this.entities[15]])},toString:function(){return"matrix3d("+this.entities.join(",")+")"}},window.Matrix3D=Matrix3D;var MobileMenu={init:function(){MobileMenu.node=$("<div id='mobmenu'><div class='r'></div><div class='b'></div></div>"),MobileMenu.node.append("<div class='mobmain'><div class='l'></div><div class='m'></div><div class='r'></div></div>"),$("#overlay").append(MobileMenu.node)},open:function(){}},Preloader={start:function(){},progress:function(e){$("#preloader").html(e+"%")}},Remote={ajax:function(e){return player.offline&&void 0!=e.offline&&(e.url="data/"+e.offline),$.ajax(e)}},Screen={xs:function(){return $(window).width()<768?!0:!1},mobile:function(){return Screen.xs()},desktop:function(){return Screen.md()||Screen.lg()},md:function(){return $(window).width()<1280&&$(window).width()>=768?!0:!1},lg:function(){return $(window).width()>=1280?!0:!1},isLandscape:function(){return $(window).width()>$(window).height()},isPortrait:function(){return $(window).width()<$(window).height()}},ScrollBar={bars:{},update:function(e){"touchstart"!=Events.pointer.down&&(ScrollBar.bars.hasOwnProperty(e)?$(e).getNiceScroll().resize():($(e).niceScroll({cursorborder:"0px"}),ScrollBar.bars[e]=!0))}},SpotHelper={screenToSphereCoords:function(e,t,i){var a=new THREE.Matrix4,n=new THREE.Matrix4,s=$("body"),o=new THREE.Raycaster,r=new THREE.Vector2;void 0!=i?(r.x=e,r.y=t):(r.x=e/s.width()*2-1,r.y=2*-(t/s.height())+1),o.setFromCamera(r,player.currentView.renderer.camera);var l=o.intersectObject(player.currentView.renderer.preview,!1),p=new THREE.Vector4;p.fromArray([l[0].point.x,l[0].point.y,l[0].point.z,0]),n.makeRotationY((360-180*player.currentView.renderer.jaw/Math.PI)*Math.PI/180),a.makeRotationX(-1*player.currentView.renderer.pitch),n.multiply(a),p=p.applyMatrix4(n);var d=new THREE.Vector4;return d.fromArray([l[0].point.x,l[0].point.y,l[0].point.z,0]),n.makeRotationY(-player.currentView.renderer.preview.rotation.y),a.makeRotationX(-player.currentView.renderer.preview.rotation.x),n.multiply(a),d=d.applyMatrix4(n),{out:new Vector3D(p.x,p.y,p.z),"in":new Vector3D(d.x,d.y,d.z)}}};DummySpot.prototype={setVisibility:function(e){e?this.node.css("visibility","visible"):this.node.css("visibility","hidden")},updateScreenCoords:function(e,t){Math.abs((e-.5*HotSpotManager.playerWidth)/(.5*HotSpotManager.playerWidth));this.node3D.resetTransform(),this.node3D.translate(e,t,0),this.node3D.applyTransforms()},appendUI:function(e){this.node.append(e)}},PlaneSpot3D.prototype={setVisibility:function(e){},setPosition:function(e,t){this.pos=new Vector3D(.9*t.x,.9*t.y,.9*t.z)},setLayer:function(e){},updateScreenCoords:function(e,t){void 0!=this.spotPlate&&(this.spotPlate.position.set(this.pos.x*this.layerMul,this.pos.y*this.layerMul,this.pos.z*this.layerMul),this.spotPlate.quaternion.copy(sphereWebGLStatic.self.camera.quaternion),this.spotPlate.lookAt(new Vector3D(0,0,0))),void 0!=this.spotPlateOutline&&(this.spotPlateOutline.position.set(this.pos.x*this.layerMul,this.pos.y*this.layerMul,this.pos.z*this.layerMul),this.spotPlateOutline.quaternion.copy(sphereWebGLStatic.self.camera.quaternion),this.spotPlateOutline.lookAt(new Vector3D(0,0,0)));Math.abs((e-.5*HotSpotManager.playerWidth)/(.5*HotSpotManager.playerWidth));if(this.node3D.resetTransform(),this.node3D.translate(e,t,0),this.node3D.applyTransforms(),void 0!=HotSpotManager.cursor3D.raycaster){var i=HotSpotManager.cursor3D.raycaster.intersectObject(this.spotPlate,!1);this.clicked?this.scale>.1&&(this.scale*=.9):void 0!=this.sphereSpot.data.record.settings&&void 0!=this.sphereSpot.data.record.settings.scale&&(this.scale=.01*parseFloat(this.sphereSpot.data.record.settings.scale)),this.spotPlate.scale.set(this.scale,this.scale,this.scale),void 0!=this.spotPlateOutline&&this.spotPlateOutline.scale.set(this.scale,this.scale,this.scale),i.length>0?(panoramaViewStatic.root.panning&&(this.clicked=!0),this.blink(!0)):this.blink(!1)}},appendUI:function(e){this.node.append(e)},blink:function(e){e?this.spotPlate.material.opacity=.85:this.spotPlate.material.opacity=1}},Collectible3D.prototype={filterMtx:function(e,t,i,a,n,s,o,r,l,p){for(var d=.5*(a-1),c=.5*(n-1),h=0,u=0,m={r:0,g:0,b:0,a:0},f=i-c;i+c>=f;f++){h=0;for(var g=t-d;t+d>=g;g++){var v=s[h+u*a]*p;value=e[4*(g+f*o)+3],
isNaN(value)&&(value=0),m.a+=value*v,h++}u++}return m.a=m.a/l,m},addGlow:function(e,t,i){for(var a=new Uint8Array(4*t*i),n=0;i>n;n++)for(var s=0;t>s;s++){({r:e[4*(s+n*t)],g:e[4*(s+n*t)+1],b:e[4*(s+n*t)+2],a:e[4*(s+n*t)+3]});a[4*(s+(i-n)*t)]=255,a[4*(s+(i-n)*t)+1]=255,a[4*(s+(i-n)*t)+2]=255;var o=0;o=e[4*(s+n*t)+3],o=o>120?255:0,a[4*(s+(i-n)*t)+3]=o}for(var r=new Uint8Array(4*t*i),l=null,p=1;4>p;p++){for(var n=0;i>n;n++)for(var s=0;t>s;s++){var d=[1,4,7,4,1,4,16,26,16,4,7,26,41,26,7,4,16,26,16,4,1,4,7,4,1],d=[1,1,1,1,1,1,1,1,1],c=this.filterMtx(a,s,n,3,3,d,t,i,9,1);r[4*(s+n*t)]=255,r[4*(s+n*t)+1]=255,r[4*(s+n*t)+2]=255;var h=.5*a[4*(s+n*t)+3]+c.a;h>255&&(h=255),r[4*(s+n*t)+3]=h}l=r,r=a,a=l}return a},prepareStates:function(){this.sm=new StateMachine(this,{}),this.sm.addState("idle",{handle:function(e,t){if(this.clicked&&"collect"==this.c.type){this.sounds.collect.play();var i="/storage/collectibles/"+this.c.icon;return t.collect=$("<div style='transform: translate(-50%, -50%);position:absolute;'><img src='"+i+"' style='width: 100px;'></div>"),t.collect.css("opacity","0"),$("#hotspots").append(t.collect),t.x=this.x2d,t.y=this.y2d,t.cx=t.x,t.cy=t.y,t.dy=1,t.dx=1,t.alpha=0,t.collect.css("left",this.x2d),t.collect.css("top",this.y2d),this.erp.setStart({alpha:0}),this.erp.setEnd({alpha:1}),this.erp.reset(),"collect"}void 0!=this.sphereSpot.data.record.settings&&void 0!=this.sphereSpot.data.record.settings.scale&&(this.scale=.01*parseFloat(this.sphereSpot.data.record.settings.scale))}}),this.erp=new Interpolate,this.sm.addState("collecting",{handle:function(e,t){this.erp.next(.2);var i=this.erp.cycleProperty("alpha","easeInCubic");if(t.collect.css("transform","translate(-50%, -50%) scale("+i+", "+i+")"),t.collect.css("opacity",i),this.erp.pos>=1){this.spotPlate.visible=!1,void 0!=this.spotPlateOutline&&(this.spotPlateOutline.visible=!1),this.clicked=!1,Equipment.collect(this.c);var a=Equipment.dropPosition();return a.alpha=0,this.erp.setStart({x:t.x,y:t.y,alpha:1}),this.erp.setEnd({x:a.x,y:a.y,alpha:0}),this.erp.reset(),"done"}return null}}),this.sm.addState("flying",{handle:function(e,t){Equipment.dropPosition();return this.erp.next(.8),t.cy=this.erp.cycleProperty("y","easeInCubic"),t.cx=this.erp.cycleProperty("x","linear"),t.alpha=this.erp.cycleProperty("alpha","easeInCubic"),t.collect.css("left",t.cx),t.collect.css("top",t.cy),t.collect.css("opacity",t.alpha),void 0==this.rot?this.rot=0:this.rot+=5,t.collect.css("transform","translate(-50%, -50%) rotate("+this.rot+"deg)"),this.erp.pos<=1?null:"done"}}),this.sm.addState("collected",{handle:function(e,t){return this.sounds.backpack.play(),Equipment.vibrate(),!0}}),this.sm.transit("idle","collect","collecting"),this.sm.transit("collecting","done","flying"),this.sm.transit("flying","done","collected")},setVisibility:function(e){},setPosition:function(e,t){this.pos=new Vector3D(.9*t.x,.9*t.y,.9*t.z)},setLayer:function(e){switch(e){case"1":this.layerMul=1;break;case"2":this.layerMul=.95;break;case"3":this.layerMul=.9;break;case"4":this.layerMul=.85;break;case"5":this.layerMul=.8;break;case"6":this.layerMul=.75;break;case"7":this.layerMul=.7;break;case"8":this.layerMul=.65;break;case"9":this.layerMul=.6;break;case"10":this.layerMul=.55}},process:function(){this.sm.process()},updateScreenCoords:function(e,t){void 0!=this.spotPlate&&(this.spotPlate.position.set(this.pos.x*this.layerMul,this.pos.y*this.layerMul,this.pos.z*this.layerMul),this.spotPlate.quaternion.copy(sphereWebGLStatic.self.camera.quaternion),this.spotPlate.lookAt(new Vector3D(0,0,0)),void 0!=this.spotPlateOutline&&(this.spotPlateOutline.position.set(this.pos.x*this.layerMul,this.pos.y*this.layerMul,this.pos.z*this.layerMul),this.spotPlateOutline.quaternion.copy(sphereWebGLStatic.self.camera.quaternion),this.spotPlateOutline.lookAt(new Vector3D(0,0,0))),this.firstShow&&(this.spotPlate.scale.set(this.scale*this.layerMul,this.scale*this.layerMul,this.scale*this.layerMul),void 0!=this.spotPlateOutline&&(this.spotPlateOutline.scale.set(this.scale*this.layerMul,this.scale*this.layerMul,this.scale*this.layerMul),this.spotPlateOutline.visible=!0),this.spotPlate.visible=!0,this.firstShow=!1));Math.abs((e-.5*HotSpotManager.playerWidth)/(.5*HotSpotManager.playerWidth));if(this.x2d=e,this.y2d=t,this.node3D.resetTransform(),this.node3D.translate(e,t,0),this.node3D.applyTransforms(),void 0!=HotSpotManager.cursor3D.raycaster){var i=HotSpotManager.cursor3D.raycaster.intersectObject(this.spotPlate,!1);if(this.spotPlate.scale.set(this.scale,this.scale,this.scale),void 0!=this.spotPlateOutline&&this.spotPlateOutline.scale.set(this.scale,this.scale,this.scale),void 0!=this.sphereSpot.data.record.settings.alpha&&1==player.cms&&(this.spotPlate.material.opacity=.01*parseFloat(this.sphereSpot.data.record.settings.alpha)),this.clicked=!1,i.length>0&&this.sphereSpot.visible?(panoramaViewStatic.root.panning&&this.proceed(),this.hovering=!0,Tooltip.show(this.c.title),this.blink(!0)):(this.hovering=!1,this.blink(!1)),null!=Equipment.dragging&&Equipment.dragging.id==this.c.settings.accept){void 0!=this.spotPlateOutline&&(this.spotPlateOutline.visible=!0);var a=Math.pow(this.x2d-player._mouseHoverX,2)+Math.pow(this.y2d-player._mouseHoverY,2);this.spotPlate.material.opacity=1,1e4>a&&(this.hovering=!0)}else"deliver"==this.c.type&&(void 0!=this.delivered||"1"==player.cms&&"1"==this.sphereSpot.data.record.settings._ed_alpha||(this.spotPlate.material.opacity=.3),this.spotPlateOutline.visible=!1)}},proceed:function(){return void 0==this.released||0!=this.released?(this.released=!1,"quiz"==this.c.require.type?void Quiz.quest(this.c.require.id,"/storage/collectibles/"+this.c.icon,function(e){1==e&&(this.clicked=!0)}.bind(this)):void(this.clicked=!0)):void 0},mouseUp:function(){this.released=!0,"deliver"==this.c.type&&this.hovering&&null!=Equipment.dragging&&Equipment.dragging.id==this.c.settings.accept&&(this.delivered=!0,this.spotPlate.material.opacity=1,Equipment.dragDelivered()),this.hovering&&"click_toggle"==this.c.require.type&&(this.spotPlate.material.opacity=this.spotPlate.material.opacity>0?0:1)},appendUI:function(e){this.node.append(e)},blink:function(e){},destroy:function(){sphereWebGLStatic.self.preview.remove(this.spotPlate),this.node.remove()}},SpotMod.prototype={reposition:function(e){if(this.dragging){var t=e.pageX-this.dragX,i=e.pageY-this.dragY;this.dest.x+=t,this.dest.y+=i;var a=this.origin.x+this.dest.x,n=this.origin.y+this.dest.y,s=(a-.5*HotSpotManager.playerWidth)/(.5*HotSpotManager.playerWidth),o=(n-.5*HotSpotManager.playerHeight)/(.5*HotSpotManager.playerHeight),r=SpotHelper.screenToSphereCoords(s,-o,!0);this.sphereSpot.setPosition(r.out,r["in"]),this.dragX=e.pageX,this.dragY=e.pageY}}},SphereSpot.prototype={edit:function(){this.mod=new SpotMod(this,this.data.record.type,this.data.record.title)},setPosition:function(e,t){this.coords={x:e.x,y:e.y,z:e.z},this.sphere={x:t.x,y:t.y,z:t.z},this.vec3D=new Vector3D(this.coords.x,this.coords.y,this.coords.z),void 0!=this.holder.setPosition&&this.holder.setPosition(this.coords,this.sphere)},remove:function(){this.holder.remove()},process:function(e,t){var i=new Vector3D(0,0,0),a=new Vector3D(0,0,0);if(i.x=this.vec3D.x,i.y=this.vec3D.y,i.z=this.vec3D.z,a.x=this.vec3D.x,a.y=this.vec3D.y,a.z=this.vec3D.z,a.normalize(),void 0!=this.holder.process&&this.holder.process(),a.dot(t)>0)return this.visible=!1,void this.holder.setVisibility(!1);this.holder.setVisibility(!0),i.transformByMatrix(e);var n=i.projectTo2D();return fx=-n.x*(.5*HotSpotManager.playerWidth)+.5*HotSpotManager.playerWidth,fy=n.y*(.5*HotSpotManager.playerHeight)+.5*HotSpotManager.playerHeight,this.updatePosition&&this.holder.updateScreenCoords(fx,fy),fx<0||fy<0||fx>HotSpotManager.playerWidth||fy>HotSpotManager.playerHeight?this.visible=!1:this.visible=!0,this.holder.setVisibility(this.visible),this.screen={x:fx,y:fy},{x:fx,y:fy}},destroy:function(){this.holder.destroy()}},StateMachine.prototype={addState:function(e,t){this.states[e]={behavior:t},""==this.current&&(this.current={state:e,extra:{}})},transit:function(e,t,i,a){void 0==this.transitions[e]&&(this.transitions[e]={}),this.transitions[e][t]={state:i,extra:a}},process:function(){if(""!=this.current){var e=this.states[this.current.state].behavior.handle.bind(this.context),t=e(this,this.payload,this.current.extra);if(null!=t)try{var i=this.transitions[this.current.state][t];void 0!=i&&(this.current=i)}catch(a){this.current=""}}}};var TPL={templates:{},langs:{},defaults:{},init:function(e,t){Handlebars.registerHelper("lng",function(e,t){return new Handlebars.SafeString(TPL.lng(e,t))}),void 0!=e&&""!=e?(TPL.skinName=e,$("body").append("<div id='skin-container'></div>"),$.getJSON("skins/"+e+"/config.json",function(i){TPL.skin=i;for(var a in TPL.skin.templates){var n=(TPL.skin.templates[a],$("<div></div>"));$("#skin-container").append(n),n.load("skins/"+e+"/"+TPL.skin.templates[a]+"?"+Date.now())}for(var a in TPL.skin.styles){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href="skins/"+e+"/"+TPL.skin.styles[a]+"?"+Date.now(),document.getElementsByTagName("head")[0].appendChild(s)}t()})):t()},lng:function(e,t){var i=Handlebars.escapeExpression(e);Handlebars.escapeExpression(t);return void 0!=t&&""!=t?TPL.defaults[e]=t:void 0!=t&&""!=t||void 0==TPL.defaults[e]||(t=TPL.defaults[e]),TPL.langs.hasOwnProperty(i)?TPL.langs[i]:t},render:function(e,t){if(void 0!=TPL.skinName&&void 0!=TPL.skin&&void 0!=TPL.skin.skinned&&void 0!=TPL.skin.skinned[e]&&(e=TPL.skin.skinned[e]),void 0==TPL.templates[e]){var i=$("#"+e).html(),a=Handlebars.compile(i);TPL.templates[e]=a}var n=TPL.templates[e];return n(t)},loadTemplate:function(e,t){var i,a;$.ajax({url:t,cache:!0,success:function(t){i=t,a=Handlebars.compile(i),TPL.templates[e]=a}})}},Tab={groups:{},gidx:[],idx:-1,eidx:-1,last:null,cancels:[],disabled:{},simpleTabInput:function(e,t,i,a){return e.on("blur",function(e){e.preventDefault()}),e.on("keydown",function(e){void 0==a&&9===e.which&&setTimeout(function(){Tab.cycle(e.shiftKey)},50)}),Tab.simpleTab(e,t,i)},simpleTab:function(e,t,i,a){return new function(){this.focus=function(e){e.getNode("focus").addClass(e.$class),e.getNode().focus()},this.blur=function(e){e.getNode("focus").removeClass(e.$class),e.getNode().blur()},this._params={},this._params.$node=e,this._params.$focusnode=a,this._params.getNode=function(e){return"focus"==e&&void 0!=this.$focusnode?"function"==typeof this.$focusnode?this.$focusnode():this.$focusnode:"function"==typeof this.$node?this.$node():this.$node},(void 0==i||""==i)&&(i="focused"),this._params.$class=i,this.order=t}},cancelStackAdd:function(e,t){for(var i in Tab.cancels)if(Tab.cancels[i].id==e)return void(Tab.cancels[i].call=t);Tab.cancels.push({id:e,call:t})},cancelStackRemove:function(e){for(var t in Tab.cancels)if(Tab.cancels[t].id==e)return void Tab.cancels.splice(t,1)},keyDown:function(e){if(-1==Tab.idx)return!0;var t=Tab.gidx[Tab.idx];return"Enter"==e.key&&0==Tab.groups[t].elements[Tab.eidx].defaultAction&&(Tab.groups[t].elements[Tab.eidx].element.action(Tab.groups[t].elements[Tab.eidx].params,e),e.preventDefault(),e.stopPropagation()),"Enter"!=e.key&&Tab.groups[t].elements[Tab.eidx].element.keyboard&&Tab.groups[t].elements[Tab.eidx].element.keyboard(Tab.groups[t].elements[Tab.eidx].params,e),!0},keyUp:function(e){if(("Escape"==e.key||"Backspace"==e.key)&&Tab.cancels.length>0){var t=Tab.cancels.pop();return t.call(),e.preventDefault(),e.stopPropagation(),player.blockBackspace=!0,!1}return!0},setGroup:function(e,t){Tab.groups[e]=new TabGroup(e,t,!0),Tab.gidx.push(e)},enableAllGroups:function(){for(var e in Tab.groups)Tab.groups[e].enabled=!0},disableGroupsExcept:function(e){for(var t in Tab.groups)t!=e&&(Tab.groups[t].enabled=!1);Tab.groups[e].enabled=!0},add:function(e,t,i,a){var n=e+"-"+Math.random().toString(36).substring(7)+"-"+Date.now();void 0!=t._params&&(i=t._params);var s={element:t,params:i,defaultAction:a,id:n};return"-"!=Tab.groups[e].order?Tab.groups[e].append(s,t.order):Tab.groups[e].prepend(s,t.order),s},findById:function(t,i){for(e in Tab.groups[t].elements)if(Tab.groups[t].elements[e].id==i)return e;return null},addAfter:function(e,t,i,a,n){var s=e+"-"+Math.random().toString(36).substring(7)+"-"+Date.now();void 0!=i._params&&(a=i._params);var o={element:i,params:a,defaultAction:n,id:s};return Tab.groups[e].insertAt(t,o),o},remove:function(e,t){Tab.groups[e].removeById(t),void 0!=this.disabled[t]&&delete this.disabled[t]},enable:function(e,t){var i=null;for(var a in Tab.groups[e].elements)if(Tab.groups[e].elements[a].id==t){i=a;break}null!=i&&(Tab.groups[e].elements[a].disabled=!1)},enableAll:function(e){for(var t in Tab.groups[e].elements)Tab.groups[e].elements[t].disabled=!1},disable:function(e,t){var i=null;for(var a in Tab.groups[e].elements)if(Tab.groups[e].elements[a].id==t){i=a;break}null!=i&&(Tab.groups[e].elements[a].disabled=!0)},clearGroup:function(e){Tab.groups[e].clear()},reset:function(){Tab.idx=-1,Tab.eidx=-1,null!=Tab.last&&Tab.last.element.blur(Tab.last.params)},cycle:function(e){var t;if(HotSpotManager.closest&&HotSpotManager.closest.hide(),null!=Tab.last&&Tab.last.element.blur(Tab.last.params),-1==Tab.idx&&(Tab.idx=0),grp=Tab.gidx[Tab.idx],!Tab.groups[grp].enabled){for(Tab.idx++,t=e?-1:1;Tab.idx<Tab.gidx.length&&!Tab.groups[Tab.gidx[Tab.idx]].enabled;)Tab.idx+=t;if(!Tab.groups[Tab.gidx[Tab.idx]].enabled)return}if(e){if(Tab.eidx--,grp=Tab.gidx[Tab.idx],Tab.eidx>=0&&Tab.groups[grp].elements[Tab.eidx].disabled===!0)return void Tab.cycle(e);if(Tab.eidx<0){for(Tab.idx--;Tab.idx>0&&(0==Tab.groups[Tab.gidx[Tab.idx]].elements.length||!Tab.groups[Tab.gidx[Tab.idx]].enabled);)Tab.idx--;for(Tab.idx<0&&(Tab.idx=Tab.gidx.length-1);(0==Tab.groups[Tab.gidx[Tab.idx]].elements.length||!Tab.groups[Tab.gidx[Tab.idx]].enabled)&&Tab.idx>0;)Tab.idx--;grp=Tab.gidx[Tab.idx],Tab.eidx=Tab.groups[grp].elements.length-1}grp=Tab.gidx[Tab.idx],Tab.groups[grp].elements[Tab.eidx].element.focus(Tab.groups[grp].elements[Tab.eidx].params),Tab.last=Tab.groups[grp].elements[Tab.eidx]}else{if(Tab.eidx++,grp=Tab.gidx[Tab.idx],Tab.eidx<Tab.groups[grp].elements.length&&Tab.groups[grp].elements[Tab.eidx].disabled===!0)return void Tab.cycle(e);if(Tab.eidx>=Tab.groups[grp].elements.length){for(Tab.eidx=0,Tab.idx++;Tab.idx<Tab.gidx.length&&(0==Tab.groups[Tab.gidx[Tab.idx]].elements.length||!Tab.groups[Tab.gidx[Tab.idx]].enabled);)Tab.idx++;for(Tab.idx>=Tab.gidx.length&&(Tab.idx=0);(0==Tab.groups[Tab.gidx[Tab.idx]].elements.length||!Tab.groups[Tab.gidx[Tab.idx]].enabled)&&Tab.idx<Tab.gidx.length;)Tab.idx++}grp=Tab.gidx[Tab.idx],Tab.groups[grp].elements[Tab.eidx].element.focus(Tab.groups[grp].elements[Tab.eidx].params),Tab.last=Tab.groups[grp].elements[Tab.eidx]}}},Tooltip={init:function(){void 0==Tooltip.initialized&&(Tooltip.node=$("<div style='position: absolute;left:0px;top:0px;padding: 4px; background-color: #ffffff;border-radius: 4px; color: #000000;pointer-events: none; opacity: 0;font-size:12px;'></div>"),Tooltip.initialized=!0,$("body").append(Tooltip.node),setInterval(Tooltip.process,20))},show:function(e){Tooltip.init(),Tooltip.node.html(e),Tooltip.node.css("opacity",1),void 0!=Tooltip.hiding&&clearTimeout(Tooltip.hiding),Tooltip.hiding=setTimeout(function(){Tooltip.node.css("opacity",0),Tooltip.hiding=void 0},20)},process:function(){Tooltip.node.css("left",player._mouseHoverX),Tooltip.node.css("top",player._mouseHoverY)}};Tween.prototype.easeInOutQuad=function(e,t,i,a){return e/=a/2,1>e?i/2*e*e+t:(e--,-i/2*(e*(e-2)-1)+t)},Tween.prototype.start=function(e,t,i,a){if(this.easing=a,this.origin=e,this.current=e,this.time=i,this.destination=t,this.running=!0,this.waits>0){var n=this;setTimeout(function(){n.sdt=Date.now(),player.addProcess(n)},this.waits)}else this.sdt=Date.now(),player.addProcess(this)},Tween.prototype.wait=function(e){return this.waits=e,this},Tween.prototype.stop=function(){this.running=!1},Tween.prototype.isRunning=function(){return this.running},Tween.prototype.process=function(){if(this.running){var e=Date.now();this.current=this.easeInOutQuad(e-this.sdt,this.origin,this.destination-this.origin,this.time),this.func(this.current),e-this.sdt>this.time&&(this.func(this.destination),this.running=!1,player.removeProcess(this),this.finished())}},UIElement.prototype={calculateCoords:function(e,t){this.originX=e,this.originY=t,e=parseInt(e),t=parseInt(t),void 0!=this.params&&("r"==this.params.align?e=$("#player").width()-e-this.node.width():"c"==this.params.align&&(e=.5*$("#player").width()-.5*this.node.width()),"b"==this.params.valign?t=$("#player").height()-t-this.node.height():"m"==this.params.valign&&(t=.5*$("#player").height()-.5*this.node.height())),this.x=e,this.y=t},update:function(){this.node.css("left",this.x+"px"),this.node.css("top",this.y+"px")},hpos:function(){if(void 0!=this.params.align){if("r"==this.params.align)return $("#player").width()-(this.x+this.node.width());if("c"==this.params.align)return 0}return this.x},vpos:function(){if(void 0!=this.params.valign){if("b"==this.params.valign)return $("#player").height()-(this.y+this.node.height());if("m"==this.params.valign)return 0}return this.y},getEmbedInfo:function(e){if(e.match(/(http:|https:|)\/\/(player.|www.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com))\/(video\/|embed\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(\&\S+)?/),RegExp.$3.indexOf("youtu")>-1)var t="youtube";else{if(!(RegExp.$3.indexOf("vimeo")>-1))return!1;var t="vimeo"}var i={url:e,type:t,id:RegExp.$6,embedUrl:"//www.youtube.com/embed/"+RegExp.$6};return i},getEmbedUrl:function(e){var t=this.getEmbedInfo(e);return t.embedUrl},verify:function(e,t){var i=[e,t];return JSON.stringify(i)},refresh:function(){if(3==this.type&&(void 0==this.params.muted&&(this.params.muted=!0),Screen.xs())){var e="?rel=0&";void 0!=this.params.start&&this.params.start>0&&(e+="start="+this.params.start+"&"),1==this.params.autostart&&(e+="autoplay=1&"),(void 0==this.params.muted||1==this.params.muted)&&(e+="mute=1&"),MediaWidget.addMediaUrl(this.getEmbedInfo(this.params.yturl),e)}},animTrans:function(e,t){var i=this.node.find(".container img"),a=parseFloat(i.eq(t).css("opacity")),n=parseFloat(i.eq(e).css("opacity"));1>a?i.eq(t).css("opacity",a+.1):n>0&&i.eq(e).css("opacity",n-.1);var s=this;(1>a||n>0)&&setTimeout(function(){s.animTrans(e,t)},20)},animationCycle:function(){var e=this.params.frames[this.currentAnimationFrame],t=this;this.animationTimer=setTimeout(function(){var e=t.currentAnimationFrame;t.currentAnimationFrame++,t.currentAnimationFrame>=t.params.frames.length&&(t.currentAnimationFrame=0),t.animTrans(e,t.currentAnimationFrame),t.animationCycle()},1e3*e.delay*this.params.speed)},build:function(e){if(this.params=e,this.verification!=this.verify(this.type,e)){if(4==this.type&&this.lasthtml!=this.params.html&&(this.node.find(".container").html(this.params.html),this.lasthtml=this.params.html),1==this.type){var t=new Image,i=this;t.onload=function(){i.calculateCoords(i.originX,i.originY),i.update()},t.src="/storage/library/"+player.current.folder.city_id+"/"+e.frames[0].image;for(var a in e.frames)0==a?this.node.find(".container").html("<img src='/storage/library/"+player.current.folder.city_id+"/"+e.frames[0].image+"'>"):this.node.find(".container").append($("<img src='/storage/library/"+player.current.folder.city_id+"/"+e.frames[a].image+"' style='position: absolute; opacity:0;left:0px;top:0px;'>"));this.currentAnimationFrame=0,void 0!=this.animationTimer&&clearTimeout(this.animationTimer),this.animationCycle()}if(3==this.type)if(void 0==this.params.muted&&(this.params.muted=!0),Screen.xs()){var n="?rel=0&";void 0!=this.params.start&&this.params.start>0&&(n+="start="+this.params.start+"&"),1==this.params.autostart&&(n+="autoplay=1&"),(void 0==this.params.muted||1==this.params.muted)&&(n+="mute=1&"),MediaWidget.addMediaUrl(this.getEmbedInfo(this.params.yturl),n)}else{var s=void 0==this.params.width?450:this.params.width,o=void 0==this.params.height?220:this.params.height,n="?rel=0&";if(void 0!=this.params.start&&this.params.start>0&&(n+="start="+this.params.start+"&"),1==this.params.autostart&&(n+="autoplay=1&"),(void 0==this.params.muted||1==this.params.muted)&&(n+="mute=1&"),void 0!=this.params.yturl){var r=this.getEmbedInfo(this.params.yturl);if(this.node.find(".container").html("<div id='yt-uie-iframe-"+this.id+"'></div>"),this.ytid=YTPlayer.embed("yt-uie-iframe-"+this.id,r.id,s,o),this.params.muted&&setTimeout(function(){Volume.yt.set(0)},3005),1==this.params.autostart){var i=this;setTimeout(function(){console.log(i.ytid),console.log(YTPlayer.api(i.ytid)),YTPlayer.api(i.ytid).playVideo()},3e3)}this.node.find(".container").append($("<a href='javascript:void(null)' class='ytclose' id='ytclose-"+this.id+"' title='"+TPL.lng("tips.clicktocloseyt","Kliknij aby zamknąć film youtube")+"'>&times;</a>")),this.ytclose_tab=Tab.add("elements",{focus:function(e){e.node.addClass("focused"),void 0==e.focus?e.node.focus():e.focus.focus()},blur:function(e){e.node.removeClass("focused")}},{node:$("#ytclose-"+this.id)}),this.player_tab=Tab.add("elements",{focus:function(e){e.node.addClass("focused"),void 0==e.focus?e.node.focus():e.focus.focus()},blur:function(e){e.node.removeClass("focused")},keyboard:function(e,t){" "==t.key&&(1==YTPlayer.api(e.ytid).getPlayerState()?YTPlayer.api(e.ytid).pauseVideo():YTPlayer.api(e.ytid).playVideo())}},{node:this.node,ytid:this.ytid});var i=this;$("#ytclose-"+this.id).click(function(){i.node.hide(),Tab.disable("elements",i.ytclose_tab.id),Tab.disable("elements",i.player_tab.id),YTPlayer.api(i.ytid).pauseVideo(),MediaWidget.showIcon(i)})}this.node.css("width",s+"px"),this.node.css("height",o+"px")}else if(2==this.type&&void 0!=this.params.videourl){this.vplayer=new vplayer("1"==player.cms?!0:void 0),this.node.find(".container").html(this.vplayer.embed()),this.node.find(".container").append($("<a href='javascript:void(null)' class='ytclose' id='vidclose-"+this.id+"' title='"+TPL.lng("tips.clicktocloseyt","Kliknij aby zamknąć film")+"'>&times;</a>"));var s=void 0==this.params.width?450:this.params.width,o=void 0==this.params.height?220:this.params.height;this.vplayer.setSize(s,o),player.offline&&(this.params.videourl=this.params.videourl.replace("https://www.wkraj.pl",".")),this.vplayer.load(this.params.videourl);var i=this;MediaWidget.getIconStatus("vid")?(this.node.hide(),setTimeout(function(){MediaWidget.showIcon(i,"<img src='assets/deaf.png' width='42'>",TPL.lng("tips.signlanguage","Język migowy"),"vid")},200)):(1==this.params.autostart||"true"==this.params.autostart)&&setTimeout(function(){i.vplayer.play()},100),$("#vidclose-"+this.id).click(function(){i.node.hide(),i.vplayer.stop(),MediaWidget.showIcon(i,"<img src='assets/deaf.png' width='42'>",TPL.lng("tips.signlanguage","Język migowy"),"vid")})}this.verification=this.verify(this.type,e),player.cms&&this.editor.update()}},destroy:function(){MediaWidget.showIcon(null),this.node.remove(),void 0!=this.ytclose_tab&&Tab.remove("elements",this.ytclose_tab.id),void 0!=this.player_tab&&Tab.remove("elements",this.player_tab.id)}},UIElementEdit.prototype.addUI=function(){this.mover=$("<div class='elem_mover'></div>"),this.hs.node.append(this.mover),this.rulers={},this.rulers.l=$("<div class='hruler'></div>"),this.rulers.r=$("<div class='hruler'></div>"),this.rulers.t=$("<div class='vruler'></div>"),this.rulers.b=$("<div class='vruler'></div>"),this.playernode.append(this.rulers.l),this.playernode.append(this.rulers.r),this.playernode.append(this.rulers.t),this.playernode.append(this.rulers.b);var e=this;this.mover.on(Events.pointer.down,function(t){var i=Events.getPointerEvent(t);e.mouseDown(i)}),this.update()},UIElementEdit.prototype.addSprite=function(){},UIElementEdit.prototype.updateRulers=function(){var e=this.playernode.width(),t=this.playernode.height(),i=this.hs.node.width(),a=this.hs.node.height(),n=.5*i,s=.5*a;void 0!=this.rulers&&(this.rulers.l.css("right",e-this.hs.x+"px"),this.rulers.l.css("top",this.hs.y+s+"px"),this.rulers.r.css("left",this.hs.x+i+"px"),this.rulers.r.css("top",this.hs.y+s+"px"),this.rulers.t.css("left",this.hs.x+n+"px"),this.rulers.t.css("bottom",t-this.hs.y+"px"),this.rulers.b.css("left",this.hs.x+n+"px"),this.rulers.b.css("top",this.hs.y+a+"px"),this.hs.x>.5*e-n?(this.hs.params.align="r",this.rulers.l.css("visibility","hidden"),this.rulers.r.css("visibility","visible")):this.hs.x<.5*e-n?(this.hs.params.align="l",this.rulers.l.css("visibility","visible"),this.rulers.r.css("visibility","hidden")):(this.hs.params.align="c",this.rulers.l.css("visibility","visible"),this.rulers.r.css("visibility","visible")),this.hs.y>.5*t-s?(this.hs.params.valign="b",this.rulers.t.css("visibility","hidden"),this.rulers.b.css("visibility","visible")):this.hs.y<.5*t-s?(this.hs.params.valign="t",this.rulers.t.css("visibility","visible"),this.rulers.b.css("visibility","hidden")):(this.hs.params.valign="m",this.rulers.t.css("visibility","visible"),this.rulers.b.css("visibility","visible")))},UIElementEdit.prototype.update=function(){.5*this.hs.node.width(),.5*this.hs.node.height()},UIElementEdit.prototype.click=function(e){self=this,$(".elem_mover").hide(),this.mover.show(),UIEdit.select(this)},UIElementEdit.prototype.mouseDown=function(e){this.drag={},this.drag.x=e.pageX,this.drag.y=e.pageY,this.down=!0,Cms.root.$refs.uiedit.ghost(!0),this.lx=this.hs.x,this.ly=this.hs.y,self=this,this.playernode.one(Events.pointer.up,function(e){var t=Events.getPointerEvent(e);self.mouseUp(t)}),this.playernode.on(Events.pointer.move,function(e){var t=Events.getPointerEvent(e);self.mouseMove(t)}),this.node.css("pointer-events","none");try{UIEdit.select(this)}catch(t){}this.updateRulers(),e.origin.preventDefault()},UIElementEdit.prototype.mouseUp=function(e){if(self=this,this.playernode.off(Events.pointer.move,function(e){var t=Events.getPointerEvent(e);self.mouseMove(t)}),this.node.css("pointer-events","all"),Cms.root.$refs.uiedit.ghost(!1),this.dragging){this.down=!1,this.dragging=!1;var t=e.pageX-this.drag.x,i=e.pageY-this.drag.y;isNaN(t)||(this.hs.x+=t),isNaN(i)||(this.hs.y+=i),this.hs.update()}else this.down=!1,this.dragging=!1;void 0!=this.rulers&&(this.rulers.l.css("visibility","hidden"),this.rulers.r.css("visibility","hidden"),this.rulers.t.css("visibility","hidden"),this.rulers.b.css("visibility","hidden")),e.origin.preventDefault()},UIElementEdit.prototype.mouseMove=function(e){var t=this.playernode.width(),i=this.playernode.height(),a=this.hs.node.width(),n=this.hs.node.height();if(this.down){this.dragging=!0;var s=e.pageX-this.drag.x,o=e.pageY-this.drag.y;isNaN(s)||(this.hs.x+=s,this.lx+=s),isNaN(o)||(this.hs.y+=o,this.ly+=o),Math.abs(this.lx+.5*a-.5*t)<30&&(this.hs.x=.5*t-.5*a),Math.abs(this.ly+.5*n-.5*i)<30&&(this.hs.y=.5*i-.5*n),this.hs.update(),this.drag.x=e.pageX,this.drag.y=e.pageY,this.updateRulers(),this.hs.originX=this.hs.hpos(),this.hs.originY=this.hs.vpos()}e.origin.preventDefault()},Vector3D.prototype={projectTo2D:function(){var e=this.x/this.w,t=this.y/this.w;return{x:e,y:t}},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){var t=this.y*e.z-this.z*e.y,i=this.z*e.x-this.x*e.z,a=this.x*e.y-this.y*e.x;return this.x=t,this.y=i,this.z=a,this},normalize:function(){var e=this.length();return this.x=this.x/e,this.y=this.y/e,this.z=this.z/e,this},lengthSquare:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSquare())},transformByMatrix:function(e){var t=this.x*e.entities[0]+this.y*e.entities[4]+this.z*e.entities[8]+this.w*e.entities[12],i=this.x*e.entities[1]+this.y*e.entities[5]+this.z*e.entities[9]+this.w*e.entities[13],a=this.x*e.entities[2]+this.y*e.entities[6]+this.z*e.entities[10]+this.w*e.entities[14],n=this.x*e.entities[3]+this.y*e.entities[7]+this.z*e.entities[11]+this.w*e.entities[15];return this.x=t,this.y=i,this.z=a,this.w=n,this},distanceFrom:function(e){var t=e.x*this.x+e.y*this.y+e.z*this.z;return t}};var getPointerEvent=function(e){return e.originalEvent.targetTouches?e.originalEvent.targetTouches[0]:e};VerticalList.prototype={clear:function(){this.items.length=0,this.node.html("")},add:function(e){e.node=$(e.html),this.items.push(e),this.node.append(e.node)},bindEvents:function(){var e=this;this.node.find("[data-itemtap]").each(function(t,i){var a=$(i);a.attr("data-vlistno",t),a.on(Events.pointer.down,function(t){var i=getPointerEvent(t),a=$(this),n=e.items[a.attr("data-vlistno")],s=a.attr("data-itemtap");n.cachedX=i.pageX,n.cachedY=i.pageY,n.currentX=i.pageX,n.currentY=i.pageY,n.touchStarted=!0,setTimeout(function(){if(Log.debug(n),n.cachedX===n.currentX&&!n.touchStarted&&n.cachedY===n.currentY){var t=new Function(s);e.loader.show(),setTimeout(t,50)}},200)}),a.on(Events.pointer.move,function(t){var i=getPointerEvent(t),a=$(this),n=e.items[a.attr("data-vlistno")];n.currentX=i.pageX,n.currentY=i.pageY}),a.on(Events.pointer.up,function(t){var i=$(this),a=e.items[i.attr("data-vlistno")];a.touchStarted=!1})}),this.scroll.calculateBounds()}},View.prototype.pause=function(){},View.prototype.resume=function(){};var YTPlayer={players:{},playerCount:0,embed:function(e,t,i,a){var n=e+"-"+t;return YTPlayer.players[e+"-"+t]={node:e,id:t,w:i,h:a},YTPlayer.playerCount++,this.injectPlayer(n),n},injectPlayer:function(e){var t=YTPlayer.players[e].node,i=YTPlayer.players[e].id,a=YTPlayer.players[e].w,n=YTPlayer.players[e].h,s=new YT.Player(t,{height:n,width:a,videoId:i,events:{onReady:YTPlayer.onPlayerReady,onStateChange:YTPlayer.onPlayerStateChange}});YTPlayer.players[e].player=s},onPlayerReady:function(){},onPlayerStateChange:function(){},api:function(e){return YTPlayer.players[e].player},each:function(e){for(var t in YTPlayer.players)e(YTPlayer.api(t),YTPlayer.players[t])},destroy:function(e){YTPlayer.api(e).clearVideo(),YTPlayer.playerCount--,delete YTPlayer.players[e]}},categoryListStatic={};categoryList.prototype={back:function(){var e=player.currentHistoryState;$(e.current).hide(),$(e.parent).show()},multiBack:function(e){history.back(),e.preventDefault()},openMenu:function(e){},openPlace:function(e){this.scroll.isScrolling()||(document.location="index.php?id="+e)},loadFolder:function(e){if(!this.scroll.isScrolling()&&(player.folders[e].opened?$("#folder_"+e).hide():$("#folder_"+e).show(),player.folders[e].opened=!player.folders[e].opened,!player.folders[e].loaded)){for(var t=0;t<player.folders[e].panos.length;t++)data=player.folders[e].panos,elem=$("<div class='panolink' id='pano"+data[t].id+"'><a ontouchend = 'categoryListStatic.openPlace("+data[t].id+")'><img src='"+data[t].thumb+"' width='200' height='100'><div class='bg'><span>"+data[t].pano_title+"</span></div></a></div>"),$("#folder_"+e).append(elem);player.folders[e].loaded=!0,this.scroll.calculateBounds()}},getCurrent:function(e){return this.current},loadPanoList:function(e){var t,i,a={id:"-1",title:"Lista panoram"};if(a.panos=[],this.scroll=new Scroller("#panos","#ui"),!player.imagesLoaded){i=null;for(var n=0;n<e.length;n++)"folder"==e[n].type?(null!=a&&player.folders.push(a),e.length>n+1&&"folder"==e[n+1].type?elem=$("<div class='folderempty'>"+e[n].title+"</div>"):elem=$("<div class='folder'><a href='javascript:void(null);' name='#f"+player.folders.length+"' ontouchend='player.list.loadFolder("+player.folders.length+");'>"+e[n].title+"</a></div><div id='folder_"+player.folders.length+"'></div>"),$("#panos").append(elem),a={id:e[n].id,title:e[n].title},a.panos=[]):(a.panos.push(e[n]),e[n].id==player.ident&&(t=e[n],i=player.folders.length));player.folders.push(a),player.imagesLoaded=!0,this.scroll.calculateBounds(),null!=i&&(player.list.loadFolder(i),this.scroll.jumpTo(0,-57*(i-1)))}for(var n=0;n<player.folders.length;n++);this.current=t}};var cubeCssRendererStatic={front:"",back:"2"};cubeCssRenderer.prototype={rx:0,ry:0,veryHighQualityLoaded:!1,basePerspective:550,zoom:550,minZoom:450,maxZoom:1550,zoomModifier:0,hqZoom:600,zoomMultiplier:1,loadTemplate:function(){$("#player").html(TPL.render("panorama-template",{w:this.planeWidth,wfix:this.wfix,wfixname:this.wfixname
}))},reUse:function(){var e=cubeCssRendererStatic.back;cubeCssRendererStatic.back=cubeCssRendererStatic.front,cubeCssRendererStatic.front=e},build:function(){this.pano=new css3DNode("#pano"+cubeCssRendererStatic.front,!1),this.a=new css3DNode("#_a"+cubeCssRendererStatic.front,!0),this.b=new css3DNode("#_b"+cubeCssRendererStatic.front,!0),this.c=new css3DNode("#_c"+cubeCssRendererStatic.front,!0),this.d=new css3DNode("#_d"+cubeCssRendererStatic.front,!0),this.e=new css3DNode("#_e"+cubeCssRendererStatic.front,!0),this.f=new css3DNode("#_f"+cubeCssRendererStatic.front,!0)},detectMobile:function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},realZoom:function(){return this.zoom},setPerspective:function(e){this.zoom=e,this.basePerspective=this.zoom,$("#player").css("perspective",this.basePerspective+"px"),$("#player").css("-moz-perspective",this.basePerspective+"px"),$("#player").css("-webkit-perspective",this.basePerspective+"px")},getPerspective:function(){return this.basePerspective},load:function(){this.loadQuality(256),player.preload(!0),this.setPerspective(650),"1"==this.properties.show_logo?$("#pano"+cubeCssRendererStatic.front+" .plogo").show():$("#pano"+cubeCssRendererStatic.front+" .plogo").hide()},loadHandlers:function(e){e.onloadstart=function(){},e.onprogrogress=function(e){}},loadQuality:function(e){cubeCssRendererStatic.quality1=e,cubeCssRendererStatic.quality2=e,cubeCssRendererStatic.quality3=e,cubeCssRendererStatic.quality4=e,cubeCssRendererStatic.quality5=e,cubeCssRendererStatic.quality6=e;var t=this,i=new Image;i.onload=function(){$("#ia"+cubeCssRendererStatic.front).attr("src",i.src),t.loaded.a+=1,t.checkLoaded(),player.offline?cubeCssRendererStatic.quality1=cubeCssRendererStatic.sd:cubeCssRendererStatic.quality1<cubeCssRendererStatic.sd&&(i.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_1.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=1",cubeCssRendererStatic.quality1=cubeCssRendererStatic.sd)},i.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_1.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=1";var a=new Image;a.onload=function(){$("#ib"+cubeCssRendererStatic.front).attr("src",a.src),t.loaded.b+=1,t.checkLoaded(),player.offline?cubeCssRendererStatic.quality2=cubeCssRendererStatic.sd:cubeCssRendererStatic.quality2<cubeCssRendererStatic.sd&&(a.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_2.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=2",cubeCssRendererStatic.quality2=cubeCssRendererStatic.sd)},a.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_2.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=2";var n=new Image;n.onload=function(){$("#ic"+cubeCssRendererStatic.front).attr("src",n.src),t.loaded.c+=1,t.checkLoaded(),player.offline&&(cubeCssRendererStatic.quality3=cubeCssRendererStatic.sd),cubeCssRendererStatic.quality3<cubeCssRendererStatic.sd&&(n.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_3.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=3",cubeCssRendererStatic.quality3=cubeCssRendererStatic.sd)},n.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_3.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=3";var s=new Image;s.onload=function(){$("#id"+cubeCssRendererStatic.front).attr("src",s.src),t.loaded.d+=1,t.checkLoaded(),player.offline?cubeCssRendererStatic.quality4=cubeCssRendererStatic.sd:cubeCssRendererStatic.quality4<cubeCssRendererStatic.sd&&(s.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_4.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=4",cubeCssRendererStatic.quality4=cubeCssRendererStatic.sd)},s.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_4.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=4";var o=new Image;o.onload=function(){$("#ie"+cubeCssRendererStatic.front).attr("src",o.src),t.loaded.e+=1,t.checkLoaded(),player.offline?cubeCssRendererStatic.quality5=cubeCssRendererStatic.sd:cubeCssRendererStatic.quality5<cubeCssRendererStatic.sd&&(o.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_5.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=5",cubeCssRendererStatic.quality5=cubeCssRendererStatic.sd)},o.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_5.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=5";var r=new Image;r.onload=function(){t.loaded.f+=1,t.checkLoaded(),$("#if"+cubeCssRendererStatic.front).attr("src",r.src),player.offline&&(cubeCssRendererStatic.quality6=cubeCssRendererStatic.sd),cubeCssRendererStatic.quality6<cubeCssRendererStatic.sd&&(r.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_6.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=6",cubeCssRendererStatic.quality6=cubeCssRendererStatic.sd)},r.src=player.offline?"data/pano_"+cubeCssRendererStatic.ident+"_6.jpg":player.storage+"/res.php?q="+cubeCssRendererStatic.sd+"&id="+cubeCssRendererStatic.ident+"&part=6"},checkLoaded:function(){this.loaded.a>=1&&this.loaded.b>=1&&this.loaded.c>=1&&this.loaded.d>=1&&this.loaded.e>=1&&this.loaded.f>=1&&(this.loaded={},player.preload(!1),""==cubeCssRendererStatic.front?($(".buf").show(),$(".buf").css("opacity",.01)):($(".buf2").show(),$(".buf").css("opacity",.99)),setTimeout(function(){""==cubeCssRendererStatic.front?(cubeCssRendererStatic.tw=new Tween(function(e){$(".buf").css("opacity",e)},function(){$(".buf2").hide(),HotSpotManager.setVisibility(!0),AppEvent.trigger(player,"PLACE.LOADED",cubeCssRendererStatic.self)}),cubeCssRendererStatic.tw.start(.01,1,500)):(cubeCssRendererStatic.tw=new Tween(function(e){$(".buf").css("opacity",e)},function(){$(".buf").hide(),HotSpotManager.setVisibility(!0),AppEvent.trigger(player,"PLACE.LOADED",cubeCssRendererStatic.self)}),cubeCssRendererStatic.tw.start(.99,0,500))},200))},process:function(){$("#world").css("margin-left",-this.planeWidth+.5*player._width+"px"),$("#world").css("margin-top",-this.planeWidth+.5*player._height+"px");var e=this.planeWidth-this.halfimage,t=this.planeWidth-this.halfimage,i=0,a=1;"2"==cubeCssRendererStatic.front?(i=this.halfimage2,a=this.halfimage2/this.halfimage):i=this.halfimage,this.pano.resetTransform(),this.pano.translate(e,t,this.zoom),this.pano.applyTransforms(),this.a.resetTransform(),this.a.rotateX(this.ry),this.a.rotateY(this.rx),this.a.translate(0,0,-i),this.a.scale(a,a,a),this.a.applyTransforms(),this.b.resetTransform(),this.b.rotateX(this.ry),this.b.rotateY(this.rx),this.b.translate(i,0,0),this.b.scale(a,a,a),this.b.rotateY(-90),this.b.applyTransforms(),this.c.resetTransform(),this.c.rotateX(this.ry),this.c.rotateY(this.rx),this.c.translate(0,0,i),this.c.scale(a,a,a),this.c.rotateY(-180),this.c.applyTransforms(),this.d.resetTransform(),this.d.rotateX(this.ry),this.d.rotateY(this.rx),this.d.translate(-i,0,0),this.d.scale(a,a,a),this.d.rotateY(-270),this.d.applyTransforms(),this.e.resetTransform(),this.e.rotateX(this.ry),this.e.rotateY(this.rx),this.e.translate(0,-i,0),this.e.scale(a,a,a),this.e.rotateX(-90),this.e.applyTransforms(),this.f.resetTransform(),this.f.rotateX(this.ry),this.f.rotateY(this.rx),this.f.translate(-1,i,0),this.f.scale(a,a,a),this.f.rotateX(90),this.f.applyTransforms(),this.zoom>this.hqZoom&&0==this.veryHighQualityLoaded&&(this.veryHighQualityLoaded=!0)},old2angle:function(e){return parseFloat(e)+85},clear:function(){},reorient:function(){}};var staticGallery3DView={};gallery3DView.prototype={rx:0,ry:0,px:0,py:0,inX:0,inY:0,autoX:-1,panning:!1,swipe:{},pd:null,gps:null,title:null,ia:null,node:null,content:null,w:0,h:0,opened:!1,helpanim:!0,lastX:0,lastY:0,flying:!0,load:function(){AppEvent.trigger(player,"PLACE.LOADED",player.currentView),$("#player").css("background-color","#000000"),$("#player").html(""),$("#menubutton").hide(),void 0!=player.lastIdent&&null!=player.lastIdent&&player.lastIdent!=player.ident||void 0==player.current.properties.exit||"0"==player.current.properties.exit||(player.addTrack(player.current.properties.exit,player.current.properties.exit_angle),player.lastIdent=player.current.properties.exit,player.lastDir=player.current.properties.exit_angle),staticGallery3DView.self=this,this.gal3d=$("<div id='gal3d'></div>"),this.content=$("<Div id='galcontent'></div>"),this.gal3d.append(this.content),$("#player").append(this.gal3d),this.closebtn=$("<div style='position:absolute;right:10px;top:5px;width:50px;height:50px;'><img src='assets/menu_close.png' on"+Events.pointer.up+"='staticGallery3DView.self.closeGallery();' id='galclose' style='left:0px' title='Zamknij' class='speaks' data-speak='PLAYER.CLOSE' data-speakgroup='TIPS'></div>"),this.gal3d.append(this.closebtn);var e=this;this.closebtn.on("mouseover",function(){e.flying=!1}),this.closebtn.on("mouseout",function(){e.flying=!0}),this.node=new css3DNode("#galcontent");var t=.2*$(window).width();130>t&&(t=100);var i=.5*t,a=Math.round(24*t/384);a>32&&(a=24);for(var n=0;n<this.properties.properties.gallery.length;n++){var s=this.properties.properties.gallery[n],o="";void 0!=s.title&&""!=s.title&&(o="<div class='bdrop'></div><div class='label' style='font-size:"+a+"px;line-height:"+Math.round(1.4*a)+"px'>"+s.title+"</div>");var r=s.title;r=""!=r?"Kliknij aby powiększyć: "+r:"Kliknij aby powiększyć",player.offline?this.content.append($("<div class='galthumb' on"+Events.pointer.up+"='staticGallery3DView.self.open("+n+")' data-no='"+n+"'><div class='img'><img src='data/"+s.file+"' width='"+t+"' height='"+i+"' title='"+r+"'>"+o+"</div></div>")):this.content.append($("<div class='galthumb thumbloading' on"+Events.pointer.up+"='staticGallery3DView.self.open("+n+")' data-no='"+n+"'><div class='img'><img src='"+s.thumb+"' width='"+t+"' height='"+i+"' onload='staticGallery3DView.self.thumbloaded(this);' title='"+r+"'>"+o+"</div></div>"))}this.w=this.content.width(),this.h=this.content.height(),this.h>$(window).height()&&this.content.css("width",2*this.w+"px"),this.w=this.content.width(),this.h=this.content.height(),this.overlay=$("<div id='galoverlay'></div>"),$("#player").append(this.overlay),SpeechManager.enableSpeech("#gal3d",".speaks",1,"TOPMENU"),this.help=$("<Div id='galhelp'><div class='left hstart'><i class='fa fa-angle-left'></i>\r\n</div><div class='right hstart'><i class='fa fa-angle-right'></i></div><div class='top hstart'><i class='fa fa-angle-up'></i></div><div class='bottom hstart'><i class='fa fa-angle-down'></i></div></div>"),this.gal3d.append(this.help),AppEvent.trigger(player,"PLACE.LOADED",player.currentView);var e=this;setTimeout(function(){e.help.find(".hstart").removeClass("hstart")},1e3),setTimeout(function(){e.help.find("div").css("opacity",0),e.helpanim=!1},5e3),Tab.add("hotspots",{focus:function(e){staticGallery3DView.self.kmode=!0,$(e.content.find(".galthumb").eq(0)).addClass("focused"),$(e.content.find(".galthumb").eq(0)).addClass("hovered"),e.gpx=0,e.gpy=0,e.dst_x=0,e.dst_y=0;var t=$(e.content.find(".galthumb").eq(0)).offset().top,i=this;i.inrow=0,i.rows=0,e.content.find(".galthumb").each(function(){var e=$(this).offset().top;e!=t&&i.rows++,0==i.rows&&i.inrow++,t=e})},blur:function(e){staticGallery3DView.self.kmode=!1,$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("focused"),$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("hovered")},action:function(t,i){var a=$(t.content.find(".galthumb").eq(t.gpx+t.gpy*this.inrow)).data("no");if(e.opened){var n=$("#galtitle").data("url"),s=$("#galtitle").data("dir");staticGallery3DView.self.goUrl(n,s)}else staticGallery3DView.self.open(a);i.preventDefault(),i.stopPropagation()},keyboard:function(e,t){"ArrowLeft"==t.key&&e.gpx>0&&($(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("focused"),$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("hovered"),e.gpx--,$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).addClass("focused"),$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).addClass("hovered")),"ArrowRight"==t.key&&e.gpx<this.inrow-1&&($(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("focused"),$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("hovered"),e.gpx+1+e.gpy*this.inrow<e.properties.properties.gallery.length&&e.gpx++,$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).addClass("focused"),$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).addClass("hovered")),"ArrowDown"==t.key&&e.gpy<this.rows&&($(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("focused"),$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("hovered"),e.gpx+(e.gpy+1)*this.inrow<e.properties.properties.gallery.length&&e.gpy++,$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).addClass("focused"),$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).addClass("hovered")),"ArrowUp"==t.key&&e.gpy>0&&($(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("focused"),$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).removeClass("hovered"),e.gpy--,$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).addClass("focused"),$(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).addClass("hovered"));var i=($(e.content.find(".galthumb").eq(e.gpx+e.gpy*this.inrow)).offset(),400*e.gpx),a=220*e.gpy,n=-staticGallery3DView.self.px,s=-staticGallery3DView.self.py;(n>i||i>n+$(document).width())&&(staticGallery3DView.self.dst_x=-i),(s>a||a>s+$(document).height()-400)&&(staticGallery3DView.self.dst_y=-a)}},this,0);var e=this;this.kde=AppEvent.on(player,"PLAYER.KEYDOWN",function(t){"Escape"!=t.key&&"Backspace"!=t.key||!e.opened||(e.close(),player.blockBackspace=!0,t.preventDefault(),t.stopPropagation())}),AppEvent.trigger(player,"PLACE.TRANSITIONED",this)},thumbloaded:function(e){$(e).parent().removeClass("thumbloading"),$(e).parent().parent().removeClass("thumbloading")},closeGallery:function(){player.back()},close:function(){this.closebtn.show(),$("#overlay").show(),$("#galbig").css("opacity","0"),this.opened=!1,this.flying=!0,player.bottomBar(!0),this.overlay.hide()},goUrl:function(e,t){player.go(e,t)},open:function(e){if(!swipe.isScrolling()){this.closebtn.hide(),player.bottomBar(!1);var t=staticGallery3DView.self.properties.properties.gallery[e],i=t.id,a="";t.rx&&t.ry?a=t.rx.toString()+","+t.ry.toString():t.rx&&(a=t.rx.toString());var n;n=player.offline?"data/"+t.file:t.thumb;var s="";this.showhelp<2&&(s="<div id='galinfo'>"+TPL.lng("gallery.help","Kliknij na zdjęcie aby przejść dalej.")+"</div>"),this.showhelp++,this.overlay.html("<div id='galtitle' data-url='"+i+"' data-dir='"+a+"'>"+t.title+"</div>"+s+"<div style='position:absolute;right:10px;top:65px;width:50px;height:50px;'><img src='assets/menu_close.png' on"+Events.pointer.up+"='staticGallery3DView.self.close();' id='galback' style='left:0px' title='Zamknij' class='speaks2' data-speak='PLAYER.CLOSE' data-speakgroup='TIPS'></div><div id='galbig' style='padding-left:5%;'><img src='"+n+"' id='full' width='95%' on"+Events.pointer.up+"='staticGallery3DView.self.goUrl(\""+i+'","'+a+"\");'  title='Kliknij aby wejść dalej'></div>"),$("#overlay").hide(),AppEvent.one(player,"beforeLoad",function(){$("#overlay").show()}),SpeechManager.enableSpeech("#gal3d",".speaks2",1,"TOPMENU"),setTimeout(function(){.5*$(window).height()-.5*$("#galbig").height();$("#galbig").css("margin-top",.5*$(window).height()-.5*$("#galbig").height()+"px"),$("#galbig").css("opacity","1")},100);var o=new Image;o.onload=function(){$("#full").attr("src",o.src)},player.offline?o.src="data/"+t.file:o.src="../"+t.path,this.overlay.show(),this.opened=!0,$("#menu").hide(),$("#menubutton").hide()}},reorient:function(){},process:function(){var e,t;if(this.rx*=.8,this.ry*=.8,!this.opened&&this.flying){if(this.kmode)return isNaN(this.dst_x)||(this.px=this.px+.03*(this.dst_x-this.px)),isNaN(this.dst_y)||(this.py=this.py+.03*(this.dst_y-this.py)),this.px<-(this.w-$(window).width())&&(this.px=-(this.w-$(window).width())),this.py<-(this.h-$(window).height()+140)&&(this.py=-(this.h-$(window).height()+140)),this.node.resetTransform(),this.node.translate(.25*-this.w,0,-20),this.node.translate(this.px+.25*this.w,this.py,0),void this.node.applyTransforms();this.inX*=.8,e=-2*swipe.inertiaX(),this.inX+=e,this.px+=this.inX,this.rx+=e,this.rx>30&&(this.rx=30),this.rx<-30&&(this.rx=-30),this.px<-(this.w-$(window).width())&&(this.px=-(this.w-$(window).width()),this.autoX=1),this.px>0&&(this.px=0,this.autoX=-1),this.inY*=.8,t=-2.5*swipe.inertiaY(),this.inY+=t,this.py-=this.inY,this.ry+=t,this.ry>30&&(this.ry=30),this.ry<-30&&(this.ry=-30),this.py<-(this.h-$(window).height()+140)&&(this.py=-(this.h-$(window).height()+140)),this.py>0&&(this.py=0),this.px+=.3*this.autoX,this.px+=swipe.distFromCenterX*-.01,this.py+=swipe.distFromCenterY*-.02,this.helpanim||(swipe.distFromCenterX<0&&Math.abs(this.lastX-this.px)>1?this.help.find(".left").css("opacity",1):this.help.find(".left").css("opacity",0),swipe.distFromCenterX>0&&Math.abs(this.lastX-this.px)>1?this.help.find(".right").css("opacity",1):this.help.find(".right").css("opacity",0),swipe.distFromCenterY<0&&Math.abs(this.lastY-this.py)>1?this.help.find(".top").css("opacity",1):this.help.find(".top").css("opacity",0),swipe.distFromCenterY>0&&Math.abs(this.lastY-this.py)>1?this.help.find(".bottom").css("opacity",1):this.help.find(".bottom").css("opacity",0)),this.node.resetTransform(),this.node.translate(.25*-this.w,0,-20),this.node.rotateY(this.rx),this.node.rotateX(this.ry),this.node.translate(this.px+.25*this.w,this.py,0),this.node.applyTransforms(),this.lastX=this.px,this.lastY=this.py}},mouseDown:function(e){this.panning=!0,swipe.start(e)},mouseUp:function(e){swipe.end(),this.panning=!1},mouseMove:function(e){swipe.move(e)},mouseWheel:function(e){},pause:function(){this.paused=!0},resume:function(){this.paused=!1},leaving:function(){player.bottomBar(!0);var e=this;AppEvent.one(player,"PLACE.TRANSITIONED",function(){e.gal3d.remove(),e.overlay.remove(),e.kde.remove()})}};var staticGalleryView={};galleryView.prototype={current:1,load:function(){AppEvent.trigger(player,"PLACE.LOADED",player.currentView),$("#player").css("background-color","#000000"),$("#player").html(""),$("#menubutton").hide(),staticGalleryView.self=this,void 0!=this.properties.gallery&&(this.menu=this.properties.gallery.menu),this.content=$("<Div id='galcontent'></div>"),$("#player").append(this.content),this.node=new css3DNode("#galcontent"),this.close=$("<img src='assets/menu_close.png' class='mobileonly' width='50' height='50' style='z-index:99999;position:absolute;right:10px;top:10px;'>"),$("#player").append(this.close),this.close.on(Events.pointer.up,function(){player.go(player.lastIdent,0)});var e=.2*$(window).width();130>e&&(e=100);this.overlay=$("<div id='galoverlay'></div>"),$("#player").append(this.overlay),this.menuOverlay=$("<div id='galmenu'><h2 id='galtoptitle'>"+this.menu_title+"</h2></div>");var t=$("<div id='galmenucontent'></div>");this.menuOverlay.append(t),$("#player").append(this.menuOverlay),this.nav=$("<div id='#galnav'><a href='javascript:void(null);' id='galleft' onclick='staticGalleryView.self.previous();' title='Poprzednie zdjęcie'><img src='assets/l_arrow.png'></a><a href='javascript:void(null);' id='galright' onclick='staticGalleryView.self.next();' title='Następne zdjęcie'><img src='assets/r_arrow.png'></a></div>"),$("#player").append(this.nav),this.menuController=new VerticalList("#galmenucontent"),this.open(1),Tab.clearGroup("hotspots"),Tab.add("hotspots",Tab.simpleTab($("#galleft"),0),{}),Tab.add("hotspots",Tab.simpleTab($("#galright"),1),{}),AppEvent.trigger(player,"PLACE.LOADED",player.currentView)},open:function(e){player.preload(!0);var t=staticGalleryView.self.properties.properties,i="",a=t["tooltip_"+e],n=t["image_"+e],s=t["description_"+e];if(""!=s?($("#g-photodesc").html(s),$("#g-photodesc").show()):$("#photodesc").hide(),this.current=e,null!=this.menu)for(var o=0;o<this.menu.length;o++)this.menu[o].id==player.ident&&(i=this.menu[o].title);this.menu_title=i,$("#galtoptitle").html("<div class='folder' style='border-bottom:2px solid #ffffff;'><a href='javascript:void(null);' ontouchend='navbar.openMenu();staticGalleryView.self.hideMenu();'><div class='lglyph'>&laquo;</div><b>Galeria</b></a></div>"),null!=this.menu?this.overlay.html("<div id='galtitle'><a href='javascript:void(null);' onclick='staticGalleryView.self.showMenu();' class='currentMenuButton'><img src='assets/current_menu.png?20131125' width='12' height='12'><span>"+i+"</span></a> <img src='assets/right_arrow.png' width='16' height='16' style='vertical-align:middle;'> <div id='upphototitle'>"+a+"</div> ("+this.current+" / "+this.max+")</div><div id='galbig'><div id='g-holder'><img src='' id='full' title='"+a+"' alt='"+a+"'><div id='g-photodesc'>"+s+"</div><a href='javascript:void(null);' id='g-info'><i class='fa fa-info'></i></a></div><div id='downphototitle'>"+a+"</div></div>"):this.overlay.html("<div id='galtitle'>"+a+" ("+this.current+" / "+this.max+")</div><div id='galbig'><img src='' id='full' title='"+a+"' alt='"+a+"'></div>"),""!=s?$("#g-info").show():$("#g-info").hide(),$("#g-info").on(Events.pointer.up,function(){$("#g-info").toggleClass("g-collapse"),$("#g-photodesc").toggleClass("g-visible"),$("#g-info").hasClass("g-collapse")?$("#g-info").html("<i class='fa fa-times'></i>"):$("#g-info").html("<i class='fa fa-info'></i>")}),$("#player").width(this.wWidth+"px"),$("#player").height(this.wHeight+"px");var r=new Image;r.onload=function(){if(this.wHeight=staticGalleryView.self.wHeight,this.wWidth=staticGalleryView.self.wWidth,$("#full").attr("src",r.src),$("#full").height()>this.wHeight-0){var e=$("#full").height(),t=$("#full").width();$("#full").height(this.wHeight-0),$("#full").width(t*($("#full").height()/e))}if($("#full").width()>this.wWidth){var e=$("#full").height(),t=$("#full").width();$("#full").width(this.wWidth),$("#full").height(e*($("#full").width()/t))}$("#downphototitle").css("width",$("#full").width());.5*this.wHeight-.5*$("#galbig").height();$("#galbig").css("margin-top",.5*this.wHeight-.5*$("#galbig").height()+"px"),$("#galbig").css("margin-left",.5*this.wWidth-.5*$("#full").width()+"px"),$("#galbig").css("opacity","1"),player.redraw(),player.preload(!1)},player.offline?r.src="data/"+n.replace("../data/",""):r.src="../"+n,this.overlay.show(),this.opened=!0},hideMenu:function(){this.menuOverlay.hide(),player.redraw()},go:function(e,t){player.go(e,t)},showMenu:function(){this.menuOverlay.show();$("#galmenucontent");this.menuController.clear(),player.redraw();for(var e=0;e<this.menu.length;e++)this.menuController.add({html:"<div class='folder'><a href='javascript:void(null);' class='menuitem' data-itemtap='staticGalleryView.self.go("+this.menu[e].id+", "+(void 0==this.menu[e].dir?0:this.menu[e].dir)+");'>"+this.menu[e].title+"</a></div>"});this.menuController.bindEvents();var t=$("<div class='centerButton mobileonly'><a href='javascript:void(null);' ontouchend='staticGalleryView.self.hideMenu();'><img src='assets/back.png' height='84' width='84'></a></div>");this.menuOverlay.append(t)},next:function(){this.current==this.max&&(this.current=0),this.open(this.current+1)},previous:function(){1==this.current&&(this.current=this.max+1),this.open(this.current-1)},reorient:function(){this.wWidth=$(window).width(),this.wHeight=$(window).height(),this.open(this.current)},process:function(){},toggleAuto:function(){this.autoplaying=!this.autoplaying,this.autoplaying?($("#playstop").html("<img src='assets/menu_reload.png' width='84' height='84' class='blink'>"),this.autoplay()):($("#playstop").html("<img src='assets/menu_next.png' width='84' height='84'>"),null!=this.autotimer&&clearTimeout(this.autotimer),this.autotimer=null)},autoplay:function(){staticGalleryView.self.autoplaying&&(staticGalleryView.self.next(),staticGalleryView.self.autotimer=setTimeout(staticGalleryView.self.autoplay,5e3))},mouseDown:function(e){this.panning=!0},mouseUp:function(e){this.panning=!1},mouseMove:function(e){},mouseWheel:function(e){},pause:function(){this.paused=!0},resume:function(){this.paused=!1},leaving:function(){player.bottomBar(!0),this.playnode.remove();var e=this;AppEvent.one(player,"PLACE.TRANSITIONED",function(){e.menuOverlay.remove(),e.overlay.remove(),e.nav.remove(),e.content.remove(),e.close.remove()})}};var Hs={trim:function(e){var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return String(e).replace(t,"")}},languageMenu={},mapInfo={isOpened:!1,isMapRunning:!1,initialized:!1,cfg:null,route:null,isDesktop:!1,splitView:!1,miniView:!1,showStreetViewOnStart:!1,here:null,lastMark:null,enlargeNode:null,radar:null,disabled:!1,markIds:{},lastActive:null,geoloc:!1,load:function(e){mapInfo.cfg=e,SpeechManager.prepareTip("PLAYER.MAPBAR.HIDE","TIPS"),SpeechManager.prepareTip("PLAYER.MAPBAR.MINIMIZE","TIPS"),SpeechManager.prepareTip("MAP_ZOOM","TIPS"),SpeechManager.prepareTip("PLAYER.ROUTE","TIPS"),Tab.setGroup("map","+"),Tab.add("map",Tab.simpleTabInput($("#front_search"),2,"focused",!0),{}),Tab.add("map",Tab.simpleTab($("#searchbar").find(".button"),5),{}),Tab.add("map",Tab.simpleTab(function(){return $("#map_enlarge")},10,"focused",function(){return $("#map_enlarge img")}),{}),Tab.add("map",Tab.simpleTab(function(){return $("#map_close")},15,"focused",function(){return $("#map_close img")}),{}),Tab.add("map",Tab.simpleTab(function(){return $("#mapbar .back")},20),{}),Tab.groups.map.disable()},back:function(){mapInfo.hideMenu()},toggleMenu:function(){isOpened?mapInfo.hideMenuReal():mapInfo.showMenu()},fetchLocation:function(e){confirm("Czy otworzyć stronę z wyznaczoną trasą ?")&&window.open("http://maps.google.com/maps","_blank")},fetchLocationFailed:function(e){alert("Nie można było pobrać lokalizacji urządzenia, aby skorzystać z tej funkcji musisz umożliwić Twojej przeglądarce pobranie informacji o Twojej lokalizacji.")},openRouteMap:function(e,t){window.open("http://maps.google.com/maps?saddr=&daddr="+e+","+t+"&ll=","_blank")},initMap:function(){$("#mapbar .coords").html(""),$("#mapcontent").html(""),ssi("Plan","load",{place:player.ident},function(e){void 0!=e.data.plan_id?Plan.start(e.data):(Plan.release(),mapInfo.loadGMap())}),mapInfo.initialized||(AppEvent.on(player,"placeReady",function(e){mapInfo.placeReady()}),AppEvent.on(player,"PLACE.LOADED",function(e){mapInfo.placeLoaded()}),mapInfo.initialized=!0,$("#front_search").on("keydown",mapInfo.detectEnter),$("#front_search").prop("placeholder",TPL.lng("tips.search","Szukaj ...")),$("#front_search").prop("title",TPL.lng("tips.entersearchtext","Wpisz szukany tekst")))},detectEnter:function(e){var t=e.which;(13==t||8==t)&&(e.preventDefault(),e.stopPropagation()),(32==t||13==t||188==t||186==t)&&mapInfo.goSearch()},findMe:function(){return mapInfo.geoloc=!mapInfo.geoloc,mapInfo.geoloc?($("#findme").html("<i class='fas fa-spinner fa-spin'></i>"),$("#findme").addClass("on"),void(navigator.geolocation?navigator.geolocation.getCurrentPosition(mapInfo.geoLocate,mapInfo.geoError):($("#findme").html("<i class='fas fa-street-view'></i>"),alert("Twoja przeglądarka nie była w stanie pobrać Twojej lokalizacji.")))):(void 0!=mapInfo.me&&mapInfo.me.setVisible(!1),$("#findme").html("<i class='fas fa-street-view'></i>"),$("#findme").removeClass("on"),void mapInfo.map.panTo(mapInfo.here.getPosition()))},geoError:function(e){switch(mapInfo.geoloc=!1,$("#findme").html("<i class='fas fa-street-view'></i>"),$("#findme").removeClass("on"),e.code){case e.PERMISSION_DENIED:alert("Użytkownik nie zezwolił na pobranie informacji o geolokacji.");break;case e.POSITION_UNAVAILABLE:alert("Informacja o lokalizacji jest niedostępna.");break;case e.TIMEOUT:alert("Przekroczono czas pobierania informacji o lokalizacj.");break;case e.UNKNOWN_ERROR:alert("Wystąpił nieznany błąd przy pobieraniu informacji o aktualizacji.")}},geoLocate:function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);if(void 0==mapInfo.me){var i="assets/__marker-2.png",a={url:i,scaledSize:new google.maps.Size(41,46),origin:new google.maps.Point(0,0)};mapInfo.me=new google.maps.Marker({position:t,map:mapInfo.map,icon:a,optimized:!1,zIndex:99999999})}mapInfo.me.setVisible(!0),$("#findme").html("<i class='fas fa-street-view'></i>"),mapInfo.map.setCenter(t),mapInfo.me.setAnimation(google.maps.Animation.BOUNCE)},goSearch:function(){Search.openAndFind($("#front_search").val())},placeLoaded:function(){setTimeout(function(){mapInfo.miniView&&("panorama"!=player.current.place_type||mapInfo.disabled?void 0==mapInfo.clicked&&(mapInfo.splitView=!1,void 0!=mapInfo.map&&mapInfo.map.set("fullscreenControl",!1),$("#mapinfo").addClass("mini"),$("#mapinfo").addClass("hidden"),$("#player").css("left","0%"),$("#player").css("width","100%"),$("#hotspots").css("left","0%"),$("#info").css("left","0%"),$("#menu_container").css("left","0%"),$("#mapinfo").removeClass("small"),mapInfo.infowindow.close()):$("#mapinfo").removeClass("hidden"))},5e3)},placeReady:function(){var e=player.dir.toString().split(",");if(mapInfo.me=void 0,void 0!=player.current.properties.map_state&&"open"==player.current.properties.map_state&&mapInfo.miniView!==!0?(1==mapInfo.clicked&&(mapInfo.clicked=!1),this.toggleMiniMap()):1!=mapInfo.clicked&&mapInfo.miniView===!0&&"open"!=player.current.properties.map_state&&this.toggleMiniMap(),$("#mapbar .coords").html("<a href='javascript:void(null);' id='findme' on"+Events.pointer.up+"='mapInfo.findMe();' title='Znajdź moją lokalizację'><i class='fas fa-spinner fa-spin'></i></a> <a href='javascript:void(null);' on"+Events.pointer.up+"='mapInfo.openRouteMap("+player.current.gps_x+", "+player.current.gps_y+")' class='rbutton speaks' title='Wyznacz trasę' data-speak='PLAYER.ROUTE' data-speakgroup='TIPS'><i class='fas fa-route'></i></a> &nbsp; "+player.current.gps_x+"N, "+player.current.gps_y+"E"),
mapInfo.isMapRunning){var t=mapInfo.markIds[player.ident];if(void 0!=t&&null!=t?(t.setAnimation(google.maps.Animation.BOUNCE),mapInfo.here=t,mapInfo.hereMarker.setVisible(!1)):void 0!=mapInfo.hereMarker&&(mapInfo.here=mapInfo.hereMarker,mapInfo.here.setPosition({lat:parseFloat(player.current.gps_x),lng:parseFloat(player.current.gps_y)}),mapInfo.hereMarker.setVisible(!0)),null!=mapInfo.lastActive){var t=mapInfo.markIds[mapInfo.lastActive];null!=t&&void 0!=t&&t.setAnimation(null)}mapInfo.lastActive=player.ident,"@"!=e[0].substr(0,1)||mapInfo.splitView?mapInfo.splitView?(mapInfo.radar.setPosition({lat:parseFloat(player.current.gps_x),lng:parseFloat(player.current.gps_y)}),mapInfo.map.getStreetView().setPosition({lat:parseFloat(player.current.gps_x),lng:parseFloat(player.current.gps_y)}),mapInfo.map.getStreetView().setPov({heading:player.lastHeading,pitch:0}),mapInfo.map.panTo(mapInfo.here.getPosition())):mapInfo.miniView&&("panorama"==player.current.place_type?$("#mapinfo").removeClass("hidden"):$("#mapinfo").addClass("hidden"),mapInfo.radar.setPosition({lat:parseFloat(player.current.gps_x),lng:parseFloat(player.current.gps_y)}),mapInfo.map.panTo(mapInfo.here.getPosition())):(mapInfo.showStreetViewOnStart=!0,mapInfo.toggleMenuDesktop(),null!=mapInfo.radar&&mapInfo.radar.setPosition({lat:parseFloat(player.current.gps_x),lng:parseFloat(player.current.gps_y)}),mapInfo.miniView=!0)}},loadGMap:function(){mapInfo.isMapRunning=!0,console.trace();var e={zoom:18,center:new google.maps.LatLng(mapInfo.cfg.gps_x,mapInfo.cfg.gps_y),fullscreenControl:!0,mapTypeId:google.maps.MapTypeId.HYBRID};map=new google.maps.Map(document.getElementById("mapcontent"),e),mapInfo.geoloc=!1,mapInfo.me=void 0;var t="assets/marker.png",i=new google.maps.LatLng(mapInfo.cfg.gps_x,mapInfo.cfg.gps_y),a={url:t,scaledSize:new google.maps.Size(21,24),origin:new google.maps.Point(0,0)};$("#mapbar .coords").html("<a href='javascript:void(null);' on"+Events.pointer.up+"='mapInfo.findMe();' id='findme' title='Zanjdź moją lokalizację'><i class='fas fa-spinner fa-spin'></i></a> <a href='javascript:void(null);' on"+Events.pointer.up+"='mapInfo.openRouteMap("+player.current.gps_x+", "+player.current.gps_y+")' class='rbutton speaks' title='Wyznacz trasę'  data-speak='PLAYER.ROUTE' data-speakgroup='TIPS'><i class='fas fa-route'></i></a> &nbsp; "+player.current.gps_x+"N, "+player.current.gps_y+"E"),$("#mapinfo .back").on(Events.pointer.up,mapInfo.hideMenuReal),$("#mapinfo .back").on("keydown",function(e){"Enter"==e.key&&mapInfo.hideMenuReal()});var n=new google.maps.Marker({position:i,map:map,icon:a,optimized:!1,zIndex:99999999});n.setAnimation(google.maps.Animation.BOUNCE),mapInfo.here=n,mapInfo.hereMarker=n,mapInfo.map=map,mapInfo.radar=new RadarMarker(i,map,{}),mapInfo.isStreetView=!1,google.maps.event.addListener(map.getStreetView(),"visible_changed",function(){mapInfo.isStreetView=this.getVisible()}),mapInfo.infowindow=new google.maps.InfoWindow({maxWidth:350,content:""});var s;setTimeout(function(){$.getJSON("markers.php?range=20000&cid="+mapInfo.cfg.folder.city_id,function(e){mapInfo.markers=e.markers;for(var t in e.markers){var a=e.markers[t];i=new google.maps.LatLng(a.lat,a.lng);var n="";switch(a.icon){case-10:n="assets/marker-green.png";break;case-3:n="assets/marker-blue.png";break;case-100:continue;default:n="assets/marker.png"}var o={url:n,scaledSize:new google.maps.Size(17,22),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,18)};null!=a.iconfile&&""!=a.iconfile&&(o="../gicons/"+a.iconfile),s=new google.maps.Marker({position:i,map:map,icon:o,no:t}),mapInfo.markers[t].id==player.ident&&(s.setAnimation(google.maps.Animation.BOUNCE),mapInfo.lastActive=mapInfo.markers[t].id,mapInfo.hereMarker.setVisible(!1)),mapInfo.markIds[mapInfo.markers[t].id]=s,google.maps.event.addListener(s,"mouseover",function(){var e=mapInfo.markers[this.no];window.setStatus("ID: "+e.id)}),google.maps.event.addListener(s,"mouseout",function(){window.setStatus("")}),google.maps.event.addListener(s,"mouseup",function(){var e=mapInfo.markers[this.no];mapInfo.lastMark=this;var t=e;if(mapInfo.miniView&&!mapInfo.splitView){var i=mapInfo.map.getStreetView().getPov();return void mapInfo.go(e.id,0)}if(""!=t.preview.url?player.offline?mapInfo.infowindow.setContent("<div style='text-align:center;color:#343434;max-width: 200px;'><b>"+e.info+"</b><br><br><img src='"+t.preview.url+"' style='cursor:pointer;' width='200px' on"+Events.pointer.up+"='mapInfo.go("+e.id+", 0)'></div>"):mapInfo.infowindow.setContent("<div style='text-align:center;color:#343434;max-width: 200px;'><b>"+e.info+"</b><br><br><img src='../"+t.preview.url+"' style='cursor:pointer;' width='200px' on"+Events.pointer.up+"='mapInfo.go("+e.id+", 0)'></div>"):mapInfo.infowindow.setContent("<div style='text-align:center;color:#343434;max-width: 200px;'><a href='javascript:void(null);' on"+Events.pointer.up+"='mapInfo.go("+e.id+", 0)'><b>"+e.info+"</b> <div style='text-align:center;padding: 15px;color: #000000'><i class='fa fa-camera' style='font-size:40px;opacity:0.5'></i></div></a></div>"),mapInfo.isStreetView){var i=mapInfo.map.getStreetView().getPov();mapInfo.go(e.id,"@"+i.heading),mapInfo.map.getStreetView().setPosition(this.getPosition())}else mapInfo.infowindow.open(map,this),mapInfo.map.panTo(this.getPosition())})}mapInfo.splitView&&mapInfo.showStreetViewOnStart&&(mapInfo.map.getStreetView().setPosition({lat:parseFloat(player.current.gps_x),lng:parseFloat(player.current.gps_y)}),mapInfo.map.getStreetView().setPov({heading:player.lastHeading,pitch:0}),mapInfo.map.streetView.setVisible(!0),mapInfo.showStreetViewOnStart=!1),$("#findme").html("<i class='fas fa-street-view'></i>")})},600)},go:function(e,t){mapInfo.radar.setPosition(mapInfo.lastMark.getPosition()),mapInfo.hideMenu(),player.go(e,t)},showWindow:function(){return player.internet?(isOpened=!0,$("#player").hide(),player.currentView.pause(),$("#mapinfo").removeClass("hidden"),void $("#menubutton").hide()):void alert("Musisz być połączony z internetem aby wyświetlić mapy.")},showMenu:function(){mapInfo.showWindow(),mapInfo.initMap()},clickToggleMiniMap:function(){mapInfo.clicked=!0,this.toggleMiniMap()},toggleMiniMap:function(){if(!mapInfo.showStreetViewOnStart&&!mapInfo.splitView){if($("#tmapbtn").toggleClass("active"),mapInfo.miniView)return Tab.groups.map.disable(),$("#mapinfo").addClass("hidden"),$("#mapinfo").removeClass("mini"),mapInfo.miniView=!1,void(mapInfo.isMapRunning=!1);if(player.internet&&!($(window).width()<1024)){Tab.groups.map.enable(),$("#mapinfo").removeClass("hidden"),SpeechManager.enableSpeech("#mapinfo",".speaks",1,"TOPMENU"),$("#mapbar .coords").html(""),$("#mapcontent").html(""),Plan.release(),mapInfo.loadGMap(),mapInfo.map.set("fullscreenControl",!1),null==mapInfo.enlargeNode&&(mapInfo.enlargeNode=$("#mapinfo").append("<a href='javascript:void(null);' onclick='mapInfo.toggleSplitView();' id='map_enlarge' title='"+TPL.lng("tips.enlargemap","Powiększ mapę")+"' data-speak='MAP_ZOOM' data-speakgroup='TIPS' class='speaks'><img src='assets/enlarge.png'></a>"),mapInfo.closeNode=$("#mapinfo").append("<a href='javascript:void(null);' onclick='mapInfo.toggleMiniMap();' id='map_close' title='"+TPL.lng("tips.closemap","Zamknij mapę")+"' data-speak='PLAYER.MAPBAR.HIDE' data-speakgroup='TIPS' class='speaks'><img src='assets/closemap.png'></a>")),mapInfo.initialized||(AppEvent.on(player,"placeReady",function(e){mapInfo.placeReady()}),AppEvent.on(player,"PLACE.LOADED",function(e){mapInfo.placeLoaded()}),mapInfo.initialized=!0,$("#front_search").on("keydown",mapInfo.detectEnter),$("#front_search").prop("placeholder",TPL.lng("tips.search","Szukaj ...")),$("#front_search").prop("title",TPL.lng("tips.entersearchtext","Wpisz szukany tekst"))),$("#mapinfo").addClass("mini"),player._width=$("#player").width(),player._height=$("#player").height(),setTimeout(function(){player.currentView.reorient()},200);var e=mapInfo.map.getCenter();google.maps.event.trigger(mapInfo.map,"resize"),mapInfo.map.setCenter(e),mapInfo.miniView=!0}}},toggleMenuDesktop:function(){return player.internet?(isOpened=!0,mapInfo.splitView?($("#player").css("left","50%"),$("#player").css("width","50%"),$("#hotspots").css("left","50%"),$("#mapinfo").addClass("small"),player._width=$("#player").width(),player._height=$("#player").height(),player.currentView.reorient()):($("#player").hide(),player.currentView.pause()),player.setHistoryManager(this),this.isDesktop=!0,$("#mapinfo").removeClass("hidden"),$("#menubutton").hide(),$("#hmenu").hide(),mapInfo.initMap(),void(mapInfo.splitView||mapInfo.toggleSplitView())):void alert("Musisz być połączony z internetem aby wyświetlić mapy.")},hideMenuReal:function(){mapInfo.splitView&&mapInfo.toggleSplitView(),mapInfo.hideMenu()},hideMenu:function(){isOpened=!1,$("#player").show(),player.currentView.resume(),mapInfo.splitView||mapInfo.miniView||($("#mapinfo").addClass("hidden"),Plan.hide(),Floors.close()),this.isDesktop&&$("#hmenu").show(),$("#menubutton").show()},toggleSplitView:function(){if(mapInfo.splitView=!mapInfo.splitView,mapInfo.splitView||mapInfo.showStreetViewOnStart?($("#mapinfo").removeClass("mini"),$("#player").show(),$("#player").css("left","50%"),$("#player").css("width","50%"),$("#hotspots").css("left","50%"),$("#info").css("left","50%"),$("#menu_container").css("left","50%"),$("#mapinfo").addClass("small"),player.currentView.resume(),player._width=$("#player").width(),player._height=$("#player").height(),void 0!=mapInfo.map&&mapInfo.map.set("fullscreenControl",!0),setTimeout(function(){player.currentView.reorient()},200),this.isDesktop&&$("#hmenu").show()):($("#player").hide(),$("#mapinfo").addClass("mini"),player.currentView.pause(),$("#player").css("left","0%"),$("#player").css("width","100%"),$("#hotspots").css("left","0%"),$("#info").css("left","0%"),$("#menu_container").css("left","0%"),this.isDesktop&&$("#hmenu").hide(),$("#mapinfo").removeClass("small"),void 0!=mapInfo.map&&mapInfo.map.set("fullscreenControl",!1),mapInfo.infowindow.close(),setTimeout(function(){player.currentView.reorient()},200)),void 0!=mapInfo.map){var e=mapInfo.map.getCenter();google.maps.event.trigger(mapInfo.map,"resize"),mapInfo.map.setCenter(e)}}};RadarMarker.prototype=new google.maps.OverlayView,RadarMarker.prototype.process=function(){if("panorama"==player.current.place_type){var e=player.currentView.getRX();e=360-e+90;try{e+=parseFloat(player.current.properties.north)}catch(t){}e=360-e,void 0!=this.node&&this.node.css("transform","rotate("+e+"deg)")}},RadarMarker.prototype.draw=function(){var e=this.div;if(0!=player.current.properties.north){if(!e){this.node=$("<div style='transform-origin: 50% 100%'><img src='assets/radar.png' width='100%'></div>"),e=this.div=this.node[0],e.className="marker",e.style.position="absolute",e.style.cursor="pointer",e.style.width="100px",e.style.height="100px";var t=this.getPanes();t.overlayLayer.appendChild(e)}var i=this.getProjection().fromLatLngToDivPixel(this.latlng);i&&(e.style.left=i.x-50+"px",e.style.top=i.y-100+"px")}},RadarMarker.prototype.remove=function(){this.div&&(this.div.parentNode.removeChild(this.div),this.div=null)},RadarMarker.prototype.getPosition=function(){return this.latlng},RadarMarker.prototype.setPosition=function(e){var t=new google.maps.LatLng(e.lat,e.lng);this.latlng=t},$(document).ready(function(){mapInfo.initialized||(AppEvent.on(player,"placeReady",function(e){mapInfo.placeReady()}),AppEvent.on(player,"PLACE.LOADED",function(e){mapInfo.placeLoaded()}),mapInfo.initialized=!0,$("#front_search").on("keyup",mapInfo.detectEnter),$("#front_search").prop("placeholder",TPL.lng("tips.search","Szukaj ...")),$("#front_search").prop("title",TPL.lng("tips.entersearchtext","Wpisz szukany tekst")))});var menuListStatic={};menuList.prototype={lastItem:null,items:[],back:function(){var e=player.currentHistoryState;$(e.current).hide(),$(e.parent).show()},multiBack:function(e){null!=player.list.lastItem?($("#"+player.list.lastItem.id).hide(),player.list.lastItem=player.list.lastItem.parent,null!=player.list.lastItem?$("#"+player.list.lastItem.id).show():history.back()):history.back(),e.preventDefault()},openMenu:function(e){null==e?(null!=player.list.lastItem&&$("#"+player.list.lastItem.id).hide(),$("#rootmenu").show()):""!=e.id&&(null!=player.list.lastItem?$("#"+player.list.lastItem.id).hide():$("#rootmenu").hide(),$("#"+e.id).show()),player.list.lastItem=e},showSubmenu:function(e){var t="#"+$(this).attr("data-sub"),i=$(this).attr("data-parent"),a={current:t,parent:i};menuListStatic.scroll.isScrolling()||(player.addToHistory(a,$(this).attr("data-title"),t),$(i).hide(),$(t).show(),this.scroll.calculateBounds(),e.preventDefault())},loadRec:function(e,t,i,a,n){null!=a&&(elem=$("<div class='folder' style='border-bottom:2px solid #ffffff;'><a href='javascript:void(null);' data-title='"+a.title+"' style='color: #919191;'><div class='lglyph'>&laquo;</div>"+a.title+"</a></div>"),$(i).append(elem),elem.children("a").on("touchend",this.multiBack));for(var s=0;s<e.length;s++)if(e[s].pano_id==player.ident&&navbar.setMenu(n,e[s]),void 0!=e[s].childs){elem=$("<div class='folder'><a href='javascript:void(null);' data-parent='"+i+"' data-title='"+e[s].title+"' data-sub='sub_"+t+"_"+s+"'>"+e[s].title+"</a><div class='glyph'>&raquo;</div></div>");"translate3d("+player._width+"px, 0px, 0px)";sub=$("<div id='sub_"+t+"_"+s+"' style='display:none;' class='menu'></div>"),$(i).append(elem),$("#panos").append(sub),elem.children("a").on("touchend",this.showSubmenu);var o={id:"sub_"+t+"_"+s,parent:n,title:e[s].title};this.items.push(o),this.loadRec(e[s].childs,t+"_"+s,"#sub_"+t+"_"+s,e[s],o)}else"link="==e[s].pano_id.substr(0,5)?elem=$("<div class='folder'><a href='javascript:void(null);' ontouchend='menuListStatic.openUrl(\"http://"+e[s].pano_id.substr(5)+"\", true, 0);'>"+e[s].title+"</a></div><div id='sub_"+t+"_"+s+"' style='margin-left:50px;'></div>"):(e[s].look_at?look=e[s].look_at:look=0,elem=$("<div class='folder'><a href='javascript:void(null);' ontouchend='menuListStatic.openUrl(\""+e[s].pano_id+'", false, '+look+");'>"+e[s].title+"</a></div><div id='sub_"+t+"_"+s+"' style='margin-left:50px;'></div>")),$(i).append(elem);this.scroll.calculateBounds()},openUrl:function(e,t,i){alert("???"),menuListStatic.scroll.isScrolling()||t||player.go(e,i)},loadPanoList:function(e){var t={id:"-1",title:"Lista panoram"};if(t.panos=[],this.scroll=new Scroller("#panos","#ui"),e=player.current.menu,navbar.setTitle(player.current.place_name),!player.imagesLoaded){var i=$("<div class='menu' id='rootmenu'></div>");$("#panos").append(i);var a={id:"rootmenu",parent:null,title:""};this.items.push(a),this.loadRec(e,"","#rootmenu",null,a),player.imagesLoaded=!0}}};var menubar={currentTab:null,setActive:function(e){menubar.closeCurrent(),menubar.currentTab=e,$("#menubar a").removeClass("active"),$(e.menuButton).addClass("active")},closeCurrent:function(){null!=menubar.currentTab?(menubar.currentTab.close(),$("#menubar a").removeClass("active"),$("#menubar_menu").addClass("active"),menubar.currentTab=null):player.list.openMenu(null)}},menuListStatic={};multiMenuList.prototype={lastItem:null,lastSubMenu:null,items:[],back:function(){var e=player.currentHistoryState;$(e.current).hide(),$(e.parent).show()},multiBack:function(e){null!=player.list.lastItem?($("#"+player.list.lastItem.id).hide(),player.list.lastItem=player.list.lastItem.parent,null!=player.list.lastItem?$("#"+player.list.lastItem.id).show():history.back()):history.back(),e.preventDefault()},openMenu:function(e){null!=player.list.lastSubMenu&&$(player.list.lastSubMenu).hide(),null==e?(null!=player.list.lastItem&&$("#"+player.list.lastItem.id).hide(),$("#rootmenu").show()):""!=e.id&&(null!=player.list.lastItem?$("#"+player.list.lastItem.id).hide():$("#rootmenu").hide(),$("#"+e.id).show()),player.list.lastItem=e},showSubmenu:function(){var e=menuListStatic.currentItem,t="#"+$(e).attr("data-sub"),i=$(e).attr("data-parent"),a={current:t,parent:i};player.addToHistory(a,$(e).attr("data-title"),t),$(i).hide(),$(t).show(),player.list.lastSubMenu=t,this.scroll.calculateBounds()},loadRec:function(e,t,i,a,n){null!=a&&(elem=$("<div class='folder' style='border-bottom:2px solid #ffffff;'><a href='javascript:void(null);' data-title='"+a.title+"' style='color: #919191;'><div class='lglyph'>&laquo;</div>"+a.title+"</a></div>"),$(i).append(elem),elem.children("a").on(Events.pointer.down,this.multiBack));for(var s=0;s<e.length;s++)if(e[s].pano_id==player.ident&&navbar.setMenu(n,e[s]),void 0!=e[s].childs){elem=$("<div class='folder'><a href='javascript:void(null);' data-itemtap='menuListStatic.showSubmenu()' data-parent='"+i+"' data-title='"+e[s].title+"' data-sub='sub_"+t+"_"+s+"'>"+e[s].title+"</a><div class='glyph'>&raquo;</div></div>");"translate3d("+player._width+"px, 0px, 0px)";sub=$("<div id='sub_"+t+"_"+s+"' style='display:none;' class='menu'></div>"),$(i).append(elem),$("#panos").append(sub);var o={id:"sub_"+t+"_"+s,parent:n,title:e[s].title};this.items.push(o),this.loadRec(e[s].childs,t+"_"+s,"#sub_"+t+"_"+s,e[s],o)}else"link="==e[s].pano_id.substr(0,5)?elem=$("<div class='folder'><a href='javascript:void(null);' data-itemtap='menuListStatic.openUrl(\"http://"+e[s].pano_id.substr(5)+"\", true, 0);'>"+e[s].title+"</a></div><div id='sub_"+t+"_"+s+"' style='margin-left:50px;'></div>"):(e[s].look_at?look=e[s].look_at:look=0,elem=$("<div class='folder'><a href='javascript:void(null);' data-itemtap='menuListStatic.openUrl(\""+e[s].pano_id+'", false, '+look+");'>"+e[s].title+"</a></div><div id='sub_"+t+"_"+s+"' style='margin-left:50px;'></div>")),$(i).append(elem);this.bindTapEvents($(i)),this.scroll.calculateBounds()},openUrl:function(e,t,i){if(!menuListStatic.scroll.isScrolling())if(t){var a=window.open(e,"_blank");(null!=a||"undefined"==typeof a)&&confirm("Twoja przeglądarka blokuje otwieranie nowych okien. Czy chcesz otworzyć ten link w bieżącym oknie ?")&&(document.location=e)}else player.go(e,i)},loadPanoList:function(e){var t={id:"-1",title:"Lista panoram"};t.panos=[],this.scroll=new Scroller("#panos","#ui"),e=player.current.menu,navbar.setTitle(player.current.place_name);var i=$("<div class='menu' id='rootmenu'></div>");$("#panos").append(i);var a={id:"rootmenu",parent:null,title:""};this.items.push(a),this.loadRec(e,"","#rootmenu",null,a),player.imagesLoaded=!0},bindTapEvents:function(e){var t=this;e.find("[data-itemtap]").each(function(e,i){var a=$(i);a.attr("data-vlistno",e),a.on(Events.pointer.down,function(e){var i=getPointerEvent(e),a=$(this),n=menuListStatic;a.attr("data-itemtap");n.cachedX=i.pageX,n.cachedY=i.pageY,n.currentX=i.pageX,n.currentY=i.pageY,n.touchStarted=!0,menuListStatic.currentItem=this,t=this,$(this).css("background-color","#121212")}),a.on(Events.pointer.move,function(e){var t=getPointerEvent(e),i=($(this),menuListStatic);i.currentX=t.pageX,i.currentY=t.pageY}),a.on(Events.pointer.up,function(e){var t=$(this),i=menuListStatic,a=t.attr("data-itemtap");if(i.touchStarted=!1,Math.abs(i.cachedX-i.currentX)<10&&Math.abs(i.cachedY-i.currentY)<10){var n=new Function(a);n()}$(this).css("background-color","#000000")})}),this.scroll.calculateBounds()}};var menuListStatic={};multiMenuListNS.prototype={lastItem:null,lastSubMenu:null,items:[],back:function(){var e=player.currentHistoryState;history.back(),$(e.current).hide(),$(e.parent).show()},multiBack:function(e){null!=player.list.lastItem?($("#"+player.list.lastItem.id).hide(),player.list.lastItem=player.list.lastItem.parent,null!=player.list.lastItem?$("#"+player.list.lastItem.id).show():history.back()):history.back(),e.preventDefault()},openMenu:function(e){null!=player.list.lastSubMenu&&$(player.list.lastSubMenu).hide(),null==e?(null!=player.list.lastItem&&$("#"+player.list.lastItem.id).hide(),$("#rootmenu").show()):""!=e.id&&(null!=player.list.lastItem?$("#"+player.list.lastItem.id).hide():$("#rootmenu").hide(),$("#"+e.id).show()),player.list.lastItem=e},showSubmenu:function(){var e=menuListStatic.currentItem,t="#"+$(e).attr("data-sub"),i=$(e).attr("data-parent"),a={current:t,parent:i};player.addToHistory(a,$(e).attr("data-title"),t),$(i).hide(),$(t).show(),player.list.lastSubMenu=t},loadRec:function(e,t,i,a,n){var s=!1;null!=a?(elem=$("<div class='folder' style='border-bottom:2px solid #ffffff;'><a href='javascript:void(null);' data-title='"+a.title+"' style='color: #919191;'><div class='lglyph'>&laquo;</div>"+a.title+"</a></div>"),$(i).append(elem),elem.children("a").on(Events.pointer.up,this.back)):s=!0;for(var o=0;o<e.length;o++){if(e[o].pano_id==player.ident&&navbar.setMenu(n,e[o]),void 0!=e[o].childs){elem=$("<div class='folder'><a href='javascript:void(null);' data-itemtap='menuListStatic.showSubmenu()' data-speak='"+(s?"1":"0")+"' data-parent='"+i+"' data-title='"+e[o].title+"' data-sub='sub_"+t+"_"+o+"'>"+e[o].title+"</a><div class='glyph'>&raquo;</div></div>");"translate3d("+player._width+"px, 0px, 0px)";sub=$("<div id='sub_"+t+"_"+o+"' style='display:none;' class='menu'></div>"),$(i).append(elem),$("#panos").append(sub);var r={id:"sub_"+t+"_"+o,parent:n,title:e[o].title};this.items.push(r),this.loadRec(e[o].childs,t+"_"+o,"#sub_"+t+"_"+o,e[o],r)}else"link="==e[o].pano_id.substr(0,5)?elem=$("<div class='folder'><a href='javascript:void(null);' data-itemtap='menuListStatic.openUrl(\"http://"+e[o].pano_id.substr(5)+"\", true, 0);' data-speak='"+(s?"1":"0")+"' data-title='"+e[o].title+"'>"+e[o].title+"</a></div><div id='sub_"+t+"_"+o+"' style='margin-left:50px;'></div>"):(look=null,e[o].look_at&&(look=e[o].look_at),null!=e[o].look_at_y&&void 0!=e[o].look_at_y?look+=","+e[o].look_at_y:null==look&&(look=0),elem=$("<div class='folder'><a href='javascript:void(null);' data-itemtap='menuListStatic.openUrl(\""+e[o].pano_id+'", false, "'+look+"\");' data-speak='"+(s?"1":"0")+"' data-title='"+e[o].title+"'>"+e[o].title+"</a></div><div id='sub_"+t+"_"+o+"' style='margin-left:50px;'></div>")),$(i).append(elem);s&&SpeechManager.prepareTip(e[o].title,"TOPMENU")}this.bindTapEvents($(i))},openUrl:function(e,t,i){if(t){var a=window.open(e,"_blank");(null==a||"undefined"==typeof a)&&confirm("Twoja przeglądarka blokuje otwieranie nowych okien. Czy chcesz otworzyć ten link w bieżącym oknie ?")&&(document.location=e)}else"quiz"==e?(player.hideMenu(),Quiz.open(i)):"folder"==e?(player.hideMenu(),Library.open(i)):player.go(e,i)},loadPanoList:function(e){var t={id:"-1",title:"Lista panoram"};t.panos=[],e=player.current.menu,navbar.setTitle(player.current.place_name);var i=$("<div class='menu' id='rootmenu'></div>");$("#panos").append(i);var a={id:"rootmenu",parent:null,title:""};this.items.push(a),this.loadRec(e,"","#rootmenu",null,a),player.imagesLoaded=!0},bindTapEvents:function(e){var t=this;e.find("[data-itemtap]").each(function(e,i){var a=$(i);a.attr("data-vlistno",e),a.on(Events.pointer.down,function(e){var i=getPointerEvent(e),a=$(this),n=menuListStatic,s=a.attr("data-itemtap");n.cachedX=i.pageX,n.cachedY=i.pageY,n.currentX=i.pageX,n.currentY=i.pageY,n.touchStarted=!0,menuListStatic.currentItem=this,t=this,$(this).css("background-color","#121212"),setTimeout(function(){if(Math.abs(n.cachedX-n.currentX)<5&&!n.touchStarted&&Math.abs(n.cachedY===n.currentY)<5){var e=new Function(s);e()}},300)}),a.on(Events.pointer.move,function(e){var t=getPointerEvent(e),i=($(this),menuListStatic);i.currentX=t.pageX,i.currentY=t.pageY}),a.on(Events.pointer.up,function(e){var t=$(this),i=menuListStatic;t.attr("data-itemtap");i.touchStarted=!1,"1"==t.attr("data-speak")&&SpeechManager.speakTip(t.attr("data-title"),"TOPMENU"),Math.abs(i.cachedX-i.currentX)<10&&Math.abs(i.cachedY-i.currentY)<10,$(this).css("background-color","#252525")})})}};var navbar={title:"",parentDiv:"",setTitle:function(e){$("#info").html(e),navbar.title=e},setMenu:function(e,t){if(navbar.item=e,null!=e.parent){var i;i=null!=e&&null!=e.title?e.title:"",i.length>10&&(i=i.substr(0,10)+" ..."),null!=t&&null!=t.title&&""==navbar.title&&(navbar.title=t.title),$("#info").html("<a href='javascript:void(null);' onclick='navbar.openMenu();' class='currentMenuButton'><img src='assets/current_menu.png?20131125' width='12' height='12'><span>"+i+"</span></a> <img src='assets/right_arrow.png' width='16' height='16' style='vertical-align:middle;'> "+navbar.title)}},openMenu:function(){setTimeout(function(){$("#panosback").show(),$("#panosback a").show(),$("#menubar").show(),$("#panos").addClass("visible");var e={current:"inMenu"};player.addToHistory(e,"W menu","#inMenu"),player.setHistoryManager(player.list),player.list.openMenu(navbar.item)},100)}},inheritsFrom=function(e,t){e.prototype=Object.create(t.prototype)};panoramaGridView.prototype={rx:0,ry:0,inX:0,inY:0,panning:!1,swipe:{},veryHighQualityLoaded:!1,zoom:500,load:function(){this.loadQuality(764)},loadQuality:function(e){var t=new Image;t.onload=function(){$("#ia").attr("src",t.src)},t.src=player.storage+"/res.php?q="+e+"&id="+this.ident+"&part=1";var i=new Image;i.onload=function(){$("#ib").attr("src",i.src)},i.src=player.storage+"/res.php?q="+e+"&id="+this.ident+"&part=2";var a=new Image;a.onload=function(){$("#ic").attr("src",a.src)},a.src=player.storage+"/res.php?q="+e+"&id="+this.ident+"&part=3";var n=new Image;n.onload=function(){$("#id").attr("src",n.src)},n.src=player.storage+"/res.php?q="+e+"&id="+this.ident+"&part=4";var s=new Image;s.onload=function(){$("#ie").attr("src",s.src)},s.src=player.storage+"/res.php?q="+e+"&id="+this.ident+"&part=5";var o=new Image;o.onload=function(){$("#if").attr("src",o.src)},o.src=player.storage+"/res.php?q="+e+"&id="+this.ident+"&part=6"},process:function(){var e=.5*player._width-375,t=.5*player._height-375;this.pano.resetTransform(),this.pano.translate(e,t,this.zoom),this.pano.rotateX(this.ry),this.pano.rotateY(this.rx),this.pano.applyTransforms(),this.zoom+=swipe.distance(),this.zoom<550&&(this.zoom=550),this.zoom>750&&(this.zoom=750),this.zoom>650&&0==this.veryHighQualityLoaded&&(this.loadQuality(1280),this.veryHighQualityLoaded=!0),this.rx+=swipe.inertiaX()+.02,this.ry+=swipe.inertiaY(),0==this.properties.params?this.ry=0:"b"==this.properties.params.bend_type&&(this.ry<-this.properties.params.benddown&&(this.ry=-(1*this.properties.params.benddown)),this.ry>this.properties.params.bendup&&(this.ry=1*this.properties.params.bendup)),this.ry>75&&(this.ry=75),this.ry<-75&&(this.ry=-75),this.inX*=.7,this.inY*=.7,this.panning&&this.calculateInertia(player._mouseX,player._mouseY)},calculateInertia:function(e,t){this.inX=.01*(e-.5*player._width),this.inX>5&&(this.inX=5),this.inX<-5&&(this.inX=-5),this.inY=.01*(.5*player._height-t),this.inY>5&&(player.inY=5),this.inY<-5&&(player.inY=-5)},mouseDown:function(e){this.panning=!0,swipe.start(e.originalEvent.touches),player.calculateInertia(player._mouseX,player._mouseY)},mouseUp:function(e){swipe.end(),this.panning=!1},mouseMove:function(e){swipe.move(e.originalEvent.touches)}},panoramaHotSpot.prototype={findIconFile:function(e){var t="",i="base";return"0"==e&&(t="0"),"1"==e&&(t="1"),"2"==e&&(t="2"),"3"==e&&(t="3"),"4"==e&&(t="4"),"5"==e&&(t="5"),"6"==e&&(t="6"),"7"==e&&(t="7"),"10"==e&&(t="10"),"11"==e&&(t="11"),"14"==e&&(t="14"),"15"==e&&(t="15"),"16"==e&&(t="16"),"17"==e&&(t="17"),"18"==e&&(t="18"),"0"==t||""==e||"none"==e?t="/html5/assets/hotspot2_top.png":""!=t&&(t="/html5/assets/spots/"+t+".png"),""!=e&&""==t&&(t=e,i="custom"),player.offline&&(t="custom"==i?"assets/spots"+t:t.replace("/html5/","")),{file:t,type:i}},updateIcon:function(e,t){ff=this.findIconFile(e),this.node.find(".ico").attr("src",ff.file),this.icon=ff.file,this.hovericon=t,this.properties.spot=e,this.properties.hover=t,"custom"==ff.type?this.node.find(".bg").hide():this.node.find(".bg").show()},speakTitle:function(){void 0!=this.properties.place.speech_title&&null!=this.properties.place.speech_title&&""!=this.properties.place.speech_title&&HotSpotManager.lastspeak!=this.properties.place.speech_title&&this.visible&&(SpeechManager.speakTip(this.properties.place.speech_title,"TOPMENU"),HotSpotManager.lastspeak=this.properties.place.speech_title),HotSpotManager.lastspeaktitle=this.properties.place.speech_title},setIconDisplay:function(e){var t="",i=!1,a="",n="",s=[50,50],o="autopilot"!=e.place.place_type&&"video"!=e.place.place_type?!0:!1;void 0!=e.with_lift&&(this.properties.with_lift=e.with_lift);var r=this.findIconFile(e.spot);t=r.file,this.spotType=e.spot,void 0!=e.mapicon&&""!=e.mapicon&&"true"!=e.nomapicon&&1!=e.nomapicon&&(i=!0,t=player.offline?"assets/gicons/"+e.mapicon:"../../gicons/"+e.mapicon,n=" icon",s[0]=32,s[1]=37,a="position:absolute;left:-16px;top:-32px;z-index:99"),this.node=$("<div class='hotspot"+n+"' id='"+this.no+"'></div>"),""==t&&(t="/html5/assets/hotspot2_top.png"),e.fullName=e.place.place_name,""==e.fullName&&"panorama"==e.place.place_type&&(e.fullName="Panorama "+e.ident),""==e.fullName&&"photo"==e.place.place_type&&(e.fullName="Zdjęcie "+e.ident);var l=e.place.thumb;player.offline&&(l="/html5/assets/eee.png?"==l?"assets/eee.png":"data/thumb_"+e.ident+".jpg"),"http"==e.ident.substr(0,4)&&(o=!1,e.fullName=e.ident,e.ident.length>35&&(e.fullName=e.ident.substr(0,35)+" ...")),e.html="","catalogue3D"==e.place.place_type&&(e.fullName="Gallery",o=!1,e.html="<div style='text-align:center;padding: 15px;color: #000000'><i class='fa fa-camera' style='font-size:40px;opacity:0.5'></i></div>");var p,d;d="1"==e.with_lift||"true"==e.with_lift?1:0,p=void 0!=e.lifth?parseInt(e.lifth):80;var c;c=s[1]<=37?-1*(p+5):-1*(p+18),this.node.html(TPL.render("hotspot-template",{no:this.no,hasPreview:o,spotfile:t,ident:e.ident,angle:e.angle,click:"on"+Events.pointer.down,data:e,thumbnail:l,ico_width:s[0],ico_height:s[1],style:a,offsety:c,lifth:p,with_lift:d})),"custom"==r.type?this.node.find(".bg").hide():this.node.find(".bg").show(),this.icon=t,this.hovericon=e.hover,player.offline&&void 0!=this.hovericon&&(this.hovericon=this.hovericon.replace("/graphics","assets/spots/graphics"),console.log(this.hovericon));var h=this;void 0!=this.fullName&&this.node.attr("title",TPL.lng("tips.clicktogo","Kliknij aby przejść do: ")+this.fullName.replace(/(<([^>]+)>)/gi,"")),this.node.on(Events.pointer.up,function(){h.proceed()}),this.node.on("mouseover",function(){"rt"!=h.properties.action&&HotSpotManager.more(h.no),window.setStatus("ID: "+e.ident),void 0!=h.hovericon&&""!=h.hovericon&&h.node.find(".ico").attr("src",h.hovericon),h.hoveringdt=Date.now(),h.hovering=!0}),this.node.on("mouseleave",function(){h.hovering=!1,h.noMore(),window.setStatus(""),void 0!=h.hovericon&&""!=h.hovericon&&h.node.find(".ico").attr("src",h.icon)}),this.node.find(".close").on(Events.pointer.up,function(e){h.noMore(),e.stopPropagation()}),this.attachDisplay(),player.cms&&this.node.find(".marker").addClass("hcms")},setPreviewDisplay:function(e){var t="";void 0!=e.shape&&(this.properties.shape=e.shape),void 0!=e.with_title&&(this.properties.with_title=e.with_title),void 0!=e.with_lift&&(this.properties.with_lift=e.with_lift),"circle"==e.shape?(this.properties.with_title&&(t="<div class='circle-title'>"+this.fullName+"</div>"),this.node=$("<div class='hotspot' id='"+this.no+"'>"+t+"<div class='circle-preview-spot' style='background-image:url(\""+this.thumbnail+"\")'></div><div class='circle-marker'></div></div>")):(this.properties.with_title&&(t="<div class='rect-title'>"+this.fullName+"</div>"),this.node=$("<div class='hotspot' id='"+this.no+"'>"+t+"<div class='rect-preview-spot' style='background-image:url(\""+this.thumbnail+"\")'></div><div class='rect-marker'></div></div>"));var i=this;player.cms||this.node.on(Events.pointer.up,function(){i.proceed()}),this.node.on("mouseover",function(){window.setStatus("ID: "+i.properties.ident)}),this.attachDisplay()},setDirectionDisplay:function(e){},setAction:function(e,t,i){this.properties.action=e,this.properties.ident=t,this.properties.angle=i},setPosition:function(e,t){this.properties.x=parseFloat(e)+(parseFloat(this.north)-95),this.properties.y=parseFloat(t)},attachDisplay:function(){if($("#hotspots").append(this.node),this.node3D=new css3DNode("#"+this.no),player.cms)if(void 0==this.editor)this.editor=new HotSpotEdit(this),
this.editor.addUI();else{var e=this;this.node.on("click",function(t){var i=Events.getPointerEvent(t);e.editor.click(i)}),this.editor.hs=this,this.editor.hs.node=this.node,this.editor.addUI()}},updateSound:function(e){this.properties.sound=e},updateDisplay:function(e,t){void 0!=this.node&&this.node.remove(),this.display=e,"icon"==e&&this.setIconDisplay(t),"preview"==e&&this.setPreviewDisplay(t),"direction"==e&&this.setDirectionDisplay(t)},remove:function(){$("#hotspots").remove(this.node)},more:function(){0==this.preventShowingInfo&&("autopilot"!=this.properties.place.place_type&&this.node.find(".spotdesc").show(),$("#hotspots").append(this.node))},noMore:function(){this.node.find(".spotdesc").hide()},proceed:function(e){var t=this;if(this.canProceed){if(HotSpotManager.setTransition(this.properties.transition),AppEvent.trigger(player,"HOTSPOT.STARTLOOKING",t),this.preventShowingInfo)return void player.currentView.turnToAnd(this.lookAtCoords().x,this.lookAtCoords().y,60,function(){AppEvent.trigger(player,"HOTSPOT.LOOKAT",t)});var i=0,a=0;if(this.valign||(i=this.lookAtCoords().y),"horizon"==this.properties.centermode&&(i=0),"exact"==this.properties.centermode&&(i=this.lookAtCoords().y),a=this.lookAtCoords().x,void 0!=this.properties.action&&"rt"==this.properties.action&&""!=this.properties.angle&&"0"!=this.properties.angle){var n=this.properties.angle.toString().split(",");a=parseFloat(n[0])+180+(parseFloat(this.north)-95),n.length>1&&(i=-parseFloat(n[1]))}if(player.cms&&1!=e){this.clicks++,this.clicks>1&&player.currentView.turnToAnd(a,i,{speed:60,rangeX:10,rangeY:20},function(){AppEvent.trigger(player,"HOTSPOT.LOOKAT",t);var e=t.properties.angle;if((void 0==t.properties.action||"go"==t.properties.action)&&void 0!=t.properties.turn_to){var i=t.getTurn(t.properties.turn_to,t.properties.angle);e=[t.properties.angle,i],player.go(t.properties.ident,e,!0)}});var t=this;void 0!=this.resetclicktimer&&clearTimeout(this.resetclicktimer),this.resetclicktimer=setTimeout(function(){t.clicks=0,this.resetclicktimer=void 0},1e3)}else{if(void 0!=this.properties.sound&&""!=this.properties.sound.effect){void 0!=this.audioEffect&&(this.audioEffect.pause(),delete this.audioEffect),this.audioEffect=new Audio("/storage/sounds/effects"+this.properties.sound.effect),this.audioEffect.play();var t=this;this.paudio_event=this.audioEffect.addEventListener("timeupdate",function(e){void 0!=t.properties.sound.duration&&t.properties.sound.duration>0&&t.audioEffect.currentTime>=t.properties.sound.duration&&(t.audioEffect.pause(),t.audioEffect.currentTime=0)})}player.currentView.turnToAnd(a,i,{speed:60,rangeX:10,rangeY:20},function(){AppEvent.trigger(player,"HOTSPOT.LOOKAT",t);var e=t.properties.angle;if(void 0!=t.properties.turn_to){var i=t.getTurn(t.properties.turn_to,t.properties.angle);e=[t.properties.angle,i]}console.log("angle: "+t.properties.angle),console.log("turn to: "+t.properties.turn_to),console.log(t.properties.ident),console.log(e),(void 0==t.properties.action||"go"==t.properties.action)&&player.go(t.properties.ident,e,!0)})}}},getTurn:function(e,t){var i=t.split(","),a=[];isNaN(e)||(e=e.toString()),void 0!=e&&""!=e&&(a=e.split(","),a[0]=parseInt(a[0])+parseInt(i[0]),a.length>1&&(a[1]=parseInt(a[1]),i.length>1&&(a[1]+=parseInt(i[1]))));var n=a[0];return a.length>1&&(n+=","+a[1]),n},target:function(){var e=this;if(this.canProceed){setTimeout(function(){e.clicks<2&&(HotSpotManager.more(e.no),e.clicks=0)},300),this.clicks++,this.clicks>1&&this.noMore(),AppEvent.trigger(player,"HOTSPOT.STARTLOOKING",e);var t=0;t=1!=this.spotType&&3!=this.spotType&&7!=this.spotType?this.lookAtCoords().y:player.currentView.renderer.ry,player.cms||player.currentView.turnToAnd(this.lookAtCoords().x,t,60,function(){AppEvent.trigger(player,"HOTSPOT.LOOKAT",e),e.clicks>1&&player.go(e.properties.ident,e.properties.angle)})}},displayHelper:function(e,t,i){var a;if(null!=this.helper){a=Object.create(t),result2=Object.create(t),a.transformByMatrix(i);var n=a.projectTo2D(),s=.3*HotSpotManager.playerHeight,o=new Vector3D(1,0,0),r=o.dot(a),l=-n.x*(.5*HotSpotManager.playerWidth)+.5*HotSpotManager.playerWidth,p=n.y*(.5*HotSpotManager.playerHeight)+.5*HotSpotManager.playerHeight,p=.5*HotSpotManager.playerHeight+this.properties.y*-.7+10*player.currentView.getRY();if(s>p&&(p=s),p>HotSpotManager.playerHeight-s&&(p=HotSpotManager.playerHeight-s),0>=e&&l>=this.helperWidth&&l<=HotSpotManager.playerWidth+-1*this.helperWidth)return void this.morphHelper(!1,l+this.helperWidth*-.5-30,p-30);result2.transformByMatrix(HotSpotManager.helperMatrix);var n=result2.projectTo2D(),p=n.y*(.5*HotSpotManager.playerHeight)+.5*HotSpotManager.playerHeight,p=.5*HotSpotManager.playerHeight+this.properties.y*-.7+10*player.currentView.getRY();s>p&&(p=s),p>HotSpotManager.playerHeight-s&&(p=HotSpotManager.playerHeight-s);var d,c=0;if(0>r?(c=10,null==this.helperLeft&&(this.helperLeft=this.helper.find(".hleft")),this.helperLeft.show(),null==this.helperRight&&(this.helperRight=this.helper.find(".hright")),this.helperRight.hide(),d={d:"l",y:p}):(c=HotSpotManager.playerWidth-this.helperWidth-40,null==this.helperLeft&&(this.helperLeft=this.helper.find(".hleft")),this.helperLeft.hide(),null==this.helperRight&&(this.helperRight=this.helper.find(".hright")),this.helperRight.show(),d={d:"r",y:p}),p=HotSpotManager.arrangeHelpers(d),null==this.lastHelperY&&(this.lastHelperY=p),p=this.lastHelperY+.05*(p-this.lastHelperY),player._width<500||player._height<500){if(this.helperLeft.hide(),this.helperRight.hide(),0>=e&&l>=0&&l<=HotSpotManager.playerWidth)return void this.morphHelper(!1,l+this.helperWidth*-.5-30,p-30);return}this.morphHelper(!0,c,p),this.lastHelperY=p}},morphHelper:function(e,t,i){this.helper.show(),e?(this.helper.css("z-index",""),void 0==this.plate&&(this.plate=this.node.find(".plate")),this.plate.removeClass("plated")):(this.helper.css("z-index","99"),void 0==this.plate&&(this.plate=this.node.find(".plate")),this.plate.addClass("plated")),this.morphHelperState!=e&&(this.morphHelperPosition+=e?2:-2),this.morphHelperPosition<=0||this.morphHelperPosition>=100?(this.morphHelperState=e,e?this.helper.css("visibility","visible"):this.helper.css("visibility","hidden")):(this.morphHelperPosition+=e?1:-1,this.helper.css("visibility","visible"),this.helper.css("opacity",.015*this.morphHelperPosition)),e&&void 0!=t&&void 0!=i?(this.helper.css("transform","translate3d("+t+"px, "+i+"px, 0)"),this.morph_x=t,this.morph_y=i,this.morph_ox=t,this.morph_oy=i):e||void 0==t||void 0==i||(this.morph_x+=.2*(t-this.morph_x),this.morph_y+=.2*(i-this.morph_y),this.helper.css("transform","translate3d("+this.morph_x+"px, "+this.morph_y+"px, 0)"))},process:function(e,t){var i=new Vector3D(0,0,0),a=new Vector3D(0,0,0);if(i.x=this.vec3D.x,i.y=this.vec3D.y,i.z=this.vec3D.z,a.x=this.vec3D.x,a.y=this.vec3D.y,a.z=this.vec3D.z,a.normalize(),a.dot(t)>0)return this.displayHelper(a.dot(t),i,e),this.visible=!1,void this.node.css("visibility","hidden");null!=this.helper&&this.displayHelper(a.dot(t),i,e),this.node.css("visibility","visible"),i.transformByMatrix(e);var n=i.projectTo2D();fx=-n.x*(.5*HotSpotManager.playerWidth)+.5*HotSpotManager.playerWidth,fy=n.y*(.5*HotSpotManager.playerHeight)+.5*HotSpotManager.playerHeight;var s;return s="1"==this.properties.with_lift?void 0!=this.properties.lifth?parseInt(this.properties.lifth):80:0,fy<175+s?this.node.find(".spotdesc").addClass("flip"):this.node.find(".spotdesc").removeClass("flip"),this.updatePosition&&(this.node3D.resetTransform(),this.node3D.translate(fx,fy,0),this.node3D.applyTransforms()),player.lastIdent==this.properties.ident&&HotSpotManager.setLastVisited(this,fx,fy),fx<0||fy<0||fx>HotSpotManager.playerWidth||fy>HotSpotManager.playerHeight?this.visible=!1:this.visible=!0,{x:fx,y:fy}},remove:function(){this.node.remove()},addHelper:function(e,t){this.helper=$("<div class='hotspot_helper'><div class='hleft'></div><div class='hright'></div></div>"),this.helper.find(".hleft").append(e),this.helper.find(".hright").append(t),this.helperWidth=50,$("#hotspots").append(this.helper)},removeHelper:function(){null!=this.helper&&(this.helper.remove(),this.helper=null,this.helperLeft=null,this.helperRight=null)},lookAtCoords:function(){var e={};return e.x=this.properties.x+180,e.y=180*Math.atan(this.properties.y/1500)/Math.PI,e},fadeIn:function(){var e=this;console.log("fadein"),setTimeout(function(){e.node.find(".marker").addClass("fin")},500*Math.random()+40)}};var panoramaViewStatic={front:"",back:"2"};panoramaView.prototype={rx:0,ry:0,inX:0,inY:0,panning:!1,swipe:{},veryHighQualityLoaded:!1,basePerspective:550,zoom:550,minZoom:450,maxZoom:1550,zoomModifier:0,hqZoom:600,zoomMultiplier:1,swipeSpeed:1,keys:{},realZoom:function(){return this.zoom+this.zoomModifier},setNav:function(){this.nav=$("<div class='nav'></div>");var e=$("<a href='javascript:void(null)' class='speaks' data-speak='PLAYER.ZOOM_IN' data-speakgroup='TIPS' title='"+TPL.lng("tips.clicktozoomin","Kliknij aby przybliżyć")+"'><i class='fa fa-search-plus'></i></a>"),t=$("<a href='javascript:void(null)' class='speaks' data-speak='PLAYER.ZOOM_OUT' data-speakgroup='TIPS' title='"+TPL.lng("tips.clicktozoomout","Kliknij aby oddalić")+"'><i class='fa fa-search-minus'></i></a>");this.nav.append(e),this.nav.append(t);var i=this;e.on(Events.pointer.down,function(){i.zooming=.5}),e.on(Events.pointer.up,function(e){i.zooming=0,e.preventDefault()}),t.on(Events.pointer.down,function(){i.zooming=-.5}),t.on(Events.pointer.up,function(e){i.zooming=0,e.preventDefault()}),"1"==PROJECT.settings["ui/icons/zoom"],$("#ui").append(this.nav),SpeechManager.enableSpeech(".nav",".speaks",0,"TIPS")},clearNav:function(){void 0!=this.nav&&this.nav.remove()},setPerspective:function(e){this.zoom=e,this.zoom<this.minZoom&&(this.zoom=this.minZoom),this.zoom>this.maxZoom&&(this.zoom=this.maxZoom),this.renderer.setPerspective(this.realZoom())},load:function(){if(this.spots=this.properties.properties.spots,panoramaViewStatic.spots=this.spots,this.renderer.load(),this.autorunH=parseFloat(this.properties.properties.autorunH),isNaN(this.autorunH)&&(this.autorunH=0),player.cms?this.autorunH=0:this.autorunH=.1,void 0!=this.properties.folder.nozoom){var e=100-parseInt(this.properties.folder.nozoom),t=(this.maxZoom-this.zoom)*e/100;this.maxZoom=this.zoom+t}if(this.loadSpots){HotSpotManager.setVisibility(!1),HotSpotManager.addAll(this.spots,this.properties.properties.north),HotSpotManager.clearRenderables(),HotSpotManager.addRenderables(this.properties.collectibles,"collectible");for(var i in this.properties.indicators){var a,n=this.properties.indicators[i];a=-1*Math.tan(n.look_y*(Math.PI/180))*1500;var s=new panoramaHotSpot({ident:n.place_id,spot:"1",x:parseFloat(n.look_x)+1,y:a,place:{type:"indicator",place_name:n.title}},i,0);s.indicator=n,s.addHelper($("<a href='javascript:void(null);' on"+Events.pointer.up+"='player.currentView.fastTurnTo("+s.lookAtCoords().x+","+s.lookAtCoords().y+")' class='indicator_left ind_title'>"+n.title+" "+n.no+"<br><small class='ind_title2'>"+n.title2+"</small><div class='arrow'></div></a>"),$("<a href='javascript:void(null);' on"+Events.pointer.up+"='player.currentView.fastTurnTo("+s.lookAtCoords().x+","+s.lookAtCoords().y+")' class='indicator_right ind_title'>"+n.title+" "+n.no+"<br><small class='ind_title2'>"+n.title2+"</small><div class='arrow'></div></a>")),s.helperWidth=120,s.tag="indicator",s.canProceed=!1,s.node.html("<div class='indicator_plate indtoggle'><div class='plate'><b class='ind_title'>"+n.title+" "+n.no+"</b><Br><span class='ind_title2'>"+n.title2+"</span></div><a href='javascript:void(null);' class='more'><i class='fa fa-angle-down'></i></a><div class='panel'>"+(""!=n.info?n.info.replace(new RegExp("\n","g"),"<br>"):"")+"</div></div>"),player.cms&&(s.node.append("<div class='indicator_selected'></div>"),s.editor.addUI()),s.node.find(".indtoggle").on("click",function(){var e=$(this).find(".more");e.toggleClass("more_flipped"),""!=e.parent().find(".panel").html()&&e.parent().find(".panel").toggleClass("panel_open")}),""==n.info.trim()&&s.node.find(".indtoggle .more").hide(),HotSpotManager.add(s)}}if(this.setPerspective(650),0!=this.properties.params&&void 0!=this.properties.params.zoom){var o=parseFloat(this.properties.params.zoom);this.zoom=650*(o/1.4),this.setPerspective(this.zoom)}this.reorient()},loaded:function(){void 0!=this.turn_to&&(player.turn_timer=setTimeout(function(){player.turn_timer=null,player.currentView.turn_to.length>1?player.currentView.turnTo(player.currentView.turn_to[0],player.currentView.turn_to[1]):player.currentView.turnTo(player.currentView.turn_to[0],player.currentView.renderer.ry)},1e3))},reorient:function(){$(window).width()<$(window).height()?(this.zoomModifier=-250,this.swipeSpeed=2):(this.zoomModifier=0,this.swipeSpeed=1),this.renderer.reorient(),this.setPerspective(this.zoom)},process:function(){if(this.renderer.process(),player.currentView==this){this.zoom+=swipe.distance()*this.zoomMultiplier,0!=this.zooming&&this.mouseWheel(this.zooming),0!=this.zoomAcc&&(this.zoom*=1+this.zoomAcc/600,this.zoomAcc*=.9),this.zoom<this.minZoom&&(this.zoom=this.minZoom),this.zoom>this.maxZoom&&(this.zoom=this.maxZoom),this.zoom>this.hqZoom&&0==this.veryHighQualityLoaded&&(this.veryHighQualityLoaded=!0),0!=this.zoomAcc&&this.setPerspective(this.zoom);var e=swipe.inertiaX()*this.swipeSpeed,t=swipe.inertiaY()*this.swipeSpeed;(Math.abs(e)>.02||Math.abs(t)>.02&&void 0!=HotSpotManager.closest)&&HotSpotManager.closest.show(),this.renderer.rx+=e,this.renderer.ry+=t,this.kb_lastzooming=this.kb_zooming,this.kb_zooming=0,(player.keys["="]||player.keys["+"])&&(this.zooming=.5,this.kb_zooming=1),player.keys["-"]&&(this.zooming=-.5,this.kb_zooming=1),1==this.kb_lastzooming&&0==this.kb_zooming&&(this.zooming=0),player.keys.ArrowLeft&&(this.renderer.rx-=.5*(player.keyCtrl?.05:1),void 0!=HotSpotManager.closest&&HotSpotManager.closest.show(),HotSpotManager.closest.speak()),player.keys.ArrowRight&&(this.renderer.rx+=.5*(player.keyCtrl?.05:1),void 0!=HotSpotManager.closest&&HotSpotManager.closest.show(),HotSpotManager.closest.speak()),player.keys.ArrowUp&&(this.renderer.ry+=.5*(player.keyCtrl?.02:1),void 0!=HotSpotManager.closest&&HotSpotManager.closest.show(),HotSpotManager.closest.speak()),player.keys.ArrowDown&&(this.renderer.ry-=.5*(player.keyCtrl?.02:1),void 0!=HotSpotManager.closest&&HotSpotManager.closest.show(),HotSpotManager.closest.speak()),this.ctween.process(),this.ctween.isRunning()?(void 0!=this.ctween.current.x&&(this.renderer.rx=this.ctween.current.x),void 0!=this.ctween.current.y&&(this.renderer.ry=this.ctween.current.y),void 0!=this.ctween.current.zoom&&this.renderer.setPerspective(this.ctween.current.zoom)):(0!=this.autorunH&&Math.abs(e)<.01||Math.abs(t)<.01)&&player.idle&&(this.renderer.rx+=.3*this.autorunH),0==this.properties.properties?2!=this.properties.pano_type&&(this.renderer.ry=0):"b"==this.properties.properties.bend_type||void 0==this.properties.properties.bend_type,this.renderer.ry>89&&(this.renderer.ry=89),this.renderer.ry<-89&&(this.renderer.ry=-89),this.inX*=.7,this.inY*=.7,this.panning&&this.calculateInertia(player._mouseX,player._mouseY),player.cms&&$("#cmscoords").val(Math.round(100*(this.renderer.rx-86))/100+", "+Math.round(100*this.renderer.ry)/-100),HotSpotManager.process3D(this.getRX(),this.getRY(),this.realZoom())}},calculateInertia:function(e,t){this.inX=.01*(e-.5*player._width),this.inX>5&&(this.inX=5),this.inX<-5&&(this.inX=-5),this.inY=.01*(.5*player._height-t),this.inY>5&&(player.inY=5),this.inY<-5&&(player.inY=-5)},mouseDown:function(e){this.panning=!0,this.ctween.stop(),swipe.start(e)},mouseUp:function(e){swipe.end(),this.panning=!1},mouseMove:function(e){swipe.move(e)},mouseWheel:function(e){this.zoomAcc+=.1*e,e>0&&this.zoomAcc<10&&(this.zoomAcc=10),0>e&&this.zoomAcc>-10&&(this.zoomAcc=-10)},clear:function(){this.loadSpots&&HotSpotManager.clear(),this.renderer.clear(),this.clearNav()},fastTurnTo:function(e,t){this.ctween.reset(),this.ctween.setSpeed(15),this.ctween.startAt(this.renderer.rx,this.renderer.ry),this.ctween.finishAt(e,t)},turnTo:function(e,t){this.ctween.reset(),this.ctween.startAt(this.renderer.rx,this.renderer.ry),this.ctween.finishAt(e,t)},turnToAnd:function(e,t,i,a){var n=0,s=null,o=null,r=-1,l=-1,p=!1,d=0;this.ctween.reset(),"object"==typeof i?(s=i.rangeX,o=i.rangeY,n=i.speed):n=i,d=this.renderer.rx-e<=180?this.renderer.rx-e:e+360-this.renderer.rx,null!=s&&(r=Math.abs(d)),null!=o&&(l=Math.abs(this.renderer.ry-t)),r>0&&s>r&&l>0&&o>l&&(p=1),p?a():(this.ctween.onFinish=a,this.ctween.setSpeed(n),this.ctween.startAt(this.renderer.rx,this.renderer.ry),this.ctween.finishAt(e,t))},zoomToAnd:function(e,t,i){this.ctween.reset(),this.ctween.onFinish=i,this.ctween.setSpeed(t),this.ctween.zooming(this.renderer.zoom,this.renderer.zoom+e)},turnToSpot:function(e){this.turnTo(e.properties.x,e.properties.y)},stopTurning:function(){try{this.ctween.stop()}catch(e){}},pause:function(){this.paused=!0},resume:function(){this.paused=!1},old2angle:function(e){return parseFloat(e)+85},beforeLeave:function(){void 0!=this.renderer.beforeLeave&&this.renderer.beforeLeave()},leaving:function(){void 0!=this.renderer.leaving&&this.renderer.leaving()},getRX:function(){return this.renderer.rx+this.renderer.disort.x},getRY:function(){return this.renderer.ry+this.renderer.disort.y},getHeadingText:function(){var e=parseInt(this.getRX()-90+4);return e%=360,0>e&&(e=360+e),e+","+parseInt(-1*this.getRY())}},photoHotSpot.prototype={updateIcon:function(e){var t,i,a,n,s,o=this.no;s=[50,50],n="hotspot-template","1"==e&&(i="1"),"2"==e&&(i="2"),"3"==e&&(i="3"),"4"==e&&(i="4"),"5"==e&&(i="5"),"6"==e&&(i="6"),"7"==e&&(i="7"),"10"==e&&(i="10"),"11"==e&&(i="11"),"14"==e&&(i="14"),"15"==e&&(i="15"),"15"==e&&(i="15"),"16"==e&&(i="16"),"17"==e&&(i="17"),"18"==e&&(i="18"),"hotspots/spot24.swf"==e&&(t=!0,i="start24",n="hotspot-start-template",s=[172,172]),"hotspots/spot23.swf"==e&&(t=!0,i="start23",n="hotspot-start-template",s=[172,172]),"hotspots/spot22.swf"==e&&(t=!0,i="start22",n="hotspot-start-template",s=[172,172]),"hotspots/spot21.swf"==e&&(t=!0,i="start21",n="hotspot-start-template",s=[172,172]),"hotspots/spot20.swf"==e&&(t=!0,i="start20",n="hotspot-start-template",s=[172,172]),"hotspots/spot19.swf"==e&&(t=!0,i="start19",n="hotspot-start-template",s=[172,172]),"hotspots/spot18.swf"==e&&(t=!0,i="start18",n="hotspot-start-template",s=[172,172]),"hotspots/spot17.swf"==e&&(t=!0,i="start17",n="hotspot-start-template",s=[172,172]),"hotspots/spot16.swf"==e&&(t=!0,i="start16",n="hotspot-start-template",s=[172,172]),"hotspots/spot15.swf"==e&&(t=!0,i="start15",n="hotspot-start-template",s=[172,172]),"hotspots/spot14.swf"==e&&(t=!0,i="start14",n="hotspot-start-template",s=[172,172]),"hotspots/spot13.swf"==e&&(t=!0,i="start13",n="hotspot-start-template",s=[172,172]),"hotspots/spot12.swf"==e&&(t=!0,i="start12",n="hotspot-start-template",s=[172,172]),this.idim=[s[0],s[1]],this.tname=n,this.properties.spot=e;var r="left:"+.5*-s[0]+"px;top:"+.5*-s[1]+"px",l="left:"+.5*-s[0]+"px;top:"+.5*-s[1]+"px",p="";t&&(p+=" speaks primary"),""==i?i="hotspot2_top.png":(a="/html5/assets/spots/hover_"+i+".png",i="/html5/assets/spots/"+i+".png");var d=this.properties,c="autopilot"!=d.place.place_type?!0:!1;d.fullName=d.place.place_name,""==d.fullName&&(d.fullName="Zdjęcie "+d.ident);var h=d.place.thumb;player.offline&&(h="data/thumb_"+d.ident+".jpg"),"http"==d.ident.substr(0,4)&&(c=!1,d.fullName=d.ident,d.ident.length>35&&(d.fullName=d.ident.substr(0,35)+" ...")),this.node.html(TPL.render(n,{no:o,hasPreview:c,spotfile:i,spotfileHover:a,ident:d.ident,angle:d.angle,click:"on"+Events.pointer.down,data:d,thumbnail:h,ico_width:s[0],ico_height:s[1],style:r,style2:l})),this.node.find(".marker").addClass("fin"),this.editor.addUI()},setSpotParams:function(e){var t=this.node.find(".ico"),i=this.node.find(".ico_hover"),a=this.node.find(".hovering");void 0!=e.scale&&(dim=[this.idim[0],this.idim[1]],dim[0]=dim[0]*(.01*parseFloat(e.scale)),dim[1]=dim[1]*(.01*parseFloat(e.scale)),t.css("left",.5*-dim[0]),t.css("top",.5*-dim[1]),t.attr("width",dim[0]),t.attr("height",dim[1]),i.css("left",.5*-dim[0]),i.css("top",.5*-dim[1]),i.attr("width",dim[0]),i.attr("height",dim[1])),void 0!=e.opacity&&t.css("opacity",.01*parseInt(e.opacity)),void 0!=e.opacity_hover&&a.css("opacity",.01*parseInt(e.opacity_hover))},speakTitle:function(){void 0!=this.properties.place.speech_title&&null!=this.properties.place.speech_title&&""!=this.properties.place.speech_title&&SpeechManager.speakTip(this.properties.place.speech_title,"TOPMENU")},setAction:function(e,t,i){this.properties.ident=e,this.properties.angle=void 0!=t?t:0,void 0!=i&&(this.properties.turn_to=i)},more:function(){this.node.find(".spotdesc").show(),$("#hotspots").append(this.node)},noMore:function(){this.node.find(".spotdesc").hide()},getTurn:function(e,t){var i=t.split(","),a=[];isNaN(e)||(e=e.toString()),void 0!=e&&""!=e&&(a=e.split(","),a[0]=parseInt(a[0])+parseInt(i[0]),a.length>1&&(a[1]=parseInt(a[1]),i.length>1&&(a[1]+=parseInt(i[1]))));var n=a[0];return a.length>1&&(n+=","+a[1]),n},proceed:function(){var e=this,t=e.properties.angle;if(void 0!=e.properties.turn_to){var i=e.getTurn(e.properties.turn_to,e.properties.angle);t=[e.properties.angle,i]}player.go(e.properties.ident,t)},target:function(){var e=this;HotSpotManager2D.more(e.no)},process:function(e,t,i,a){this.node.show();var n=e+this.properties.x*i/1e3,s=t+this.properties.y*a/500;this.node.css("left",n+"px"),this.node.css("top",s+"px")},remove:function(){this.node.remove()}},photoView.prototype={rx:0,ry:0,lrx:0,lry:0,inX:0,inY:0,panning:!1,swipe:{},pd:null,gps:null,title:null,ia:null,wwidth:0,wheight:0,isStart:!1,layers:[],node:null,opacity:0,scaleFactor:1,infoState:"",autorun:"",autorunDir:-1,autorunT:null,zooming:0,load:function(){this.layers=[],this.spots=this.properties.properties.spots,this.wwidth<600?HotSpotManager2D.setMobile(!0):HotSpotManager2D.setMobile(!1),this.infoState=player.current.properties.info_state,("full"==this.infoState||"fullext"==this.infoState)&&$(window).width()>400?(this.txm=500,this.cntx=.75):(this.txm=0,this.cntx=1),this.loadQuality(764),HotSpotManager2D.addAll(this.spots);var e;e=this,AppEvent.on(player,"MENU.INFOWINDOW.TOGGLE",function(t){t?e.infoState="full":e.infoState=""}),this.kde=AppEvent.on(player,"PLAYER.KEYDOWN",function(t){"+"==t.key&&(e.zooming=1,$(".zoomtools .zoomout").addClass("z-active")),"-"==t.key&&(e.zooming=-1,$(".zoomtools .zoomin").addClass("z-active"))}),this.kue=AppEvent.on(player,"PLAYER.KEYUP",function(t){("+"==t.key||"-"==t.key)&&(e.zooming=0,$(".zoomtools .zoomin").removeClass("z-active"),$(".zoomtools .zoomout").removeClass("z-active")),"Escape"==t.key&&player.back()})},addTools:function(){if(!this.isStart&&void 0!=player.currentView.properties.properties&&"1"==player.currentView.properties.properties.layers_mode){player.zoomtools=$("<div class='zoomtools'><a href='javascript:void(null)' class='zoomout speaks' data-speak='PLAYER.ZOOM_IN' data-speakgroup='TIPS' title='"+TPL.lng("tips.clicktozoomin","Kliknij aby przybliżyć")+"' style='line-height:26px;'>+</i></a><a href='javascript:void(null)' class='zoomin speaks' data-speak='PLAYER.ZOOM_OUT' data-speakgroup='TIPS'title='"+TPL.lng("tips.clicktozoomout","Kliknij aby oddalić")+"' style='line-height:18px;'>-</i></a><a href='javascript:void(null);' class='reset speaks' data-speak='PLAYER.RESET' data-speakgroup='TIPS'>Reset</a></div>"),$("#player").append(player.zoomtools),SpeechManager.enableSpeech(".zoomtools",".speaks",0,"TIPS");var e=this;player.zoomtools.find(".zoomin").on(Events.pointer.down,function(){e.zooming=-1,""!=e.infoState&&Menu.hideinfowindow()}),player.zoomtools.find(".zoomin").on(Events.pointer.up,function(){e.zooming=0}),player.zoomtools.find(".zoomin").on("mouseout",function(){e.zooming=0}),player.zoomtools.find(".zoomout").on(Events.pointer.down,function(){e.zooming=1,""!=e.infoState&&Menu.hideinfowindow()}),player.zoomtools.find(".zoomout").on("mouseup",function(){e.zooming=0}),player.zoomtools.find(".zoomout").on("mouseout",function(){e.zooming=0}),player.zoomtools.find(".reset").on("click",function(){e.scaleFactor=1,e.rx=0,e.lrx=0,e.ry=0,e.lry=0})}},reorient:function(){var e,t,i,a,n,s=$("#player").width(),o=$("#player").height();if(this.wwidth=s,this.wheight=o,this.wwidth<600?HotSpotManager2D.setMobile(!0):HotSpotManager2D.setMobile(!1),ia=this.ia,a=ia.naturalWidth,n=ia.naturalHeight,this.isStart||void 0==player.currentView.properties.properties||"1"!=player.currentView.properties.properties.layers_mode?(ia.width=s,i=n*(ia.width/a),ia.height=i):s>o?(ia.width=s,p=s,i=n*(ia.width/a),ia.height=i):(ia.height=o,i=o,p=a*(ia.height/n),ia.width=p),0==i&&(i=o),0==p&&(p=s),e=.5*o-Math.round(.5*i),0>e&&(e=0),t=.5*s-Math.round(.5*p),0>t&&(t=0),(void 0==player.currentView.properties.properties||"1"!=player.currentView.properties.properties.layers_mode)&&(pd.css("top",e+"px"),pd.css("left",t+"px")),o>s&&e>100){title.show(),gps.show(),gps.css("top",e+ia.height+"px");var r=.5*e-.5*title.height();50>r&&(r=50),title.css("top",r+"px")}else title.hide(),gps.hide();var s=$(window).width()-this.txm,o=$(window).height()-50;if(!this.isStart){var l=0;for(layerno in this.layers){var p=-1,d=this.layers[layerno],c=d.children("img").get(0),h=parseInt(player.currentView.properties.properties.layer_x[l]),u=parseInt(player.currentView.properties.properties.layer_y[l]),m=parseFloat(player.currentView.properties.properties.layer_scale[l]),f=c.naturalWidth*(1.555*m),g=c.naturalHeight*(1.555*m);if(c.width=f,c.height=g,f>g?f>.85*s&&(c.width=.85*s,c.height=g*(c.width/f),p=c.width,c.height>.85*o&&(c.height=.85*o,c.width=f*(c.height/g))):g>.85*o&&(c.height=.85*o,c.width=f*(c.height/g),c.width>.85*s&&(c.width=.85*s,c.height=g*(c.width/f))),0==h&&0==u){var v=.5*s-.5*c.clientWidth,y=.5*o-.5*c.clientHeight;d.css("transform","translate3d("+v+"px, "+y+"px, 0px)"),d.css("-webkit-transform","translate3d("+v+"px, "+y+"px, 0px)")}else{var v=h/1e3*s,y=u/500*o;v+c.width+20>s&&(v=s-(c.width+20)),y+c.height+20>o&&(y=o-(c.height+20)),d.css("transform","translate3d("+v+"px, "+y+"px, 0px)"),d.css("-webkit-transform","translate3d("+v+"px, "+y+"px, 0px)")}l++}}},loadQuality:function(e){if(ia=new Image,this.ia=ia,$(ia).attr("aria-hidden","true"),this.properties.priority>=10)if(this.isStart=!0,player.offline){var t="";"PL"!=player.lang&&(t="_"+player.lang),ia.src="data/screen_"+this.properties.place_id+t+".jpg"}else ia.src=this.properties.image;else player.offline?ia.src="data/photo_"+this.properties.place_id+".jpg":ia.src="https://www.wkraj.pl/data/"+this.properties.place_id+"_photo.jpg";var i=this;player.preload(!0);var a;void 0!=player.lastIdent&&null!=player.lastIdent&&player.lastIdent!=player.ident||void 0==player.current.properties.exit||"0"==player.current.properties.exit||(player.addTrack(player.current.properties.exit,player.current.properties.exit_angle),player.lastIdent=player.current.properties.exit,player.lastDir=player.current.properties.exit_angle),void 0!=player.lastIdent&&null!=player.lastIdent&&player.lastIdent!=player.ident&&(a=$("<img src='assets/menu_close.png' width='50' height='50' on"+Events.pointer.up+"='player.back();' class='photoclose speaks' data-speak='PLAYER.CLOSE' data-speakgroup='TIPS' title='"+TPL.lng("back","Powrót")+"'>")),i.cimg=a,ia.onerror=ia.onload=function(){var e;i.black=$("<div style='position:absolute;left:0px;top:0px;right:0px;bottom:0px;z-index:998;background-color:#000000;'></div>"),i.black.css("opacity",0),pd=$("<div style='position:absolute;opacity:0;z-index:999;'></div>"),i.node=pd,i.layersnode=$("<div style='position:absolute;left:0px;top:50px;pointer-events:none;' class='hqimages'></div>"),gps=$("<div style='position:absolute;right:10px;padding-top:8px;color:#ffffff;z-index:9999;'>N "+player.currentView.properties.gps_x+"&deg;<br>E "+player.currentView.properties.gps_y+"&deg;</div>"),e=null!=player.currentView.properties.folder&&null!=player.currentView.properties.folder.parent_folder&&null!=player.currentView.properties.folder.parent_folder.parent_folder&&void 0!=player.currentView.properties.folder.parent_folder.parent_folder.city_name?player.currentView.properties.folder.parent_folder.parent_folder.city_name+" - ":"",void 0!=player.currentView.properties.folder.parent_folder&&void 0!=player.currentView.properties.folder.parent_folder.city_name&&(e+=player.currentView.properties.folder.parent_folder.city_name),title=$("<div style='position:absolute;top:70px;color:#afafaf;z-index:9999;text-align:center;width:100%;font-size:12px'><h1 style='font-size:20px;color:#ffffff'>"+player.currentView.properties.folder.city_name+"</h1>"+e+"</div>");$(window).width(),$(window).height();player.preload(!1),"d"==i.properties.properties.autorun&&setTimeout(function(){i.autorun=i.properties.properties.autorun},4e3),$("#player").css("background-color","#000000");var t;t=$("<a href='javascript:void(null)' class='photolink' aria-hidden='true'></a>"),"1"!=player.currentView.properties.properties.layers_mode||""==player.currentView.properties.properties.layers.layer_0?t.append(ia):(i.bg=$("<div style='position:absolute;left:0px;top:0px;right:0px;bottom:0px;background-size:cover;z-index:999;'></div>"),i.bg.css("opacity",0),$("#player").append(i.bg),i.node.css("width","100%"),i.node.css("height","100%"),i.bg.css("background-image","url("+ia.src+")"));var n,s;if(i.photoLoaded=!0,void 0!=player.currentView.properties.properties&&"1"==player.currentView.properties.properties.layers_mode&&!i.isStart){player.currentView.properties.properties.layers&&player.currentView.properties.properties.layers.length>0&&player.preload(!0);var o={},r=0;o={};for(lind in player.currentView.properties.properties.layers)s=player.currentView.properties.properties.layers[lind],void 0!=s&&""!=s&&(n=new Image,o[lind]=n,function(e,t,a,n){e.onload=function(){var a=(e.width,$(window).width()),s=$(window).height(),o=parseInt(player.currentView.properties.properties.layer_x[n]),r=parseInt(player.currentView.properties.properties.layer_y[n]),l=$("<div style='position:absolute;left:0px;top:0px;z-index:"+(1e3+t)+"'></div>");if(l.css("opacity",0),l.append(e),i.layers.push(l),i.layersnode.append(l),0==o&&0==r){var p=.5*a-.5*e.clientWidth,d=.5*s-.5*e.clientHeight;l.css("transform","translate3d("+p+"px, "+d+"px, 0px)"),l.css("-webkit-transform","translate3d("+p+"px, "+d+"px, 0px)")}else{var p=o/1e3*a,d=r/500*s;l.css("transform","translate3d("+p+"px, "+d+"px, 0px)"),l.css("-webkit-transform","translate3d("+p+"px, "+d+"px, 0px)")}i.reorient();var c=new Tween(function(e){l.css("opacity",e)},function(){});c.start(0,1,1e3),player.preload(!1)}}(n,lind,s,r),r++,player.offline?n.src="data/"+s:n.src="https://www.wkraj.pl/data/"+s,n.oncontextmenu=function(){return!1})}pd.append(t),i.gps=gps,i.ctitle=title,$("#player").append(i.black),$("#player").append(pd),pd.append(i.layersnode),$("#player").append(gps),$("#player").append(title),null!=player.lastIdent&&$("#ui").append(a),i.addTools(),AppEvent.trigger(player,"PLACE.LOADED",player.currentView),player.currentView.reorient()}},process:function(){try{0!=this.zooming&&(this.scaleFactor+=.01*this.zooming,this.scaleFactor<.5&&(this.scaleFactor=.5),this.scaleFactor>5&&(this.scaleFactor=5)),this.opacity<1&&this.photoLoaded&&(this.opacity+=.01,this.node.css("opacity",this.opacity),void 0!=this.bg&&this.bg.css("opacity",this.opacity),void 0!=this.black&&this.black.css("opacity",this.opacity),this.opacity>=1&&AppEvent.trigger(player,"PLACE.TRANSITIONED",this));var e=10*-swipe.inertiaX(),t=10*swipe.inertiaY();if("d"==this.autorun&&"1"!=player.currentView.properties.properties.layers_mode){if(Math.abs(t)>.01){this.autorun="";var i=this;null!=this.autorunT&&clearTimeout(this.autorunT),this.autorunT=setTimeout(function(){i.autorun=i.properties.properties.autorun,i.autorunT=null},6e3)}t=.4*this.autorunDir}this.lrx+=e,this.lry+=t,this.rx+=e,this.ry+=t,this.rx<-1*(ia.width-this.wwidth)&&(this.rx=-1*(ia.width-this.wwidth)),this.rx>0&&(this.rx=0),this.ry<-1*(ia.height-this.wheight)&&(this.ry=-1*(ia.height-this.wheight),
this.autorunDir*=-1),this.ry>0&&(this.ry=0,this.autorunDir*=-1);var a=.5,n=0;("full"==this.infoState||"fullext"==this.infoState)&&$(window).width()>400?(a=.75,n=500,this.lastInfoState!=this.infoState&&this.reorient(),this.lastInfoState=this.infoState):(this.lastInfoState!=this.infoState&&(a=1,n=0,this.reorient()),this.lastInfoState=this.infoState);var s=.03*(n-this.txm);this.txm+=s,n=this.txm,Math.abs(s)>.1&&this.reorient(),pd.css("transform","translate3d("+this.rx+"px,"+this.ry+"px, 0px)"),pd.css("-webkit-transform","translate3d("+this.rx+"px,"+this.ry+"px, 0px)");var o="";o+="scale("+this.scaleFactor+","+this.scaleFactor+") ",o+="translate3d("+(this.lrx+n)+"px,"+this.lry+"px, 0px)",this.layersnode.css("transform",o),this.layersnode.css("-webkit-transform",o),this.layersnode.css("transform-origin",$(window).width()*a+"px "+.5*$(window).height()+"px"),this.layersnode.css("-webkit-transform-origin",$(window).width()*a+"px "+.5*$(window).height()+"px")}catch(r){}try{void 0==this.node?HotSpotManager2D.process($("#player").position(),$("#player").width(),$("#player").height()):HotSpotManager2D.process(this.node.position(),this.node.width(),this.node.height())}catch(r){}},mouseDown:function(e){this.panning=!0,swipe.start(e)},mouseUp:function(e){swipe.end(),this.panning=!1},mouseMove:function(e){swipe.move(e)},mouseWheel:function(e){this.scaleFactor+=.001*e,this.scaleFactor<.7&&(this.scaleFactor=.7),this.scaleFactor>5&&(this.scaleFactor=5)},clear:function(){void 0!=this.cimg&&this.cimg.remove()},leaving:function(){this.node.css("z-index","100"),void 0!=this.bg&&this.bg.css("z-index","100"),void 0!=this.black&&this.black.css("z-index","100");var e=this;void 0!=player.zoomtools&&player.zoomtools.remove(),HotSpotManager2D.clear(),AppEvent.one(player,"PLACE.TRANSITIONED",function(){null!=e.gps&&e.gps.remove(),null!=e.ctitle&&e.ctitle.remove(),void 0!=e.black&&e.black.remove(),void 0!=e.bg&&e.bg.remove(),void 0!=e.layersnode&&e.layersnode.remove(),e.node.remove(),e.kde.remove(),e.kue.remove()})},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getRX:function(){return 0},getRY:function(){return 0},stopTurning:function(){}};var placeInfo={isOpened:!1,scroll:null,setDesc:function(e,t){},load:function(e){var t,i;if("photo"==e.place_type?i="ZDJĘCIE":"panorama"==e.place_type&&(i="PANORAMA"),void 0!=e.description){var a=e.description.replace(/\n/g,"<br />");a=a.replace(/\r/g,"")+"<br><br><br><br><br><br>&nbsp;",$("#infotextcontent").html(a)}$("#textheader").html(t);for(sid in e.properties.spots);placeInfo.hideMenu()},back:function(){},toggleMenu:function(){Menu.infowindow(),event.preventDefault()},showMenu:function(){$("#textinfo").show(),$("#infomenu").show(),isOpened=!0,setTimeout(function(){$("#textinfo").removeClass("hidden"),$("#infomenu").removeClass("hidden")},200)},hideMenuReal:function(){history.back()},hideMenu:function(){$("#textinfo").addClass("hidden"),$("#infomenu").addClass("hidden"),setTimeout(function(){$("#infomenu").hide(),isOpened=!1,$("#textinfo").hide()},1e3)}},player={_width:0,_height:0,_mouseX:0,_mouseY:0,_mouseHoverX:0,_mouseHoverY:0,ident:0,params:{},lastIdent:null,lastDir:null,lastHeading:0,lastTabTime:0,from:null,dir:0,storage:"",current:{},currentView:{},all:[],folders:[],processClass:[],imagesLoaded:!1,debug:!1,list:null,orientation:null,lastHistory:[],lang:"",keys:{},keyCtrl:!1,offline:!1,variant:null,track:[],cms:0,idle:!0,idle_timer:null,turn_to:null,blockBackspace:!1,pointerInfo:{},lastFrameTime:0,currentFrameTime:0,cancelIdle:function(){null!=player.idle_timer&&clearTimeout(player.idle_timer),player.idle=!1,player.idle_timer=setTimeout(function(){player.idle=!0,player.idle_timer=null},2e4)},introAddTab:function(e,t){Tab.add("intro",{focus:function(e){e.node.addClass("focused"),void 0==e.focus?e.node.focus():e.focus.focus()},blur:function(e){e.node.removeClass("focused")}},{node:e,focus:t})},intro:function(){var e=$("<div></div>"),t=$("<div class='intro-bd'></div>"),i=$("<div class='intro-buttons'></div>"),a=$("<a href='javascript:void(null);' title='"+TPL.lng("intro.with_sound","Kliknij aby kontynuować oglądanie projektu z dźwiękiem.")+"' class='intro-button intro-faded'><img src='assets/sound_on.png'></a>"),n=$("<a href='javascript:void(null);' title='"+TPL.lng("intro.without_sound","Kliknij aby kontynuować oglądanie projektu bez dźwięku.")+"' class='intro-button intro-faded'><img src='assets/sound_off.png'></a>");if(void 0==PROJECT.settings["core/soundscreen"]||"0"!=PROJECT.settings["core/soundscreen"]){HotSpotManager2D.setVisibility(!1);var s=new Image;s.onload=function(){a.removeClass("intro-faded")},s.src="assets/sound_on.png",s.complete&&a.removeClass("intro-faded");var o=new Image;o.onload=function(){n.removeClass("intro-faded")},o.src="assets/sound_off.png",o.complete&&n.removeClass("intro-faded"),Tab.setGroup("intro","+"),player.introAddTab(a),player.introAddTab(n),e.append(t),e.append(i),i.append(a),i.append(n),Tab.disableGroupsExcept("intro"),a.click(function(){if(Tab.clearGroup("intro"),Tab.enableAllGroups(),e.remove(),Music.resumePlaying(),HotSpotManager2D.setVisibility(!0),void 0!=PROJECT.settings["core/readtitle"]&&""!=PROJECT.settings["core/readtitle"]){var t=JSON.parse(PROJECT.settings["core/readtitle"]);void 0!=t[player.lang]&&""!=t[player.lang]&&SpeechManager.speakTip(t[player.lang],"TOPMENU")}}),n.click(function(){Tab.clearGroup("intro"),Tab.enableAllGroups(),e.remove(),Music.toggle(),HotSpotManager2D.setVisibility(!0)}),$("body").append(e)}},setupHistory:function(e){},parseId:function(e){e=e.toString();var t=e.split("!"),i=[];if(e=t[0],player.params={},t.length>1)for(var a in t)a>0&&(i=t[a].split("="),player.params[i[0]]=i[1]);return e},copyCoords:function(){var e=document.getElementById("cmscoords");e.select(),document.execCommand("copy")},cmsMode:function(e){player.cms=1},init:function(e,t,i,a,n){Events.init(),TPL.init(PROJECT.settings["skin/folder"],function(){this.postload(e,t,i,a,n)}.bind(this))},postload:function(e,t,i,a,n){if("0"==PROJECT.settings.nearest&&$("#menubar_nearest").hide(),document.addEventListener("contextmenu",function(e){}),void 0!=window.location.hash&&""!=window.location.hash&&"sub"!=window.location.hash.substr(1,3)){var s=window.location.hash.substr(1);"/"==s.substr(0,1)&&(s=s.substr(1));var o=s.split("/");e=player.parseId(o[0]),o.length>1&&(t=o[1])}player.internet=!0,player.offline,$("#bbar_menu").html(TPL.lng("bottombar.menu","MENU")),$("#bbar_map").html(TPL.lng("bottombar.map","MAPA")),PluginManager.onInit(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,1)},0)}),window.addEventListener("popstate",function(e){var t=player.currentHistoryState;void 0!=t&&void 0!=t.current&&"inMenu"==t.current||player.historyManager&&player.historyManager.back(),player.lastHistory.pop(),player.saveLastHistory(player.lastHistory[player.lastHistory.length-1]),e.preventDefault()}),player.debug=n,player.storage=a,player._width=$(window).width(),player._height=$(window).height(),$("#player").css("width",player._width+"px"),$("#player").css("height",player._height+"px"),$(window).resize(player.onresize),window.addEventListener("onorientationchange",player.onOrientationChange),player.ident=i,player.load(e,t),player.lastIdent=player.ident,player.lastDir=t,player.addTrack(0,0),SpeechManager.prepareTip("PLAYER.CLOSE","TIPS"),SpeechManager.prepareTip("PLAYER.PREVIOS_PANO","TIPS"),SpeechManager.prepareTip("PLAYER.MAP","TIPS"),SpeechManager.prepareTip("PLAYER.MENU","TIPS"),SpeechManager.prepareTip("PLAYER.SEARCH","TIPS"),$("#menu a").on(Events.pointer.down,function(){SpeechManager.speakTip("PLAYER.MENU","TIPS"),player.showMenu()}),$("#infomenu a").on(Events.pointer.down,function(){SpeechManager.speakTip("PLAYER.CLOSE","TIPS"),placeInfo.toggleMenu()}),$("#menubutton a").on(Events.pointer.down,function(){placeInfo.toggleMenu()}),$("#mapbutton a").on(Events.pointer.down,function(){SpeechManager.speakTip("PLAYER.MAP","TIPS"),mapInfo.toggleMenu()}),$("#menuHomeButton").on(Events.pointer.down,function(){player.list.multiBack()}),$("#menubar_menu").on(Events.pointer.down,function(){SpeechManager.speakTip("PLAYER.MENU","TIPS"),menubar.closeCurrent()}),$("#menubar_langicon").on(Events.pointer.down,function(){LanguageMenu.show(!0)}),$("#menubar_nearest").on(Events.pointer.down,function(){NearestManager.show()}),$("#navbar_close").on(Events.pointer.down,function(){SpeechManager.speakTip("PLAYER.CLOSE","TIPS"),player.hideMenu()}),$("#menubar_menu .tip").html(TPL.lng("menubar.menu","Menu")),$("#menubar_langicon .tip").html(TPL.lng("menubar.lang","Język")),$("#menubar_nearest .tip").html(TPL.lng("menubar.nearest","W pobliżu")),$("#player").on(Events.pointer.down,player.mouseDowned),$("#player").on(Events.pointer.move,player.mouseMoved),$(window).on("keydown",player.keyDown),$(window).on("keyup",player.keyUp),$("#player").on("DOMMouseScroll",player.onWheel),$("#player").on("mousewheel",player.onWheel),player.process()},cycleInfo:function(){void 0!=player.iv1&&clearTimeout(player.iv1),void 0!=player.iv2&&clearTimeout(player.iv2),player._width>760&&(player.iv1=setInterval(function(){$("#info").find(".labelshow").addClass("labelhiding"),$("#info").find(".labelshow").removeClass("labelshow"),player.iv2=setTimeout(function(){$("#info").find(".labelnext").length||($("#info").find(".labelhide").addClass("labelnext"),$("#info").find(".labelhide").removeClass("labelhide"),$("#info").find(".labelhiding").addClass("labelhide"),$("#info").find(".labelhiding").removeClass("labelhiding")),$("#info").find(".labelnext").addClass("labelshow"),$("#info").find(".labelnext").removeClass("labelnext"),$("#info").find(".labelhide").addClass("labelnext"),$("#info").find(".labelhide").removeClass("labelhide"),$("#info").find(".labelhiding").addClass("labelhide"),$("#info").find(".labelhiding").removeClass("labelhiding")},900)},6e3))},load:function(e,t,i){player.preload(!0),player.freezedisort=!0,i!==!0&&HotSpotManager.setTransition(void 0),e=Hs.trim(e),player.dirfrom=player.dir,player.dir=t,player.from=player.ident,player.ident=e,void 0!=player.currentView&&void 0!=player.currentView.clear&&player.currentView.clear(),void 0!=player.currentView&&null!=player.currentView&&null!=player.currentView.beforeLeave&&player.currentView.beforeLeave(),AppEvent.trigger(player,"beforeLoad",{}),Remote.ajax({url:"placeloader.php?ident="+e,offline:player.lang+"_"+e+".json",dataType:"json",success:player.placeloaded})},placeloaded:function(e){var t=!1;if("1000"==e.ERROR)return void(document.location="https://www.wkraj.pl");if(!player.offline){if(0==player.cms){for(var i in e.domains)e.domains[i].host.toLowerCase()==window.location.hostname&&(t=!0);if(e.domain.toLowerCase()+".wkraj.pl"!=window.location.hostname&&!t){if(e.domains.length>0){var a=e.domains[0].proto;""==a&&(a=document.location.protocol),document.location=a+"//"+e.domains[0].host+"/html5/index.php?id="+e.place_id+"#"+e.place_id+(void 0!=player.dir?"/"+player.dir:"")}else document.location=document.location.protocol+"//"+e.domain+".wkraj.pl/html5/index.php?id="+e.place_id+"#"+e.place_id+(void 0!=player.dir?"/"+player.dir:"");return player.ident=player.from,player.dir=player.fromdir,void(window.location.hash=player.ident+(void 0!=player.dir?"/"+player.dir:""))}}if(0==player.cms&&void 0!=player.domain&&""!=player.domain&&""!=e.domain&&player.domain.toLowerCase()!=e.domain.toLowerCase())return player.ident=player.from,player.dir=player.fromdir,window.location.hash=player.ident+(void 0!=player.dir?"/"+player.dir:""),void(document.location=document.location.protocol+"//"+e.domain+".wkraj.pl/html5/index.php?id="+e.place_id+"#"+e.place_id+(void 0!=player.dir?"/"+player.dir:""))}player.current=e,player.folder=player.current.folder.city_id,player.domain=player.current.domain,player.offline?player.list=new multiMenuListNS:player.list=new categoryList,AppEvent.trigger(player,"afterLoad",e),Remote.ajax({url:"jsonloader.php?folders=1&ident="+player.ident,offline:"menu.json",dataType:"json",success:player.loaded,error:player.error}),player.preload(!1)},error:function(){player.list=new multiMenuListNS,$.ajax({url:"jsonsinglefolderloader.php?ident="+player.ident,dataType:"json",success:player.loadederr})},loadederr:function(e){player.loaded(e)},loaded:function(e){Tab.clearGroup("hotspots"),player.all=e,""==player.current.description&&""!=player.current.properties.description&&(player.current.description=player.current.properties.description),placeInfo.load(player.current),mapInfo.load(player.current),player.list.loadPanoList(e);var t="";""!=player.current.psc_name&&player.current.psc_id>0,""!=player.current.place_name?$("#info").html("<div class='label labelshow' style='padding-left: 0px'>"+t+player.current.place_name+"</div>"):$("#info").html("<div class='label labelshow' style='padding-left: 0px'>"+t+"Panorama nr. "+player.current.place_id+"</div>");var i=player.current.folder.parent_folder.city_name+" - "+player.current.folder.city_name;void 0!=player.current.folder.parent_folder.parent_folder&&void 0!=player.current.folder.parent_folder.parent_folder.city_name&&(i=player.current.folder.parent_folder.parent_folder.city_name+" - "+i),player._width>760&&$("#overlay").append($("<div class='label' style='position: absolute;left: 10px;bottom: 45px; text-shadow: 4px 4px 6px rgba(66, 68, 90, 1);color:#ffffff'>"+i+"</div>"));var a=TPL.lng("PLAYER.VISITS","Liczba wyświetleń:"),n=TPL.lng("PLAYER.PLACE_ID","ID Miejsca:"),s=TPL.lng("PLAYER.LAST_UPDATED","Data wykonania:");void 0==PROJECT.settings["ui/bottom/stats"]||"1"==PROJECT.settings["ui/bottom/stats"]?$("#info").append($("<div class='label labelhide' style='padding-left: 0px' aria-hidden='true'>"+a+" "+player.current.visits+" &nbsp;|&nbsp; "+n+" "+player.current.place_id+" &nbsp;|&nbsp; "+s+" "+player.current.photo_date+"</div>")):(void 0==PROJECT.settings["ui/bottom/date"]||"1"==PROJECT.settings["ui/bottom/date"])&&$("#info").append($("<div class='label labelhide' style='padding-left: 0px' aria-hidden='true'>"+n+" "+player.current.place_id+" &nbsp;|&nbsp; "+s+" "+player.current.photo_date+"</div>")),player.cycleInfo(),null!=player.currentView&&void 0!=player.currentView.leaving&&(player.currentView.leaving(),player.lastView=player.currentView),null!=player.current?(player.debug?player.currentView=new panoramaGridView(player.ident,player.current):"panorama"==player.current.place_type?player.currentView=new panoramaView(player.ident,player.current,player.half,player.turn_to):"start"==player.current.place_type?(player.currentView=new startView(player.ident,player.current),player.lastView=void 0):"photo"==player.current.place_type?(player.currentView=new photoView(player.ident,player.current),player.lastView=void 0):"video"==player.current.place_type?(player.currentView=new videoView(player.ident,player.current),player.lastView=void 0):"catalogue3D"==player.current.place_type?(player.currentView=new gallery3DView(player.ident,player.current),player.lastView=void 0):"gallery"==player.current.place_type?(player.currentView=new galleryView(player.ident,player.current),player.lastView=void 0):"autopilot"==player.current.place_type&&(player.lastView=void 0,player.currentView=null,Autoplay.start(player.ident,player.current)),ElementManager.load(player.current.elements),null!=player.currentView&&player.currentView.load()):player.toggleMenu(null),player.cancelIdle(),player.offline||setTimeout(function(){$.ajax({url:"../../panostat.php?ident="+player.ident})},100),AppEvent.trigger(player,"placeReady",{view:player.currentView})},saveLastHistory:function(e){player.lastHistory.push(e),player.currentHistoryState=e},addToHistory:function(e,t,i){t="Wirtualny Kraj",history.pushState(e,t,i),player.saveLastHistory(e),document.title=t},setHistoryManager:function(e){player.historyManager=e},toggleMenu:function(e){try{setTimeout(function(){if($("#panosback").toggle(),$("#panosback a").toggle(),$("#panos").toggleClass("visible"),$("#menubar").toggle(),player.list.openMenu(null),$("#panos").hasClass("visible"));},100)}catch(t){Log.error(t.toString(),"player.toggleMenu")}null!=e&&e.preventDefault()},hideMenu:function(){menubar.closeCurrent(),$("#panosback").hide(),$("#panosback a").hide(),$("#menubar").hide(),$("#panos").removeClass("visible")},showMenu:function(e){setTimeout(function(){$("#panosback a").show(),$("#panos").addClass("visible"),$("#menubar").show(),player.list.openMenu(null)},100),null!=e&&e.stopPropagation()},onresize:function(e){player._width=$(window).width(),player._height=$(window).height(),$("#player").css("width",player._width+"px"),$("#player").css("height",player._height+"px"),player.currentView.reorient(e)},onOrientationChange:function(){},addProcess:function(e){player.processClass.push(e)},removeProcess:function(e){var t=player.processClass.indexOf(e);player.processClass.splice(t,1)},process:function(){window.requestAnimFrame(player.process),player.lastFrameTime=player.currentFrameTime,player.currentFrameTime=Date.now(),void 0==player.lastView||void 0==player.lastView.process||void 0!=player.lastView.paused&&player.lastView.paused||player.lastView.process(),void 0==player.currentView||void 0==player.currentView.process||void 0!=player.currentView.paused&&player.currentView.paused||player.currentView.process(),sphereWebGLStatic.postRender&&sphereWebGLStatic.postRender();for(proc in player.processClass)player.processClass[proc].process();AppEvent.trigger(player,"onProcess",{})},keyDown:function(e){return player.keys[e.key]=1,e.ctrlKey||(player.keyCtrl=!1),e.ctrlKey&&(player.keyCtrl=!0),player.cancelIdle(),"Tab"==e.key?(player.lastTabTime=Date.now(),Tab.cycle(e.shiftKey),e.stopPropagation(),!1):(Tab.keyDown(e),void AppEvent.trigger(player,"PLAYER.KEYDOWN",e))},keyUp:function(e){player.keys[e.key]=0,e.ctrlKey||(player.keyCtrl=!1),e.ctrlKey&&(player.keyCtrl=!0),player.cancelIdle(),Tab.keyUp(e)&&AppEvent.trigger(player,"PLAYER.KEYUP",e),"Backspace"==e.key&&0==player.blockBackspace&&1!=player.cms&&player.back(),player.blockBackspace=!1},mouseDowned:function(e){var t=Events.getPointerEvent(e);player._mouseX=t.pageX,player._mouseY=t.pageY,player.currentView.mouseDown(t),AppEvent.trigger(player,"mouseDown",t),$("body").one(Events.pointer.up,player.mouseUped),$("#c3d").css("cursor","grabbing"),player.cancelIdle()},mouseUped:function(e){var t=Events.getPointerEvent(e);player.currentView.mouseUp(t),AppEvent.trigger(player,"mouseUp",t),$("#c3d").css("cursor","grab"),player.cancelIdle()},mouseMoved:function(e){var t=Events.getPointerEvent(e);player.pointerInfo=t,void 0==player.freezedisort&&(player._mouseHoverX=t.pageX,player._mouseHoverY=t.pageY),player.currentView.mouseMove(t),AppEvent.trigger(player,"mouseMove",t),player.cancelIdle(),e.preventDefault()},onWheel:function(e){var t=-26,i="WebkitAppearance"in document.documentElement.style;i&&(t=1);var a=e.originalEvent.wheelDelta;isNaN(a)&&(a=e.originalEvent.detail),player.currentView.mouseWheel(a*t),AppEvent.trigger(player,"mouseWheel",a),player.cancelIdle(),e.preventDefault()},addTrack:function(e,t){player.track.push({ident:e,dir:t}),player.track.length>5&&player.track.shift()},go:function(e,t,i){var a,n=e;if(Array.isArray(t)?(a=t[0],void 0!=t[1]&&(player.turn_to=t[1].toString())):(a=t,player.turn_to=void 0),"0"!=e&&0!=e){player.cancelIdle(),player.hideMenu();e=player.parseId(e),player.lastIdent=player.ident,player.lastDir=player.dir,null!=player.currentView&&player.addTrack(player.ident,null!=player.currentView.getHeadingText?player.currentView.getHeadingText():0),AppEvent.trigger(player,"PLAYER.GO",{id:e,dir:a,params:player.params}),"folder"==String(e).toLowerCase()?Library.open(n.substr(7)):"http"==String(e).substr(0,4).toLowerCase()?window.open(e,"_blank"):(setTimeout(function(){window.location.hash=e+"/"+a},200),player.load(e,a,i))}},back:function(){player.track.length;ct=player.track.pop(),player.go(ct.ident,ct.dir),player.track.pop()},redraw:function(){document.body.scrollTop=10,setTimeout(function(){document.body.scrollTop=0,window.scrollTo(0,1)},100)},preload:function(e){e?(void 0!=player.prl&&clearTimeout(player.prl),$("#loaderIcon").show()):player.prl=setTimeout(function(){$("#loaderIcon").hide(),player.prl=void 0},1e3)},bottomBar:function(e){e?$(".bottombar").show():$(".bottombar").hide(),AppEvent.trigger(player,"BOTTOMBAR.TOGGLE",{display:e})},setLang:function(e){""==e&&(e="PL"),player.lang=e;try{var t=new URLSearchParams(window.location.search),i=t.get("setlang");void 0!=i&&""!=i&&(player.lang=i)}catch(a){}}},PluginManager={plugins:[],add:function(e){PluginManager.plugins.push(e),e.register&&e.register()},on:function(e,t){var i;for(i in PluginManager.plugins)PluginManager.plugins[i].hasOwnProperty(e)&&PluginManager.plugins[i][e](t)},onInit:function(){var e;for(e in PluginManager.plugins)PluginManager.plugins[e].init();for(e in PluginManager.plugins)void 0!=PluginManager.plugins[e].afterInit&&PluginManager.plugins[e].afterInit()}};simpleFolderList.prototype={loadFolder:function(e){if(player.folders[e].opened?$("#folder_"+e).hide():$("#folder_"+e).show(),player.folders[e].opened=!player.folders[e].opened,!player.folders[e].loaded){for(var t=0;t<player.folders[e].panos.length;t++)data=player.folders[e].panos,elem=$("<div class='panolink'><a href='index.php?id="+data[t].id+"'><img src='"+data[t].thumb+"' width='200' height='100'><div class='bg'><span>"+data[t].pano_title+"</span></div></a></div>"),$("#folder_"+e).append(elem);player.folders[e].loaded=!0}},getCurrent:function(e){return this.current},loadPanoList:function(e){var t={id:"-1",title:"Lista panoram"};if(t.panos=[],!player.imagesLoaded){for(var i=0;i<e.length;i++)"folder"==e[i].type?(null!=t&&player.folders.push(t),e.length>i+1&&"folder"==e[i+1].type?elem=$("<div class='folderempty'>"+e[i].title+"</div>"):elem=$("<div class='folder'><a href='javascript:void(null);' onclick='player.list.loadFolder("+player.folders.length+");'>"+e[i].title+"</a></div><div id='folder_"+player.folders.length+"'></div>"),$("#panos").append(elem),t={id:e[i].id,title:e[i].title},t.panos=[]):(t.panos.push(e[i]),elem=$("<div class='panolink'><a href='index.php?id="+e[i].id+"'><img src='"+e[i].thumb+"' width='200' height='100'><div class='bg'><span>"+e[i].pano_title+"</span></div></a></div>"),$("#panos").append(elem),e[i].id==player.ident&&(currentpano=e[i]));player.folders.push(t),player.imagesLoaded=!0}for(var i=0;i<player.folders.length;i++);this.current=currentpano}};var sphereWebGLStatic={tail:[],postRender:function(){void 0!=sphereWebGLStatic.renderer&&sphereWebGLStatic.renderer.clearDepth()}};sphereWebGLRenderer.prototype={rx:0,ry:0,veryHighQualityLoaded:!1,basePerspective:550,zoom:550,loadTemplate:function(){(void 0==$("#c3d")||0==$("#c3d").length)&&($("#player").append("<div id='c3d' style='width:100%;height:100%;position:absolute;z-index:999;'></div>"),sphereWebGLStatic.fresh=!0,sphereWebGLStatic.node=$("#c3d")),this.node=$("#c3d")},reUse:function(){},build:function(){sphereWebGLStatic.fresh?(sphereWebGLStatic.cycle=0,sphereWebGLStatic.scene=new THREE.Scene,sphereWebGLStatic.renderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,alpha:!0}),sphereWebGLStatic.renderer.autoClear=!1,sphereWebGLStatic.renderer.setSize(sphereWebGLStatic.node.width(),sphereWebGLStatic.node.height()),sphereWebGLStatic.node.append($(sphereWebGLStatic.renderer.domElement)),sphereWebGLStatic.fresh=!1):sphereWebGLStatic.cycle=0==sphereWebGLStatic.cycle?1:0,this.scene=sphereWebGLStatic.scene,this.camera=new THREE.PerspectiveCamera(45,sphereWebGLStatic.node.width()/sphereWebGLStatic.node.height(),.1,1e3),this.camera.layers.set(sphereWebGLStatic.cycle),this.cycle=sphereWebGLStatic.cycle,this.renderer=sphereWebGLStatic.renderer},realZoom:function(){return this.zoom},setPerspective:function(e,t){this.zoom=e,this.basePerspective=this.zoom,void 0!=t&&(this.basePerspective*=t);var i=this.basePerspective;this.fov=2*(180*Math.atan(.5*this.node.height()/i)/Math.PI),this.camera.aspect=sphereWebGLStatic.node.width()/sphereWebGLStatic.node.height(),this.camera.fov=this.fov,this.camera.updateProjectionMatrix(),sphereWebGLStatic.renderer.setSize(sphereWebGLStatic.node.width(),sphereWebGLStatic.node.height())},getPerspective:function(){return this.basePerspective},loadSphere:function(e,t){switch(this.ql=1,Quality.current){case 1280:this.ql=.5;break;case 2048:}var i=500*this.ql;if(player.offline?this.panofile="data/pano_"+this.properties.place_id+"_preview.jpg":this.panofile=this.properties.properties.image1,void 0!=this.properties.variants)if(this.properties.variants.variant_main==player.variant)this.panofile=this.properties.properties.image1;else if(void 0!=this.properties.variants.items)for(var a in this.properties.variants.items)this.properties.variants.items[a].type==player.variant&&(player.offline?this.panofile="data/pano_"+this.properties.place_id+"_"+player.variant+"_preview.jpg":this.panofile=this.properties.variants.items[a].file);12e3==this.properties.properties.l_width&&(i=1e3*this.ql);var n=e/i,s=t/i,o=0,r=null,l=this;this.showLoading&&player.preload(!0);var p="";p=player.offline?this.panofile:"//"+PROJECT.host+"/proxify/thumbpano/noredirect/true/file/-pdata-"+this.panofile+"/preview.jpg",r=(new THREE.TextureLoader).load(p,function(t){AppEvent.trigger(player,"PLACE.LOADED",sphereWebGLStatic.self);for(var a=0;s>a;a++)for(var r=0;n>r;r++){var p,d=r*(360/n)*Math.PI/180,c=360/n*Math.PI/180,h=a*(180/s)*Math.PI/180,u=180/s*Math.PI/180,m=new THREE.InnerSphereGeometry(25,8,8,d,c,h,u);p=new THREE.MeshBasicMaterial({color:6710886,opacity:0,transparent:!0}),p.side=THREE.DoubleSide;var f=new THREE.Mesh(m,p);f.layers.set(sphereWebGLStatic.cycle),l.preview.add(f),1==l.ql&&(l.fragments[o]={mesh:f,textureLoaded:!1,x:e-i-r*i,y:a*i}),o++}l.fading_in=1,l.showLoading&&player.preload(!1),void 0!=panoramaViewStatic.root&&panoramaViewStatic.root.loaded()}),this.previewTexture=r;var d,c=new THREE.InnerSphereGeometry(25.2,38,22);d=new THREE.MeshBasicMaterial({color:16777215,map:r}),d.side=THREE.DoubleSide,d.opacity=0,d.transparent=!0,d.needsUpdate=!0,this.preview=new THREE.Mesh(c,d),this.preview.layers.set(sphereWebGLStatic.cycle),this.scene.add(this.preview);var h=window.PROJECT.settings["core/panologo/exclude"],u=!1;if(void 0!=h){var m=h.split(",");for(var a in m)m[a]==this.ident&&(u=!0)}if(!u&&void 0!=window.PROJECT.settings["core/panologo"]&&""!=window.PROJECT.settings["core/panologo"])var f=(new THREE.TextureLoader).load("https://"+window.PROJECT.host+"/"+window.PROJECT.settings["core/panologo"],function(e){const t=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,map:f}),i=new THREE.CircleGeometry(9,64);sphereWebGLStatic.self.logoPlate=new THREE.Mesh(i,t),sphereWebGLStatic.self.logoPlate.translateY(-20),sphereWebGLStatic.self.logoPlate.rotateX(-90*Math.PI/180),sphereWebGLStatic.self.logoPlate.layers.set(sphereWebGLStatic.cycle),sphereWebGLStatic.self.preview.add(sphereWebGLStatic.self.logoPlate)})},loadFragmentTexture:function(e){var t=500*this.ql,i=500*this.ql,a=1,n=1;player._width<1100&&(a=.5,n=.5),12e3==this.properties.properties.l_width&&(t=1e3*this.ql,i=1e3*this.ql,a=1,n=1,a=.75,n=.75);var s="",o=this;s=player.offline?void 0!=player.variant&&null!=player.variant&&""!=player.variant?"data/frag_"+this.properties.place_id+"_"+player.variant+"_"+this.fragments[e].x+"_"+this.fragments[e].y+"_1.jpg":"data/frag_"+this.properties.place_id+"_"+this.fragments[e].x+"_"+this.fragments[e].y+"_1.jpg":"//"+PROJECT.host+"/proxify/thumbpano/noredirect/true/file/-pdata-"+this.panofile+"/sx/"+a+"/sy/"+n+"/clip/"+this.fragments[e].x+","+this.fragments[e].y+","+t+","+i+"/piece.jpg",tex=(new THREE.TextureLoader).load(s,function(t){t.magFilter=THREE.LinearFilter,t.minFilter=THREE.LinearFilter,o.fragments[e].mesh.material.color.setHex(16777215),o.fragments[e].mesh.material.opacity=0,o.fragments[e].texture=t,o.fragments[e].mesh.material.map=t,o.fragments[e].mesh.material.needsUpdate=!0,o.fragments[e].textureLoaded=!0})},inFrustum:function(){var e=[];this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld);var t=new THREE.Frustum;t.setFromMatrix((new THREE.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse));for(var i in this.fragments){var a=this.fragments[i].mesh;a.updateMatrix(),a.updateMatrixWorld(),t.intersectsObject(a)&&e.push(i)}return e},loadFrustum:function(){for(var e=this.inFrustum(),t=null,i=Math.floor(e.length/2),a=0;i>=a;a++)i-a>=0&&(t=this.fragments[e[i-a]],void 0==t||t.textureLoaded||this.loadFragmentTexture(e[i-a])),i+a<e.length&&(t=this.fragments[e[i+a+1]],void 0==t||t.textureLoaded||this.loadFragmentTexture(e[i+a+1]))},load:function(){12e3!=this.properties.properties.l_width?this.loadSphere(8e3,4e3):this.loadSphere(12e3,6e3),this.setPerspective(650)},loadQuality:function(e){},checkLoaded:function(){},process:function(){void 0!=player._mouseHoverX&&(this.disort.dstx=.005*(player._mouseHoverX-.5*player._width)),void 0!=player._mouseHoverY&&(this.disort.dsty=(player._mouseHoverY-.5*player._height)*-.005),player.cms?(this.disort.x=0,this.disort.y=0):(this.disort.x+=.1*(this.disort.dstx-this.disort.x),this.disort.y+=.1*(this.disort.dsty-this.disort.y));var e=this.disort.x,t=this.disort.y;this.jaw=(this.rx+e)*Math.PI/180,this.pitch=(-this.ry-t)*Math.PI/180;var i=(1*Math.cos(this.jaw*Math.PI/180),1*Math.sin(this.jaw*Math.PI/180),1*Math.sin(this.pitch*Math.PI/180),1*Math.sin(this.pitch*Math.PI/180),new THREE.Vector3(0,0,1)),a=new THREE.Matrix4;a.makeRotationX(this.pitch);var n=new THREE.Matrix4;n.makeRotationY(this.jaw),n.multiply(a),i.applyMatrix4(n),this.preview&&(this.preview.rotation.x=this.pitch),this.preview&&(this.preview.rotation.y=(this.rx+e+90)*Math.PI/180),this.logoPlate&&(this.logoPlate.rotation.z=-1*(this.rx+e+90)*Math.PI/180),this.fade(),this.renderer.render(this.scene,this.camera,void 0,!1)},clear:function(){clearInterval(this.worker)},beforeLeave:function(){player.lastView=null,this.fading_in=0,this.fading_out=1,this.transCounter=0,this.transSpeed=0,this.preview.scale.set(2,2,2)},leaving:function(){for(;sphereWebGLStatic.tail.length>0;){var e=sphereWebGLStatic.tail.shift();e.destroy()}sphereWebGLStatic.tail.push(this),sphereWebGLStatic.previous=this,this.fading_in=0,this.preview.scale.set(2,2,2);for(var t in this.fragments);self=this,"panorama"!=player.current.place_type&&this.node.css("z-index","100"),AppEvent.one(player,"PLACE.TRANSITIONED",function(e){"panorama"!=player.current.place_type&&self.node.remove()},{me:self})},destroy:function(){this.scene.remove(this.preview),this.preview=null,this.camera=null,this.previewTexture.dispose(),this.previewTexture=null;for(var e in this.fragments)this.scene.remove(this.fragments[e].mesh),this.fragments[e].mesh=null,void 0!=this.fragments[e].texture&&(this.fragments[e].texture.dispose(),this.fragments[e].texture=null)},fade:function(){var e=0,t=0;if(void 0!=HotSpotManager.currentTransition&&(e=HotSpotManager.currentTransition.inzoom,t=HotSpotManager.currentTransition.outzoom),1!=this.fading_in&&1!=this.fading_out){this.preview.material.opacity=1,this.preview.material.transparent=!0,this.preview.material.needsUpdate=!0;for(var i in this.fragments)this.fragments[i].textureLoaded&&(this.fragments[i].mesh.material.opacity=1,this.fragments[i].mesh.material.transparent=!1,this.fragments[i].mesh.material.needsUpdate=!0);if(!this.fading_in&&!this.fading_out)return}if(this.fading_in&&null!=this.preview){var a=0,n=90,s=cos((this.jaw+a)*(Math.PI/180))*cos((this.pitch+n)*(Math.PI/180)),o=sin((this.jaw+a)*(Math.PI/180))*cos((this.pitch+n)*(Math.PI/180)),r=sin((this.pitch+n)*(Math.PI/180));this.opacity+=this.opacityStep,this.transCounter*=1-this.opacityStep;var l=1-this.transCounter;l>.9999&&(l=1),1>=l&&(this.preview.position.x=(s-s*l)*-e,this.preview.position.y=(o-o*l)*-e,this.preview.position.z=(r-r*l)*-e),
this.preview.material.opacity=this.opacity,this.preview.material.transparent=!0,this.preview.material.needsUpdate=!0,1==this.fading_in&&this.opacity>=1&&(player.freezedisort=void 0,this.fading_in=2,AppEvent.trigger(player,"PLACE.TRANSITIONED",sphereWebGLStatic.self),HotSpotManager.setVisibility(!0)),l>=1&&(this.fading_in=0)}if(this.fading_out&&null!=this.preview){var a=0,n=90,s=cos((this.jaw+a)*(Math.PI/180))*cos((this.pitch+n)*(Math.PI/180)),o=sin((this.jaw+a)*(Math.PI/180))*cos((this.pitch+n)*(Math.PI/180)),r=sin((this.pitch+n)*(Math.PI/180));this.transSpeed+=t/600;var p=t/200;this.transSpeed>p&&(this.transSpeed=p),this.transCounter+=this.transSpeed;var l=this.transCounter;20>l||player.currentView.renderer.opacity<1?(this.preview.position.x=s*l,this.preview.position.y=o*l,this.preview.position.z=r*l):player.lastView=null}},reorient:function(){},togglePhotoPreview:function(){if(this.isPhotoPreview)this.isPhotoPreview&&(this.isPhotoPreview=!1,sphereWebGLStatic.node.width(this.originWidth),sphereWebGLStatic.node.height(this.originHeight),sphereWebGLStatic.renderer.setSize(this.originWidth,this.originHeight),sphereWebGLStatic.node.css("transform-origin",""),sphereWebGLStatic.node.css("transform",""),setTimeout(function(){sphereWebGLStatic.self.setPerspective(sphereWebGLStatic.self.zoom)},100));else{this.isPhotoPreview=!0,this.originWidth=sphereWebGLStatic.node.width(),this.originHeight=sphereWebGLStatic.node.height(),sphereWebGLStatic.node.width("2000px"),sphereWebGLStatic.node.height("1000px"),sphereWebGLStatic.renderer.setSize(2e3,1e3);var e=this.originWidth/2e3,t=e;sphereWebGLStatic.node.css("transform-origin","0 40%"),sphereWebGLStatic.node.css("transform","scale("+e+", "+t+")"),setTimeout(function(){sphereWebGLStatic.self.setPerspective(sphereWebGLStatic.self.zoom,2e3/sphereWebGLStatic.self.originWidth)},100)}},screenshot:function(e){var t,i=(sphereWebGLStatic.node.width(),sphereWebGLStatic.node.height(),this);setTimeout(function(){t=i.renderer.domElement.toDataURL("image/jpeg"),e(t)},100)}};var ssi_rules={Plan:{load:{resolve:function(e){return void 0==e.plan?"Plan_load.json":"Plan_load_"+e.plan+".json"}},getPlans:{resolve:function(e){return"Plan_getPlans.json"}},landmarks:{resolve:function(e){return"Plan_landmarks_"+e.plan+".json"}},connections:{resolve:function(e){return"Plan_connections_"+e.plan+".json"}},plantoid:{resolve:function(e){return"Plan_routes.json"},process:function(e,t){return{data:t.data.places[e.planspot]}}},route:{resolve:function(e){return"Plan_routes.json"},process:function(e,t){try{var i=new Dijkstras;i.setGraph(t.data.graph);var a=i.getPath(e.from.toString(),e.target.toString()),n=[];if(a.length>0){a.unshift(e.from);for(var s in a)n.push(t.data.places[a[s]])}}catch(o){}return{data:{path:a,places:n}}}}},Search:{results:{resolve:function(e){return"Search_all.json"},process:function(e,t){var i=[];try{for(var a=0;a<t.data.length;a++){var n=t.data[a];(n.title.toUpperCase().substr(0,e.words.length)==e.words.toUpperCase()||n.id==e.words.toUpperCase()||null!=n.psc_name&&n.psc_name.toUpperCase().substr(0,e.words.length)==e.words.toUpperCase()||null!=n.loc_name&&n.loc_name.toUpperCase().substr(0,e.words.length)==e.words.toUpperCase())&&i.push(n)}}catch(s){alert("Row: "+a+"; "+s)}return{data:i}}}}};startView.prototype={rx:0,ry:0,inX:0,inY:0,panning:!1,swipe:{},pd:null,gps:null,title:null,ia:null,wwidth:0,wheight:0,isStart:!1,layers:[],load:function(){this.loadQuality(764)},reorient:function(){},loadQuality:function(e){ia=new Image,this.isStart=!0,ia.src=this.properties.image;var t=this;ia.onload=function(){var e;e=null!=player.currentView.properties.folder.parent_folder.parent_folder?player.currentView.properties.folder.parent_folder.parent_folder.city_name+" - ":"",e+=player.currentView.properties.folder.parent_folder.city_name;$(window).width(),$(window).height();mobi="/data/"+player.currentView.properties.place_id+"_mobi.jpg";var i={city:player.currentView.properties.folder.city_name,title:e,image:mobi,ident:PROJECT.settings["core/start_pano"],angle:PROJECT.settings["core/start_pano_look"]};$("#player").css("background-color","#000000"),$("#player").html(""),$("#player").html(TPL.render("start-template",i)),Autoplay.running()&&($(".start_button").hide(),AppEvent.on(Autoplay,"AUTOPLAY.FINISHED",function(){$(".start_button").show()})),AppEvent.trigger(player,"PLACE.LOADED",player.currentView),player.currentView.reorient(),t.transitionIn()}},transitionIn:function(){try{setTimeout(function(){$(".startview").css("opacity","1")},50),setTimeout(function(){$(".startview h1").css("opacity","1")},500),setTimeout(function(){$(".startview h2").css("opacity","1")},1e3),setTimeout(function(){$(".start_button_container").addClass("start_button_show")},1500)}catch(e){alert(e)}},process:function(){},mouseDown:function(e){this.panning=!0,swipe.start(e)},mouseUp:function(e){swipe.end(),this.panning=!1},mouseMove:function(e){swipe.move(e)},mouseWheel:function(e){},clear:function(){},pause:function(){this.paused=!0},resume:function(){this.paused=!1}},videoView.prototype={load:function(){AppEvent.trigger(player,"PLACE.LOADED",player.currentView),pd=$("<div class='videoView'></div>"),this.node=pd,void 0!=this.properties.bg&&""!=this.properties.bg&&this.node.css("background-image","url("+this.properties.bg+")"),pd.append($("<div class='vplayer'></div>")),this.playernode=pd.find(".vplayer"),$("#ui").append(pd),this.media=new vplayer,this.media.fitScreen(200,150),this.playernode.append(this.media.embed()),player.offline&&(this.properties.video=this.properties.video.replace("/data","data")),this.media.load(this.properties.video),this.media.setTitle(this.properties.place_name),this.close=$("<img src='assets/menu_close.png' alt='"+this.l.close+"' title='"+this.l.close+"' width='50' height='50' style='z-index:99999;position:absolute;right:10px;top:70px;cursor:pointer;pointer-events:all;'>"),this.node.append(this.close),this.close.on(Events.pointer.up,function(){void 0!=player.lastIdent&&null!=player.lastIdent&&player.lastIdent!=player.ident||void 0==player.current.properties.exit||"0"==player.current.properties.exit||(player.addTrack(player.current.properties.exit,player.current.properties.exit_angle),player.lastIdent=player.current.properties.exit,player.lastDir=player.current.properties.exit_angle),player.back()})},reorient:function(){},process:function(){switch(this.state){case"transin":this.style.opacity++,this.node.css("opacity",.01*this.style.opacity),this.style.opacity>=100&&(AppEvent.trigger(player,"PLACE.TRANSITIONED",this),this.state="running");break;case"running":break;case"transout":}},mouseDown:function(e){},mouseUp:function(e){},mouseMove:function(e){},mouseWheel:function(e){},clear:function(){},leaving:function(){var e=this;AppEvent.one(player,"PLACE.TRANSITIONED",function(){e.node.remove()})},pause:function(){},resume:function(){},getRX:function(){return 0},getRY:function(){return 0},stopTurning:function(){}};var VideoManager={playerCount:0};CLoader.prototype.progress=function(e){if(isNaN(e))this.progress(0);else if(this.ctx.clearRect(0,0,this.width,this.height),this.ctx.beginPath(),this.ctx.arc(.5*this.width,.5*this.height,.4*this.width,1.5*Math.PI,2*Math.PI*100-.5*Math.PI),this.ctx.fillStyle="rgba(0,0,0,0.6)",this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(.5*this.width,.5*this.height,.4*this.width,1.5*Math.PI,2*Math.PI*100-.5*Math.PI),this.ctx.strokeStyle=this.style.bgcolor,this.ctx.lineWidth=this.style.thickness,this.ctx.stroke(),e>0&&(this.ctx.beginPath(),this.ctx.arc(.5*this.width,.5*this.height,.4*this.width,1.5*Math.PI,2*Math.PI*e-.5*Math.PI),this.ctx.strokeStyle=this.style.color,this.ctx.lineWidth=this.style.thickness-2,this.ctx.stroke(),this.style.percents)){var t=Math.round(100*e).toString()+"%",i=this.ctx.measureText(t);this.ctx.font=this.style.fontSize+"px "+this.style.fontFamily,this.ctx.fillStyle=this.style.fontColor,this.ctx.fillText(t,.5*this.width-.5*i.width,this.style.fontTop)}},CLoader.prototype.setStyle=function(e,t){this.style.color=e,this.style.thickness=t},CLoader.prototype.setFont=function(e,t,i,a){this.style.fontColor=e,this.style.fontSize=t,this.style.fontFamily=i,this.style.fontTop=a},CLoader.prototype.showPercent=function(e){this.style.percents=e};var Comments={node:null,isOpen:!1,couting:null,init:function(){player.offline||(Tab.setGroup("comments","+"),Comments.node=$(TPL.render("comments-main",{})),$("#panels").append(Comments.node),"off"!=PROJECT.settings["comments/mode"]&&(this.createUI(),AppEvent.on(player,"PLACE.LOADED",Comments.placeLoaded),Tab.add("bottom",Tab.simpleTab($(".commentbutton"),10),{})),$("#cmnt-btn-latest").hide(),$("#cmnt-btn-current").hide(),Tab.add("comments",Tab.simpleTabInput($("#com_message"),1),{}),Tab.add("comments",Tab.simpleTabInput($("#com_author"),5),{}),Tab.add("comments",Tab.simpleTab(Comments.node.find(".send"),20),{}),Tab.add("comments",Tab.simpleTab(Comments.node.find(".close"),50),{}),Tab.groups.comments.disable())},placeLoaded:function(){var e;try{e=player.current.comments.count}catch(t){e=0}e>0?Comments.button.find(".counter").html("("+e+")"):Comments.button.find(".counter").html("")},createUI:function(){var e;try{e=player.current.comments.count}catch(t){e=0}Comments.button=$("<a href='javascript:void(null);' aria-hidden='true' onclick='Comments.open();' class='commentbutton' data-speak='PLAYER.COMMENTS' data-speakgroup='TIPS' title='"+TPL.lng("comments_button","Komentarze")+"'><i class='fas fa-comments'></i> "+TPL.lng("comments_button","Komentarze")+" <span class='counter'>("+e+")</span></a>"),Screen.xs()||$("#overlay .tray").append(Comments.button),SpeechManager.enableSpeech("#overlay",".commentbutton",1,"TOPMENU")},startCounting:function(){null==Comments.counting&&(Comments.counting=setInterval(Comments.countingFunc,300))},stopCounting:function(){null!=Comments.counting&&clearInterval(Comments.counting),Comments.counting=null},countingFunc:function(){$(".comments .counter").html($(".comments #com_message").val().length+" / 500")},close:function(){Comments.node.hide(),Comments.stopCounting(),Tab.groups.comments.disable(),$("#player").css("width","100%"),$("#hmenu").css("width","100%"),$("#overlay").css("width","100%"),$("#ui").css("width","100%"),$(Comments).trigger("hide"),player._width=$("#player").width(),player._height=$("#player").height(),setTimeout(function(){player.currentView.reorient()},200)},closeSendInfo:function(){$(".comments .com-added").hide(),$(".comments .com-add").show()},preventKeys:function(e){return e.stopPropagation(),!1},open:function(){Comments.node.show(),Comments.startCounting(),Tab.groups.comments.enable(),$(".comments .com-add").show(),$(".comments .com-list").removeClass("full"),$(".comments .com-list").scrollTop(0),$("#cmnt-btn-current").hide(),$("#player").css("width","calc(100% - 350px)"),$("#hmenu").css("width","calc(100% - 350px)"),$("#overlay").css("width","calc(100% - 350px)"),$("#ui").css("width","calc(100% - 350px)"),player._width=$("#player").width(),player._height=$("#player").height(),$(Comments).trigger("shown"),setTimeout(function(){player.currentView.reorient()},200),$("#no-comments").hide(),$(".com-list").html("<div class='item'><i class='fas fa-spinner fa-spin'></i> Ładowanie ...</div>"),ssi("comments","list",{id:player.ident,filter:"full"},function(e){if($(".com-list").html(""),$(".comments h3").html("Komentarze ("+e.data.count+")"),e.data.count>0){$("#no-comments").hide();for(var t in e.data.items){var i=e.data.items[t],a=parseFloat(i.rx),n=-1*parseFloat(i.ry);isNaN(a)&&(a=0),isNaN(n)&&(n=0),$(".com-list").append("<div class='item thumb'><div class='thumb' style='background-image: url(\""+i.thumb_url+"\")' onclick='player.go("+i.place+', "'+a+","+n+"\");'></div><div class='author'>"+i.author+"</div>"+i.comment+"</div>")}}else $("#no-comments").show()})},latest:function(){Comments.node.show(),Comments.startCounting(),$(".comments .com-add").hide(),$(".comments .com-list").addClass("full"),$(".comments .com-list").scrollTop(0),$("#cmnt-btn-latest").hide(),$("#cmnt-btn-current").show(),$(".com-list").html("<div class='item'><i class='fas fa-spinner fa-spin'></i> Ładowanie ...</div>"),ssi("comments","list",{id:player.ident,filter:"full"},function(e){if($(".com-list").html(""),$(".comments h3").html("Wszystkie komentarze ("+e.data.count+")"),e.data.count>0){$("#no-comments").hide();for(var t in e.data.items){var i=e.data.items[t];""==i.author&&(i.author="Brak autora"),$(".com-list").append("<div class='item thumb'><div class='thumb' style='background-image: url(\""+i.thumb_url+"\")' onclick='player.go("+i.place+", \"0\");'></div><div class='author'>"+i.author+"</div>"+i.comment+"</div>")}}else $("#no-comments").show()})},add:function(){var e=$("#com_message").val();""==e.trim()?($("#com_message").addClass("error"),void 0!=Comments.ferr&&clearTimeout(Comments.ferr),Comments.ferr=setTimeout(function(){$("#com_message").removeClass("error"),Comments.ferr=void 0},1e3)):($(".com-add").addClass("sending"),$(".com-add .send").html('<i class="fas fa-spinner fa-spin"></i>'),ssi("comments","add",{id:player.ident,comment:e,author:$("#com_author").val()},function(e){$("#com_message").val(""),$(".com-add").removeClass("sending"),$(".com-add .send").html("Wyślij"),$(".comments .com-added").show(),$(".comments .com-add").hide()}))},placeReady:function(e){}};PluginManager.add(Comments);var Autoplay={program:[],current:0,initialized:!1,isRunning:!1,speechStatus:-1,baseIdent:null,labels:{},init:function(){AppEvent.on(SpeechManager,"SPEECH.FINISHED",Autoplay.speechFinished)},speechFinished:function(){void 0!=Autoplay.postponed&&SpeechManager.hasSpeech()&&(player.go(Autoplay.postponed.command.params[0],parseFloat(Autoplay.postponed.command.params[1]),Autoplay.postponed.ry),Autoplay.postponed=void 0)},skipSpeech:function(){player.go(Autoplay.postponed.command.params[0],parseFloat(Autoplay.postponed.command.params[1]),Autoplay.postponed.ry)},onPlaceLoad:function(e){Autoplay.postponed=void 0,Autoplay.baseIdent!=player.ident&&(Autoplay.isRunning&&(SpeechManager.hasSpeech()?-1==Autoplay.speechStatus?(Autoplay.speechStatus=1,Autoplay.speakAndGo(!0)):1==Autoplay.speechStatus?Autoplay.speakAndGo(!0):0==Autoplay.speechStatus&&Autoplay.speakAndGo(!1):(console.log("next after load "+player.ident),Autoplay.next())),Autoplay.baseIdent=player.ident)},speakAndGo:function(e){Autoplay.next()},start:function(e,t){Autoplay.initialized||(AppEvent.on(player,"PLACE.LOADED",Autoplay.onPlaceLoad),Autoplay.initialized=!0,$("#overlay").append(TPL.render("autoplay-ui",{pdown:"on"+Events.pointer.down})),Autoplay.button=$("#aui_icon"),Autoplay.stopbutton=$("#aui_back"),Autoplay.skipbutton=$("#aui_skip"),Autoplay.button.on(Events.pointer.down,Autoplay.toggle),Autoplay.stopbutton.on(Events.pointer.down,Autoplay.stop),Autoplay.skipbutton.on(Events.pointer.down,Autoplay.skipSpeech)),Autoplay.baseIdent=player.ident,player.bottomBar(!1),$("#autoplay_ui").show(),Autoplay.program=Autoplay.compile(t.properties.code),AppEvent.trigger(player,"AUTOPLAY.STARTED",{}),Autoplay.run()},compile:function(e){var t=e.replace(/(\r\n|\n|\r)/gm,""),i=t.split(";"),a="",n="",s=[],o=[];for(var r in i){a=i[r].trim();var l=a.indexOf(" ");s=[],-1!=l?(n=a.substr(0,l).toLowerCase(),s=a.substr(l+1).split(",")):n=a.toLowerCase(),o.push({opcode:n,params:s})}return o},run:function(){Autoplay.current=0,Autoplay.resume()},cycle:function(){var e;if(Autoplay.isRunning){if(Autoplay.current>=Autoplay.program.length)return void Autoplay.finished();switch(e=Autoplay.program[Autoplay.current],Autoplay.current++,e.opcode){case"e":Autoplay.labels[e.params[0]]=Autoplay.current,Autoplay.next();break;case"loop":Autoplay.current=Autoplay.labels[e.params[0]],Autoplay.next();break;case"s":setTimeout(function(){Autoplay.cycle()},1e3*parseFloat(e.params[0]));break;case"go":var t=parseFloat(e.params[2]);(void 0==t||null==t)&&(t=0),SpeechManager.hasSpeech()&&SpeechManager.speaks()&&1==Autoplay.speechStatus?Autoplay.postponed={command:e,ry:t}:player.go(e.params[0],parseFloat(e.params[1]),t);break;case"rr":case"rl":player.currentView.turnToAnd(player.currentView.old2angle(e.params[0]),e.params[1],60,Autoplay.afterTurn);break;case"rls":case"rrs":player.currentView.turnToAnd(player.currentView.old2angle(e.params[0]),e.params[1],30*parseFloat(e.params[2]),Autoplay.afterTurn);break;case"zi":player.currentView.zoomToAnd(200*parseFloat(e.params[0]),e.params.length>1?1e3*parseFloat(e.params[1]):2e3,Autoplay.cycle);break;case"zo":player.currentView.zoomToAnd(-200*parseFloat(e.params[0]),e.params.length>1?1e3*parseFloat(e.params[1]):2e3,Autoplay.cycle);break;case"map":"2"==e.params[0]?($("#mapinfo").addClass("hidden"),mapInfo.disabled=!0):($("#mapinfo").removeClass("hidden"),mapInfo.disabled=!1),Autoplay.cycle();break;case"lng":case"txt":"txt"==e.opcode||e.params[0]==player.lang?("txt"==e.opcode?$("#category_info").html(e.params[0]):$("#category_info").html(e.params[1]),$("#category_info").css("opacity","1"),Autoplay.next(),setTimeout(function(){$("#category_info").css("opacity","0")},2e3)):Autoplay.cycle();break;default:Autoplay.next()}}},afterTurn:function(){Autoplay.next()},next:function(){setTimeout(function(){Autoplay.cycle()},1e3)},finished:function(){player.bottomBar(!0),$("#autoplay_ui").hide(),AppEvent.trigger(Autoplay,"AUTOPLAY.FINISHED",{})},stop:function(){SpeechManager.speakTip("PLAYER.CLOSE","TIPS"),Autoplay.pause(),Autoplay.finished()},toggle:function(){Autoplay.isRunning?Autoplay.pause():Autoplay.resume()},pause:function(){Autoplay.isRunning&&(Autoplay.isRunning=!1,Autoplay.button.html("<span>"+TPL.lng("autopilot.resume","Wznów")+"</span><img src='assets/play.png'>"),Autoplay.button.removeClass("aui_auto_running"),player.currentView.stopTurning(),AppEvent.trigger(Autoplay,"AUTOPLAY.PAUSED",{}))},resume:function(){Autoplay.isRunning=!0,Autoplay.button.html("<span>"+TPL.lng("autopilot.stop","Zatrzymaj")+"</span><img src='assets/pause.png'>"),Autoplay.button.addClass("aui_auto_running"),Autoplay.cycle(),AppEvent.trigger(Autoplay,"AUTOPLAY.RESUMED",{})},running:function(){return Autoplay.isRunning}};PluginManager.add(Autoplay);var Autopilot={landmarks:[],pos:0,initialized:!1,running:!1,speed:3,speedAutoClose:null,init:function(){AppEvent.on(player,"mouseDown",Autopilot.pause)},setRoute:function(e){Autopilot.landmarks=e,Autopilot.initialized||(Autopilot.initialized=!0,AppEvent.on(player,"PLACE.LOADED",Autopilot.onPlaceLoad),$("#overlay").append(TPL.render("autoplay-main",{pdown:"on"+Events.pointer.down})),Autopilot.button=$("#autoplay_icon"),Autopilot.speedbutton=$("#autoplay_speed"),Autopilot.stopbutton=$("#autoplay_back"),Autopilot.button.on(Events.pointer.down,Autopilot.toggle),Autopilot.speedbutton.on(Events.pointer.down,Autopilot.selectspeed),Autopilot.stopbutton.on(Events.pointer.down,Autopilot.stop))},onPlaceLoad:function(e){Autopilot.running&&setTimeout(Autopilot.cycle,1e3*Autopilot.speed)},start:function(){Autopilot.pos=0,Autopilot.running=!0,player.bottomBar(!1),$("#autoplay_box").show(),setTimeout(function(){ssi("Plan","plantoid",{planspot:Autopilot.landmarks[Autopilot.pos]},function(e){e.data>0?player.go(e.data,0):Autopilot.cycle()})},200)},toggle:function(){Autopilot.running?Autopilot.pause():Autopilot.resume()},pause:function(){Autopilot.running&&(Autopilot.running=!1,Autopilot.button.html("<span>"+TPL.lng("autopilot.resume","Wznów")+"</span><img src='assets/play.png'>"),Autopilot.button.removeClass("auto_running"),player.currentView.stopTurning(),$("#big_pause").show(),$("#big_pause").removeClass("big_fade"),setTimeout(function(){$("#big_pause").addClass("big_fade")},100))},resume:function(){Autopilot.running=!0,Autopilot.button.html("<span>"+TPL.lng("autopilot.stop","Zatrzymaj")+"</span><img src='assets/pause.png'>"),Autopilot.button.addClass("auto_running"),Autopilot.cycle(),$("#big_play").show(),$("#big_play").removeClass("big_fade"),setTimeout(function(){$("#big_play").addClass("big_fade")},100)},stop:function(){Autopilot.running=!1,player.bottomBar(!0),$("#autoplay_box").hide()},selectspeed:function(){$("#autoplay_speedlist").toggle(),null!=Autopilot.speedAutoClose&&clearTimeout(Autopilot.speedAutoClose),$("#autoplay_speedlist").is(":visible")?Autopilot.speedAutoClose=setTimeout(function(){$("#autoplay_speedlist").hide()},1e4):null!=Autopilot.speedAutoClose&&clearTimeout(Autopilot.speedAutoClose)},setspeed:function(e){switch($("#autoplay_speedlist").hide(),Autopilot.speed=e,Autopilot.speed){case 1:Autopilot.speedbutton.html("<img src='assets/speed4.png'><span>Prędkość:<Br><b>"+TPL.lng("autopilot.very_fast","b. szybko")+"</b></span>");break;case 2:Autopilot.speedbutton.html("<img src='assets/speed3.png'><span>Prędkość:<Br><b>"+TPL.lng("autopilot.fast","szybko")+"</b></span>");break;case 3:Autopilot.speedbutton.html("<img src='assets/speed2.png'><span>Prędkość:<Br><b>"+TPL.lng("autopilot.very_slow","wolno")+"</b></span>");break;case 4:Autopilot.speedbutton.html("<img src='assets/speed1.png'><span>Prędkość:<Br><b>"+TPL.lng("autopilot.very_slow","b. wolno")+"</b></span>")}},cycle:function(){Autopilot.running&&(Autopilot.pos++,Autopilot.pos<Autopilot.landmarks.length?ssi("Plan","plantoid",{planspot:Autopilot.landmarks[Autopilot.pos]},function(e){var t=HotSpotManager.findById(e.data);null!=t?HotSpotManager.findById(e.data).proceed():e.data>0?player.go(e.data,0):Autopilot.cycle()}):(player.bottomBar(!0),$("#autoplay_box").hide()))}};PluginManager.add(Autopilot);var CategoryInfo={lastCategory:"",lastLevel:"",lastIcon:"",init:function(){AppEvent.on(player,"PLACE.LOADED",CategoryInfo.onPlaceLoad),AppEvent.on(player,"HOTSPOT.STARTLOOKING",CategoryInfo.onLookAt),AppEvent.on(player,"PLAYER.GO",CategoryInfo.onGo),CategoryInfo.flash=$("<div id='category_info'></div>"),$("#overlay").append("<div id='ci_bg'></div>"),$("#overlay").append(CategoryInfo.flash),$("#overlay").append("<div id='ci_cat'></div>"),$("#overlay").append("<div id='ci_level'></div>"),$("#overlay").append("<div id='ci_icon'><div class='icon'></div></div>"),$("#overlay").append("<div id='ci_infoicon'><img src='assets/menu_info.png'></div>"),$("#ci_infoicon").on(Events.pointer.down,function(){SpeechManager.speakTip("PLAYER.HELP.4.TITLE","TIPS"),placeInfo.toggleMenu()}),SpeechManager.prepareTip("PLAYER.HELP.4.TITLE","TIPS"),$("#overlay").append("<div id='ci_status'></div>"),window.setStatus=function(e){$("#ci_status").html(e),""==e?$("#ci_status").css("visibility","hidden"):$("#ci_status").css("visibility","visible")}},onLookAt:function(e){CategoryInfo.selectedSpot=e},onGo:function(e){if(null!=CategoryInfo.selectedSpot){var t=CategoryInfo.selectedSpot.properties.place.iconfile;CategoryInfo.lastIcon!=t&&(null!=t&&"null"!=t&&""!=t?($("#ci_icon .icon").css("background-image","url(/html5app/storage/plan/"+t+")"),$("#ci_icon").show(),$("#ci_icon").removeClass("icon_fade_in"),$("#ci_icon").removeClass("icon_fade_out"),setTimeout(function(){$("#ci_icon").addClass("icon_fade_in")},100)):($("#ci_icon").addClass("icon_fade_out"),setTimeout(function(){$("#ci_icon").removeClass("icon_fade_in")},100))),CategoryInfo.lastIcon=t}},onPlaceLoad:function(e){if(console.log("Last folder: "+CategoryInfo.lastFolder),console.log("Current folder: "+player.current.folder.city_id),void 0!=CategoryInfo.lastFolder&&CategoryInfo.lastFolder!=player.current.folder.city_id&&parseInt(player.current.priority)<9&&0==player.current.folder.silent&&($("#ci_bg").css("opacity","1"),$("#ci_bg").css("visibility","visible"),$("#category_info").html(player.current.folder.city_name),setTimeout(function(){$("#category_info").css("opacity","1")},500),setTimeout(function(){$("#ci_bg").css("opacity","0"),$("#category_info").css("opacity","0"),setTimeout(function(){$("#ci_bg").css("visibility","hidden")},500)},3e3)),CategoryInfo.lastFolder=player.current.folder.city_id,window.setStatus(""),""!=player.current.description&&void 0!=player.current.description?($("#ci_infoicon").show(),"photo"==player.current.place_type?$("#ci_infoicon").addClass("photo"):$("#ci_infoicon").removeClass("photo")):$("#ci_infoicon").hide(),null!=player.current.psc_name){var t="";0==player.current.plan_level&&""!=player.current.psc_floor0&&null!=player.current.psc_floor0&&(t=player.current.psc_floor0),player.current.plan_level<0&&""!=player.current.psc_basement&&null!=player.current.psc_basement&&(t=player.current.psc_basement),player.current.plan_level>0&&""!=player.current.psc_floorname&&null!=player.current.psc_floorname&&(t=player.current.psc_floorname+" "+player.current.plan_level),t=""!=t?", "+t:"";var i=$("#info .label").html();if($("#info .label").html(i+"<br><small>"+player.current.psc_name+t+"</small>"),player.current.psc_name!=CategoryInfo.lastCategory){var a="";0==player.current.level&&""!=player.current.psc_floor0&&null!=player.current.psc_floor0&&(a="<br>"+player.current.psc_floor0),player.current.level<0&&""!=player.current.psc_basement&&null!=player.current.psc_basement&&(a="<br>"+player.current.psc_basement),player.current.level>0&&""!=player.current.psc_floorname&&null!=player.current.psc_floorname&&(a="<br>"+player.current.psc_floorname+" "+player.current.level),$("#category_info").html(player.current.psc_name+"<span class='level'>"+a+"</span>"),$("#category_info").css("opacity","1"),setTimeout(function(){$("#category_info").css("opacity","0")},6e3)}else if(player.current.level!=CategoryInfo.lastLevel){var a="";0==player.current.level&&""!=player.current.psc_floor0&&null!=player.current.psc_floor0&&(a="<br>"+player.current.psc_floor0),player.current.level<0&&""!=player.current.psc_basement&&null!=player.current.psc_basement&&(a="<br>"+player.current.psc_basement),player.current.level>0&&""!=player.current.psc_floorname&&null!=player.current.psc_floorname&&(a="<br>"+player.current.psc_floorname+" "+player.current.level),$("#category_info").html("<span class='level'>"+a+"</span>"),$("#category_info").css("opacity","1"),setTimeout(function(){$("#category_info").css("opacity","0")},6e3)}CategoryInfo.lastCategory=player.current.psc_name,CategoryInfo.lastLevel=player.current.level}}};PluginManager.add(CategoryInfo);var Help={scrollInit:!1,init:function(){AppEvent.on(player,"afterLoad",Help.afterLoad),Help.node=$("<div id='help'></div>");var e,t;try{e=JSON.parse(PROJECT.settings["core/project_name"]),t=e[PROJECT.lang]}catch(i){t=""}var a=(PROJECT.domain+".wkraj.pl/html5//index.php?id="+player.ident,"https://www.wkraj.pl/qrcode.php?q=high&domain="+PROJECT.domain);player.offline&&(a="data/qrcode.png"),Help.node.append(TPL.render("help-main",{project_name:t,domain:PROJECT.domain,ident:player.ident,qrcode:a})),$("#panels").append(Help.node),Help.button=$("<div id='help_icon' class='bottombar circlebutton'><img src='assets/help_icon.png' width='32' height='32'></div><span id='help_tip' class='bottombar bbar_label'>"+TPL.lng("help.icon_title","POMOC")+"</span>"),$("#overlay").append(Help.button),Help.button.on(Events.pointer.down,function(e){Help.open()}),Help.node.find(".backarrow").on(Events.pointer.up,function(e){Help.close()}),SpeechManager.prepareTip("PLAYER.HELP_BUTTON","TIPS")},afterLoad:function(e){var t="https://www.wkraj.pl/qrcode.php?q=high&domain="+PROJECT.domain+".wkraj.pl/html5/index.php?id="+player.ident;""!=player.current.place_name?$("#pano_name").html(player.current.place_name):$("#pano_name").html("Panorama nr. "+player.current.place_id),player.offline||$("#qrcode").attr("src",t),$("#help_pano_id").html(player.ident),$("#selfurl").attr("href","https://"+PROJECT.domain+".wkraj.pl/html5/index.php?id="+player.ident)},close:function(){$("#help").hide(),Tab.cancelStackRemove("help-sidebar")},open:function(){SpeechManager.speakTip("PLAYER.HELP_BUTTON","TIPS"),$("#help").show(),$(".helpstate").show(),$(".aboutstate").hide(),ScrollBar.update("#help .helppage"),Tab.cancelStackAdd("help-sidebar",Help.close)},about:function(){SpeechManager.speakTip("PLAYER.HELP_BUTTON","TIPS"),$("#help").show(),$(".helpstate").hide(),$(".aboutstate").show(),ScrollBar.update("#help .helppage")}};PluginManager.add(Help);var Equipment={collectibles:[],erp:null,delivered:{},deliveredCount:0,opened:!1,tweens:{},init:function(){this.erp=new Interpolate,this.widget=$("<div class='eq-widget'>Ekwipunek</div>"),this.eq=$("<div id='eq' class='eq'><div class='inventory'><div class='items'></div></div></div>"),this.inv=this.eq.find(".inventory .items"),this.collection=this.eq.find(".collection"),$("#overlay").append(this.widget),$("#panels").append(this.eq),$("#eq .eq-close").click(this.close.bind(this)),this.widget.click(this.toggle.bind(this)),this.sounds={open:new AudioEffect("assets/audio/games/backpack.mp3"),deliver:new AudioEffect("assets/audio/games/delivered.mp3")},this.sounds.open.setVolume(.7)},vibrate:function(){this.erp.setStart({scale:.8}),this.erp.setEnd({scale:1}),this.erp.reset(),this.vibrating()},vibrating:function(){if(this.erp.pos<=1){this.erp.next(.1);var e=this.erp.cycleProperty("scale","easeOutElastic");this.widget.find("img").css("transform","scale("+e+", "+e+")"),setTimeout(this.vibrating.bind(this),16)}},has:function(e){for(var t in this.collectibles){var i=this.collectibles[t];if(i.id==e.id)return!0}return!1},showWidget:function(){this.widget.show(),this.widget.html("<div class='label'><b>Plecak</b><br><small>Przedmioty:"+(this.collectibles.length-this.deliveredCount)+"</small></div><img src='assets/games/backpack.png?1234' width='180'>"),this.widget.addClass("show")},showGhost:function(){this.widget.show(),this.widget.html("<img src='assets/games/backpack.png?1234' width='180'>"),void 0!=this.tweens.bpout&&clearTimeout(this.tweens.bpout),void 0==this.tweens.bpin&&(this.tweens.bpin=setTimeout(function(){this.widget.addClass("show"),this.tweens.bpin=void 0}.bind(this),100)),this.tweens.bpout=setTimeout(function(){this.widget.removeClass("show"),this.tweens.bpout=void 0}.bind(this),2e3)},collect:function(e){ItemState.setState(e,"picked"),QuestManager.action("collected",e)?(this.collectibles.push(e),this.showWidget(),this.opened&&this.refreshInventory()):Equipment.showGhost()},dropPosition:function(){var e=this.widget.offset(),t=.5*this.widget.width()+80,i=this.widget.height();return{x:parseInt(e.left)+t,y:parseInt(e.top)+i}},close:function(){this.opened=!1;var e=100*this.collectibles.length,t=e;for(var i in this.collectibles){var a=this.collectibles[i];t-=100,setTimeout(function(){this.node.removeClass("backpacked")}.bind(a),t)}setTimeout(function(){this.eq.hide()}.bind(this),e)},refreshInventory:function(){this.inv.html(""),this.collection.html("");for(var e in this.collectibles){var t=this.collectibles[e];void 0==Equipment.delivered[t.id]&&(t.no=e,t.node=$("<div class='carried'><span class='eqc-label'>"+t.title+"</span><img src='/storage/collectibles/"+t.icon+"' width='80'></div>"),this.enableDnD(t),this.inv.append(t.node))}var i=100*this.collectibles.length;for(var e in this.collectibles){var t=this.collectibles[e];i-=100,setTimeout(function(){this.node.addClass("backpacked")}.bind(t),i)}},toggle:function(){this.opened?this.close():this.open()},open:function(){this.eq.show(),this.sounds.open.play(),this.opened=!0,this.dragging=null,this.refreshInventory()},dragDelivered:function(){Equipment.dragging.node.remove(),Equipment.delivered[Equipment.dragging.id]=!0,ItemState.setState(Equipment.dragging,"delivered"),this.deliveredCount++,this.showWidget(),this.deliveredCount>=this.collectibles.length&&this.close(),QuestManager.action("delivered",Equipment.dragging),this.sounds.deliver.play()},enableDnD:function(e){e.node.on("mousedown",function(t){this.dragging=e,e.drag=$("<div style='position: absolute;transform: translate(-50%, -50%);z-index:999999;pointer-events:none;'><img src='/storage/collectibles/"+e.icon+"' width='150'></div>"),$("body").append(e.drag),e.gx=t.clientX,e.gy=t.clientY,e.drag.css("left",t.clientX),e.drag.css("top",t.clientY),$("body").one("mouseup.gdrag",function(t){e.drag.remove(),this.dragging=null,$("body").off("mousemove.gdrag"),t.stopPropagation(),t.preventDefault()}.bind(this)),$("body").on("mousemove.gdrag",function(t){e.drag.css("left",t.clientX),
e.drag.css("top",t.clientY)}.bind(this)),t.stopPropagation(),t.preventDefault()}.bind(this))},resetQuestItems:function(e){var t=[],i={};for(var a in Equipment.collectibles){var n=Equipment.collectibles[a];n.collection_id!=e.id&&(t[a]=n,i[n.id]=e.id)}Equipment.collectibles=t;var s={};this.deliveredCount=0;for(var a in Equipment.delivered)i[a]&&(s[a]=!0,this.deliveredCount++);Equipment.delivered=s,this.showWidget()}};PluginManager.add(Equipment);var ItemState={items:{},init:function(){},setState:function(e,t){ItemState.items[e.id]={state:t}},canSpawn:function(e){return void 0==ItemState.items[e.id]?!0:!1},state:function(e){return ItemState.items[item.id].state},resetStates:function(e){var t=[];for(var i in ItemState.items){var a=ItemState.items[i];a.collection_id!=e.id&&(t[i]=a)}Equipment.collectibles=t}};PluginManager.add(ItemState);var FullScreen={node:null,init:function(){(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)&&(FullScreen.node=$("<div id='fs'></div>"),FullScreen.node.append(TPL.render("fullscreen-main",{})),$("#overlay").append(FullScreen.node),AppEvent.on(player,"placeReady",function(e){FullScreen.placeReady(e)}),$("#fs a").prop("title",TPL.lng("tips.clicktofullscreen","Kliknij aby zmienić jakość")))},placeReady:function(e){"panorama"==player.current.place_type?$("#fs").show():$("#fs").hide()},toggle:function(e){var t=$("body").get(0);e.preventDefault(),e.stopPropagation(),document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():(t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen(),setTimeout(function(){player.currentView.reorient()},500))}};PluginManager.add(FullScreen);var Dialog={afterFunc:null,flatTimer:null,hinted:{},init:function(){$("#panels").append($("<div id='dialog_overlay'></div>")),$("#panels").append($("<div id='dialogs'></div>"))},message:function(e,t,i,a){var n=$("#dialog");void 0!=n&&n.remove(),Dialog.afterFunc=a,$("#dialogs").append(TPL.render("dialog-main",{message:t,button:i,icon:e,hasIcon:""!=e?!0:!1})),$("#dialog").css("left",.5*$("body").width()-.5*($("#dialog").width()+50)),$("#dialog").css("opacity","1"),$("#dialog").css("top","80px")},select:function(e,t,i,a,n){var s=$("#dialog");void 0!=s&&s.remove(),Dialog.afterFunc=n,$("#dialogs").append(TPL.render("dialog-multiopt",{message:t,options:a,icon:e,help:i,clickEvent:"on"+Events.pointer.up})),$("#dialog").css("left",.5*$("body").width()-.5*($("#dialog").width()+50)),$("#dialog").css("opacity","1"),$("#dialog").css("top","80px")},route:function(e,t,i,a,n,s,o,r,l){var p=$("#dialogroute");void 0!=p&&p.remove(),Dialog.afterFunc=l,$("#dialog_overlay").show(),$("#dialogs").append(TPL.render("dialog-routeopt",{placeName:e,thumb:t,category:i,id:a,go:s,start:o,finish:r,help:n,clickEvent:"on"+Events.pointer.up})),$("#dialogroute").css("left",.5*$("body").width()-.5*($("#dialogroute").width()+50)),$("#dialogroute").css("opacity","1"),$("#dialogroute").css("top","80px")},flash:function(e,t,i,a){var n=null;null!=Dialog.flashTimer&&clearTimeout(Dialog.flashTimer);var s="";"object"==typeof t&&(s=t.help,t=t.message),n=void 0==a?"dialog-flash":a;var o=$(n);void 0!=o&&o.remove(),$("#dialog_flash")&&$("#dialog_flash").remove(),$("#dialogs").append(TPL.render(n,{message:t,icon:e,help:s})),$("#dialog_flash").css("left",.5*$("body").width()-.5*($("#dialog_flash").width()+50)),$("#dialog_flash").removeClass("dialog_notrans"),$("#dialog_flash").on(Events.pointer.down,Dialog.closeFlash),setTimeout(function(){$("#dialog_flash").css("opacity","1"),$("#dialog_flash").css("top","80px")},200),void 0==i?Dialog.flashTimer=setTimeout(function(){Dialog.closeFlash()},8e3):Dialog.flashTimer=setTimeout(function(){Dialog.closeFlash()},i)},closeFlash:function(){$("#dialog_flash").css("opacity","0"),setTimeout(function(){$("#dialog_flash").hide(),$("#dialog_flash").addClass("dialog_notrans"),$("#dialog_flash").css("top","-80px")},1e3)},hint:function(e,t,i,a,n){Dialog.hinted.hasOwnProperty(e)||(Dialog.flash(t,i,a,n),Dialog.hinted[e]=1)},okHandler:function(){$("#dialog").hide(),$("#dialog_overlay").hide(),null!=Dialog.afterFunc&&Dialog.afterFunc()},optionHandler:function(e,t,i){$(t).hide(),$("#dialog_overlay").hide(),null!=Dialog.afterFunc&&Dialog.afterFunc(e),i.stopPropagation(),i.preventDefault()},cancel:function(e){$(e).hide(),$("#dialog_overlay").hide(),null!=Dialog.afterFunc&&Dialog.afterFunc(-1)},test:function(){Dialog.flash("<img src='/html5/assets/end_white.png'>","Dotarłeś do miejsca przeznaczenia")},closeDialogs:function(){$("#dialog").hide(),$("#dialog_overlay").hide()}};PluginManager.add(Dialog);var Library={node:null,current:null,init:function(){Library.bootstrap()},bootstrap:function(){Library.node=$("<div id='library' class='lib-main'><libcmp ref='lib'></libcmp></div>"),$("#panels").append(Library.node),Vue.component("libcmp",Library.cmp),Library.vue=new Vue({el:"#library"})},open:function(e){Library.vue.$refs.lib.open(e)},openFromFile:function(e){Library.vue.$refs.lib.openFromFile(e)},placeReady:function(e){},process:function(){},ssi:function(e,t,i,a){var n={};n.className=e,n.methodName=t;for(var s in i)n["parameters!"+s]=i[s];$.ajax({type:"POST",url:"https://www.wkraj.pl/gatewayManager.php?result=json",dataType:"json",data:n}).done(function(e){a(e)})}};PluginManager.add(Library),Library.cmp={props:["value"],data:function(){return{folder:{},subs:[],files:[],visible:!1,mode:"list",selected:{},page:0,totalpages:0,total:0,idx:0,settings:{text:{color:"#ffffff",size:"14"},gallery:{alpha:1}},lang:{opendocument:"test"}}},mounted:function(){},methods:{open:function(e){this.lang.opendocument=TPL.lng("open.document","Otwórz dokument"),this.visible=!0,this.id=e,this.fromCsv=!1,console.log(e.substr(-1)),"/"==e.substr(-1)&&(this.fromCsv=!0),this.openFolder(e)},CSVtoArray:function(e){var t=/^\s*(?:'[^'\\]*(?:\\[\S\s][^'\\]*)*'|"[^"\\]*(?:\\[\S\s][^"\\]*)*"|[^,'"\s\\]*(?:\s+[^,'"\s\\]+)*)\s*(?:,\s*(?:'[^'\\]*(?:\\[\S\s][^'\\]*)*'|"[^"\\]*(?:\\[\S\s][^"\\]*)*"|[^,'"\s\\]*(?:\s+[^,'"\s\\]+)*)\s*)*$/,i=/(?!\s*$)\s*(?:'([^'\\]*(?:\\[\S\s][^'\\]*)*)'|"([^"\\]*(?:\\[\S\s][^"\\]*)*)"|([^,'"\s\\]*(?:\s+[^,'"\s\\]+)*))\s*(?:,|$)/g;if(console.log(e),e=e.replace('/""/g',"”"),!t.test(e))return null;var a=[];return e.replace(i,function(e,t,i,n){return void 0!==t?a.push(t.replace(/\\'/g,"'")):void 0!==i?a.push(i.replace(/\\"/g,'"')):void 0!==n&&a.push(n),""}),/,\s*$/.test(e)&&a.push(""),a},openFolder:function(e,t){var i=this;void 0!=t?this.page=parseInt(this.page)+t:this.page=0,this.fromCsv?(player.offline?i.dir="./storage/library/"+e:i.dir="/storage/library/"+e,$.getJSON(i.dir+"index.json?ts="+Date.now(),function(e){"EN"==player.lang&&void 0!=e.title_EN?i.$set(i.folder,"title",e.title_EN):i.$set(i.folder,"title",e.title),void 0!=e.bg&&(e.bg.file=i.dir+e.bg.file+"?ts="+Date.now(),e.bg.alpha=e.bg.alpha,i.$set(i.folder,"bg",e.bg)),i.settings=e}),$.ajax(i.dir+"index.csv?ts="+Date.now()).done(function(e){var t=e.split("\n");i.page=0,i.totalpages=1,i.total=t.length,i.files=[];for(var a in t)if(0!=a){var n=i.CSVtoArray(t[a]);try{var s="";switch(n[0]){case"audio":s="audio";break;case"dokument":s="document";break;default:s="image"}var o=2,r=3;"EN"==player.lang&&(o=4,r=5),i.files.push({type:s,no:parseInt(a),previewUrl:i.dir+n[1]+"?ts="+Date.now(),title:n[o],desc:n[r]})}catch(l){console.log("Line "+a+": "+t[a]),console.log(l)}}})):Library.ssi("userfiles","folder",{folder:e,page:this.page},function(e){i.folder=e.data.folder,i.subs=e.data.subs,i.files=e.data.files,i.page=e.data.page,i.total=e.data.total,i.totalpages=e.data.totalpages;var t=50*i.page;for(var a in i.files)t++,i.$set(i.files[a],"no",t),i.$set(i.files[a],"previewUrl",i.previewUrl(i.files[a]))})},previewUrl:function(e){return player.offline?"./storage/library/"+this.folder.customer_id+"/"+this.folder.path+"/"+e.filename:"https://www.wkraj.pl/storage/library/"+this.folder.customer_id+"/"+this.folder.path+"/"+e.filename},preview:function(e){this.mode="preview",this.selected=this.files[e],this.idx=parseInt(e)},closePreview:function(){this.mode="list"},close:function(){this.visible=!1}},watch:{},template:"#tpl-lib"};var MediaWidget={media:[],uielement:{},hasIcon:{},setIconStatus:function(e,t){MediaWidget.hasIcon[e]=t,null!=MediaWidget.uielement&&void 0!=MediaWidget.uielement&&(MediaWidget.uielement.__icon_symbol=e)},getIconStatus:function(e){return MediaWidget.hasIcon[e]},init:function(){MediaWidget.node=$("<a href='javascript:void(null);' id='mediawidget' title='"+TPL.lng("tips.clicktoseevideo","Kliknij aby oglądnąć film")+"' onclick='MediaWidget.open();'><img src='assets/youtube.png' width='42'></a>"),MediaWidget.player=$("<div id='mediawidget_player'></div>"),$("#overlay").append(MediaWidget.node),MediaWidget.node.hide(),$("#overlay").append(MediaWidget.player),Tab.setGroup("mediaelement","+"),AppEvent.on(player,"placeReady",function(e){MediaWidget.placeReady(e)}),AppEvent.on(ElementManager,"beforeLoad",function(e){MediaWidget.clear()}),this.tab=Tab.add("mediaelement",{action:function(e){e.node.click()},focus:function(e){e.node.addClass("focused"),void 0==e.focus?e.node.focus():e.focus.focus()},blur:function(e){e.node.removeClass("focused")}},{node:$("#mediawidget"),focus:$("#mediawidget")}),Tab.disable("mediaelement",this.tab.id)},addMediaUrl:function(e,t){MediaWidget.media=[],MediaWidget.media.push(e),MediaWidget.node.show()},showIcon:function(e,t,i,a){MediaWidget.uielement=e,void 0!=a?MediaWidget.setIconStatus(a,!0):MediaWidget.setIconStatus("default",!0),void 0==t?MediaWidget.node.html("<img src='assets/youtube.png' width='42'>"):MediaWidget.node.html(t),void 0==i?MediaWidget.node.prop("title",TPL.lng("tips.clicktoseevideo","Kliknij aby oglądnąć film")):MediaWidget.node.prop("title",i),(void 0!=e||null!=e)&&e.node.addClass("media-hidden"),void 0!=e||null!=e?(MediaWidget.node.show(),Tab.enable("mediaelement",this.tab.id)):(MediaWidget.node.hide(),Tab.disable("mediaelement",this.tab.id))},clear:function(){MediaWidget.media=[],(void 0==MediaWidget.uielement||null==MediaWidget.uielement)&&MediaWidget.node.hide()},placeReady:function(e){},open:function(e){void 0!=MediaWidget.uielement.__icon_symbol&&MediaWidget.setIconStatus(MediaWidget.uielement.__icon_symbol,!1),void 0!=MediaWidget.uielement&&void 0!=MediaWidget.uielement.id?($(".media-hidden").show(),MediaWidget.node.hide(),Tab.disable("mediaelement",this.tab.id),Tab.enableAll("elements")):(MediaWidget.player.show(),MediaWidget.player.html("<a href='javascript:void(null);' onclick='MediaWidget.close()' class='close'>&times;</a><div class='spacer'></div><div id='yt-fs-player'></div>"),MediaWidget.yt=YTPlayer.embed("yt-fs-player",MediaWidget.media[0].id,"100%","100%"))},close:function(e){void 0!=MediaWidget.yt&&YTPlayer.destroy(MediaWidget.yt),MediaWidget.player.hide(),MediaWidget.player.html("")}};PluginManager.add(MediaWidget);var LanguageMenu={data:null,menuButton:"#menubar_langicon",init:function(){AppEvent.on(player,"afterLoad",LanguageMenu.afterLoad)},go:function(e){player.offline?window.location.href=LanguageMenu.data.folder.languages[e]+".html?setlang="+LanguageMenu.data.folder.languages[e]:LanguageMenu.data.folder.languages[e]!=LanguageMenu.data.lang?document.location="index.php?id="+LanguageMenu.data.place_id+"&lng="+LanguageMenu.data.folder.languages[e]:$("#languages").hide()},show:function(e){var t="";if(LanguageMenu.data.folder.languages&&LanguageMenu.data.folder.languages.length>1&&(null==LanguageMenu.data.lang||""==LanguageMenu.data.lang||e)){$("#languages").show(),$("#languages").html(""),AppEvent.trigger(LanguageMenu,"LANGSELECTION.SHOW",{}),e&&($("#languages").addClass("tab"),menubar.setActive(this));for(var i in LanguageMenu.data.folder.languages)t+="<div class='lang'><a href='javascript:void(null);' onclick='LanguageMenu.go(\""+i+"\")'><img src='flags/hd/"+LanguageMenu.data.folder.languages[i].toLowerCase()+".png'></a></div>";$("#languages").html("<div class='langlist'>Select language<br><br>"+t+"</div>")}else{var a=LanguageMenu.data.lang?LanguageMenu.data.lang:"";""==a&&(a="PL"),$("#glyph_langicon").attr("src","flags/hd/"+a.toLowerCase()+".png"),LanguageMenu.data.folder.languages.length<=1?$("menubar_langicon").hide():$("menubar_langicon").show()}},afterLoad:function(e){LanguageMenu.data=e,LanguageMenu.show(!1)},close:function(){$("#languages").hide()}};PluginManager.add(LanguageMenu);var Menu={firstLoad:!0,places:{},breadcrumbs:[],currentMenu:null,hovering:{},icons:[],tip:{},lastFolder:null,forcedInfo:"",wheelWeight:0,actives:{},rightIcons:null,removeHtml:function(e){return null==e||void 0==e?"":(e=e.replace(/(<([^>]+)>)/gi," "),e=e.replace("  "," "),e=e.replace("  "," "))},register:function(){Tab.setGroup("hotspots","+"),Tab.setGroup("topmenu","+"),Tab.setGroup("topicons","-"),Tab.setGroup("info","+"),Tab.setGroup("iwindow","+"),Tab.setGroup("iwin.wcag","+"),Tab.setGroup("iwin.close","+"),Tab.setGroup("bottom","+"),Menu.helpTab=Menu.addTabToIcon("","","",0)},init:function(){AppEvent.on(player,"afterLoad",Menu.afterLoad),AppEvent.on(player,"PLACE.LOADED",Menu.placeLoaded);var e="<div class='contrast'><a href='javascript:void(null);' title='"+TPL.lng("info.wcag.contrast_normal","normalny kontrast")+"' class='ctr c0 speaks' data-speakgroup='TIPS' data-speak='HTML5.info.wcag.contrast_normal'>A</a>";e+="<a href='javascript:void(null);'  title='"+TPL.lng("info.wcag.white_on_black","biały tekst na czarnym tle")+"' class='ctr c1 speaks' data-speakgroup='TIPS' data-speak='HTML5.info.wcag.white_on_black'>A</a>",e+="<a href='javascript:void(null);'  title='"+TPL.lng("info.wcag.black_on_yellow","czarny tekst na żółtym tle")+"' class='ctr c2 speaks' data-speakgroup='TIPS' data-speak='HTML5.info.wcag.black_on_yellow'>A</a>",e+="<a href='javascript:void(null);' title='"+TPL.lng("info.wcag.yellow_on_black","żółty tekst na czarnym tle")+"' class='ctr c3 speaks' data-speakgroup='TIPS' data-speak='HTML5.info.wcag.yellow_on_black'>A</a></div>";var t="<div id='wcagpanel'>"+e+"<div class='brk'></div><div class='sizes'>";t+="<a href='javascript:void(null);' class='sz f1 speaks' data-speakgroup='TIPS' data-speak='HTML5.info.wcag.font_normal' title='"+TPL.lng("info.wcag.font_normal","normalna czcionka")+"'>A</a>",t+="<a href='javascript:void(null);' class='sz f2 speaks' data-speak='HTML5.info.wcag.font_bigger' title='"+TPL.lng("info.wcag.font_bigger","powiększona czcionka")+"' data-speakgroup='TIPS'>A<sup>+</sup></a>",t+="<a href='javascript:void(null);' class='sz f3 speaks' data-speak='HTML5.info.wcag.font_verybig' title='"+TPL.lng("info.wcag.font_verybig","bardzo powiększona czcionka")+"' data-speakgroup='TIPS'>A<sup>++</sup></a></div></div>",player.offline?Menu.node=$("<div id='menu_container'><div id='hmenu'></div><div id='iwindow'><div class='tabs'><a href='javascript:void(null);' onclick='Menu.tab(1);' class='tab t1 selected'>Informacje</a><a href='javascript:void(null);' onclick='Menu.tab(2);' class='tab t2'>#</a></div><div class='wcag'><a href='javascript:void(null);' title='"+TPL.lng("info.wcagbutton","Ustawienia dostępności")+"' onclick='Menu.toggleWcag();' id='wcagicon' class='speaks' data-speakgroup='TIPS' data-speak='HTML5.info.wcagbutton'>A</a></div> <a class='e speaks' data-speak='PLAYER.IWIN.FULL' data-speakgroup='TIPS' href='#' title='"+TPL.lng("tips.enlargewindow","Powiększ okno")+"' onclick='Menu.infowindow_full();'><span class='fa fa-compress'></span></a><a class='x speaks' title='"+TPL.lng("tips.closeinfowindow","Zamknij okno informacyjne")+"' data-speak='PLAYER.CLOSE' data-speakgroup='TIPS' href='#' onclick='Menu.infowindow();'><span aria-hidden='true'>&times;</span></a><div class='content'></div><div class='indicators'></div>"+t+"</div></div>"):Menu.node=$("<div id='menu_container'><div id='hmenu'></div><div id='iwindow'><div class='tabs'><a href='javascript:void(null);' onclick='Menu.tab(1);' class='tab t1 selected'>Informacje</a><a href='javascript:void(null);' onclick='Menu.tab(2);' class='tab t2'>#</a></div><div class='wcag'><a href='javascript:void(null);' title='"+TPL.lng("info.wcagbutton","Ustawienia dostępności")+"' onclick='Menu.toggleWcag();' id='wcagicon' class='speaks' data-speakgroup='TIPS' data-speak='HTML5.info.wcagbutton'>A</a></div> <a href='javascript:void(null);' onclick='Menu.openPdf()' title='"+TPL.lng("info.openpdf","Otwórz PDF")+"' class='speaks pdf' style='right: 60px; font-size: 12px;' data-speak='HTML5.info.openpdf' data-speakgroup='TIPS'>"+TPL.lng("info.openpdf","Otwórz PDF")+"</a><a class='e speaks' data-speak='PLAYER.IWIN.FULL' data-speakgroup='TIPS' href='#' title='"+TPL.lng("tips.enlargewindow","Powiększ okno")+"' onclick='Menu.infowindow_full();'><span class='fa fa-compress'></span></a><a class='x speaks' title='"+TPL.lng("tips.closeinfowindow","Zamknij okno informacyjne")+"' data-speak='PLAYER.CLOSE' data-speakgroup='TIPS' href='#' onclick='Menu.infowindow();'><span aria-hidden='true'>&times;</span></a><div class='content'></div><div class='indicators'></div>"+t+"</div></div>"),$("#ui").prepend($("<div class='menu_bg'></div>")),$("#panels").append(Menu.node),$("#panels").on("mouseenter",".sub",Menu.subHover),$("#player").on("mousemove",Menu.mousemove),$("#menu_container #wcagpanel .f1").on("click",function(){$("#iwindow .content").removeClass("size2"),$("#iwindow .content").removeClass("size3")}),$("#menu_container #wcagpanel .f2").on("click",function(){$("#iwindow .content").addClass("size2"),$("#iwindow .content").removeClass("size3")}),$("#menu_container #wcagpanel .f3").on("click",function(){$("#iwindow .content").removeClass("size2"),$("#iwindow .content").addClass("size3")});var i=$("#iwindow");$("#menu_container #wcagpanel .c0").on("click",function(){i.removeClass("ctr1"),i.removeClass("ctr2"),i.removeClass("ctr3")}),$("#menu_container #wcagpanel .c1").on("click",function(){i.addClass("ctr1"),i.removeClass("ctr2"),i.removeClass("ctr3")}),$("#menu_container #wcagpanel .c2").on("click",function(){i.removeClass("ctr1"),i.addClass("ctr2"),i.removeClass("ctr3")}),$("#menu_container #wcagpanel .c3").on("click",function(){i.removeClass("ctr1"),i.removeClass("ctr2"),i.addClass("ctr3")}),SpeechManager.enableSpeech("#panels",".speaks",0,"TOPMENU"),setTimeout(function(){$(".sub").each(function(e){if(void 0==$(this).attr("data-init-top")){var t=parseInt($(this).css("top"));$(this).attr("data-init-top",t)}}),$("#panels").on("DOMMouseScroll",".sub",Menu.onWheel),$("#panels").on("mousewheel",".sub",Menu.onWheel)},3500)},openPdf:function(){window.open("https://www.wkraj.pl/html5/pdf/doc.php?id="+player.ident+"&lng="+player.lang.toLowerCase())},toggleWcag:function(){$("#wcagpanel").toggleClass("wcagopen"),$(".wcag a").toggleClass("wcagiconopen"),$("#wcagpanel").hasClass("wcagopen")?(Tab.clearGroup("iwin.wcag"),Menu.addBasicTab("iwin.wcag",$("#iwindow .c0")),Menu.addBasicTab("iwin.wcag",$("#iwindow .c1")),Menu.addBasicTab("iwin.wcag",$("#iwindow .c2")),Menu.addBasicTab("iwin.wcag",$("#iwindow .c3")),Menu.addBasicTab("iwin.wcag",$("#iwindow .f1")),Menu.addBasicTab("iwin.wcag",$("#iwindow .f2")),Menu.addBasicTab("iwin.wcag",$("#iwindow .f3"))):Tab.clearGroup("iwin.wcag")},mousemove:function(e){e.pageY<200?($(".menu_bg").css("opacity","1"),$(".menu_bg").css("visibility","visible")):($(".menu_bg").css("opacity","0"),$(".menu_bg").css("visibility","hidden"))},onWheel:function(e){var t=Math.max(-1,Math.min(1,e.originalEvent.wheelDelta||-e.originalEvent.detail));t=Math.round(120*t);var i=$(this).offset(),a=i.top,n=parseInt($(this)[0].scrollHeight)+a;a=parseInt($(this).css("top")),(n>$(window).height()-50||t>0)&&$(this).css("top",a+t);var s=$(this).data("init-top");a+t>s&&$(this).css("top",s),e.preventDefault(),e.stopPropagation()},subHover:function(e){var t=0;Menu.currentMenu=$(this),void 0==$(this).attr("data-init-top")&&(t=parseInt($(this).css("top")),$(this).attr("data-init-top",t)),e.stopPropagation()},hexToRgbA:function(e,t){var i;return/^#([A-Fa-f0-9]{3}){1,2}$/.test(e)?(i=e.substring(1).split(""),3==i.length&&(i=[i[0],i[0],i[1],i[1],i[2],i[2]]),i="0x"+i.join(""),"rgba("+[i>>16&255,i>>8&255,255&i].join(",")+","+t+")"):""},getMenuColor:function(e){var t="0.8";return void 0==e.color||0==e.color||""==e.color?"transparent":"1"==e.color?"rgba(155,0,0,"+t+")":"2"==e.color?"rgba(0,155,0,"+t+")":"3"==e.color?"rgba(0,0,155,"+t+")":"4"==e.color?"rgba(0,155,155,"+t+")":"5"==e.color?"rgba(155,155,0,"+t+")":"6"==e.color?"rgba(50,0,0,"+t+")":"7"==e.color?"rgba(0,0,255,"+t+")":"8"==e.color?"rgba(240,123,6,"+t+")":"9"==e.color?"rgba(255,255,255,"+t+")":Menu.hexToRgbA(e.color,.8)},renderMenuItem:function(e){return void 0==e.color||""==e.color?e.title:e.title},submenu:function(e,t,i){var a="",n=t;if(e&&e.length>0){var s=!1;for(var o in e)if(e[o].childs){s=!0;break}e.length<10&&(s=!0);var r="sub";i&&(r+=" firstsub");var l="";"transparent"!=n&&(l="background-color: transparent;"),a=s?"<div class='"+r+"' style='"+l+"'>":"<div class='"+r+"' style='width:607px;column-count:2;"+l+"'>";var p=null,l="";for(var o in e){t=n,p=Menu.getMenuColor(e[o]);var d=0;e[o].look_at&&(d=e[o].look_at),null!=e[o].look_at_y&&void 0!=e[o].look_at_y&&(d+=","+e[o].look_at_y);var c="";!Menu.places[e[o].pano_id]||"panorama"!=Menu.places[e[o].pano_id].type&&"photo"!=Menu.places[e[o].pano_id].type||(c="onclick='Menu.openUrlEvt(\""+e[o].pano_id+'", false, "'+d+"\", event);'"),"transparent"!=p?(t=p,l="background-color:"+p):"transparent"!=n&&(l="background-color:"+n);var h="",u=" data-speak='"+e[o].title+"'",m=Menu.removeHtml(Menu.renderMenuItem(e[o]));-1!==e[o].pano_id.indexOf("link=")&&(m='Otwórz link "'+Menu.removeHtml(Menu.renderMenuItem(e[o]))),a+=e[o].childs?"<div class='menuitem subitems speaks"+h+"' title='"+m+"' "+u+" style='"+l+"' "+c+">":"<div class='menuitem speaks"+h+"' title='"+m+"' "+u+" style='"+l+"' onclick='Menu.openUrlEvt(\""+e[o].pano_id+'", false, "'+d+"\", event);'>";var f=e[o].childs?"<div class='more' style='pointer-events:none;'>&raquo;</div>":"";if(Menu.places[e[o].pano_id]&&("panorama"==Menu.places[e[o].pano_id].type||"photo"==Menu.places[e[o].pano_id].type)||void 0!=e[o].glyph&&""!=e[o].glyph){var g;g=void 0!=Menu.places[e[o].pano_id]?Menu.places[e[o].pano_id].thumb:"",void 0!=e[o].glyph&&""!=e[o].glyph&&(g=e[o].glyph),a+="<div class='img'><img data-src='"+g+"' height='45' style='opacity:0'></div>",a+="<span><a href='#' class='part'>"+Menu.renderMenuItem(e[o])+f+"</a></span>"}else a+="<a href='#' class='"+(""!=f?"subitems":"")+"'>"+Menu.renderMenuItem(e[o])+f+"</a>";a+=Menu.submenu(e[o].childs,t,!1),a+="<div class='clear'></div></div>"}a+="</div>"}return a},hoveringEvt:function(e){$($(e).find(".sub")).css("display","");var t=$(e).find(".firstsub"),i=$(e).offset();if(i.left+t.width()>$(window).width()){var a=i.left+t.width()-$(window).width();t.css("left","-"+a+"px")}else t.css("left","0px")},afterLoad:function(e){Menu.prepareBc(e)},prepareBc:function(e){Menu.placedata=e,Menu.breadcrumbs=[],Menu.topMenuIndex=0,Menu.updateInfoText(1);for(var t in e.menu){var i=e.menu[t];if(Menu.inMenu(i.childs)||i.pano_id==player.ident){Menu.topMenuIndex=t,Menu.breadcrumbs.push({title:i.title,index:t});var a=$($("#hmenu .bcmenu")[t]);a&&a.length>0&&$("#menu_breadcrumbs").css("left",$($("#hmenu .bcmenu")[t]).position().left)}}for(var n="",s=Menu.breadcrumbs.length-1;s>=0;s--){var o=Menu.strip(Menu.breadcrumbs[s].title);0==s&&(o="<b>"+o+"</b>"),n+=o+(s>0?" <i class='fa fa-caret-right' aria-hidden='true'></i> ":"")}var r=null;if(Menu.node.find(".bcmenu .topmenu").removeClass("active"),Menu.node.find(".bcmenu .menuitem").removeClass("active"),void 0!=Menu.breadcrumbs&&Menu.breadcrumbs.length>0&&(r=$(Menu.node.find(".bcmenu")[Menu.breadcrumbs[Menu.breadcrumbs.length-1].index]),r.find(".topmenu").addClass("active"),r=r.children(".sub"),Menu.breadcrumbs.length>1))for(var s=Menu.breadcrumbs.length-2;s>=0;s--)r=$(r.children(".menuitem")[Menu.breadcrumbs[s].index]),r.addClass("active"),r=r.children(".sub");n&&""!=n?($("#menu_breadcrumbs").html(n),$("#menu_breadcrumbs").show()):$("#menu_breadcrumbs").hide()},strip:function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""},addBasicTab:function(e,t,i,a){Tab.add(e,{focus:function(e){e.node.addClass("focused"),void 0==e.focus?e.node.focus():e.focus.focus()},blur:function(e){e.node.removeClass("focused")},keyboard:void 0!=a?a:function(){}},{node:t,focus:i})},addTabToIcon:function(e,t,i,a,n,s,o,r){var l={title:e,glyph:t,node:i,subnode:void 0==r?i:r};void 0==n&&(n=".submenu"),void 0==s&&(s="span");var p=Tab.add("topicons",{action:function(e){e.opened=void 0==e.opened?!0:!e.opened,void 0==o?e.node.find(".topicon").toggleClass("hovered"):o(),-1!=e.midx&&($(e.items.eq(e.midx)).click(),event.preventDefault(),event.stopPropagation())},focus:function(e){e.node.find(".topicon").addClass("focused"),e.node.find(".topicon").focus(),e.midx=-1,e.items=e.subnode.find(n).children(s)},blur:function(e){e.node.find(".topicon").removeClass("focused"),void 0==o?e.node.find(".topicon").removeClass("hovered"):e.opened&&o(),e.opened=!1},keyboard:function(e,t){if(e.opened&&(player.keys.ArrowLeft=0,player.keys.ArrowRight=0,player.keys.ArrowUp=0,player.keys.ArrowDown=0),"ArrowDown"==t.key){if(e.midx>=$(e.items).length-1)return;e.node.find(".topicon").removeClass("focused"),e.midx>-1&&$(e.items.eq(e.midx)).removeClass("selected focused"),e.midx++,$(e.items.eq(e.midx)).addClass("selected focused"),$(e.items.eq(e.midx)).trigger("speaks")}"ArrowUp"==t.key&&e.midx>=0?(e.node.find(".topicon").removeClass("focused"),e.midx>-1&&$(e.items.eq(e.midx)).removeClass("selected focused"),e.midx--,e.midx>-1&&($(e.items.eq(e.midx)).addClass("selected focused"),$(e.items.eq(e.midx)).trigger("speaks"))):e.midx<0&&(e.node.find(".topicon").addClass("focused"),e.node.find(".topicon").focus())}},l,a);return p},prepIcon:function(e,t,i,a){var n="";n+="<div class='top right' style='pointer-events:none;'>",n+="<a href='#' aria-hidden='true' class='topicon righticon speaks ttip' data-ttip='"+t+"' data-speakgroup='TIPS' data-speak='"+i+"'><i class='fa "+e+"' aria-hidden='true'></i><span class='tip'></span></a>",n+="</div>";var s=$(n);Menu.icons.push(s);var o=null;return o=void 0==a?this.addTabToIcon(t,e,s):this.addTabToIcon(t,e,s,a.sub,a.subsel,a.itemsel,a.toggle,a.node),s.tab=o,s},prepIconSvg:function(e,t,i,a,n){var s="";s+="<div class='top right' style='pointer-events:none;'>",s+=void 0==n?"<a href='#' aria-hidden='true' class='topicon righticon speaks ttip' data-ttip='"+t+"' data-speakgroup='TIPS' data-speak='"+i+"' style='padding:7px;'><img src='"+e+"' width='25' aria-hidden='true' style='pointer-events:none;'><span class='tip'></span></a>":"<a href='"+n.url+"' target='"+n.target+"' aria-hidden='true' class='topicon righticon speaks ttip' data-ttip='"+t+"' data-speakgroup='TIPS' data-speak='"+i+"' style='padding:7px;'><img src='"+e+"' width='25' aria-hidden='true' style='pointer-events:none;'><span class='tip'></span></a>",s+="</div>";var o=$(s);Menu.icons.push(o);var r=null;return r=void 0==a?this.addTabToIcon(t,e,o):this.addTabToIcon(t,e,o,a.sub,a.subsel,a.itemsel,a.toggle,a.node),o.tab=r,o},placeLoaded:function(){var e=Menu.placedata;if(Menu.data=e,Menu.actives={},Tab.clearGroup("info"),Menu.firstLoad||Menu.lastFolder!=e.folder.city_id){var t=$("#hmenu");t.html(""),Menu.places=e.menuplaces,Menu.lastFolder=e.folder.city_id;var i=0,a="";void 0!=window.PROJECT.settings["ui/icons/info/bg"]&&""!=window.PROJECT.settings["ui/icons/info/bg"]&&(a="background-color: "+window.PROJECT.settings["ui/icons/info/bg"]);var n="",s="";Tab.clearGroup("topmenu");for(var o in e.menu){var r=e.menu[o],l="<div class='top topanim bcmenu' onmouseover='Menu.hoveringEvt(this);'>",p=0;r.look_at&&(p=r.look_at),null!=r.look_at_y&&void 0!=r.look_at_y&&(p+=","+r.look_at_y),i+=100,n=Menu.getMenuColor(r),s="","transparent"!=n&&(s="style='background-color:"+n+"'");var d=Menu.removeHtml(Menu.renderMenuItem(r));-1!==r.pano_id.indexOf("link=")&&(d='Otwórz link "'+Menu.removeHtml(Menu.renderMenuItem(r))+'" w nowej zakładce'),l+="<a href='#' title='"+d+"' class='topmenu speaks' "+s+" data-speak='"+r.title+"' onclick='Menu.openUrlEvt(\""+r.pano_id+'", false, "'+p+"\", event);'>"+Menu.renderMenuItem(r)+(r.childs?" <span class='down'><i class='fa fa-caret-down' aria-hidden='true'></i></span>":"")+"</a>",l+=Menu.submenu(r.childs,n,!0),l+="</div>";var c=$(l);t.append(c),r.node=c,Tab.add("topmenu",{focus:function(e){e.node.find(".topmenu").addClass("focused"),e.node.find(".topmenu").focus(),e.midx=-1,e.bc=[],e.items=e.node.children(".sub").children(".menuitem")},blur:function(e){e.node.find(".topmenu").removeClass("focused"),e.node.removeClass("opened"),$("#menu_breadcrumbs").removeClass("fade"),e.midx&&e.midx>-1&&$(e.items.eq(e.midx)).removeClass("selected"),e.midx=-1},action:function(e,t){-1==e.midx?e.items.length>0?(e.node.toggleClass("opened"),$("#menu_breadcrumbs").toggleClass("fade")):e.node.find("a").click():($(e.items.eq(e.midx)).click(),e.node.removeClass("opened"),$("#menu_breadcrumbs").removeClass("fade"),t.preventDefault(),t.stopPropagation())},keyboard:function(e,t){if(e.node.hasClass("opened")&&(player.keys.ArrowLeft=0,player.keys.ArrowRight=0,player.keys.ArrowUp=0,player.keys.ArrowDown=0,"Escape"==t.key&&(e.node.toggleClass("opened"),$("#menu_breadcrumbs").toggleClass("fade"),t.preventDefault(),t.stopPropagation())),"ArrowLeft"==t.key&&e.bc.length>0){e.midx>-1&&$(e.items.eq(e.midx)).removeClass("selected focused");var i=e.bc.pop();e.items=i.items,e.midx=i.midx,$(e.items.eq(e.midx)).addClass("selectedvfocused"),$(e.items.eq(e.midx)).trigger("speaks")}if("ArrowRight"==t.key){var a=$(e.items.eq(e.midx)).children(".sub").children(".menuitem");$(a).length>0&&(e.bc.push({midx:e.midx,items:e.items}),e.items=a,e.midx=0,$(e.items.eq(e.midx)).addClass("selected focused"),$(e.items.eq(e.midx)).trigger("speaks"))}if("ArrowDown"==t.key){if(e.midx>=$(e.items).length-1)return;e.midx>-1&&$(e.items.eq(e.midx)).removeClass("selected focused"),e.midx++,$(e.items.eq(e.midx)).addClass("selected focused"),$(e.items.eq(e.midx)).trigger("speaks")}"ArrowUp"==t.key&&e.midx>0&&(e.midx>-1&&$(e.items.eq(e.midx)).removeClass("selected focused"),e.midx--,e.midx>-1&&$(e.items.eq(e.midx)).addClass("selected focused"),$(e.items.eq(e.midx)).trigger("speaks"))}},r,0)}t.find(".sub").each(function(e){var t=new MutationObserver(function(e){for(var t in e)$(e[t].target).find("img").each(function(e){$(this).on("load",function(){$(this).css("opacity",1)}),$(this).attr("src",$(this).data("src"))})}),i=this;t.observe(i,{attributes:!0})});var l="";l+="<div class='top right' style='pointer-events:none;z-index:2'>",l+="<div onclick='#' aria-hidden='true' tabindex='0' class='popup topicon righticon speaks' data-speakgroup='TIPS' data-speak='PLAYER.HELP_BUTTON'><i class='fa fa-question' aria-hidden='true'></i>",l+="<div class='submenu' style='padding: 0px;'>",l+="<span onclick='Help.open();' class='speaks' style='padding: 10px;' data-speak=''>"+TPL.lng("menu.help","Pomoc")+"</span>",l+="<span onclick='Help.about();' class='speaks' style='padding: 10px;' data-speak='"+TPL.lng("menu.realization","Realizacja")+"'>"+TPL.lng("menu.realization","Realizacja")+"</span>",l+="</div></div></div>";var h=$(l);t.append(h),Menu.helpTab.params.node=h,Menu.helpTab.params.subnode=h,Menu.helpTab.params.title=TPL.lng("menu.help","Pomoc");for(var u in Menu.icons)t.append(Menu.icons[u]);if(l="",l+="</div><div class='top right' style='pointer-events:none;'>",l+="<a href='#' aria-hidden='true' onclick='Search.open();' id='tsrchbtn' class='topicon righticon speaks ttip' data-ttip='"+TPL.lng("tips.search","Szukaj")+"' data-speakgroup='TIPS' data-speak='PLAYER.SEARCH'><i class='fa fa-search' aria-hidden='true'></i></a>",
l+="</div><div class='top right' style='pointer-events:none;'>",l+="<a href='#' aria-hidden='true' id='tmapbtn' class='topicon righticon speaks ttip' data-ttip='"+TPL.lng("tips.map","Mapa")+"' data-speakgroup='TIPS' data-speak='PLAYER.MAP'><i class='fa fa-globe-americas' aria-hidden='true'></i></a>",l+="</div>",e.folder.languages.length>1){if(l+="<div class='top right' style='pointer-events:none;'>",l+="<div onclick='' id='langbtns' class='expandable topicon righticon speaks ttip' data-ttip='"+TPL.lng("tips.lang","Języki")+"' data-speakgroup='TIPS' data-speak='HTML5.tips.lang' tabindex='0'>",player.offline){l+="<img src='flags/hd/"+(""!=player.lang.toLowerCase()?player.lang.toLowerCase():"pl")+".png' width='17' style='pointer-events:none;'>";for(var m in e.folder.languages)e.folder.languages[m]!=player.lang&&(l+="<span onclick='LanguageMenu.go(\""+m+"\")'><img src='flags/hd/"+e.folder.languages[m].toLowerCase()+".png' width='17'></span>")}else{l+="<img src='/flags/hd/"+(""!=player.lang.toLowerCase()?player.lang.toLowerCase():"pl")+".png' width='17' style='pointer-events:none;'>";for(var m in e.folder.languages)e.folder.languages[m]!=player.lang&&(l+="<span onclick='LanguageMenu.go(\""+m+"\")' class='speaks' data-speakgroup='TIPS' data-speak='HTML5.langs."+e.folder.languages[m]+"'><img src='/flags/hd/"+e.folder.languages[m].toLowerCase()+".png' width='17'></span>")}l+="</div>"}l+="</div>",t.append(l);var l="<div class='top infobutton'><div class='rect'></div><div class='rect'></div><div class='rect'></div>";l+="<a href='#' title='"+TPL.lng("tips.placeinfo","Informacja o miejscu")+"' class='topicon infoicon speaks'aria-flowto='iwindow' style='"+a+"' data-speak='PLAYER.HELP.4.TITLE' data-speakgroup='TIPS'><i class='fa fa-info' aria-hidden='true'></i></a>",l+="</div>";var c=$(l);t.append(c),$(".infoicon").on("click",Menu.infowindow),Menu.addTabToIcon(TPL.lng("tips.search","Szukaj"),"",$($("#tsrchbtn").parent())),Menu.addTabToIcon(TPL.lng("tips.map","Mapa"),"",$($("#tmapbtn").parent())),e.folder.languages.length>1&&Menu.addTabToIcon(TPL.lng("tips.lang","Języki"),"",$($("#langbtns").parent()),0,"#langbtns","span",void 0,$($("#langbtns").parent()));var f=document.createElement("style"),g=Math.round(15+43*(e.folder.languages.length-1))+"px !important";f.innerHTML=".expandable:hover {height:"+g+"} #langbtns.hovered {height:"+g+"} .expanded {height: "+g+"}",document.body.appendChild(f),setTimeout(function(){$("#langbtns").removeClass("expanded")},7e3),$("#tmapbtn").on(Events.pointer.down,function(){mapInfo.clickToggleMiniMap()}),$("#tmapbtn").on("keydown",function(e){"Enter"==e.key&&mapInfo.clickToggleMiniMap()}),t.append("<div id='menu_breadcrumbs' aria-hidden='true'></div><div id='ttip-popup'></div>"),Menu.firstLoad=!1,setTimeout(function(){Menu.prepareBc(Menu.placedata)},2500),AppEvent.trigger(player,"MENU.REBUILD",!0),$(".ttip").each(function(e){var t=$(this);t.on("mouseover",function(){var e=$(this);$("#ttip-popup").html(e.data("ttip"));var t=e.offset().left+.5*e.outerWidth()-.5*$("#ttip-popup").outerWidth();$("#ttip-popup").css("left",t),$("#ttip-popup").css("top",e.offset().top+e.outerHeight()+5),$("#ttip-popup").show()}),t.on("mouseout",function(){$("#ttip-popup").hide()})})}("full"==e.properties.info_state||"fullext"==e.properties.info_state)&&$(window).width()>400&&(Menu.forcedInfo=player.ident,Menu.showinfowindow()),Menu.forcedInfo!=player.ident&&""!=Menu.forcedInfo&&(Menu.forcedInfo="",Menu.hideinfowindow());var v=player.current;void 0!=v.description&&""!=v.description||void 0!=v.parentplace&&void 0!=v.parentplace.description&&""!=v.parentplace.description||void 0!=v.indicators&&v.indicators.length>0?($(".infoicon").css("display","block"),$(".infoanim").css("display","block"),$(".infoicon").css("visibility","visible"),$("#menu_breadcrumbs").css("left",$($("#hmenu .bcmenu")[Menu.topMenuIndex]).position().left),Tab.add("info",{focus:function(e){$(".infoicon").addClass("focused"),$(".infoicon").focus()},blur:function(e){$(".infoicon").removeClass("focused")}},{})):($(".infoicon").css("display","block"),$(".infoanim").css("display","block"),$(".infoicon").css("visibility","hidden"),$(".infoanim").css("visibility","hidden")),v.indicators.length>0?$(".indicators").show():$(".indicators").hide()},inMenu:function(e){for(var t in e){if(e[t].pano_id==player.ident)return Menu.breadcrumbs.push({title:e[t].title,index:t}),1;if(e[t].childs&&Menu.inMenu(e[t].childs))return Menu.breadcrumbs.push({title:e[t].title,index:t}),1}return 0},openUrl:function(e,t,i){if(""!=e){if(Autoplay.isRunning&&Autoplay.stop(),$("#panels .sub").css("display","none"),Menu.currentMenu&&Menu.currentMenu.css("display","none"),setTimeout(function(){$("#panels .sub").css("display",""),Menu.currentMenu.css("left","")},40),"quest"==e.substr(0,5))return void QuestManager.load(i);if("quiz"==e.substr(0,5))return void Quiz.open(i);if("folder"==e.substr(0,6))return void Library.open(i);if("link="==e.substr(0,5)&&(e="http://"+e.substr(5),t=!0),"hlink="==e.substr(0,6)&&(e="https://"+e.substr(6),t=!0),t){var a=window.open(e,"_blank");(null==a||"undefined"==typeof a)&&confirm("Twoja przeglądarka blokuje otwieranie nowych okien. Czy chcesz otworzyć ten link w bieżącym oknie ?")&&(document.location=e)}else player.go(e,i)}},openUrlEvt:function(e,t,i,a){return this.openUrl(e,t,i),a.preventDefault(),a.stopPropagation(),!1},initIwindowTabs:function(){Tab.cancelStackAdd("iwindow",Menu.infowindow),Tab.clearGroup("iwindow"),Tab.clearGroup("iwin.wcag"),Tab.clearGroup("iwin.close"),Menu.addBasicTab("iwindow",$("#iwindow #wcagicon")),Menu.addBasicTab("iwin.close",$("#iwindow .pdf")),Menu.addBasicTab("iwin.close",$("#iwindow .e")),Menu.addBasicTab("iwin.close",$("#iwindow .x")),Menu.addBasicTab("iwin.close",$("#iwindow .content"),$("#iwindow .content p"),function(e){e.node.hasClass("focused")&&(player.keys.ArrowLeft=0,player.keys.ArrowRight=0,player.keys.ArrowUp=0,player.keys.ArrowDown=0,"ArrowDown"==event.key&&(void 0==e.st&&(e.st=0),e.st+=10,e.node.scrollTop(e.st),e.st=e.node.scrollTop()),"ArrowUp"==event.key&&(void 0==e.st&&(e.st=0),e.st-=10,e.node.scrollTop(e.st),e.st=e.node.scrollTop()))})},infowindow_full:function(){$("#iwindow").toggleClass("wide"),$("#iwindow").css("max-width",""),$("#iwindow .content").css("max-height","");var e=Menu.data;$("#iwindow").hasClass("wide")||(void 0!=e.properties.info_width&&null!=e.properties.info_width&&"0"!=e.properties.info_width&&$("#iwindow").css("max-width",e.properties.info_width+"px"),void 0!=e.properties.info_height&&null!=e.properties.info_height&&"0"!=e.properties.info_height&&(Screen.mobile()||$("#iwindow .content").css("max-height",e.properties.info_height+"px")))},infowindow:function(){$("#iwindow").css({cssText:""}),$("#iwindow").toggleClass("iwindow_show"),$(".infoanim").removeClass("infoanim"),$(".infoicon").toggleClass("infoicon_down"),$("#iwindow").hasClass("iwindow_show")?(Menu.initIwindowTabs(),AppEvent.trigger(player,"MENU.INFOWINDOW.TOGGLE",!0)):(Tab.clearGroup("iwindow"),Tab.clearGroup("iwin.wcag"),Tab.clearGroup("iwin.close"),Tab.cancelStackRemove("iwindow",Menu.infowindow),AppEvent.trigger(player,"MENU.INFOWINDOW.TOGGLE",!1)),Menu.updateInfoText()},showinfowindow:function(e){var t=Menu.placedata;void 0!=e&&(t=e),void 0!=t.properties.info_left&&void 0!=t.properties.info_top?$("#iwindow").css({cssText:"left: "+(t.properties.info_left+15)+"px !important;\ntop: "+(t.properties.info_top+15)+"px !important"}):$("#iwindow").css({cssText:""}),void 0!=t.properties.info_width&&null!=t.properties.info_width&&"0"!=t.properties.info_width&&$("#iwindow").css("max-width",t.properties.info_width+"px"),void 0!=t.properties.info_height&&null!=t.properties.info_height&&"0"!=t.properties.info_height&&(Screen.mobile()||$("#iwindow .content").css("max-height",t.properties.info_height+"px")),$("#iwindow").addClass("iwindow_show"),$(".infoanim").removeClass("infoanim"),$(".infoicon").addClass("infoicon_down"),AppEvent.trigger(player,"MENU.INFOWINDOW.TOGGLE",!0),Menu.initIwindowTabs(),Menu.updateInfoText(void 0,e)},updateInfoText:function(e,t){var i=player.current,a="";void 0!=t&&(i=t);var n=i.description;if((void 0==n||""==n.trim())&&void 0!=i.parentplace&&void 0!=i.parentplace.description&&""!=i.parentplace.description.trim()&&(n=i.parentplace.description),$("#iwindow .tabs").hide(),void 0!=n&&""==n&&0==i.indicators.length&&Menu.hideinfowindow(),void 0!=n?(a=n,a=a.replace(/\r/g,""),$("#iwindow").hasClass("iwindow_show")&&void 0!=e&&Menu.lastDesc!=a&&void 0!=Menu.lastDesc?($("#iwindow").attr("style","opacity: 0 !important"),setTimeout(function(){$("#iwindow .content").html(a),$("#iwindow").attr("style","transition: opacity 1s !important")},2e3)):$("#iwindow .content").html(a),Menu.lastDesc=a):0==i.indicators.length&&Menu.hideinfowindow(),i.indicators.length>0){$("#iwindow .indicators").html("");var s="<div class='indicators_info'>"+(null!=i.indicators_info&&void 0!=i.indicators_info?i.indicators_info.replace("\n","<br>"):"")+"</div>";for(var o in i.indicators){var r=i.indicators[o];s+="<div class='indicator' onclick='Menu.turnTo("+r.look_x+","+r.look_y+")'>",s+="<span class='title'>"+r.title+"</span>",s+="<span class='info'>"+r.info.replace(new RegExp("\n","g"),"<br>")+"</span>",s+="</div>"}"1"==i.indicators_tab?($("#iwindow .indicators").html(s),$("#iwindow .indicators").hide(),$("#iwindow .tabs").show(),$("#iwindow .tabs .t2").html(i.indicators_tab_title)):($("#iwindow .tabs").hide(),$("#iwindow .content").html(a+s))}},turnTo:function(e,t){player.currentView.turnTo(parseFloat(e)+90-4,t)},tab:function(e){1==e?($("#iwindow .wcag").show(),$("#iwindow .content").show(),$("#iwindow .indicators").hide(),$("#iwindow .tabs .t1").addClass("selected"),$("#iwindow .tabs .t2").removeClass("selected")):2==e&&($("#iwindow .wcag").hide(),$("#iwindow .content").hide(),$("#iwindow .indicators").show(),$("#iwindow .tabs .t2").addClass("selected"),$("#iwindow .tabs .t1").removeClass("selected"))},hideinfowindow:function(){$("#iwindow").removeClass("iwindow_show"),$(".infoicon").removeClass("infoicon_down"),AppEvent.trigger(player,"MENU.INFOWINDOW.TOGGLE",!1)},hideInfoIcon:function(e){e?$(".infoicon").css("display","none"):$(".infoicon").css("display","block")}};PluginManager.add(Menu);var WcagMenu={register:function(){},init:function(){WcagMenu.node=$("<div id='wcagui_container'><div class='top-nav'><a class='btn btn-menu' id='wcag-menu-btn' href='javascript:void(null);'><i class='fas fa-bars'></i> Menu</a></div><div id='wcag-menu'></div></div>"),$("#panels").append(WcagMenu.node),AppEvent.on(player,"PLACE.LOADED",WcagMenu.placeLoaded),WcagMenu.node.find("#wcag-menu-btn").on("click",WcagMenu.openMenu)},show:function(){$("#menu_container").hide(),$("#wcagui_container").show()},openMenu:function(){WcagMenu.node.find("#wcag-menu").addClass("expand")},slideMenu:function(e,t){$("#"+e).addClass("in"),$("#"+t).addClass("out")},backMenu:function(e,t){$("#"+e).removeClass("out"),$("#"+t).removeClass("in")},placeMenu:function(e,t,i){var a=$("<div class='menunav' id='"+e+"'></div>"),n=[];if(null!=t){var s=$("<a class='item' href='javascript:void(null)'>&laquo; Cofnij</a>");a.append(s),s.on("click",function(){WcagMenu.backMenu(t,e)})}for(var o in i){var r=i[o],s=$("<a class='item' data-mnu='"+e+"-"+o+"' href='javascript:void(null)'>"+r.title+"</a>");a.append(s),void 0!=r.childs&&(n.push(WcagMenu.placeMenu(e+"-"+o,e,r.childs)),s.html(r.title+" >"),s.on("click",function(){WcagMenu.slideMenu($(this).data("mnu"),e)}))}return n.length>0?n.splice(0,0,a):n.push(a),n},placeLoaded:function(){var e=Menu.placedata,t=WcagMenu.node.find("#wcag-menu");t.html("");var i=WcagMenu.placeMenu("nav-root",null,e.menu);for(var a in i)t.append(i[a]);i[0].addClass("in")}};PluginManager.add(WcagMenu),AudioEffect.prototype.setLoop=function(e){this.loop=e,this.audio.loop=e},AudioEffect.prototype.setVolume=function(e){this.volume=e,this.audio&&(this.audio.volume=this.volume)},AudioEffect.prototype.fadeVolume=function(e){e!=this.volume&&(this.volume+=e>this.volume?this.fade_dt:-this.fade_dt),Math.abs(this.volume)<.01&&(this.volume=0),this.audio&&(this.audio.volume=this.volume)},AudioEffect.prototype.setMuted=function(e){this.muted=e,this.audio&&(this.audio.muted=this.muted)},AudioEffect.prototype.play=function(){this.audio.volume=this.volume,self=this;var e=new Promise(function(e,t){var i=null;i=self.audio.play().then(function(){e(self.audio)},function(e){"NotAllowedError"==e.name?setTimeout(function(){self.play()},2e3):t(e)})});return e},AudioEffect.prototype.pause=function(){this.audio.pause()},AudioEffect.prototype.playRange=function(e,t){this.audio.currentTime=e;var i=this.audio.play();this.from=e,this.to=t;var a=this;return this.paudio_event=this.audio.addEventListener("timeupdate",function(t){void 0!=a.to&&a.to>0&&a.audio.currentTime>=a.to&&(a.loop||a.audio.pause(),a.audio.currentTime=e)}),i};var Music={node:null,current:2048,audio:null,icon:null,isMuted:!1,ambient:null,ambient_source:"",ambient_state:null,init:function(){$("#overlay").append(Quality.node),AppEvent.on(player,"placeReady",function(e){Music.placeReady(e)}),SpeechManager.prepareTip("PLAYER.VOLUME.MUTE","TIPS"),SpeechManager.prepareTip("PLAYER.VOLUME.UNMUTE","TIPS"),Music.icon=Menu.prepIconSvg("assets/speaker.svg",TPL.lng("tips.volume","Głośność"),"HTML5.tips.volume"),"on"==window.PROJECT.settings["pdf/guide"]&&(player.pdfguide=Menu.prepIconSvg("assets/pdf.svg",TPL.lng("tips.pdfguide","Przewodnik w PDF"),"HTML5.tips.pdfguide")),AppEvent.on(player,"MENU.REBUILD",function(){Music.icon.children("a").on("click",Volume.toggleUI),"on"==window.PROJECT.settings["pdf/guide"]&&player.pdfguide.children("a").on("click",function(){window.open("/html5/pdf/guide.php?folder="+player.folder,"_blank")})}),AppEvent.on(player,"VOLUME.SET",function(){void 0!=Music.audio&&null!=Music.audio&&Music.audio.setVolume(Volume.currentMusicVolume()),void 0!=Music.ambient&&null!=Music.ambient&&("mute"==Music.ambient_state?Music.ambient.fadeVolume(0):Volume.currentAmbientVolume()>.2?Music.ambient.fadeVolume(null!=Music.audio?.2:Volume.currentAmbientVolume()):Music.ambient.fadeVolume(Volume.currentAmbientVolume()))}),Music.mobileicon=$("<div class='mobileonly mobilemute'><i class='fa fa-volume-up fa-fw'></i></div>"),$("#overlay").append(Music.mobileicon),Music.mobileicon.on("click",Music.toggle)},toggle:function(){Music.isMuted=!Music.isMuted,Music.isMuted?(Music.icon.find("a").html("<img src='assets/speaker-off.svg' width='25' aria-hidden='true'>"),Music.mobileicon.find("i").removeClass("fa-volume-up"),Music.mobileicon.find("i").addClass("fa-volume-mute"),Volume.setMuted()):(Music.icon.find("a").html("<img src='assets/speaker.svg' width='25' aria-hidden='true'>"),Music.mobileicon.find("i").removeClass("fa-volume-mute"),Music.mobileicon.find("i").addClass("fa-volume-up"),Volume.setDefault()),Music.audio&&Music.audio.setMuted(Music.isMuted)},placeReady:function(e){var t;if(void 0!=player.current.sound&&""!=player.current.sound?t=player.current.sound:void 0!=player.current.parentplace&&void 0!=player.current.parentplace.sound&&""!=player.current.parentplace.sound&&(t=player.current.parentplace.sound),Music.ambient_state=null,void 0!=player.current.ambient_state&&(Music.ambient_state=player.current.ambient_state),void 0!=player.current.ambient&&""!=player.current.ambient&&Music.ambient_source!=player.current.ambient&&(""!=Music.ambient_source&&(Music.ambient.pause(),delete Music.ambient),Music.ambient_source=player.current.ambient,Music.ambient=new AudioEffect(Music.ambient_source),Music.ambient.setVolume(Volume.currentAmbientVolume()),Music.ambient.setMuted(Music.isMuted),Music.ambient.setLoop(!0),Music.ambient.play()),SpeechManager.hasSpeech()?Music.mobileicon.css("bottom","150px"):Music.mobileicon.css("bottom","110px"),player.offline&&(t="app/"+t),Music.lastmusic!=t&&""!=t&&(null!=Music.audio&&(Music.audio.pause(),delete Music.audio,Music.audio=null,Music.lastmusic=""),null!=t)){Music.audio=new AudioEffect(t),Music.audio.setVolume(Volume.currentMusicVolume()),Music.audio.setMuted(Music.isMuted),Music.audio.setLoop(void 0==player.current.sound_noloop||"0"==player.current.sound_noloop?!0:!1);var i;i=player.current.sound_start>0||player.current.sound_end>0?Music.audio.playRange(player.current.sound_start,player.current.sound_end):Music.audio.play(),i.then(function(){Music.lastmusic=t})["catch"](function(){Music.disabledmusic=t,console.log("Can't play music")})}Music.pingMute()},resumePlaying:function(){void 0!=Music.audio&&null!=Music.audio&&(void 0!=Music.disabledmusic&&Music.disabledmusic!=Music.lastmusic&&(Music.lastmusic=Music.disabledmusic),Music.audio.play())},pingMute:function(){void 0==Music.firstPing&&(Music.icon.addClass("muteslow"),Music.icon.addClass("bigmute"),setTimeout(function(){Music.icon.removeClass("bigmute")},12e3),Music.firstPing=!0)}},Volume={power:1,init:function(){Volume.buildUI(),AppEvent.on(player,"placeReady",function(e){Volume.placeReady(e)})},addBasicTab:function(e,t,i,a,n){var s=Tab.findById("topicons",Music.icon.tab.id);return Tab.addAfter(e,s+t,{focus:function(e){e.node.addClass("focused"),void 0==e.focus?e.node.focus():e.focus.focus()},blur:function(e){e.node.removeClass("focused")},keyboard:void 0!=n?n:function(){}},{node:i,focus:a})},buildUI:function(){Volume.ui=$("<div class='volume-bar'> <a href='javascript:void(null);' onclick='Volume.hideUI()' class='bclose speaks ttip' data-ttip='"+TPL.lng("tips.clicktoclose","Kliknij aby zamknąć")+"' data-speakgroup='TIPS' data-speak='PLAYER.CLOSE'>&times;</a></div>"),Volume.master=new VolBar("",1),Volume.music=new VolBar(TPL.lng("volume.music","Muzyka"),3),Volume.lektor=new VolBar(TPL.lng("volume.lektor","Lektor"),5),Volume.yt=new VolBar(TPL.lng("volume.yt","YouTUBE"),7),Volume.ui.append("<div class='clear'></div>"),Volume.ui.append(Volume.master.ui()),Volume.ui.append("<hr size='1' id='vdiv'>"),Volume.ui.append(Volume.music.ui()),Volume.ui.append(Volume.lektor.ui()),Volume.ui.append(Volume.yt.ui()),Volume.closeTab=Volume.addBasicTab("topicons",9,Volume.ui.find(".bclose")),this.enableTabs(!1),$("#overlay").append(Volume.ui),SpeechManager.enableSpeech(".volume-bar",".speaks",0,"TOPMENU"),AppEvent.on(player,"SOUND.UNMUTED",function(){Volume.master.muted||(Music.icon.find("a").css("padding","7px"),Music.icon.find("a").html("<img src='assets/speaker.svg' width='25' aria-hidden='true' style='pointer-events:none;'>"),Music.mobileicon.find("i").removeClass("fa-volume-mute"),Music.mobileicon.find("i").addClass("fa-volume-up"))}),AppEvent.on(player,"SOUND.MUTED",function(){Volume.master.muted&&(Music.icon.find("a").css("padding","0px"),Music.icon.find("a").html("<img src='assets/speaker-off.svg' width='38' aria-hidden='true'>"),Music.mobileicon.find("i").removeClass("fa-volume-up"),Music.mobileicon.find("i").addClass("fa-volume-mute"))}),Volume.checkVisibility()},toggleMute:function(e){void 0==e&&Music.toggle()},setMuted:function(){Volume.master.mute(1)},setDefault:function(){Volume.master.setDefault()},toggleUI:function(){void 0!=Volume.ui&&Volume.ui.is(":visible")?Volume.hideUI():Volume.showUI()},enableTabs:function(e){e?(Tab.enable("topicons",Volume.closeTab.id),Volume.master.enableTabs(!0),Volume.music.enableTabs(!0),Volume.lektor.enableTabs(!0),Volume.yt.enableTabs(!0)):(Tab.disable("topicons",Volume.closeTab.id),Volume.master.enableTabs(!1),Volume.music.enableTabs(!1),Volume.lektor.enableTabs(!1),Volume.yt.enableTabs(!1))},showUI:function(){void 0==Volume.ui&&Volume.buildUI(),Volume.ui.show(),Music.icon.css("opacity","0.1"),this.enableTabs(!0)},hideUI:function(){Volume.ui.hide(),Music.icon.css("opacity","1"),this.enableTabs(!1)},currentAmbientVolume:function(){var e=void 0==player.current.ambient_vol?.2:parseFloat(player.current.ambient_vol);return e*Volume.music.val()*Volume.master.val()},currentMusicVolume:function(){return Volume.music.val()*Volume.master.val()},currentTipVolume:function(){var e=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);return e?.02*Volume.lektor.val()*Volume.master.val():.2*Volume.lektor.val()*Volume.master.val()},currentSpeechVolume:function(){return Volume.lektor.val()*Volume.master.val()},currentYTVolume:function(){return Volume.yt.val()*Volume.master.val()*100},checkVisibility:function(){console.log("AMBIENT: "+player.current.ambient),void 0!=player.current.ambient&&""!=player.current.ambient?Volume.music.visible(1):Volume.music.visible(0),YTPlayer.playerCount>0||VideoManager.playerCount>0?Volume.yt.visible(1):Volume.yt.visible(0),Volume.yt.visibility||Volume.music.visibility?(Volume.lektor.visible(1),$("#vdiv").show()):(Volume.lektor.visible(0),$("#vdiv").hide())},placeReady:function(e){Volume.checkVisibility()}};PluginManager.add(Music),PluginManager.add(Volume);var NearestManager={previewNode:null,opened:!1,ID:"",json:null,hasResizing:!1,pos:0,see:0,loaded:0,limit:0,excluded:{},menuButton:"#menubar_nearest",init:function(){$("#panels").append($("<div id='nearest'></div>")),AppEvent.on(player,"afterLoad",NearestManager.afterLoad),SpeechManager.prepareTip("PLAYER.OPEN_PREVIEW","TIPS")},afterLoad:function(e){NearestManager.ID=e.place_id,ssi("nearest","enabled",{id:e.place_id},function(e){})},enlargeIt:function(e,t){var i=$(e);$("#thumb_"+i.attr("data-pid")).attr("src",i.attr("data-image")),$("#galleries_"+i.attr("data-pid")+" img").css("border","1px solid #ffffff"),i.find("img").css("border","3px solid #ffffff")},resizing:function(){NearestManager.fill(0),$("#nearest").css("height",$(window).height()-50+"px")},close:function(){$("#nearest").hide()},show:function(){SpeechManager.speakTip("PLAYER.OPEN_PREVIEW","TIPS"),menubar.setActive(this),player.preload(1),$("#nearest").show(),$("#nearest").html(""),$("#nearest").css("height",$(window).height()-50+"px"),NearestManager.opened=!NearestManager.opened,NearestManager.opened?ssi("nearest","view",{id:NearestManager.ID,view:"mobile"},function(e){NearestManager.json=e,NearestManager.fill(0),player.preload(0)}):(player.preload(0),NearestManager.fill(0))},invertTag:function(e,t){var i=$(e),a=!0,n=0,s=0;if(i.hasClass("tagged")){for(var o in NearestManager.json.data.tags)1==NearestManager.excluded[o]&&(a=!1,n++),s++;if(a)for(var o in NearestManager.json.data.tags)o!=t&&(NearestManager.excluded[o]=1);else for(var r in NearestManager.excluded)delete NearestManager.excluded[r]}else delete NearestManager.excluded[t];$(e).toggleClass("tagged"),NearestManager.fill(0)},toggleTag:function(e,t){var i=$(e);i.hasClass("tagged")?NearestManager.excluded[t]=1:delete NearestManager.excluded[t],$(e).toggleClass("tagged"),NearestManager.fill(1)},toggleAllTag:function(e){var t=$(e);if(t.hasClass("tagged"))for(var i in NearestManager.json.data.tags)NearestManager.excluded[i]=1;else for(var a in NearestManager.excluded)delete NearestManager.excluded[a];NearestManager.fill(0)},isExcluded:function(e){return void 0!=NearestManager.excluded[NearestManager.json.data.tagged[e][0]]&&(NearestManager.json.data.tagged[e].length<=1||void 0!=NearestManager.excluded[NearestManager.json.data.tagged[e][1]])&&(NearestManager.json.data.tagged[e].length<=2||void 0!=NearestManager.excluded[NearestManager.json.data.tagged[e][2]])?!0:!1},countItems:function(){var e=0;for(var t in NearestManager.json.data.items)NearestManager.isExcluded(t)||e++;return e},more:function(){var e="",t=0,i=0;for(var a in NearestManager.json.data.items)if(i++,!(i-1<=NearestManager.loaded)){if(t>6)break;NearestManager.isExcluded(a)||(e+=NearestManager.json.data.items[a],NearestManager.loaded=i-1,t++)}$(e).insertBefore("#nearest_more")},fill:function(e){var t="";$(window).width();NearestManager.pos=0,NearestManager.loaded=0,t=NearestManager.json.data.start,t+="<div style='float:left' class='' id='nearestPlaces'>";var i=0;for(var a in NearestManager.json.data.items){if(i>6){t+="<div id='nearest_more' onclick='NearestManager.more();'><div class='more'>...</div></div>";break}NearestManager.isExcluded(a)||(t+=NearestManager.json.data.items[a],NearestManager.loaded=i,i++)}0==i&&(t+="<h3 style='padding-top:130px;padding-bottom:130px;'>Nie znaleziono obiektów w wybranych przez Ciebie kategoriach.</h3>"),t+="<div style='width:100%;height:100px;position:relative;float:left;'></div></div>",NearestManager.see=i-e,i-e>NearestManager.limit&&(NearestManager.limit=i-e);var n="",s=!0,o=[],r=0;for(var l in NearestManager.json.data.tags){var p="tagged";void 0!=NearestManager.excluded[l]&&(p="",s=!1),r+=NearestManager.json.data.tags[l],"tagged"==p&&o.push(l),n+="<div class='tag'><a href='javascript:void(null);' class='left "+p+"' data-tag='"+l+"' onclick='NearestManager.invertTag(this, \""+l+"\");'>"+l+" <span class='tagcount'>["+NearestManager.json.data.tags[l]+"]</span></a>",n+=(""!=p?" <a href='javascript:void(null);' class='right "+p+"' data-tag='"+l+"' onclick='NearestManager.toggleTag(this, \""+l+"\");'><div style='position:absolute;right:5px;top:5px;border:1px solid #415171;padding:5px;'>&#10003;</div></a>":" <a href='javascript:void(null);' class='right "+p+"' data-tag='"+l+"' onclick='NearestManager.toggleTag(this, \""+l+"\");'><div style='position:absolute;right:5px;top:5px;border:1px solid #113141;padding:5px;width:13px;height:18px;'>&nbsp;</div></a>")+"<div class='clear'></div></div><div class='clear'></div>"}var d="<div class='tag'><a href='javascript:void(null);' class='left "+(s?"tagged":"")+"' data-tag='"+(s?"Ukryj wszystkie":"Pokaż wszystkie")+"' onclick='NearestManager.toggleAllTag(this);'>"+(s?"Ukryj wszystkie":"Pokaż wszystkie")+" <span class='tagcount'>["+r+"]</span>"+(s?"<div style='position:absolute;right:5px;top:5px;border:1px solid #415171;padding:5px;'>&#10003;</div></a>":"<div style='position:absolute;right:5px;top:5px;border:1px solid #113141;padding:5px;width:13px;height:18px;'>&nbsp;</div>")+"<div class='clear'></div></div><div class='clear'></div>";t+=NearestManager.json.data.end,0==e?($("#nearest").html(TPL.render("nearest-main",{data:t,alltags:d+n})),s?$("#neartags .menu").html("Wszystkie kategorie <img src='assets/dropdown.png' width='15'>"):1==o.length?$("#neartags .menu").html(o[0]+" <img src='assets/dropdown.png' width='15'>"):2==o.length?$("#neartags .menu").html(o[0]+" i "+o[1]+" <img src='assets/dropdown.png' width='15'>"):$("#neartags .menu").html(o[0]+" i "+(o.length-1)+" "+(o.length-1<5?"inne":"innych")+" <img src='assets/dropdown.png' width='15'>")):($("#nearest_inner").html(t),$("#neartags_taglist").html(d+n))},toggleCategoryMenu:function(){$("#neartags_taglist").toggle(),"Zamknij menu"==$("#neartags .menu").html()?NearestManager.fill(0):$("#neartags .menu").html("Zamknij menu")},openRoute:function(e,t,i,a){this.lat=i,this.lng=a,this.slat=e,this.slng=t,$("#select_route").show()},routeFromHome:function(){mapInfo.openRouteMap(this.lat,this.lng)},geoError:function(e){var t="";switch(e.code){case e.PERMISSION_DENIED:t="Nie przyznano dostepu do geolokalizacji dla tej strony. Sprawdź ustawienia przeglądarki.";break;case e.POSITION_UNAVAILABLE:t="Dane o lokalizacji są niedostępne w tym momencie.";break;case e.TIMEOUT:t="Nie udało się pobrać danych o geolokalizacji (TIMEOUT).";break;case e.UNKNOWN_ERROR:t="Wystąpił nieznany błąd."}alert(t)},showPosition:function(e){mapInfo.openRouteMap(this.lat,this.lng)},routeFromPano:function(){window.open("http://maps.google.com/maps?saddr="+this.slat+","+this.slng+"&daddr="+NearestManager.lat+","+NearestManager.lng+"&ll=","_blank")}};PluginManager.add(NearestManager);var PanoSlider={node:null,idx:0,imgs:[],cycling:!1,nextCycle:null,init:function(){"0"!=PROJECT.settings.slider&&(PanoSlider.node=$("<div id='panoslider'><div class='photoholder'><div class='top'><div class='gps'></div><div class='counter'></div><div class='id'></div></div><div class='bottom'><div class='title'></div><div class='control'><a href='javascript:void(null)'  onclick='PanoSlider.previous();' class='l'><i class='fa fa-chevron-left'></i></a> <a href='javascript:void(null)' onclick='PanoSlider.togglecycle();' class='t'><i class='fa fa-pause'></i></a> <a href='javascript:void(null)' onclick='PanoSlider.next();' class='r'><i class='fa fa-chevron-right'></i></a></div></div></div><a href='javascript:void(null);' onclick='PanoSlider.close();' class='closepanel'><img src='assets/menu_close.png'></a></div>"),PanoSlider.button=$("<a href='javascript:void(null);' aria-hidden='true' title='"+TPL.lng("slider_button","Szybka prezentacja")+"' onclick='PanoSlider.show();' class='sliderbutton' data-speak='PLAYER.OPEN_SLIDER' data-speakgroup='TIPS'>"+TPL.lng("slider_button","Szybka prezentacja")+"</a>"),Screen.xs()||$("#overlay .tray").append(PanoSlider.button),Tab.add("bottom",Tab.simpleTab($(".sliderbutton"),1),{}),PanoSlider.loader=$("<div class='loader'><img src='assets/loader.svg'></div>"),AppEvent.on(player,"PLACE.LOADED",PanoSlider.placeLoaded),SpeechManager.enableSpeech("#overlay",".sliderbutton",1,"TOPMENU"),PanoSlider.counter=PanoSlider.node.find(".counter"),PanoSlider.title=PanoSlider.node.find(".title"),PanoSlider.gps=PanoSlider.node.find(".gps"),PanoSlider.idlabel=PanoSlider.node.find(".id"),PanoSlider.controls=PanoSlider.node.find(".control"),PanoSlider.previousBtn=PanoSlider.node.find(".control .l"),PanoSlider.toggleBtn=PanoSlider.node.find(".control .t"),PanoSlider.nextBtn=PanoSlider.node.find(".control .r"),PanoSlider.holder=PanoSlider.node.find(".photoholder"),PanoSlider.items=[],$(window).resize(PanoSlider.onresize))},placeLoaded:function(e){"gallery"==player.current.place_type?PanoSlider.button.hide():PanoSlider.button.show()},go:function(){PanoSlider.close();var e="";null!=PanoSlider.items[PanoSlider.idx].rotx&&(e=PanoSlider.items[PanoSlider.idx].rotx),null!=PanoSlider.items[PanoSlider.idx].rotx&&null!=PanoSlider.items[PanoSlider.idx].roty&&(e=PanoSlider.items[PanoSlider.idx].rotx+","+PanoSlider.items[PanoSlider.idx].roty),player.go(PanoSlider.items[PanoSlider.idx].id,e)},close:function(){for(null!=PanoSlider.nextCycle&&(clearTimeout(PanoSlider.nextCycle),PanoSlider.nextCycle=null);PanoSlider.imgs.length>0;){var e=PanoSlider.imgs.shift();e.remove()}PanoSlider.node.detach(),PanoSlider.cycling=!1},next:function(){PanoSlider.cycling||(PanoSlider.idx++,PanoSlider.idx>=PanoSlider.items.length&&(PanoSlider.idx=0),PanoSlider.cycle())},previous:function(){PanoSlider.cycling||(PanoSlider.idx--,PanoSlider.idx<0&&(PanoSlider.idx=PanoSlider.items.length-1),PanoSlider.cycle())},togglecycle:function(){PanoSlider.cycling=!PanoSlider.cycling,PanoSlider.cycling?(PanoSlider.previousBtn.css("opacity","0.1"),PanoSlider.nextBtn.css("opacity","0.1"),PanoSlider.previousBtn.css("cursor","inherit"),PanoSlider.nextBtn.css("cursor","inherit"),PanoSlider.toggleBtn.html("<i class='fa fa-pause'></i>"),PanoSlider.toggleBtn.addClass("blinking"),PanoSlider.cycle()):(null!=PanoSlider.nextCycle&&(clearTimeout(PanoSlider.nextCycle),PanoSlider.nextCycle=null),PanoSlider.previousBtn.css("opacity","1"),PanoSlider.nextBtn.css("opacity","1"),PanoSlider.previousBtn.css("cursor","pointer"),PanoSlider.nextBtn.css("cursor","pointer"),PanoSlider.toggleBtn.html("<i class='fa fa-play'></i>"),PanoSlider.toggleBtn.removeClass("blinking"))},onresize:function(){var e=$(window).innerHeight()/$(window).innerWidth(),t=PanoSlider.node.find(".top"),i=PanoSlider.node.find(".bottom");t.css("height",32*e+"%"),i.css("height",32*e+"%")},show:function(){$("#panels").append(PanoSlider.node),PanoSlider.cycling=!1,Remote.ajax({url:"projectpanos.php?folder="+player.folder,offline:"projectpanos.json",dataType:"json",success:function(e){PanoSlider.items=e,PanoSlider.idx=0;for(var t in PanoSlider.items)if(PanoSlider.items[t].id==player.ident){for(PanoSlider.idx=parseInt(t);PanoSlider.idx>=0&&PanoSlider.items[PanoSlider.idx].id==PanoSlider.items[t].id;)PanoSlider.idx--;PanoSlider.idx++}PanoSlider.togglecycle()}}),PanoSlider.onresize()},cycle:function(){var e=new Image;null!=PanoSlider.nextCycle&&(clearTimeout(PanoSlider.nextCycle),PanoSlider.nextCycle=null),PanoSlider.loader.show(),e.onload=function(){var e="img";(0==PanoSlider.idx||PanoSlider.items[PanoSlider.idx].id!=PanoSlider.items[PanoSlider.idx-1].id)&&(e="imgslide");
var t=PanoSlider.items[PanoSlider.idx].quality;player.offline&&(t="data/"+PanoSlider.items[PanoSlider.idx].symbol);var i=$("<div class='"+e+"' onclick='PanoSlider.go();' style='background-image:url("+t+")'></div>"),a=PanoSlider.imgs[PanoSlider.imgs.length-1];if(PanoSlider.imgs.push(i),PanoSlider.imgs.length>2){var n=PanoSlider.imgs.shift();n.remove()}PanoSlider.holder.append(i),PanoSlider.counter.html(PanoSlider.idx+1+" / "+PanoSlider.items.length);var s=TPL.lng("html5.variants."+PanoSlider.items[PanoSlider.idx].variant,""),o=PanoSlider.items[PanoSlider.idx].title;void 0!=player.lang&&"PL"!=player.lang&&""!=player.lang&&PanoSlider.items[PanoSlider.idx].langs[player.lang]&&(o=PanoSlider.items[PanoSlider.idx].langs[player.lang]),PanoSlider.title.html(o+(""!=s?" - <b style='color:green;'>"+s+"</b>":"")),PanoSlider.gps.html("N "+PanoSlider.items[PanoSlider.idx].gpsx+" &nbsp; E "+PanoSlider.items[PanoSlider.idx].gpsy),PanoSlider.idlabel.html("ID: "+PanoSlider.items[PanoSlider.idx].id),setTimeout(function(){i.addClass("in"),a.addClass("out")},500),PanoSlider.cycling&&(PanoSlider.nextCycle=setTimeout(function(){PanoSlider.idx++,PanoSlider.idx>=PanoSlider.items.length&&(PanoSlider.idx=0),PanoSlider.nextCycle=null,PanoSlider.cycle()},5e3)),PanoSlider.loader.hide()},player.offline?e.src="data/"+PanoSlider.items[PanoSlider.idx].symbol:e.src=PanoSlider.items[PanoSlider.idx].quality}};PluginManager.add(PanoSlider);var PhotoView={node:null,init:function(){PhotoView.node=$("<div id='inphotoview'><div class='photo'><img src='' class='img'><div class='loader'><img src='assets/loader.svg'></div><div class='info'></div><div class='clear'></div></div></div>"),PhotoView.node.on("click",function(){PhotoView.node.removeClass("inph_reveal"),$(".nav").show(),void 0!=PhotoView.idleReset&&(clearInterval(PhotoView.idleReset),PhotoView.idleReset=void 0),PhotoView.spot.preventShowingInfo=!1}),$("#panels").append(PhotoView.node),AppEvent.on(player,"HOTSPOT.STARTLOOKING",PhotoView.hotspot),AppEvent.on(player,"PLAYER.KEYUP",function(e){PhotoView.node.hasClass("inph_reveal")&&(player.blockBackspace=!0),("Escape"==e.key||"Backspace"==e.key)&&(PhotoView.node.removeClass("inph_reveal"),$(".nav").show())})},hotspot:function(e){if("photo"==e.properties.place.place_type&&("1"==e.properties.place.preview_mode||"2"==e.properties.place.preview_mode)){e.noMore(),e.preventShowingInfo=!0,PhotoView.spot=e;var t=PhotoView.node.find(".info");"2"==e.properties.place.preview_mode?(t.html(""),t.show(),t.append("<h4>"+e.properties.place.place_name+"</h4>"),t.append("<div>"+e.properties.place.description+"</div>")):(t.html(""),t.hide()),PhotoView.node.find(".photo").removeClass("hphoto"),PhotoView.node.find(".photo").removeClass("vphoto"),PhotoView.node.find(".loader").show(),PhotoView.node.find(".photo .img").removeClass("loaded");var i=new Image;i.onload=function(){i.naturalWidth<i.naturalHeight?(PhotoView.node.find(".photo").removeClass("hphoto"),PhotoView.node.find(".photo").addClass("vphoto")):(PhotoView.node.find(".photo").removeClass("vphoto"),PhotoView.node.find(".photo").addClass("hphoto")),PhotoView.node.find(".photo .img").attr("src","https://www.wkraj.pl/data/"+e.properties.place.place_id+"_photo.jpg"),PhotoView.node.find(".photo .img").addClass("loaded"),PhotoView.node.find(".loader").hide(),$(".nav").hide(),PhotoView.node.addClass("inph_reveal")},i.src="https://www.wkraj.pl/data/"+e.properties.place.place_id+"_photo.jpg",PhotoView.idleReset=setInterval(function(){player.cancelIdle()},2e3)}}};PluginManager.add(PhotoView);var Quality={node:null,current:2048,init:function(){Quality.node=$("<div id='qty'></div>"),Quality.node.append(TPL.render("quality-main",{})),$("#overlay").append(Quality.node),Screen.xs()&&Quality.toggle(),$("#qty a").prop("title",TPL.lng("tips.clicktochangeqality","Kliknij aby zmienić jakość")),AppEvent.on(player,"placeReady",function(e){Quality.placeReady(e)})},placeReady:function(e){"panorama"==player.current.place_type?$("#qty").show():$("#qty").hide()},toggle:function(e){e&&e.preventDefault(),2048==Quality.current?(Quality.current=1280,Quality.node.find("a").html("SD"),player.go(player.ident,player.dir)):(Quality.current=2048,Quality.node.find("a").html("HD"),player.go(player.ident,player.dir))}};PluginManager.add(Quality);var Floors={initialized:!1,defalutFloor:null,all:[],init:function(){Floors.initialized||(ssi("Plan","getPlans",{folder:player.folder},function(e){Floors.all=e.data;for(var t in Floors.all){Floors.all[t].nobasement=!0,Floors.all[t].position=parseInt(t)+1;for(var i in Floors.all[t].levels)-1==Floors.all[t].levels[i].level&&(Floors.all[t].nobasement=!1),"1"==Floors.all[t].levels[i]["default"]&&null==Floors.defalutFloor&&(Floors.defaultFloor=Floors.all[t].levels[i].plan_id)}}),Floors.node=$("<div id='floors'></div>"),$("#panels").append(Floors.node),Floors.initialized=!0)},findFloor:function(e){for(var t in Floors.all){Floors.all[t].nobasement=!0,Floors.all[t].position=parseInt(t)+1;for(var i in Floors.all[t].levels)if(e==Floors.all[t].levels[i].plan_id)return Floors.all[t]}},open:function(){Floors.initialized||(Floors.initialized=!0),Floors.node.html(TPL.render("floors-main",{})),$("#floors").show(),$("#floors_result_box").html(""),ssi("Plan","getPlans",{folder:player.folder},function(e){$("#floors_result_box").append(TPL.render("floor-header",{}));for(var t in e.data){e.data[t].nobasement=!0,e.data[t].position=parseInt(t)+1;for(var i in e.data[t].levels)Plan.planData.plan_id==e.data[t].levels[i].plan_id?e.data[t].levels[i].active=!0:e.data[t].levels[i].active=!1,-1==e.data[t].levels[i].level&&(e.data[t].nobasement=!1);e.data[t].pdown="on"+Events.pointer.down,$("#floors_result_box").append(TPL.render("floor-row",e.data[t]))}})},selectFloors:function(e){ssi("Plan","getPlans",{folder:player.folder},function(t){var i=null;for(var a in t.data)for(var n in t.data[a].levels)if(t.data[a].levels[n].plan_id==e){i=t.data[a];break}i.pdown="on"+Events.pointer.down,Dialog.message("<img src='/html5/assets/floors.png'>",TPL.render("select-floor",i),TPL.lng("plan.cancel","Anuluj"),function(){})})},load:function(e){Floors.close(),Plan.load(e)},close:function(){$("#floors").hide(),Dialog.closeDialogs()}},Plan={mapNode:null,mapImage:null,center:{},processing:!1,landmarks:[],conInfo:[],condata:{},connections:{},swipe:{},ar:0,scale:.4,initialized:!1,compassMode:!1,width:0,height:0,lastDist:-1,repaint:null,here:{},origin:null,target:null,zooming:!1,newScale:0,deltaScale:0,init:function(){Plan.initialized||(Plan.swipe=new swiper,$("#mapinfo").on(Events.pointer.down,function(e){Plan.swipe.start(Events.getPointerEvent(e)),Plan.checkDoubleTap(),e.stopPropagation(),e.preventDefault()}),$("#mapinfo").on(Events.pointer.up,function(e){Plan.swipe.end(Events.getPointerEvent(e)),e.stopPropagation(),e.preventDefault()}),$("#mapinfo").on(Events.pointer.move,function(e){Plan.swipe.move(Events.getPointerEvent(e)),e.stopPropagation(),e.preventDefault()}),$("#mapinfo").on(Events.pointer.up,".plan-point",function(e){Plan.selectTarget(Events.getPointerEvent(e)),Plan.swipe.end(Events.getPointerEvent(e)),e.preventDefault()}),$("#mapinfo").on(Events.pointer.up,".plan-point-exit",function(e){Plan.selectFloor(Events.getPointerEvent(e)),Plan.swipe.end(Events.getPointerEvent(e)),e.preventDefault()}),$("#mapinfo").on(Events.pointer.up,".route_go",function(e){mapInfo.toggleMenu(),Plan.goOrigin()}),$("#mapinfo").on(Events.pointer.up,".target",function(e){Plan.actionTarget()}),$("#mapinfo").on(Events.pointer.wheel,function(e){Plan.wheel(Events.getWheelEvent(e)),e.stopPropagation(),e.preventDefault()}),AppEvent.on(player,"placeReady",function(e){Plan.placeReady(e),Floors.init()}),Plan.initialized=!0)},release:function(){$("#mapinfo").off(Events.pointer.down),$("#mapinfo").off(Events.pointer.up),$("#mapinfo").off(Events.pointer.move)},load:function(e){ssi("Plan","load",{plan:e},function(e){void 0!=e.data.plan_id&&Plan.start(e.data)})},setupFloors:function(){var e=Floors.findFloor(Plan.planData.plan_id),t=e.levels;$(".ffloors").html("");for(var i in t)t[i].plan_id==Plan.planData.plan_id?$(".ffloors").append($('<a class="level active blink " onmousedown="Floors.load('+t[i].plan_id+');" data-plan="2" href="javascript:void(null)">'+t[i].level+"</a>")):$(".ffloors").append($('<a class="level active" onmousedown="Floors.load('+t[i].plan_id+');" data-plan="2" href="javascript:void(null)">'+t[i].level+"</a>"))},start:function(e){Plan.planData=e,$("#mapcontent").html(TPL.render("plan-main",{planfile:e.planfile,pdown:"on"+Events.pointer.down,pup:"on"+Events.pointer.up}));$("<div class='plan-point'></div>");$(".plan_search_icon").on(Events.pointer.down,function(e){Search.open()}),Plan.setupFloors(),$("#heading .title").html(e.title+" - Poziom "+e.plan_level),Plan.mapNode=new css3DNode("#plan-canvas"),Plan.mapImage=new css3DNode("#plan-canvas img"),Plan.processing||(player.addProcess(Plan),Plan.processing=!0),player.preload(!0);var t=new Image;t.onload=function(){player.preload(!1),Plan.imageWidth=$("#plan-canvas img").width(),Plan.imageHeight=$("#plan-canvas img").height(),Plan._width=$("#mapcontent").width(),Plan._height=$("#mapcontent").height();var t=Plan._width/$("#plan-canvas img").width(),i=Plan._height/$("#plan-canvas img").height();Plan.scale=i>t?t:i,$("#plan-canvas img").css("opacity","1"),Plan.loadLandmarks(e),void 0!=e.x&&void 0!=e.y?Plan.centerTo(e.x,e.y):Plan.centerTo(.5*Plan.imageWidth,.5*Plan.imageHeight),Dialog.hint("plan_open","",TPL.lng("plan.start_tip","<span class='high'>WSKAŻ</span>wybrane punkty aby wyznaczyć trasę")+"<br>",17e3,"dialog-tutorial")},t.src="/storage/plan/"+e.planfile},loadLandmarks:function(e){Plan.planData=e,ssi("Plan","landmarks",{plan:e.plan_id},function(t){var i=t.data;Plan.landmarks=[],Plan.condata={};for(var a=0;a<i.length;a++)if(Plan.landmarks.push({place:i[a]}),void 0!=Plan.here&&Plan.here.place==i[a].place_id&&(Plan.here.no=a),void 0!=Plan.origin&&Plan.origin.place==i[a].place_id){var n=i[a].place_name;""==n&&(n="Panorama nr."),$("#route_from span").html("<b>Od: </b>"+n+" "+i[a].place_id)}void 0!=Plan.target&&void 0!=Plan.target.current&&$("#route_to span").html("<b>Do: </b>"+Plan.target.title),void 0!=Plan.target&&void 0!=Plan.origin&&($("#routebar").show(),Plan.routeBarVisibility(1)),ssi("Plan","connections",{plan:e.plan_id},function(e){for(var t=e.data,i=0;i<t.length;i++)Plan.condata[t[i].spotA+"_"+t[i].spotB]=t[i];Plan.refresh()})})},refreshTarget:function(e){if((null!=Plan.origin||null!=Plan.origin&&-1==Plan.origin.no)&&Plan.refreshOrigin(),null!=Plan.target){var t;-1==Plan.target.current&&(Plan.target.current=Plan.findNoByPlanspot(Plan.target.planspot)),t=Plan.landmarks[Plan.target.current],void 0!=t&&void 0!=Plan.landmarks[Plan.target.current]&&Plan.landmarks[Plan.target.current].place.planspot_id==Plan.target.planspot?(Plan.target.node.css("left",Plan.scale*t.place.x-25+"px"),Plan.target.node.css("top",Plan.scale*t.place.y-25+"px"),$("#plan-points").append(Plan.target.node)):Plan.target.node.remove(),ssi("Plan","route",{folder:Plan.planData.folder,from:Plan.origin.planspot,target:Plan.target.planspot},function(t){var i=t.data;Plan.route={},Plan.routesA=[],Plan.routesB=[],Plan.routePlaces={},Plan.target.routeLength=0;for(var a=0;a<i.path.length-1;a++)Plan.route[i.path[a]]=i.path[a+1],Plan.routesA.push(i.path[a]),Plan.routesB.push(i.path[a+1]),Plan.routePlaces[i.path[a]]=i.places[a],Plan.routePlaces[i.path[a+1]]=i.places[a+1],Plan.target.routeLength++;Plan.refreshConnections(),Plan.refreshHotSpots(),void 0!=e&&null!=e&&e()})}},selectFloor:function(e){if(null!=e){var t;t=$(e.origin.target).attr("data-no"),Floors.selectFloors(Plan.landmarks[t].place.plan_exit),e.origin.stopPropagation()}},selectTarget:function(e){if(null!=e){var t;t=$(e.origin.target).attr("data-no"),PlanTarget.mark(Plan.landmarks[t].place.x,Plan.landmarks[t].place.y),console.log(Plan.landmarks[t].place);var i="";i=Plan.landmarks[t].place.place_name,""==i&&(i="Panorama nr. ");var a="";""!=Plan.landmarks[t].place.psc_name&&Plan.landmarks[t].place.psc_id>0&&(a=Plan.landmarks[t].place.psc_name),Dialog.route(i,Plan.landmarks[t].place.thumb,a,Plan.landmarks[t].place.place_id,TPL.lng("plan.mark_as","lub oznacz to miejsce jako:"),TPL.lng("plan.goto","Przejdź tutaj"),TPL.lng("plan.route_begin","Początek trasy"),TPL.lng("plan.route_end","Koniec trasy"),function(e){2==e&&(null==Plan.target&&(Plan.target={},Plan.target.node=$("<div class='target'><img src='assets/end_black.png' width='30' height='30'></div>")),Plan.target.current=t,Plan.target.planspot=Plan.landmarks[t].place.planspot_id,Plan.target.title=i+" ("+Plan.landmarks[t].place.place_id+")",$("#route_to span").html("<b>Do:</b> "+i+" ("+Plan.landmarks[t].place.place_id+")"),void 0!=Plan.origin.no&&($("#routebar").show(),Plan.routeBarVisibility(1))),1==e&&(null==Plan.origin&&(Plan.origin={}),Plan.origin.x=Plan.landmarks[t].place.x,Plan.origin.y=Plan.landmarks[t].place.y,Plan.origin.place=Plan.landmarks[t].place.place_id,Plan.origin.planspot=Plan.landmarks[t].place.planspot_id,Plan.origin.title=i+" ("+Plan.landmarks[t].place.place_id+")",Plan.origin.no=t,Plan.here=Plan.origin,Plan.refreshOrigin(),Plan.startFrom=Plan.landmarks[t].place.place_id,Floors.open()),0==e&&(mapInfo.toggleMenu(),player.go(Plan.landmarks[t].place.place_id,0)),Plan.refreshTarget(function(){0==Plan.target.routeLength&&Plan.landmarks[Plan.target.current].place.place_id!=player.ident&&Dialog.flash("<img src='/html5/assets/no_connection.png'>",TPL.lnd("plan.route_not_found","Nie znaleziono trasy."))})}),e.origin.stopPropagation()}},findNoByPlanspot:function(e){for(var t=0;t<Plan.landmarks.length;t++)if(Plan.landmarks[t].place.planspot_id==e)return t;return-1},setOriginById:function(e,t){null!=Plan.origin&&void 0!=Plan.origin&&null!=Plan.origin.node&&Plan.origin.node.remove(),Plan.origin={},Plan.origin.no=-1,Plan.origin.planspot=e,Plan.origin.title=t,Plan.refreshTarget(function(){})},setTargetById:function(e,t){null==Plan.target&&(Plan.target={},Plan.target.node=$("<div class='target'><img src='assets/end_black.png' width='30' height='30'></div>")),Plan.target.current=-1,Plan.target.planspot=e,Plan.target.title=t,Plan.refreshTarget(function(){})},refreshHere:function(){null==Plan.origin&&(Plan.origin={}),null!=Plan.here&&null!=Plan.here.x&&null!=Plan.here.y&&(Plan.origin.x=Plan.here.x,Plan.origin.y=Plan.here.y,Plan.origin.place=Plan.here.place,Plan.origin.planspot=Plan.here.planspot),Plan.refreshOrigin()},refreshOrigin:function(){void 0!=Plan.origin.planspot&&(null!=Plan.origin.node&&Plan.origin.node.remove(),-1==Plan.origin.no&&(Plan.origin.no=Plan.findNoByPlanspot(Plan.origin.planspot),-1!=Plan.origin.no?(Plan.origin.place=Plan.landmarks[Plan.origin.no].place.place_id,Plan.origin.x=Plan.landmarks[Plan.origin.no].place.x,Plan.origin.y=Plan.landmarks[Plan.origin.no].place.y,Plan.here=Plan.origin):Plan.here=null),Plan.origin.no>-1&&Plan.origin.no<Plan.landmarks.length&&Plan.landmarks[Plan.origin.no].place.planspot_id==Plan.origin.planspot&&(Plan.origin.node=$("<div class='start'><img src='assets/start_black.png' width='30' height='30'></div>"),Plan.origin.node.css("left",Plan.scale*Plan.origin.x-25+"px"),Plan.origin.node.css("top",Plan.scale*Plan.origin.y-25+"px"),$("#plan-points").append(Plan.origin.node),Plan.origin.node.on(Events.pointer.up,function(e){Plan.actionOrigin()})),$("#route_from span").html("<b>Od: </b>"+Plan.origin.title),void 0!=Plan.target&&void 0!=Plan.target.current&&($("#routebar").show(),Plan.routeBarVisibility(1)))},refresh:function(){$("#plan-points").html(""),$("#cons").css("width",$("#planfile").width()*Plan.scale),$("#cons").css("height",$("#planfile").height()*Plan.scale);for(var e=0;e<Plan.landmarks.length;e++){if(Plan.landmarks[e].place.place_id<=0){if(!(Plan.landmarks[e].place.plan_exit>0))continue;var t=$("<div class='pph' data-no='"+e+"'><div class='plan-point-exit' data-no='"+e+"'><img src='assets/floors.png' width='24' height='24'></div></div>")}else var t=$("<div class='pph' data-no='"+e+"'><div class='plan-point' data-no='"+e+"'></div></div>");t.css("transform","translate3d("+Plan.scale*Plan.landmarks[e].place.x+"px, "+Plan.scale*Plan.landmarks[e].place.y+"px, 0px)"),$("#plan-points").append(t),Plan.landmarks[e].node=t}$("#plan-points").show(),$("#cons").show(),Plan.refreshHere(),Plan.refreshTarget(null),Plan.refreshConnections()},connectionInfo:function(e,t){return void 0!=Plan.condata[e+"_"+t]?Plan.condata[e+"_"+t]:void 0!=Plan.condata[t+"_"+e]?Plan.condata[t+"_"+e]:null},isConnected:function(e,t){return Plan.connections[e]==t||Plan.connections[t]==e?!0:!1},setConnection:function(e,t){e=parseFloat(e),t=parseFloat(t),Plan.connections[e]=t,Plan.connections[t]=e},refreshConnections:function(){var e={},t={};Plan.connections={},Plan.connectors=[],$("#cons").empty();for(var i in Plan.landmarks)e[Plan.landmarks[i].place.place]=Plan.landmarks[i],t[Plan.landmarks[i].place.planspot_id]=Plan.landmarks[i],void 0!=Plan.landmarks[i].node&&Plan.landmarks[i].node.find(".plan-point").removeClass("plan-routed-point");for(var i in Plan.landmarks){var a=Plan.landmarks[i];for(var n in a.place.data.spots){var s,o,r=a.place.data.spots[n];if(e[r.ident]&&(s=e[r.ident].place.planspot_id),e[a.place.place]&&(o=e[a.place.place].place.planspot_id),void 0!=e[r.ident]&&!Plan.isConnected(s,o)){Plan.setConnection(s,o);var l=Plan.connectionInfo(s,o);Plan.drawConnection(t[s],t[o],l),void 0==Plan.route||null==Plan.route||Plan.route[s]!=o&&Plan.route[o]!=s||(t[s].node.find(".plan-point").addClass("plan-routed-point"),t[o].node.find(".plan-point").addClass("plan-routed-point"))}}}for(var p in Plan.condata){var l=Plan.condata[p];Plan.isConnected(l.spotA,l.spotB)||(Plan.setConnection(l.spotA,l.spotB),Plan.drawConnection(t[l.spotA],t[l.spotB],l),void 0!=Plan.route&&null!=Plan.route&&(Plan.route[l.spotA]==l.spotB||Plan.route[l.spotB]==l.spotA))}Plan.drawRoute(t)},drawRoute:function(e){var t="";if(void 0!=Plan.route&&null!=Plan.route){for(var i in Plan.routesA){var a=Plan.routesA[i],n=Plan.routesB[i];""!=t&&(t+=" "),void 0!=e[a]&&(t+=e[a].place.x*Plan.scale+","+e[a].place.y*Plan.scale),void 0!=e[n]&&(t+=" "+e[n].place.x*Plan.scale+","+e[n].place.y*Plan.scale)}line=document.createElementNS("http://www.w3.org/2000/svg","polyline"),line.setAttributeNS(null,"points",t),line.setAttributeNS(null,"style","fill:none;stroke:#00Cf00;stroke-width:7"),line.setAttributeNS(null,"stroke-linejoin","round"),$("#cons").append($(line))}},drawConnection:function(e,t,i){var a=document.createElementNS("http://www.w3.org/2000/svg","polyline");if(a.setAttributeNS(null,"points",e.place.x*Plan.scale+","+e.place.y*Plan.scale+" "+t.place.x*Plan.scale+","+t.place.y*Plan.scale),null!=i){if("1"==i.active)switch(i.type){case"P":a.setAttributeNS(null,"style","fill:none;stroke:#F6FF00;stroke-width:1");break;case"U":a.setAttributeNS(null,"style","fill:none;stroke:#F6FF00;stroke-width:1");break;default:a.setAttributeNS(null,"style","fill:none;stroke:#F6FF00;stroke-width:1")}}else a.setAttributeNS(null,"style","fill:none;stroke:#F6FF00;stroke-width:1");a.setAttributeNS(null,"stroke-dasharray","2,5"),$("#cons").append($(a))},centerTo:function(e,t){Plan.center.x=parseFloat(e)*Plan.scale,Plan.center.y=parseFloat(t)*Plan.scale,Plan.mapNode.resetTransform(),Plan.mapNode.translate(-(Plan.center.x-.5*Plan._width),-(Plan.center.x-.5*Plan._height),-1),Plan.mapNode.applyTransforms()},wheel:function(e){Plan.deltaZoom(3e-4*e.delta),void 0!=Plan.nowheel&&null!=Plan.nowheel&&clearTimeout(Plan.nowheel),Plan.nowheel=setTimeout(function(){Plan.deltaZoom(0),Plan.nowheel=null},100)},process:function(){if(Plan.mapNode.resetTransform(),Plan.mapNode.translate(.5*Plan._width,.5*Plan._height,0),Plan.mapImage.resetTransform(),Plan.mapImage.scale(Plan.scale,Plan.scale,1),Plan.mapImage.applyTransforms(),Plan.swipe.resizing||Plan.zooming){$("#plan-points").hide(),$("#cons").hide();var e=Plan.scale;Plan.swipe.resizing?Plan.scale+=Plan.swipe.dist*(.006*Plan.scale):0!=Plan.deltaScale?Plan.scale+=Plan.deltaScale:Plan.scale=Plan.newScale,Plan.scale>2&&(Plan.scale=2),Plan.scale<.2&&(Plan.scale=.2),Plan.mapImage.resetTransform(),Plan.mapImage.scale(Plan.scale,Plan.scale,1),Plan.mapImage.applyTransforms(),Plan.center.x+=(Plan.imageWidth*Plan.scale-Plan.imageWidth*e)*(Plan.center.x/(Plan.imageWidth*e)),Plan.center.y+=(Plan.imageHeight*Plan.scale-Plan.imageHeight*e)*(Plan.center.y/(Plan.imageHeight*e)),null!=Plan.repaint&&clearTimeout(Plan.repaint),Plan.repaint=setTimeout(function(){Plan.refresh()},100)}else{Plan.center.x+=10*Plan.swipe.inertiaX(),Plan.center.y-=15*Plan.swipe.inertiaY();var t={};t.left=Plan.center.x-.5*Plan._width,t.right=Plan.center.x+.5*Plan._width,t.top=Plan.center.y-.5*Plan._height,t.bottom=Plan.center.y+.5*Plan._height,Plan.imageWidth*Plan.scale>=Plan._width?t.right>Plan.imageWidth*Plan.scale+150?Plan.center.x=Plan.imageWidth*Plan.scale-.5*player._width+150:t.left<-150&&(Plan.center.x=.5*player._width-150):Plan.center.x=Plan.imageWidth*Plan.scale*.5,Plan.imageHeight*Plan.scale>=Plan._height?t.bottom>Plan.imageHeight*Plan.scale+150?Plan.center.y=Plan.imageHeight*Plan.scale-.5*player._height+150:t.top<-150&&(Plan.center.y=.5*player._height-150):Plan.center.y=Plan.imageHeight*Plan.scale*.5}Plan.mapNode.translate(-Plan.center.x,-Plan.center.y,0),Plan.mapNode.applyTransforms()},hide:function(){$("#mapcontent").html("")},goOrigin:function(){var e=[];if(Plan.origin){for(var t in Plan.routesA)m=Plan.routesA[t],e.push(m);m=Plan.routesB[t],e.push(m),Autopilot.setRoute(e),Autopilot.start()}},placeReady:function(e){ssi("Plan","load",{place:player.ident},function(e){if(void 0!=e.data.plan_id)if(Plan.loadLandmarks(e.data),void 0!=Plan.planData.planspot_id){Plan.here.x=Plan.planData.x,Plan.here.y=Plan.planData.y,Plan.here.place=Plan.planData.place,Plan.here.planspot=Plan.planData.planspot_id;var t=player.current.place_name;""==t&&(t="Panorama nr. "),Plan.here.title=t+" "+player.ident,Plan.origin=Plan.here}else Plan.here={}}),Plan.refreshTarget(null),Plan.refreshHotSpots()},refreshHotSpots:function(){var e={},t={};for(var i in Plan.landmarks)e[Plan.landmarks[i].place.place]=Plan.landmarks[i],t[Plan.landmarks[i].place.planspot_id]=Plan.landmarks[i];for(var a in HotSpotManager.spots){var n=HotSpotManager.spots[a];if("default"==n.tag){var s=n.properties.ident;if(n.removeHelper(),n.node.find(".mark_direction").remove(),void 0!=Plan.route){var o=null,r=null;for(var l in Plan.routesA){if(Plan.routePlaces[Plan.routesA[l]]==player.ident){for(;-1==Plan.routePlaces[Plan.routesB[l]];)l++;Plan.routePlaces[Plan.routesB[l]]==s&&(o=l,n.node.find(".mark_direction").remove(),n.node.append("<img src='/html5/assets/route_spot.png' class='mark_direction'>"),n.addHelper($("<a href='javascript:void(null);' on"+Events.pointer.up+"='player.currentView.turnTo("+n.lookAtCoords().x+","+n.lookAtCoords().y+")'><img src='/html5/assets/mark_left.png'></a>"),$("<a href='javascript:void(null);' on"+Events.pointer.up+"='player.currentView.turnTo("+n.lookAtCoords().x+","+n.lookAtCoords().y+")'><img src='/html5/assets/mark_right.png'></a>")))}r=l}}else n.node.find(".mark_direction").remove(),n.removeHelper()}}void 0!=e[player.ident]&&void 0!=Plan.routesB&&Plan.routesB[Plan.routesB.length-1]==e[player.ident].place.planspot_id&&(Dialog.message("",TPL.lng("plan.target_reached","<span class='high'>DOTARŁEŚ</span> do miejsca przeznaczenia")+"<br>",TPL.lng("plan.close","Zamknij")),Plan.actionTarget())},actionTarget:function(){Plan.target.node.remove(),Plan.target=null,Plan.route=null,$("#route_to span").html("<b>Do: </b>"),$("#routebar").hide(),Plan.routeBarVisibility(0),Plan.refresh()},actionHere:function(){$(".plan-point").addClass("blinking")},actionOrigin:function(){var e="<b>"+Plan.landmarks[Plan.here.no].place.place_name+"(Panorama nr. "+Plan.here.place+")</b>";Dialog.flash("<div class='start_icon'><img src='/html5/assets/start_black.png' width='30' height='30'></div>",{message:"Twoja pozycja:<br> "+e,help:"<hr size='1'><i>Kliknij na któryś z punktów na mapie aby wyznaczyć nową pozycję.</i>"}),$(".plan-point").removeClass("stretching"),setTimeout(function(){$(".plan-point").addClass("stretching")},50)},routeBarVisibility:function(e){e?($("#route_go_bar").css("opacity","1"),$("#route_go_bar").css("bottom","0")):($("#route_go_bar").css("opacity","0"),$("#route_go_bar").css("bottom","35"))},checkDoubleTap:function(){Plan.swipe.doubleTap&&(Plan.zooming=!0,Plan.dtaptween=new Tween(function(e){Plan.newScale=e},function(){Plan.zooming=!1,Plan.refresh()}),Plan.dtaptween.start(Plan.scale,Plan.scale+1,1e3,"easeInOutQuad"))},deltaZoom:function(e){0!=e?(Plan.deltaScale=e,Plan.zooming=!0):(Plan.deltaScale=0,Plan.zooming=!1,Plan.refresh())}};PluginManager.add(Plan);var PlanTarget={firstMark:!0,mark:function(e,t){void 0!=PlanTarget.node&&PlanTarget.node.remove(),PlanTarget.node=$("<img src='assets/crosshair.png' id='crosshair'>"),$("#plan-points").append(PlanTarget.node),PlanTarget.node.css("left",e*Plan.scale-32+"px"),PlanTarget.node.css("top",t*Plan.scale-32+"px")}},QuestManager={view:null,widget:null,isOpen:!1,couting:null,quests:[],init:function(){AppEvent.on(player,"PLACE.LOADED",QuestManager.placeLoaded),this.sounds={complete:new AudioEffect("assets/audio/games/completed.mp3")},this.player=Date.now()+"-"+Math.floor(1e4*Math.random()),setInterval(function(){QuestManager.widgetTick()},1e3)},placeLoaded:function(){var e=player.current;e.quests.length>0&&e.quests[0].startsAt==player.ident&&-1==QuestManager.findQuestById(e.quests[0].id)&&QuestManager.viewQuest(e.quests[0])},load:function(e){$.getJSON("/html5/questloader.php?id="+e).then(function(e){QuestManager.viewQuest(e)})},closeViewQuest:function(){QuestManager.view.remove()},viewQuest:function(e){QuestManager.quest=e;var t={},i=QuestManager.findQuestById(e.id);return-1!=i&&(t=e,e=QuestManager.quests[i],void 0!=e.done)?void QuestManager.complete(e):(QuestManager.view=$(TPL.render("quest-main",{"short":e["short"],title:e.name,info:e.info,help:e.help})),$("#panels").append(QuestManager.view),SpeechManager.enableSpeech(".quest",".speaks",0,"TOPMENU"),-1!=i&&(QuestManager.view.find(".qproceed").hide(),QuestManager.view.find(".qrestart").show()),QuestManager.view.find(".qclose").click(function(){QuestManager.closeViewQuest()}),QuestManager.view.find(".qrestart").click(function(){Equipment.resetQuestItems(e),ItemState.resetStates(e),QuestManager.quests.splice(i,1),QuestManager.quests.push(t),QuestManager.closeViewQuest(),QuestManager.showWidget(),HotSpotManager.clearRenderables(),HotSpotManager.addRenderables(player.currentView.properties.collectibles,"collectible")}),QuestManager.view.find(".qproceed").click(function(){-1==i&&(QuestManager.quests.push(e),QuestManager.closeViewQuest(),QuestManager.showWidget(),HotSpotManager.clearRenderables(),HotSpotManager.addRenderables(player.currentView.properties.collectibles,"collectible"))}),void QuestManager.view.show())},showWidget:function(){var e="",t=0;for(var i in QuestManager.quests){var a=QuestManager.quests[i];void 0==a.done&&(a.collected=0,a.total=parseInt(a.total),a.startedAt=new Date,a.time="00:00:00",e+="<div id='quest-"+a.id+"'>"+TPL.render("quest-short",{no:parseInt(i)+1,quest:a})+"</div>",t++)}void 0!=QuestManager.widget&&QuestManager.widget.remove(),t>0&&(QuestManager.widget=$(TPL.render("quest-widget",{count:t,pending:e})),$("#panels").append(QuestManager.widget))},findQuestById:function(e){for(var t in QuestManager.quests)if(QuestManager.quests[t].id==e)return t;return-1},widgetTick:function(){for(var e in QuestManager.quests)"1"==QuestManager.quests[e].tracktime&&QuestManager.refreshQuest(e)},action:function(e,t){var i=QuestManager.findQuestById(t.collection_id);return"collected"==e&&"pickup.items"==QuestManager.quests[i].logic?(QuestManager.quests[i].collected++,QuestManager.quests[i].collected>=parseInt(QuestManager.quests[i].tocollect)&&QuestManager.complete(QuestManager.quests[i]),QuestManager.refreshQuest(i),!1):("delivered"==e&&"deliver.items"==QuestManager.quests[i].logic&&(QuestManager.quests[i].collected++,QuestManager.quests[i].collected>=parseInt(QuestManager.quests[i].tocollect)&&QuestManager.complete(QuestManager.quests[i]),QuestManager.refreshQuest(i)),!0)},complete:function(e){if(void 0==e.done){var t=new Date;e.timespent=Math.round(.001*(t.getTime()-e.startedAt.getTime())),e.points=1}e.done=!0,QuestManager.showWidget(),QuestManager.victory=$(TPL.render("quest-victory",{quest:e})),QuestManager.sounds.complete.play(),$("#panels").append(QuestManager.victory),e.saved&&$(".quest-victory .vsaverank").hide(),QuestManager.victory.find(".vclose").click(function(){QuestManager.victory.remove()}),QuestManager.victory.find(".vsaverank").click(function(){QuestManager.savenick(e)}),QuestManager.victory.find(".vranking").click(function(){QuestManager.showranking(e)})},savenick:function(e){QuestManager.saverank=$(TPL.render("quest-saverank",{quest:e})),$("#panels").append(QuestManager.saverank),$("#quest-nick").on("keydown",function(){$("#quest-nick").removeClass("error")}),$("#quest-email").on("keydown",function(){$("#quest-email").removeClass("error")}),QuestManager.saverank.find(".vsaverank").click(function(){var t=$("#quest-nick").val(),i=$("#quest-email").val(),a=QuestManager.player;$("#quest-nick").removeClass("error"),$("#quest-email").removeClass("error"),ssi("Quest","addToRanking",{quest_id:e.id,ident:a,nick:t,email:i,points:e.points,time:e.timespent},function(t){"invalid"==t.data.status?(void 0!=t.data.errors.nick&&$("#quest-nick").addClass("error"),void 0!=t.data.errors.email&&($("#quest-email").addClass("error"),setTimeout(function(){$("#quest-nick").removeClass("error")},2e3))):(e.saved=!0,QuestManager.saverank.remove(),$(".quest-victory .vsaverank").hide())})}),QuestManager.saverank.find(".vclose").click(function(){QuestManager.saverank.remove()})},showranking:function(e){QuestManager.ranking=$(TPL.render("quest-ranking",{quest:e})),$("#panels").append(QuestManager.ranking),ssi("Quest","info",{id:e.id},function(e){var t="<tr><th>#</th><th>Nick</th><th>Czas</th></tr>";for(var i in e.data.ranking){var a=e.data.ranking[i],n=parseInt(a.time),s=this.ddigit(Math.floor(n/3600))+":"+this.ddigit(Math.floor(n/60))+":"+this.ddigit(n%60);t+="<tr>",t+="<td>"+(parseInt(i)+1)+"</td>",t+="<td>"+a.nick+"</td>",t+="<td>"+s+"</td>",t+="</tr>"}$("#quest-ranks").html(t)}.bind(this)),QuestManager.ranking.find(".vclose").click(function(){QuestManager.ranking.remove()})},ddigit:function(e){return 10>e?"0"+e:e},refreshQuest:function(e){var t=new Date,i=QuestManager.quests[e];if(void 0==i.done){var a=Math.round(.001*(t.getTime()-i.startedAt.getTime()));i.time=this.ddigit(Math.floor(a/3600))+":"+this.ddigit(Math.floor(a/60))+":"+this.ddigit(a%60)}$("#quest-"+i.id).html(TPL.render("quest-short",{no:parseInt(e)+1,quest:i}))},placeReady:function(e){}};PluginManager.add(QuestManager);var Search={node:null,lateCall:null,init:function(){Search.node=$("<div id='search'></div>"),Search.node.append(TPL.render("search-main",{pointer_up:"on"+Events.pointer.up,routing:PROJECT.settings["search/routing"]})),$("#panels").append(Search.node),$("#search_box input").on("focus",Search.focusInput),$("#search_box input").on("blur",Search.blurInput),$("#search_box input").on("keyup",Search.typing),Search.button=$("<div id='search_icon'  class='bottombar'><img src='assets/search.png' width='32' height='32'></div><span id='search_tip' class='bottombar bbar_label'>"+TPL.lng("search.icon_title","SZUKAJ")+"</span>"),$("#overlay").append(Search.button),Search.button.on(Events.pointer.down,function(e){Search.open(),SpeechManager.speakTip("PLAYER.SEARCH","TIPS")}),SpeechManager.prepareTip("PLAYER.SEARCH","TIPS")},focusInput:function(){$(".searchbar").addClass("focused")},blurInput:function(){$(".searchbar").removeClass("focused")},openAndFind:function(e){$("#search_box input").val(e),Search.open()},open:function(){$("#search").show(),$("#tsrchbtn").addClass("active"),setTimeout(function(){$("#search_box input").focus()},100),Search.fillResults(),setTimeout(function(){$("#search").css("transform","translate(0px, 0px)");
},100),Tab.cancelStackAdd("search-sidebar",Search.close)},close:function(){Tab.cancelStackRemove("search-sidebar"),$("#search").css("transform","translate(-500px, 0px)"),$("#tsrchbtn").removeClass("active"),setTimeout(function(){$("#search").hide()},1e3)},setStart:function(e,t,i,a){null!=Plan.target&&Plan.target.planspot==t&&($("#search_result_box .row a").removeClass("ito"),Plan.actionTarget()),Search.startPlan=i,$("#search_result_box .row a").removeClass("ifrom"),$(e.target).addClass("ifrom"),Plan.setOriginById(t,a),Search.navMenu()},setEnd:function(e,t,i,a){Search.endPlan=i,(null==Plan.target||Plan.origin.planspot!=t)&&($("#search_result_box .row a").removeClass("ito"),null!=Plan.target&&Plan.target.planspot==t?Plan.actionTarget():($(e.target).addClass("ito"),Plan.setTargetById(t,a)),Search.navMenu())},fillResults:function(){$("#search_result_box").html("<div class='loader'><img src='assets/loading-bubbles.svg'></div>"),""==$("#search_box input").val()?($("#search_result_box").hide(),$("#search_help_box").show()):($("#search_result_box").show(),$("#search_help_box").hide()),Search.navMenu();var e="city";$("#search_filter_all").prop("checked")&&(e="all"),ssi("Search","results",{place:player.ident,scope:e,words:$("#search_box input").val()},function(e){$("#search_result_box").html("");for(var t={},i=0;i<e.data.length;i++)t.title=e.data[i].title,t.id=e.data[i].id,t.target=e.data[i].planspot,t.plan=e.data[i].plan,t.location=e.data[i].loc_name,t.level=e.data[i].level,player.offline?t.thumb="data/thumb_"+e.data[i].id+".jpg":t.thumb=e.data[i].thumb,t.body=e.data[i].body,t.extra=void 0!=e.data[i].content&&""!=e.data[i].content?e.data[i].content:"",t.look_x=null!=e.data[i].look_x&&""!=e.data[i].look_x?e.data[i].look_x:"0",t.look_y=null!=e.data[i].look_y&&""!=e.data[i].look_y?e.data[i].look_y:"0",t.classfrom="",t.classto="",null!=Plan.origin&&Plan.origin.planspot==t.target&&(t.classfrom="ifrom"),null!=Plan.target&&Plan.target.planspot==t.target&&(t.classto="ito"),player.ident==e.data[i].id?t.current=1:t.current=0,t.pointer_up="on"+Events.pointer.up,t.up="on"+Events.pointer.up,t.down="on"+Events.pointer.down,t.move="on"+Events.pointer.move,""==t.title&&(t.title="ID: "+e.data[i].id),t.routing=PROJECT.settings["search/routing"],console.log(t),$("#search_result_box").append(TPL.render("search-row",t));0==e.data.length?$("#search_result_box").html("Nie znaleziono żadnych pasujących miejsc."):$("#search_result_box .row").each(function(e){var t=$(this),i=t.find(".title").height();t.css("height",i+30+"px"),t.find(".icons").css("top",.5*i-5+"px")}),ScrollBar.update("#search_result_box")})},navMenu:function(){null!=Plan.origin&&Plan.origin.planspot>0&&null!=Plan.target&&Plan.target.planspot>0&&Plan.origin.planspot!=Plan.target.planspot?($("#search .buttons").show(),$("#search_result_box").css("bottom","57px")):($("#search .buttons").hide(),$("#search_result_box").css("bottom","0px"))},typing:function(e){null!=Search.lateCall&&clearTimeout(Search.lateCall),13==e.keyCode?(Search.lateCall=null,Search.fillResults(),$("#search_box input").blur()):Search.lateCall=setTimeout(Search.fillResults,400)},up:function(e,t,i){Search.mcnt<=1&&(Search.close(),void 0!=t&&void 0==i?player.go(e,t):void 0!=t&&void 0!=i?player.go(e,t+","+i):player.go(e,"0"))},down:function(){Search.isDown=!0,Search.mcnt=0},move:function(){Search.isDown&&Search.mcnt++},goRoute:function(){Search.close(),Plan.goOrigin()},goMap:function(){Search.close(),mapInfo.showWindow(),Floors.load(Search.startPlan)}};PluginManager.add(Search);var Share={node:null,isOpen:!1,init:function(){var e=window.location.href,t=document.getElementsByTagName("title")[0].innerHTML;Share.node=$(TPL.render("share-main",{url:e,title:t})),$("#overlay").append(this.node),Share.icon=Menu.prepIcon("fas fa-share-alt",TPL.lng("tips.share","Udostępnij"),"HTML5.tips.share",{sub:0,subsel:".items",itemsel:"a",toggle:Share.toggle,node:this.node}),AppEvent.on(player,"MENU.REBUILD",function(){Share.icon.children("a").on("click",Share.toggle)})},toggle:function(){Share.isOpen=!Share.isOpen,Share.isOpen?(Share.node.show(),setTimeout(function(){$("body").one("click",Share.clickOut)},200)):Share.node.hide()},clickOut:function(){Share.isOpen&&(Share.node.hide(),Share.isOpen=!1)},placeReady:function(e){}};PluginManager.add(Share);var Quiz={node:null,current:null,init:function(){Quiz.bootstrap()},bootstrap:function(){Quiz.node=$("<div id='quiz' class='quiz-main'><qwin ref='qwin'></qwin><questwin ref='questwin'></questwin></div>"),$("#panels").append(Quiz.node),Vue.component("qwin",Quiz.qwin),Vue.component("questwin",Quiz.questwin),Quiz.vue=new Vue({el:"#quiz"})},open:function(e){Quiz.vue.$refs.qwin.open(e)},quest:function(e,t,i){var a=void 0==Quiz.notfirst?"1":"";Quiz.vue.$refs.questwin.open(e,t,i,a),Quiz.notfirst=1},placeReady:function(e){},process:function(){},ssi:function(e,t,i,a){var n={};n.className=e,n.methodName=t;for(var s in i)n["parameters!"+s]=i[s];$.ajax({type:"POST",url:"/gatewayManager.php?result=json",dataType:"json",data:n}).done(function(e){a(e)})}};PluginManager.add(Quiz),Quiz.questwin={props:["value"],data:function(){return{visible:!1,bg:"",glyph:"",state:"summary",title:"",rules:"",ranks:[],id:"",reg_text:"",reg_link:"",has_reg:!1,info:{},question:"",qphoto:"",qphotoformat:"",qcurrent:0,qtotal:0,answers:[],shownextbutton:!1,correct:0,answered:0,winmsg:"",winicon:"",cansave:!1,totalTime:"",rank:{},result:"",nickname:"",nicknameerror:!1,time:"",hasTitle:!1,big:""}},mounted:function(){},methods:{open:function(e,t,i,a){var n=this;this.state="question",this.opener=i,this.shownextbutton=!1,this.glyph=t,this.id=e,this.hasTitle=!1,this.visible=!0,ssi("quiz","anyQuestion",{id:this.id,first:void 0!=a?a:""},function(e){if(n.gqid=e.data.gqid,n.question=e.data.question,n.qcurrent=e.data.question_number,n.qtotal=e.data.total_questions,n.answers=[],""!=e.data.answer1&&n.answers.push({text:e.data.answer1,s:"A"}),""!=e.data.answer2&&n.answers.push({text:e.data.answer2,s:"B"}),""!=e.data.answer3&&n.answers.push({text:e.data.answer3,s:"C"}),""!=e.data.answer4&&n.answers.push({text:e.data.answer4,s:"D"}),""!=e.data.answer5&&n.answers.push({text:e.data.answer5,s:"E"}),""!=e.data.photo&&null!=e.data.photo){n.qphoto="/storage/quiz/"+e.data.photo;var t=e.data.photo.length;$("#quiz-video").html(""),"mp4"==e.data.photo.substring(t-3)?(n.qphotoformat="mp4",this.media=new vplayer,this.media.style("",{backgroundColor:"#ffffff"}),this.media.load(n.qphoto),this.media.setLoop(!0),this.media.showControls(!1),setTimeout(function(){$("#quiz-video").append(this.media.embed()),this.media.playButton(null)}.bind(this),150)):n.qphotoformat="image"}else n.qphoto=""})},answer:function(e){var t=this;ssi("quiz","checkAnswer",{id:this.id,question:t.gqid,answer:e},function(i){t.correct="true"==i.data.correct?!0:!1,t.answered=e,t.shownextbutton=!0,setTimeout(function(){this.close(),this.opener(t.correct)}.bind(this),300)}.bind(this))},close:function(){this.visible=!1}},watch:{},template:"#tpl-questwin"},Quiz.qwin={props:["value"],data:function(){return{visible:!1,bg:"",state:"summary",title:"",rules:"",ranks:[],id:"",reg_text:"",reg_link:"",has_reg:!1,info:{},question:"",qphoto:"",qcurrent:0,qtotal:0,answers:[],shownextbutton:!1,correct:0,answered:0,winmsg:"",winicon:"",cansave:!1,totalTime:"",rank:{},result:"",nickname:"",nicknameerror:!1,time:"",hasTitle:!1,big:""}},mounted:function(){SpeechManager.prepareTip("PLAYER.QUIZ.RANKINGS","TIPS"),SpeechManager.prepareTip("PLAYER.QUIZ.START","TIPS"),SpeechManager.prepareTip("PLAYER.QUIZ.NEW","TIPS"),SpeechManager.prepareTip("PLAYER.QUIZ.NEXT","TIPS"),SpeechManager.prepareTip("PLAYER.QUIZ.SAVE","TIPS"),SpeechManager.prepareTip("PLAYER.QUIZ.BACK","TIPS"),SpeechManager.prepareTip("PLAYER.QUIZ.A","TIPS"),SpeechManager.prepareTip("PLAYER.QUIZ.B","TIPS"),SpeechManager.prepareTip("PLAYER.QUIZ.C","TIPS"),SpeechManager.prepareTip("PLAYER.QUIZ.D","TIPS")},methods:{open:function(e){var t=this;this.state="summary",this.id=e,this.hasTitle=!1,ssi("quiz","info",{id:e},function(e){t.title=e.data.game.title,t.info=e.data.game,t.rules=e.data.game.rules.replace(/\n/g,"<br>"),t.bg="/storage/quiz/"+e.data.game.background,t.visible=!0,t.reg_text=e.data.game.reg_text,t.reg_link=e.data.game.reg_link,(""!=t.reg_text&&void 0!=t.reg_text||""!=t.reg_link&&void 0!=t.reg_link)&&(t.has_reg=!0)})},reset:function(){this.state="summary",this.hasTitle=!1},startQuiz:function(){var e=this;this.hasTitle=!0,ssi("quiz","info",{id:this.id},function(t){e.start=new Date,e.info=t.data.game,void 0!=e.timer&&(clearInterval(e.timer),e.timer=void 0),e.timer=setInterval(function(){e.tick()},500),e.getNextQuestion()})},stopQuiz:function(){void 0!=this.timer&&(clearInterval(this.timer),this.timer=void 0),this.time=""},tick:function(){var e=new Date,t=.001*(e-this.start),i=Math.floor(t/60),a=Math.round(t%60);this.time=i+":"+a},getNextQuestion:function(){this.state="question";var e=this;e.shownextbutton=!1,ssi("quiz","nextQuestion",{id:this.id},function(t){console.log(t.data),void 0!=t.data.finished?e.results():(e.question=t.data.question,e.qcurrent=t.data.question_number,e.qtotal=t.data.total_questions,e.answers=[],""!=t.data.answer1&&e.answers.push({text:t.data.answer1,s:"A"}),""!=t.data.answer2&&e.answers.push({text:t.data.answer2,s:"B"}),""!=t.data.answer3&&e.answers.push({text:t.data.answer3,s:"C"}),""!=t.data.answer4&&e.answers.push({text:t.data.answer4,s:"D"}),""!=t.data.answer5&&e.answers.push({text:t.data.answer5,s:"E"}),""!=t.data.photo&&null!=t.data.photo?e.qphoto="/storage/quiz/"+t.data.photo:e.qphoto="")})},answer:function(e){var t=this;ssi("quiz","answer",{id:this.id,no:e},function(i){t.correct=i.data.right_answer,t.answered=e,t.shownextbutton=!0})},getBadge:function(e,t){var i="",a="",n=!1,s="";return e==t?(i="/storage/quiz/"+this.info.gold,a="/storage/quiz/"+this.info.b_gold,n=!0,s=this.info.config.result100):e/t>=.85?(i="/storage/quiz/"+this.info.silver,a="/storage/quiz/"+this.info.b_silver,n=!0,s=this.info.config.result85):e/t>=.75?(i="/storage/quiz/"+this.info.bronze,a="/storage/quiz/"+this.info.b_bronze,n=!0,s=this.info.config.result75):e/t>=.5?(i="",n=!0,s=this.info.config.result50):.5>e/t&&(i="",s=this.info.config.result0),{big:a,winicon:i,cansave:n,winmsg:s}},results:function(){this.state="results";var e=this;this.hasTitle=!0,e.cansave=!1,this.stopQuiz(),ssi("quiz","results",{},function(t){var i=t.data,a=t.data.time;e.totalTime=Math.floor(a/60)+" min i "+a%60+" sek",e.rank=i,e.winicon="",e.result=Math.round(i.good/i.total*100);var n=e.getBadge(i.good,i.total);e.winicon=n.winicon,e.cansave=n.cansave,e.winmsg=n.winmsg})},saveresults:function(){this.state="saveresults",this.nicknameerror=!1},save:function(){var e=this;""!=this.nickname?ssi("quiz","addToRanking",{nick:this.nickname},function(t){e.reset()}):this.nicknameerror=!0},rankings:function(){this.state="rankings";var e=this;ssi("quiz","info",{id:this.id},function(t){e.ranks=t.data.ranking;for(var i in e.ranks)b=e.getBadge(e.ranks[i].good,e.ranks[i].total),e.ranks[i].badge=b.winicon,e.ranks[i].big=b.big})},showBig:function(e){this.big=e,this.state="big"},reg:function(){this.state="reg"},close:function(){this.visible=!1,this.stopQuiz()}},watch:{},template:"#tpl-qwin"};var Cms={node:null,current:null,vue:null,init:function(){player.cms&&(AppEvent.on(player,"placeReady",Cms.placeReady),$("#ui").append($("<cms ref='cms'></cms>")),$("#ui").append($("<popup ref='popup'></popup>")),player.cmsnode=$("<div class='cms'></div>"),$("#ui").append(player.cmsnode),$("#player").on("mousedown",function(e){3==e.which?Cms.vue.$refs.popup.open(e.clientX,e.clientY):Cms.vue.$refs.cms.$refs.panoedit.open()}),document.addEventListener("contextmenu",function(e){e.preventDefault()}))},placeReady:function(){Cms.vue.$refs.cms.$refs.panoedit.open()},afterInit:function(){player.cms&&(Cms.saveButton=$("<a href='javascript:void(null);' onclick='Cms.save();'><i class='fa fa-save'></i><Br>Zapisz</a>"),player.cmsnode.append(Cms.saveButton),Cms.vue=new Vue({el:"#ui"}),Cms.root=Cms.vue.$refs.cms)},save:function(){var e=[];for(var t in ElementManager.elements){var i=ElementManager.elements[t];if(void 0==i.place||null==i.place||i.place==player.ident){var a={type:i.type,group:i.group,group_id:i.group_id,folder_wide:i.folderwide,x:i.hpos(),y:i.vpos(),params:JSON.stringify(i.params),uid:i.uid};void 0!=i.id&&(a.id=i.id),e.push(a)}}$.post("/cms/index.php?mod=Panorama&action=syncElements&pano="+player.ident,{elements:e},function(e){for(var t in ElementManager.elements){var i=ElementManager.elements[t];void 0!=e.created&&void 0==i.id&&void 0!=e.created[i.uid]&&(i.id=e.created[i.uid].id)}alert("Zapisano zmiany")})}};PluginManager.add(Cms);var SpotEdit={node:null,current:null,init:function(){SpotEdit.node=$("<div id='SpotEditor' class='cms-editor'></div>"),player.cms&&(SpotEdit.node.append(TPL.render("spot-edit-main",{})),$("#overlay").append(SpotEdit.node),AppEvent.on(player,"placeReady",SpotEdit.placeReady),AppEvent.on(player,"onProcess",SpotEdit.process),SpotEdit.addPlateButton=$("<a href='javascript:void(null);' onclick='SpotEdit.add();'><i class='fa fa-sign'></i><Br>Dodaj tabliczkę</a>"),player.cmsnode.append(SpotEdit.addPlateButton))},add:function(){var e=HotSpotManager.spots.length+1,t=Math.round(100*(player.currentView.renderer.rx-86))/100,i=-1*Math.tan(Math.round(100*player.currentView.renderer.ry)/-100*(Math.PI/180))*1500,a=new panoramaHotSpot({ident:"",spot:"1",x:t,y:i,place:{type:"indicator",place_name:""}},e,0);$("#se_x").val(t),$("#se_y").val(i),a.indicator={look_x:t,look_y:i,title:"Brak danych",no:"",title2:"Wprowadź dane",info:""},a.addHelper($("<a href='javascript:void(null);' on"+Events.pointer.up+"='player.currentView.fastTurnTo("+a.lookAtCoords().x+","+a.lookAtCoords().y+")' class='indicator_left ind_title'>"+a.indicator.title+"<br><small class='ind_title2'>"+a.indicator.title2+"</small><div class='arrow'></div></a>"),$("<a href='javascript:void(null);' on"+Events.pointer.up+"='player.currentView.fastTurnTo("+a.lookAtCoords().x+","+a.lookAtCoords().y+")' class='indicator_right ind_title'>"+a.indicator.title+"<br><small class='ind_title2'>"+a.indicator.title2+"</small><div class='arrow'></div></a>")),a.helperWidth=120,a.tag="indicator",a.node.html("<div class='indicator_plate indtoggle'><div class='plate'><b class='ind_title'>"+a.indicator.title+"</b><Br><span class='ind_title2'>"+a.indicator.title2+"</span></div><a href='javascript:void(null);' class='more'><i class='fa fa-angle-down'></i></a><div class='panel'></div></div>"),player.cms&&a.editor.addUI(),a.node.find(".indtoggle").on("click",function(){var e=$(this).find(".more");e.toggleClass("more_flipped"),e.parent().find(".panel").toggleClass("panel_open")}),a.node.find(".indtoggle .more").hide(),HotSpotManager.add(a),SpotEdit.select(a.editor)},select:function(e){$("#SpotEditor").removeClass("open"),setTimeout(function(){void 0!=e.hs.indicator&&$("#SpotEditor").addClass("open")},100),SpotEdit.current!==e&&(null!=SpotEdit.current&&SpotEdit.current.hs.node.find(".indicator_selected").hide(),SpotEdit.current=e,e.hs.node.find(".indicator_selected").show(),void 0!=e.hs.indicator?($("#se_title").val(e.hs.indicator.title),$("#se_no").val(e.hs.indicator.no),$("#se_title2").val(e.hs.indicator.title2),$("#se_info").val(e.hs.indicator.info),$("#se_x").val(e.hs.indicator.look_x),$("#se_y").val(e.hs.indicator.look_y)):e.hs.node3D?Cms.root.$refs.spotedit.open(SpotEdit.current):Cms.root.$refs.spotedit2d.open(SpotEdit.current))},updateCoords:function(e,t){$("#se_x").val(e),$("#se_y").val(t),void 0!=SpotEdit.current.hs.indicator&&(SpotEdit.current.hs.indicator.look_x=e,SpotEdit.current.hs.indicator.look_y=t)},updateContent:function(e,t,i,a){SpotEdit.current.hs.indicator.title=e,SpotEdit.current.hs.indicator.no=t,SpotEdit.current.hs.indicator.title2=i,SpotEdit.current.hs.indicator.info=a,SpotEdit.current.hs.node.find(".ind_title").html(e+" "+t),SpotEdit.current.hs.node.find(".ind_title2").html(i),SpotEdit.current.hs.node.find(".panel").html(a.replace(new RegExp("\n","g"),"<br>")),""!=a?SpotEdit.current.hs.node.find(".more").show():SpotEdit.current.hs.node.find(".more").hide()},save:function(){var e={};e.look_x=parseFloat($("#se_x").val())-parseFloat(player.current.properties.north)+95,e.look_y=$("#se_y").val(),e.title=$("#se_title").val(),e.no=$("#se_no").val(),e.title2=$("#se_title2").val(),e.info=$("#se_info").val(),e.place_id=player.ident,e.id=SpotEdit.current.hs.indicator.id,SpotEdit.updateContent(e.title,e.no,e.title2,e.info),$.post("/cms/index.php?mod=Panorama&action=addIndicator&ajax=1&pano="+player.ident,e,function(t){(void 0==e.id||null==e.id)&&(e.id=t.indicator.id,SpotEdit.current.hs.indicator.id=t.indicator.id)})},remove:function(){confirm("Czy na pewno chcesz usunąć tą tabliczkę ?")&&(SpotEdit.current.hs.remove(),$("#SpotEditor").removeClass("open"),void 0!=SpotEdit.current.hs.indicator.id&&null!=SpotEdit.current.hs.indicator.id&&SpotEdit.current.hs.indicator.id>0&&$.get("/cms/index.php?mod=Panorama&action=removeind&ajax=1&pano="+player.ident+"&id="+SpotEdit.current.hs.indicator.id,function(e){console.log(e)}))},placeReady:function(e){},process:function(){}};PluginManager.add(SpotEdit);var UIEdit={node:null,current:null,init:function(){UIEdit.node=$("<div id='UiEditor' class='cms-editor'></div>"),player.cms&&(UIEdit.node.append(TPL.render("uielement-edit-main",{})),$("#overlay").append(UIEdit.node),UIEdit.addUIElementButton=$("<a href='javascript:void(null);' onclick='UIEdit.openSelectMenu();'><i class='fa fa-edit'></i><Br>Dodaj element</a>"),player.cmsnode.prepend(UIEdit.addUIElementButton))},openSelectMenu:function(){UIEdit.addUIElementButton.addClass("selected"),Cms.root.$refs.selectcomponent.open()},add:function(e,t){var i=(HotSpotManager.spots.length+1,new UIElement(.5*$("#player").width(),.5*$("#player").height()));void 0!=e&&(i.type=e,i.build(t)),ElementManager.add(i),player.cms&&i.editor.addUI(),UIEdit.select(i.editor)},deselect:function(){UIEdit.current.hs.node.removeClass("element_selected"),UIEdit.current=null},select:function(e){UIEdit.current!==e&&(null!=UIEdit.current&&UIEdit.current.hs.node.removeClass("element_selected"),UIEdit.current=e,Cms.root.$refs.uiedit.open(e),e.hs.node.addClass("element_selected"))},updateCoords:function(e,t){$("#se_x").val(e),$("#se_y").val(t),SpotEdit.current.hs.indicator.look_x=e,SpotEdit.current.hs.indicator.look_y=t},save:function(){UIEdit.current.hs.videourl=$("#uie_videourl").val(),UIEdit.current.hs.build()},remove:function(){confirm("Czy na pewno chcesz usunąć tą tabliczkę ?")&&(SpotEdit.current.hs.remove(),$("#SpotEditor").removeClass("open"),void 0!=SpotEdit.current.hs.indicator.id&&null!=SpotEdit.current.hs.indicator.id&&SpotEdit.current.hs.indicator.id>0&&$.get("/cms/index.php?mod=Panorama&action=removeind&ajax=1&pano="+player.ident+"&id="+SpotEdit.current.hs.indicator.id,function(e){console.log(e)}))},placeReady:function(e){},process:function(){},selectMedia:function(){$("#uie_media").click()},uploadfile:function(e){var t;this.input=$("#uie_media").get(0),this.uploading=!0,this.upfiles=this.input.files,this.progress=0;var t=this.upfiles[0],i=this;$.ajax({url:"/uploadres.php?fileName="+t.name+"&mimeType="+t.type,type:"POST",data:t,processData:!1,contentType:t.type,success:function(e){},error:function(e){alert("Unable to upload file "+t.name)},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload?e.upload.addEventListener("progress",function(e){i.progress=e.loaded/e.total*100,i.progress<100?$("#uie_console").html("Uploading "+i.progress+"%"):$("#uie_console").html("Processing ... Please wait.")},!1):console.log("Upload progress is not supported."),e}})}};PluginManager.add(UIEdit);var SpotDesc={node:null,current:2048,audio:null,icon:null,isMuted:!1,lastDesc:null,init:function(){SpotDesc.node=$("<div id='spotdesc'><span class='title'></span><a class='x speaks' data-speak='PLAYER.CLOSE' data-speakgroup='TIPS' href='#' onclick='SpotDesc.hide();'>×</a><div class='cnt'><div class='txt'></div></div></div>"),$("#overlay").append(SpotDesc.node),AppEvent.on(player,"HOTSPOT.CREATED",function(e){"description"==e.properties.place.place_type&&(e.noMore(),e.preventShowingInfo=!0)}),AppEvent.on(player,"HOTSPOT.STARTLOOKING",SpotDesc.hotspot),AppEvent.on(player,"placeReady",function(e){SpotDesc.hide()}),AppEvent.on(player,"PLAYER.KEYUP",function(e){$("#spotdesc").hasClass("toggle")&&(player.blockBackspace=!0,("Escape"==e.key||"Backspace"==e.key)&&SpotDesc.hide())}),SpotDesc.lightbox=$("<div id='lightbox'><a class='x speaks' data-speak='PLAYER.CLOSE' data-speakgroup='TIPS' href='#'' onclick='SpotDesc.hideLightbox();'>×</a><img src='' width='100%'></div>"),$("#overlay").append(SpotDesc.lightbox)},hide:function(){$("#spotdesc").removeClass("toggle"),SpotDesc.hideLightbox(),SpotDesc.lastDesc=null},hideLightbox:function(){SpotDesc.lightbox.hide()},hotspot:function(e){if("description"==e.properties.place.place_type){if(e.noMore(),e.preventShowingInfo=!0,SpotDesc.lastDesc==e.properties.place.place_id)return $("#spotdesc").removeClass("toggle"),void(SpotDesc.lastDesc=null);$("#spotdesc").addClass("toggle"),$("#spotdesc .cnt .txt").html(e.properties.place.dd.description.autoLink({target:"_blank"})),setTimeout(function(){var t=$("#spotdesc .cnt .txt").height()+20;250>t?$("#spotdesc").css("height",t+60+"px"):t>250&&t<$(window).height()-100?$("#spotdesc").css("height",t+60+"px"):t>$(window).height()-200&&$("#spotdesc").css("height",$(window).height()-200+"px"),void 0!=e.properties.place.dd.action&&""!=e.properties.place.dd.action&&($("#spotdesc .cnt .txt img").css("cursor","pointer"),$("#spotdesc .cnt .txt img").on("click",function(){$.getJSON("placeloader.php?ident="+e.properties.place.dd.action,function(e){$(window).width()>=480&&SpotDesc.lightbox.css("width",$(window).width()-380+"px"),SpotDesc.lightbox.find("img").attr("src","../data/"+e.properties.image),SpotDesc.lightbox.show()})}))},350),SpotDesc.lastDesc=e.properties.place.place_id}else SpotDesc.hide()}};PluginManager.add(SpotDesc);var Variants={node:null,current:2048,init:function(){Variants.node=$("<div id='variants'></div>"),$("#overlay").append(Variants.node),AppEvent.on(player,"beforeLoad",function(e){Variants.stopcycle(),void 0!=player.params.v&&(player.variant=player.params.v,player.params.v=void 0)}),AppEvent.on(player,"placeReady",function(e){Variants.placeReady(e)})},placeReady:function(e){if("panorama"==player.current.place_type){if(void 0!=player.current.properties.hide_variants&&"1"==player.current.properties.hide_variants?$("#variants").hide():$("#variants").show(),Variants.node.html(""),variants={spring:{title:TPL.lng("html5.variants.spring","Wiosna"),has:!1},summer:{title:TPL.lng("html5.variants.summer","Lato"),has:!1},autumn:{title:TPL.lng("html5.variants.autumn","Jesień"),has:!1},winter:{title:TPL.lng("html5.variants.winter","Zima"),has:!1},summer2018:{title:TPL.lng("html5.variants.summer2018","Lato 2018"),has:!1},winter2011:{title:TPL.lng("html5.variants.winter2011","Zima 2011"),has:!1},after:{title:TPL.lng("html5.variants.after","Po rewitalizacji"),has:!1},before:{title:TPL.lng("html5.variants.before","Przed rewitalizacją"),has:!1},day:{title:TPL.lng("html5.variants.day","Dzień"),has:!1},night:{title:TPL.lng("html5.variants.night","Noc"),has:!1},v1:{title:TPL.lng("html5.variants.v1","Wariant 1"),has:!1},v2:{title:TPL.lng("html5.variants.v2","Wariant 2"),has:!1},v3:{title:TPL.lng("html5.variants.v3","Wariant 3"),has:!1},v4:{title:TPL.lng("html5.variants.v4","Wariant 4"),has:!1},v5:{title:TPL.lng("html5.variants.v5","Wariant 5"),has:!1},v6:{title:TPL.lng("html5.variants.v6","Wariant 6"),has:!1},v7:{title:TPL.lng("html5.variants.v7","Wariant 7"),has:!1},v8:{title:TPL.lng("html5.variants.v8","Wariant 8"),has:!1}},void 0!=player.current.variants){variants[player.current.variants.variant_main].has=!0;for(var t in player.current.variants.items)variants[player.current.variants.items[t].type].has=!0,void 0!=player.current.variants.items[t].ident&&(variants[player.current.variants.items[t].type].ident=player.current.variants.items[t].ident);var i="";for(var a in variants)i="",(player.variant==a||null==player.variant&&a==player.current.variants.variant_main)&&(i="active"),variants[a].has&&Variants.node.append($("<a href='javascript:void(null);' class='variant_option speaks "+i+"' onclick='Variants.switch(\""+a+'", '+variants[a].ident+")' data-speak='"+variants[a].title+"'  title='Zmień wersję panoramy na: "+variants[a].title+"'>"+variants[a].title+"</a>"));SpeechManager.enableSpeech("#variants",".speaks",0,"TOPMENU"),void 0!=player.current.properties.autocycle&&""!=player.current.properties.autocycle&&Variants.auto(JSON.parse(player.current.properties.autocycle),!0)}Variants.ident=player.ident}else $("#variants").hide()},"switch":function(e,t,i,a){player.turn_to=null;var n=player.currentView.renderer.rx,s=player.currentView.renderer.ry;HotSpotManager.setTransition(void 0),void 0!=t?player.load(t,n-90+4+","+-1*s):i?(player.currentView.loadSpots=!1,void 0!=player.currentView&&void 0!=player.currentView.clear&&player.currentView.clear(),void 0!=player.currentView&&null!=player.currentView&&null!=player.currentView.beforeLeave&&player.currentView.beforeLeave(),player.variant=e,player.currentView.leaving(),player.lastView=player.currentView,player.current.loadSpots=!1,player.current.showLoading=!1,player.currentView=new panoramaView(player.ident,player.current,player.half,player.turn_to),void 0!=a&&(player.currentView.renderer.opacityStep=a),player.currentView.renderer.rx=player.lastView.renderer.rx,player.currentView.renderer.ry=player.lastView.renderer.ry,null!=player.currentView&&player.currentView.load()):(player.variant=e,player.load(player.ident,n-90+4+","+-1*s))},auto:function(e,t){Variants.program=e,Variants.progloop=t,Variants.progindex=0,Variants.autocycle()},autocycle:function(){var e;if(void 0!=Variants.program[Variants.progindex].speed&&(e=.04*Variants.program[Variants.progindex].speed),Variants["switch"](Variants.program[Variants.progindex]["var"],null,!0,e),Variants.progindex++,Variants.progindex>Variants.program.length-1){if(!Variants.progloop)return;Variants.progindex=0}Variants.timeout=setTimeout(function(){Variants.autocycle()},Variants.program[Variants.progindex].delay)},stopcycle:function(){void 0!=Variants.timeout&&(clearTimeout(Variants.timeout),Variants.timeout=void 0)}};PluginManager.add(Variants),AudioElement.prototype.load=function(e){this.url=e},AudioElement.prototype.setVolume=function(e){document.getElementById(this.id).volume=e},AudioElement.prototype.play=function(){document.getElementById(this.id).src=this.url,document.getElementById(this.id).load(),document.getElementById(this.id).play()};var AudioManager={sounds:{},lastUrl:"",load:function(e){AudioManager.sounds.hasOwnProperty(e)||(AudioManager.sounds[e]=new AudioPlayer("speechtip"),AudioManager.sounds[e].loadSound(e))},play:function(e,t){return this.lastUrl!=e&&""!=this.lastUrl&&void 0!=AudioManager.sounds[this.lastUrl]&&AudioManager.sounds[this.lastUrl].stop(),AudioManager.sounds.hasOwnProperty(e)?(AudioManager.sounds[e].playWhenLoaded(),AudioManager.sounds[e].setVolume(t)):(AudioManager.load(e),AudioManager.sounds[e].playWhenLoaded(),AudioManager.sounds[e].setVolume(t)),this.lastUrl=e,AudioManager.sounds[e]},setAllVolumes:function(e){for(var t in AudioManager.sounds)AudioManager.sounds[t].setVolume(e)}};AudioPlayer.prototype.forceAudioElement=function(){this.audioApiSupport=!1,this.audioElement=new AudioElement(this.htmlAudioID)},AudioPlayer.prototype.loadSound=function(e){if(!this.audioApiSupport)return void this.audioElement.load(e);this.streamURL=e;var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",this.dataLoaded=!1;var i=this;t.onload=function(){i.context.decodeAudioData(t.response,function(e){i.buffer=e,i.dataLoaded=!0,null!=i.onDataLoaded&&i.onDataLoaded(),i.playAfterLoad&&i.play()},function(e){throw new Error(e)})},t.send()},AudioPlayer.prototype.setVolume=function(e){return this.volume=e,this.audioApiSupport?void(void 0!=this.volumeNode&&(this.volumeNode.gain.value=this.volume)):void this.audioElement.setVolume(e)},AudioPlayer.prototype.play=function(){if(!this.audioApiSupport)return void this.audioElement.play();this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.volumeNode=this.context.createGain(),this.volumeNode.gain.value=this.volume,this.source.connect(this.volumeNode),this.volumeNode.connect(this.context.destination),this.source.loop=!1;try{this.source.noteOn(0)}catch(e){this.source.start(0)}},AudioPlayer.prototype.playWhenLoaded=function(){return this.audioApiSupport?void(this.dataLoaded?this.play():this.playAfterLoad=!0):void this.audioElement.play()},AudioPlayer.prototype.stop=function(){void 0!=this.source&&this.source.stop()},AudioPlayer.prototype.pause=function(){this.source.suspend()},AudioPlayer.prototype.resume=function(){this.source.resume()};var SpeechManager={speechFile:"",tapPlay:!1,paused:!1,loader:null,notVisible:!1,isMuted:!1,selectingLang:!1,hovering:[],tipPlayer:null,currentSpeech:null,init:function(){AppEvent.on(player,"afterLoad",SpeechManager.afterLoad),AppEvent.on(player,"placeReady",SpeechManager.placeReady),SpeechManager.icon=$("<div class='speech_widget'><a href='javascript:void(null);' title='Kliknij aby odsłuchać lektora' onclick='SpeechManager.speak();'><img src='assets/lector2.png' id='lector_icon' width='45'></a></div>"),SpeechManager.cloader=$("<canvas id='spm_loader' width='54' height='52'></canvas>"),$("#overlay").append(SpeechManager.cloader),$("#overlay").append(SpeechManager.icon),AppEvent.on(player,"BOTTOMBAR.TOGGLE",SpeechManager.bottomBar),AppEvent.on(player,"MENU.INFOWINDOW.TOGGLE",SpeechManager.infowindow),AppEvent.on(player,"SOUND.MUTED",function(e){if(Volume.lektor.isMuted()){SpeechManager.isMuted=!0;var t=document.getElementById("speech");t.muted=SpeechManager.isMuted}}),AppEvent.on(player,"VOLUME.SET",function(){var e=document.getElementById("speech");e.volume=Volume.currentSpeechVolume()}),AppEvent.on(player,"SOUND.UNMUTED",function(e){if(!Volume.lektor.isMuted()){SpeechManager.isMuted=!1;var t=document.getElementById("speech");t.muted=SpeechManager.isMuted}}),AppEvent.on(player,"AUTOPLAY.STARTED",function(e){var t=document.getElementById("speech");SpeechManager.hasSpeech()&&t.pause()}),AppEvent.on(Autoplay,"AUTOPLAY.FINISHED",function(e){var t=document.getElementById("speech");t.pause(),SpeechManager.hasSpeech()&&(t.currentTime=0)}),AppEvent.on(Autoplay,"AUTOPLAY.PAUSED",function(e){var t=document.getElementById("speech");SpeechManager.hasSpeech()&&t.pause()}),AppEvent.on(Autoplay,"AUTOPLAY.RESUMED",function(e){var t=document.getElementById("speech");SpeechManager.hasSpeech()&&t.play()}),AppEvent.on(LanguageMenu,"LANGSELECTION.SHOW",function(){SpeechManager.selectingLang=!0}),AppEvent.on(player,"VOLUME.SET",function(){AudioManager.setAllVolumes(Volume.currentTipVolume())}),SpeechManager.enableSpeech("#hotspots",".speaks",0,"HOTSPOT")},pause:function(){var e=document.getElementById("speech");SpeechManager.hasSpeech()&&e.pause()},resume:function(){var e=document.getElementById("speech");SpeechManager.hasSpeech()&&e.play()},infowindow:function(e){e?(SpeechManager.icon.addClass("slide"),SpeechManager.cloader.addClass("slide")):(SpeechManager.icon.removeClass("slide"),SpeechManager.cloader.removeClass("slide"))},hideWidget:function(e){SpeechManager.hasSpeech()&&(e?($("#spm_loader").css("display","none"),$(".speech_widget").css("display","none")):($("#spm_loader").css("display","inline"),$(".speech_widget").css("display","block")))},bottomBar:function(e){SpeechManager.notVisible=!e.display,void 0!=SpeechManager.speechFile&&""!=SpeechManager.speechFile&&(e.display?(SpeechManager.icon.show(),SpeechManager.cloader.show()):(SpeechManager.icon.hide(),SpeechManager.cloader.hide()))},afterLoad:function(e){(void 0==e.desc_speech||""==e.desc_speech)&&void 0!=e.parentplace&&void 0!=e.parentplace.desc_speech&&""!=e.parentplace.desc_speech.trim()&&(e.desc_speech=e.parentplace.desc_speech),
SpeechManager.speechFile!=e.desc_speech&&(SpeechManager.speechFile=e.desc_speech,$("#lector_icon").attr("class",""),$("#lector_icon").attr("src","assets/lector2.png"),SpeechManager.tapPlay=!1,void 0!=SpeechManager.speechFile&&""!=SpeechManager.speechFile?(AppEvent.on(player,"onProcess",SpeechManager.process),SpeechManager.notVisible||"0"==e.folder.speech||(SpeechManager.icon.show(),SpeechManager.cloader.show()),SpeechManager.loader=new CLoader("spm_loader"),SpeechManager.loader.style.thickness=4,"0"==e.folder.speech||void 0!=e.speech&&"click"==e.speech.autostart||SpeechManager.speak(),Music.pingMute()):(SpeechManager.icon.hide(),SpeechManager.cloader.hide(),void 0!=e.speech&&"force"==e.speech.silencemode&&document.getElementById("speech").pause()))},placeReady:function(){},hasSpeech:function(){return""!=SpeechManager.speechFile&&void 0!=SpeechManager.speechFile?!0:!1},speaks:function(){return SpeechManager.tapPlay},speak:function(){if(SpeechManager.tapPlay||!SpeechManager.hasSpeech()||SpeechManager.selectingLang){var e=document.getElementById("speech");e.muted=SpeechManager.isMuted,e.paused?($("#lector_icon").attr("class",""),$("#lector_icon").attr("src","assets/lector_playing.png"),e.play()):($("#lector_icon").attr("class",""),$("#lector_icon").attr("src","assets/lector.png"),e.pause())}else $("#lector_icon").attr("src","assets/uploading.png"),$("#lector_icon").attr("class","blink"),player.offline?document.getElementById("speech").src="data"+SpeechManager.speechFile:document.getElementById("speech").src=SpeechManager.speechFile,void 0!=SpeechManager.tipPlayer&&SpeechManager.tipPlayer.stop(),document.getElementById("speech").load(),document.getElementById("speech").addEventListener("canplay",function(){$("#lector_icon").attr("class",""),$("#lector_icon").attr("src","assets/lector.png")}),document.getElementById("speech").addEventListener("ended",function(){$("#lector_icon").attr("src","assets/lector.png"),AppEvent.trigger(SpeechManager,"SPEECH.FINISHED",{}),SpeechManager.tapPlay=!1}),document.getElementById("speech").play(),SpeechManager.tapPlay=!0},prepareTip:function(e,t){var i="",a=void 0;void 0!=LanguageMenu.data&&(a=LanguageMenu.data.lang),void 0==a&&(a="PL"),"TIPS"!=t||player.offline||(i="/sounds/tips/"+a+"_"+e+".mp3"),"TOPMENU"!=t||player.offline||(i="/text2speech.php?grp=topmenu&lng="+a+"&text="+e+".mp3"),"TIPS"==t&&player.offline&&(i="sounds/tips/"+a+"_"+e+".mp3"),AudioManager.load(i)},speakTip:function(e,t){var i="",a=void 0;Music.isMuted||(void 0!=LanguageMenu.data&&(a=LanguageMenu.data.lang),(void 0==a||null==a||""==a)&&(a="PL"),"TIPS"!=t||player.offline||(i="/sounds/tips/"+a+"_"+e+".mp3"),"TOPMENU"!=t||player.offline||(i="/text2speech.php?grp=topmenu&folder="+player.folder+"&lng="+a+"&text="+e+".mp3"),"TIPS"==t&&player.offline&&(i="sounds/tips/"+a+"_"+e+".mp3"),"TOPMENU"==t&&player.offline&&"PL"==a&&(i="sounds/topmenu/"+e+".mp3"),SpeechManager.tipPlayer=AudioManager.play(i,Volume.currentTipVolume()))},process:function(){if(SpeechManager.tapPlay&&!Autoplay.running()){var e=document.getElementById("speech");e.paused||SpeechManager.loader.progress(e.currentTime/e.duration),!e.paused&&e.currentTime>0&&"assets/lector_playing.png"!=$("#lector_icon").attr("src")&&($("#lector_icon").attr("src","assets/lector_playing.png"),$("#lector_icon").attr("class",""))}else SpeechManager.loader.progress(0)},enableSpeech:function(e,t,i,a){void 0==a&&(a="TOPMENU"),1==i&&$(e).find(t).each(function(e){var t=$(this),i=t.attr("data-speak");void 0!=i&&SpeechManager.prepareTip(i,t.attr("data-speakgroup"))}),$(e).on("mouseout blur",t,function(e){var t=$(this);"focusout"==e.type&&Date.now()-player.lastTabTime>1e3||(SpeechManager.currentSpeech=null,void 0!=SpeechManager.hovering[t.attr("data-speak")]&&null!=SpeechManager.hovering[t.attr("data-speak")]&&clearTimeout(SpeechManager.hovering[t.attr("data-speak")]))}),$(e).on("mouseover focus speaks",t,function(e){var t=$(this),i=(Date.now(),a),n=document.getElementById("speech");n.paused&&("focusin"==e.type&&Date.now()-player.lastTabTime>1e3||(null==SpeechManager.currentSpeech||SpeechManager.currentSpeech!=t.attr("data-speak"))&&(void 0!=t.attr("data-speakgroup")&&(i=t.attr("data-speakgroup")),SpeechManager.hovering[t.attr("data-speak")]=setTimeout(function(){SpeechManager.speakTip(t.attr("data-speak"),i),SpeechManager.hovering[t.attr("data-speak")]=null},500),SpeechManager.currentSpeech=t.attr("data-speak"),e.stopPropagation()))})}};PluginManager.add(SpeechManager);var WCompass={node:null,init:function(){WCompass.node=$("<div id='compass'></div>"),WCompass.node.append(TPL.render("compass-main",{})),$("#overlay").append(WCompass.node),AppEvent.on(player,"placeReady",function(e){WCompass.placeReady(e)}),AppEvent.on(player,"onProcess",function(){WCompass.process()}),AppEvent.on(player,"BOTTOMBAR.TOGGLE",function(e){WCompass.toggle(e)})},placeReady:function(e){"panorama"==player.current.place_type?$("#compass").show():$("#compass").hide()},process:function(){if("panorama"==player.current.place_type){var e=player.currentView.getRX();e=360-e+90;try{e+=parseFloat(player.current.properties.north)}catch(t){}$("#carrow").css("transform","rotate("+e+"deg)")}},toggle:function(e){"panorama"==player.current.place_type&&(console.log("TOGGLE"),e.display?$("#compass").show():$("#compass").hide())}};PluginManager.add(WCompass);var Wcag={node:null,isActive:!1,textVisible:!1,couting:null,init:function(){var e="#";void 0!=window.PROJECT.settings["accessibility/docurl"]&&""!=window.PROJECT.settings["accessibility/docurl"]&&(e=window.PROJECT.settings["accessibility/docurl"]),Wcag.node=$(TPL.render("wcag-main",{docurl:e,showdoc:"#"!=e?!0:!1}));var t=0,i=!1,a=!1;"1"==window.PROJECT.settings["accessibility/blindoff"]&&(Wcag.node.find(".blind-btn").hide(),i=!0,t+=60),"1"==window.PROJECT.settings["accessibility/wcagoff"]&&(Wcag.node.find(".wcag-btn").hide(),Wcag.node.find(".blind-btn").css("right","10px"),t+=60,a=!0),t>0&&$("#overlay .tray").css("right",130-t+"px"),$("#panels").append(Wcag.node),Wcag.node.find(".wcag-btn").on("click",Wcag.toggle),setTimeout(function(){Wcag.node.find(".wcag-btn").attr("title",TPL.lng("tips.wcagtitle","Informacje dla niepełnosprawnych WCAG 2.1")),Wcag.node.find(".blind-btn").attr("title",TPL.lng("tips.blindtitle","Wersja dla niewidomych"))},1e3),Wcag.node.find(".blind-btn").on("click",function(){document.location="/text"}),$(Comments).on("shown",function(){Wcag.node.find(".wcag-btn").css("right","360px")}),$(Comments).on("hide",function(){Wcag.node.find(".wcag-btn").css("right","")}),(void 0==window.PROJECT.settings["accessibility/docoff"]||"1"!=window.PROJECT.settings["accessibility/docoff"])&&(void 0!=window.PROJECT.settings["accessibility/docurl"]&&""!=window.PROJECT.settings["accessibility/docurl"]?(Wcag.button=$("<a href='"+window.PROJECT.settings["accessibility/docurl"]+"' target='_blank' class='deklaracjabutton' data-speak='PLAYER.DEKLARACJA' data-speakgroup='TIPS' title='"+TPL.lng("deklaracja_button","Deklaracja dostępności")+"'>"+TPL.lng("deklaracja_button","Deklaracja dostępności")+"</a>"),Screen.xs()||$("#overlay .tray").prepend(Wcag.button),Tab.add("bottom",Tab.simpleTab($(".deklaracjabutton"),20),{})):(Wcag.button=$("<a href='javascript:void(null);' class='deklaracjabutton disabled' data-speak='PLAYER.DEKLARACJA' data-speakgroup='TIPS' title='"+TPL.lng("deklaracja_button","Deklaracja dostępności")+"'>"+TPL.lng("deklaracja_button","Deklaracja dostępności")+"</a>"),Screen.xs()||$("#overlay .tray").prepend(Wcag.button))),a||Tab.add("bottom",Tab.simpleTab($(".wcag-btn"),26),{}),i||Tab.add("bottom",Tab.simpleTab($(".blind-btn"),25),{})},toggle:function(){Wcag.toggletext(),Wcag.isActive?Wcag.isActive=!1:Wcag.isActive=!0},preventKeys:function(e){return e.stopPropagation(),!1},toggletext:function(){Wcag.textVisible?Wcag.closetext():Wcag.opentext()},opentext:function(){Wcag.textVisible=!0,Wcag.node.find(".wcag-info").addClass("wcag-info-show")},closetext:function(){Wcag.textVisible=!1,Wcag.node.find(".wcag-info").removeClass("wcag-info-show")},placeReady:function(e){}};PluginManager.add(Wcag);var VideoView={node:null,self:this,l:{close:TPL.lng("close.movie","Zamknij film")},close:function(){void 0!=VideoView.idleReset&&(clearInterval(VideoView.idleReset),VideoView.idleReset=void 0),Menu.hideInfoIcon(!1),SpeechManager.hideWidget(!1),Volume.lektor.mute(!1),VideoView.self.media.vnode.pause(),VideoView.node.removeClass("inph_reveal"),$(".nav").show(),VideoView.spot.preventShowingInfo=!1},showInfo:function(e){var t=$("#invideoview .photo").offset();Menu.showinfowindow({description:VideoView.spot.properties.place.description,indicators:[],properties:{info_left:t.left+50,info_top:t.top,info_width:"700",info_height:"400"}}),e.stopPropagation()},init:function(){VideoView.node=$("<div id='invideoview'><div class='bg'></div><div class='photo'><div class='video'></div><div class='clear'></div></div></div>"),VideoView.l.close=TPL.lng("close.movie","Zamknij film"),VideoView.node.find(".bg").on("click",function(){}),$("#overlay").append(VideoView.node),this.closeBtn=$("<div><img src='assets/menu_close.png' data-speakgroup='TIPS' data-speak='PLAYER.CLOSE' alt='"+this.l.close+"' title='"+this.l.close+"' width='50' height='50' style='z-index:99999;position:absolute;right:-25px;top:-25px;cursor:pointer;pointer-events:all;' class='speaks'></div>"),VideoView.node.find(".photo").append(this.closeBtn),this.closeBtn.on(Events.pointer.up,function(){VideoView.close()}),SpeechManager.enableSpeech("#invideoview",".speaks",0,"TOPMENU"),AppEvent.on(player,"HOTSPOT.STARTLOOKING",VideoView.hotspot),AppEvent.on(player,"PLAYER.KEYUP",function(e){VideoView.node.hasClass("inph_reveal")&&(player.blockBackspace=!0,("Escape"==e.key||"Backspace"==e.key)&&VideoView.close()," "==e.key&&VideoView.self.media.toggle())}),Tab.add("hotspots",Tab.simpleTab(this.closeBtn,0),{})},hotspot:function(e){if("video"==e.properties.place.place_type&&("1"==e.properties.place.preview_mode||"2"==e.properties.place.preview_mode)){e.noMore(),e.preventShowingInfo=!0,Menu.hideInfoIcon(!0),SpeechManager.hideWidget(!0),Volume.lektor.mute(!0),VideoView.spot=e;var t=VideoView.node.find(".info");"2"==e.properties.place.preview_mode?(t.html(""),t.show(),t.append("<h4>"+e.properties.place.place_name+"</h4>"),t.append("<div>"+e.properties.place.description+"</div>")):(t.html(""),t.hide()),VideoView.node.find(".photo").removeClass("hphoto"),VideoView.node.find(".photo").removeClass("vphoto"),VideoView.node.find(".loader").show(),this.media=new vplayer,this.media.fitScreen(200,150),VideoView.node.find(".photo .video").html(""),VideoView.node.find(".photo .video").append(this.media.embed());var i=$("<a href='javascript:void(null);' onclick='VideoView.showInfo(event);' class='ibutton'  title='"+TPL.lng("tips.placeinfo","Informacja o miejscu")+"'><i class='fa fa-info' aria-hidden='true'></i></a>");VideoView.node.find(".screen-ctl").append(i),player.offline&&(e.properties.place.video=e.properties.place.video.replace("/data","data")),this.media.load(e.properties.place.video),this.media.playButton(null),this.media.setTitle(e.properties.place.place_name),VideoView.node.addClass("inph_reveal"),VideoView.idleReset=setInterval(function(){player.cancelIdle()},2e3)}}};PluginManager.add(VideoView);
//# sourceMappingURL=_debug/js/wkraj_player.js.map
